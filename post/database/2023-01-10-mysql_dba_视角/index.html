<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="MySQL DBAËßÜËßí - https://hobocat.github.io/post/database/2023-01-10-mysql_dba_%E8%A7%86%E8%A7%92/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>MySQL DBAËßÜËßí</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">MySQL DBAËßÜËßí</h1>
    
        
        
            <div id="toc">üìú</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2023-01-10&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2023-01-10&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            25519 Â≠ó</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            51 ÂàÜÈíü</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/database">database</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1mysqlÈÉ®ÁΩ≤ÂâçÂáÜÂ§á">1„ÄÅMySQLÈÉ®ÁΩ≤ÂâçÂáÜÂ§á</a></li>
    <li><a href="#2mysql80‰∫åËøõÂà∂ÂÆâË£ÖËøáÁ®ã">2„ÄÅMySQL8.0‰∫åËøõÂà∂ÂÆâË£ÖËøáÁ®ã</a></li>
    <li><a href="#3mysql‰ΩìÁ≥ªÊÄªËßà">3„ÄÅMySQL‰ΩìÁ≥ªÊÄªËßà</a>
      <ul>
        <li><a href="#Êû∂ÊûÑ‰ªãÁªç">Êû∂ÊûÑ‰ªãÁªç</a></li>
        <li><a href="#Á∫øÁ®ã‰ªãÁªç">Á∫øÁ®ã‰ªãÁªç</a></li>
        <li><a href="#mysql-80-innodbÁªìÊûÑ">MySQL 8.0 InnodbÁªìÊûÑ</a></li>
        <li><a href="#Â≠òÂÇ®ÁªìÊûÑ">Â≠òÂÇ®ÁªìÊûÑ</a></li>
        <li><a href="#Á≥ªÁªüÂ∫ìË°®‰ªãÁªç">Á≥ªÁªüÂ∫ìË°®‰ªãÁªç</a></li>
      </ul>
    </li>
    <li><a href="#4mysqlÁöÑÊó•Â∏∏ÁÆ°ÁêÜ">4„ÄÅMySQLÁöÑÊó•Â∏∏ÁÆ°ÁêÜ</a>
      <ul>
        <li><a href="#Áî®Êà∑ÁÆ°ÁêÜ">Áî®Êà∑ÁÆ°ÁêÜ</a></li>
        <li><a href="#ÊùÉÈôêÁÆ°ÁêÜ">ÊùÉÈôêÁÆ°ÁêÜ</a></li>
      </ul>
    </li>
    <li><a href="#5mysqlÁ≥ªÁªüÁöÑÊó•Âøó">5„ÄÅMySQLÁ≥ªÁªüÁöÑÊó•Âøó</a>
      <ul>
        <li><a href="#Êó•ÂøóÁ±ªÂûã">Êó•ÂøóÁ±ªÂûã</a></li>
        <li><a href="#Êó•ÂøóÂèÇÊï∞Êü•ËØ¢ËÆæÁΩÆ">Êó•ÂøóÂèÇÊï∞Êü•ËØ¢ËÆæÁΩÆ</a></li>
      </ul>
    </li>
    <li><a href="#6sqlÁü•ËØÜÁõ∏ÂÖ≥">6„ÄÅSQLÁü•ËØÜÁõ∏ÂÖ≥</a>
      <ul>
        <li><a href="#sql_mode">SQL_MODE</a></li>
        <li><a href="#ÂàóÁöÑÊï∞ÊçÆÁ±ªÂûã">ÂàóÁöÑÊï∞ÊçÆÁ±ªÂûã</a></li>
        <li><a href="#Â∏∏Áî®ÂáΩÊï∞">Â∏∏Áî®ÂáΩÊï∞</a></li>
      </ul>
    </li>
    <li><a href="#7Á¥¢ÂºïÊâßË°åËÆ°Âàí">7„ÄÅÁ¥¢Âºï&amp;ÊâßË°åËÆ°Âàí</a>
      <ul>
        <li><a href="#sqlÁöÑÊâßË°åÊµÅÁ®ã">SQLÁöÑÊâßË°åÊµÅÁ®ã</a></li>
        <li><a href="#Á¥¢Âºï">Á¥¢Âºï</a></li>
        <li><a href="#ÊâßË°åËÆ°Âàí">ÊâßË°åËÆ°Âàí</a></li>
        <li><a href="#‰ºòÂåñÂô®ÈíàÂØπÁ¥¢ÂºïÁöÑÁÆóÊ≥ï">‰ºòÂåñÂô®ÈíàÂØπÁ¥¢ÂºïÁöÑÁÆóÊ≥ï</a></li>
        <li><a href="#Ë°®ËøûÊé•ÁÆóÊ≥ï">Ë°®ËøûÊé•ÁÆóÊ≥ï</a></li>
      </ul>
    </li>
    <li><a href="#8innodb-Â≠òÂÇ®ÂºïÊìé">8„ÄÅInnoDB Â≠òÂÇ®ÂºïÊìé</a>
      <ul>
        <li><a href="#Ê†∏ÂøÉÁâπÊÄßÊÄªËßà">Ê†∏ÂøÉÁâπÊÄßÊÄªËßà</a></li>
        <li><a href="#Â≠òÂÇ®ÂºïÊìéÁöÑÁÆ°ÁêÜ">Â≠òÂÇ®ÂºïÊìéÁöÑÁÆ°ÁêÜ</a></li>
        <li><a href="#Ë°®Á©∫Èó¥">Ë°®Á©∫Èó¥</a></li>
        <li><a href="#Ë°åÊ†ºÂºè">Ë°åÊ†ºÂºè</a></li>
        <li><a href="#È°µÁªìÊûÑ">È°µÁªìÊûÑ</a></li>
        <li><a href="#Êó•Âøó‰∏éÊï∞ÊçÆÂà∑Êñ∞">Êó•Âøó‰∏éÊï∞ÊçÆÂà∑Êñ∞</a></li>
        <li><a href="#innodb-‰∫ãÂä°ËØ¶Ëß£"><strong>InnoDB</strong> ‰∫ãÂä°ËØ¶Ëß£</a></li>
        <li><a href="#innodb-ÈîÅÊú∫Âà∂">InnoDB ÈîÅÊú∫Âà∂</a></li>
        <li><a href="#‰∏çÂêåÊÉÖÂÜµ‰∏ãÁöÑÈîÅÂ§ÑÁêÜÁ§∫‰æã">‰∏çÂêåÊÉÖÂÜµ‰∏ãÁöÑÈîÅÂ§ÑÁêÜÁ§∫‰æã</a></li>
        <li><a href="#mvcc-Â§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂">MVCC Â§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂</a></li>
        <li><a href="#rrÁ∫ßÂà´‰∏ãÂΩìÂâçËØªÁöÑÂπªËØªÈóÆÈ¢ò">RRÁ∫ßÂà´‰∏ãÂΩìÂâçËØªÁöÑÂπªËØªÈóÆÈ¢ò</a></li>
      </ul>
    </li>
    <li><a href="#9Â§á‰ªΩÊÅ¢Â§ç‰∏éËøÅÁßª">9„ÄÅÂ§á‰ªΩÊÅ¢Â§ç‰∏éËøÅÁßª</a>
      <ul>
        <li><a href="#binlog-Êó•ÂøóÁöÑÊ†ºÂºè">binlog Êó•ÂøóÁöÑÊ†ºÂºè</a></li>
        <li><a href="#gtid">GTID</a></li>
        <li><a href="#binlogÊìç‰Ωú">binlogÊìç‰Ωú</a></li>
        <li><a href="#slow-logÁöÑÊü•Áúã">slow logÁöÑÊü•Áúã</a></li>
        <li><a href="#Áâ©ÁêÜÂ§á‰ªΩ">Áâ©ÁêÜÂ§á‰ªΩ</a></li>
        <li><a href="#clone-plugin">Clone Plugin</a></li>
      </ul>
    </li>
    <li><a href="#10ÂêÑÁßçÊû∂ÊûÑ‰ΩìÁ≥ª">10„ÄÅÂêÑÁßçÊû∂ÊûÑ‰ΩìÁ≥ª</a></li>
    <li><a href="#ÈôÑÂΩï">ÈôÑÂΩï</a>
      <ul>
        <li><a href="#80ÁâàÊú¨Áõ∏ÂØπ‰∫é57ÁâàÊú¨ÁöÑÂèòÂåñ">8.0ÁâàÊú¨Áõ∏ÂØπ‰∫é5.7ÁâàÊú¨ÁöÑÂèòÂåñ</a></li>
        <li><a href="#ÂêÑÁâàÊú¨innodbË°®Êñá‰ª∂ÁªìÊûÑÁöÑÂèòÂåñ">ÂêÑÁâàÊú¨InnoDBË°®Êñá‰ª∂ÁªìÊûÑÁöÑÂèòÂåñ</a></li>
        <li><a href="#mysql57ÂçáÁ∫ßÂà∞80">MySQL5.7ÂçáÁ∫ßÂà∞8.0</a></li>
        <li><a href="#innodb-undoredoÂú®Â¢ûÂà†ÊîπÊìç‰ΩúÊó∂ÁöÑÂ∑•‰Ωú">InnoDB Undo„ÄÅRedoÂú®Â¢ûÂà†ÊîπÊìç‰ΩúÊó∂ÁöÑÂ∑•‰Ωú</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="1mysqlÈÉ®ÁΩ≤ÂâçÂáÜÂ§á">1„ÄÅMySQLÈÉ®ÁΩ≤ÂâçÂáÜÂ§á</h2>
<ul>
<li>
<p>ÂÖ≥Èó≠NUMA</p>
<p>NUMAÔºàNon-Uniform Memory AccessÔºåÈùû‰∏ÄËá¥ÊÄßÂÜÖÂ≠òËÆøÈóÆÔºâÊúçÂä°Âô®ÁöÑÂü∫Êú¨ÁâπÂæÅÊòØ Linux Â∞ÜÁ≥ªÁªüÁöÑÁ°¨‰ª∂ËµÑÊ∫êÂàíÂàÜ‰∏∫Â§ö‰∏™ËΩØ‰ª∂ÊäΩË±°ÔºåÁß∞‰∏∫ËäÇÁÇπ„ÄÇÊØè‰∏™ËäÇÁÇπ‰∏äÊúâÂçïÁã¨ÁöÑ CPU„ÄÅÂÜÖÂ≠òÂíå I/O ÊßΩÂè£Á≠â„ÄÇCPU ËÆøÈóÆËá™Ë∫´ Node ÂÜÖÂ≠òÁöÑÈÄüÂ∫¶Â∞ÜËøúËøúÈ´ò‰∫éËÆøÈóÆËøúÂú∞ÂÜÖÂ≠òÔºàÁ≥ªÁªüÂÜÖÂÖ∂ÂÆÉËäÇÁÇπÁöÑÂÜÖÂ≠òÔºâÁöÑÈÄüÂ∫¶ÔºåËøô‰πüÊòØÈùû‰∏ÄËá¥ÂÜÖÂ≠òËÆøÈóÆ NUMA ÁöÑÁî±Êù•„ÄÇ</p>
<p>ÁÆÄÂçïÊù•ÊØîÊñπÂ∞±ÊòØÂ¶ÇÊûúÊòØ8GÂÜÖÂ≠òÔºå4Ê†∏CPUÔºåÈÇ£‰πà‰∏Ä‰∏™Ê†∏ÂøÉÂàÜÂæó2GÂÜÖÂ≠òÔºåÂáèÂ∞ëÂÖ±‰∫´ÂÜÖÂ≠òÂ∏¶Êù•ÁöÑËµÑÊ∫ê‰∫âÂ§∫„ÄÇ‰ΩÜÊòØMySQLÂàÜÈÖç‰∫Ü6GÂÜÖÂ≠ò„ÄÇÊüê‰∫õÁ∫øÁ®ãË∂ÖÂá∫ËäÇÁÇπÊú¨Âú∞ÂÜÖÂ≠òÈÉ®ÂàÜ‰ºöË¢´ SWAP Âà∞Á£ÅÁõò‰∏äÔºåËÄå‰∏çÊòØ‰ΩøÁî®ÂÖ∂‰ªñËäÇÁÇπÁöÑÁâ©ÁêÜÂÜÖÂ≠òÔºåÂºïÂèëÊÄßËÉΩÈóÆÈ¢ò„ÄÇ</p>
<pre tabindex="0"><code>biosÁ∫ßÂà´ÂÖ≥Èó≠„ÄêÊé®Ëçê„Äë
Âú®biosÂ±ÇÈù¢numaÂÖ≥Èó≠Êó∂ÔºåÊó†ËÆ∫osÂ±ÇÈù¢ÁöÑnumaÊòØÂê¶ÊâìÂºÄÔºåÈÉΩ‰∏ç‰ºöÂΩ±ÂìçÊÄßËÉΩ„ÄÇ‰∏ÄËà¨Âú®biosÁöÑAdvanced‰∏ã

‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§ÂèØ‰ª•Êü•ÁúãnumactlÊòØÂê¶Ë¢´ÂÖ≥Èó≠
numactl --hardware
available: 1 nodes (0) #Â¶ÇÊûúÊòØ2ÊàñÂ§ö‰∏™nodesÂ∞±ËØ¥ÊòénumaÊ≤°ÂÖ≥Êéâ
============================================================================
OSÁ∫ßÂà´ÂÖ≥Èó≠
Ê≥®ÊÑèÔºöÂú®osÂ±ÇnumaÂÖ≥Èó≠Êó∂,biosÂ±ÇÊòØÊâìÂºÄÁöÑËØù‰ºöÂΩ±ÂìçÊÄßËÉΩÔºåQPS‰ºö‰∏ãÈôç15-30%;
vi /boot/grub2/grub.cfg

ÊâæÂà∞Âπ∂ÂÆâË£ÖÂ¶Ç‰∏ãËÆæÁΩÆnuma=off
kernel /boot/vmlinuz-2.6.18-128.1.16.0.1.el5 root=LABEL=DBSYS ro bootarea=dbsys
rhgb quiet console=ttyS0,115200n8 console=tty1 crashkernel=128M@16M numa=off
initrd /boot/initrd-2.6.18-128.1.16.0.1.el5.img
============================================================================
Êï∞ÊçÆÂ∫ìÁ∫ßÂà´ÂÖ≥Èó≠
mysql&gt; show variables like &#39;%numa%&#39;;
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| innodb_numa_interleave | OFF   |
+------------------------+-------+
ÊàñËÄÖ‰øÆÊîπetc/init.d/mysqld
Â∞Ü$bindir/mysqld_safe --datadir=&#34;$datadir&#34;Ëøô‰∏ÄË°å‰øÆÊîπ‰∏∫Ôºö
/usr/bin/numactl --interleave all $bindir/mysqld_safe --datadir=&#34;$datadir&#34; --pid-file=&#34;$mysqld_pid_file_path&#34; $other_args &gt;/dev/null &amp; wait_for_pid created &#34;$!&#34; &#34;$mysqld_pid_file_path&#34;; return_value=$?
</code></pre></li>
<li>
<p>ÂºÄÂêØCPUÈ´òÊÄßËÉΩÊ®°Âºè</p>
<p>BiosËÆæÁΩÆOperator ModeËÆæÁΩÆ‰∏∫Maximum Performance</p>
</li>
<li>
<p>ÈòµÂàóÂç°RAIDÈÖçÁΩÆ</p>
<p>Âª∫ËÆÆÈÖçÁΩÆ‰∏∫raid10</p>
</li>
<li>
<p>ÂÖ≥Èó≠THP</p>
<p>THPÔºàtransparent_hugepageÔºâÂç≥ÂàÜÈÖçÂ§ßÈ°µÂÜÖÂ≠òÔºåMySQLÊúâËá™Â∑±ÁöÑÂÜÖÂ≠òÂàÜÈÖçÊú∫Âà∂„ÄÇ</p>
<pre tabindex="0"><code>chomd +x /etc/rc.d/rc.local
‰øÆÊîπ /etc/rc.local
Âú®Êñá‰ª∂Êú´Â∞æÊ∑ªÂä†Â¶Ç‰∏ãÊåá‰ª§
if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
fi
if test -f /sys/kernel/mm/transparent_hugepage/defrag; then
echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
fi

# Êü•Áúãtransparent hugepageÊòØÂê¶ÂÖ≥Èó≠
cat /sys/kernel/mm/transparent_hugepage/enabled
# ÊòæÁ§∫ËøôÊ†∑‰∏∫ÂÖ≥Èó≠ always madvise [never]
</code></pre></li>
<li>
<p>ÁΩëÂç°ÁªëÂÆö</p>
</li>
</ul>
<pre tabindex="0"><code>bondingÊäÄÊúØÔºå‰∏öÂä°Êï∞ÊçÆÂ∫ìÊúçÂä°Âô®ÈÉΩË¶ÅÈÖçÁΩÆbondingÁªßÁª≠„ÄÇÂª∫ËÆÆÊòØ‰∏ªÂ§áÊ®°Âºè„ÄÇ‰∫§Êç¢Êú∫‰∏ÄÂÆöË¶ÅÂ†ÜÂè†„ÄÇ
</code></pre><ul>
<li>
<p>Á≥ªÁªüÂ±ÇÈù¢ÂèÇÊï∞‰ºòÂåñ</p>
<pre tabindex="0"><code>Êõ¥ÊîπÊñá‰ª∂Âè•ÊüÑÂíåËøõÁ®ãÊï∞
‰øÆÊîπ /etc/sysctl.conf
vm.swappiness = 5                       # ‰∫§Êç¢ÂàÜÂå∫Ôºà‰πüÂèØ‰ª•ËÆæÁΩÆ‰∏∫0ÔºâÁöÑÊîªÂáªÊÄß„ÄÇËæÉÈ´òÁöÑÂÄº‰ºöÊõ¥ÊøÄËøõ
vm.dirty_ratio = 20                     # Êñá‰ª∂Á≥ªÁªüÁºìÂ≠òËÑèÈ°µÊï∞ÈáèËææÂà∞Á≥ªÁªüÂÜÖÂ≠òÁôæÂàÜ‰πãÂ§öÂ∞ëÊó∂ÔºåÁ≥ªÁªüÈòªÂ°ûÂ§ÑÁêÜÁºìÂ≠òËÑèÈ°µ
vm.dirty_background_ratio = 10          # Êñá‰ª∂Á≥ªÁªüÁºìÂ≠òËÑèÈ°µÊï∞ÈáèËææÂà∞Á≥ªÁªüÂÜÖÂ≠òÁôæÂàÜ‰πãÂ§öÂ∞ëÊó∂ÔºåÁ≥ªÁªüÂºÇÊ≠•Â§ÑÁêÜÁºìÂ≠òËÑèÈ°µ
net.ipv4.tcp_max_syn_backlog = 819200   # ÂçäËøûÊé•ÈòüÂàóÂ§ßÂ∞è
net.core.netdev_max_backlog = 400000    # ÂÜÖÊ†∏‰ªéÁΩëÂç°Êî∂Âà∞Êï∞ÊçÆÂåÖÂêéÔºå‰∫§Áî±ÂçèËÆÆÊ†àÔºàÂ¶ÇIP„ÄÅTCPÔºâÂ§ÑÁêÜ‰πãÂâçÁöÑÁºìÂÜ≤ÈòüÂàó
net.core.somaxconn = 4096               # ÊåáÊúçÂä°Á´ØÊâÄËÉΩacceptÂç≥Â§ÑÁêÜÊï∞ÊçÆÁöÑÊúÄÂ§ßÂÆ¢Êà∑Á´ØÊï∞ÈáèÔºåÂç≥ÂÆåÊàêËøûÊé•‰∏äÈôê
net.ipv4.tcp_tw_reuse=1                 # Ë°®Á§∫ÂºÄÂêØÈáçÁî®„ÄÇÂÖÅËÆ∏Â∞ÜTIME-WAIT socketsÈáçÊñ∞Áî®‰∫éÊñ∞ÁöÑTCPËøûÊé•ÔºåÈªòËÆ§‰∏∫0ÔºåË°®Á§∫ÂÖ≥Èó≠
net.ipv4.tcp_tw_recycle=0               # Ë°®Á§∫ÂºÄÂêØTCPËøûÊé•‰∏≠TIME-WAIT socketsÁöÑÂø´ÈÄüÂõûÊî∂ÔºåÈªòËÆ§‰∏∫0ÔºåË°®Á§∫ÂÖ≥Èó≠

=====================================================================
Èò≤ÁÅ´Â¢ô
Á¶ÅÁî®selinux
/etc/sysconfig/selinux Êõ¥ÊîπSELINUX=disabled.
iptablesÂ¶ÇÊûú‰∏ç‰ΩøÁî®ÂèØ‰ª•ÂÖ≥Èó≠„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÊâìÂºÄMySQLÈúÄË¶ÅÁöÑÁ´ØÂè£Âè∑

=====================================================================
Êñá‰ª∂Á≥ªÁªü‰ºòÂåñ
Êé®Ëçê‰ΩøÁî®XFSÊñá‰ª∂Á≥ªÁªü
MySQLÊï∞ÊçÆÂàÜÂå∫Áã¨Á´ã Ôºå‰æãÂ¶ÇÊåÇËΩΩÁÇπ‰∏∫: /data
fdisk /dev/sdb
‰æùÊ¨°ÂÆâË£ÖÊèêÁ§∫ÈîÆÂÖ•
p n l w

‰øÆÊîπ /etc/fstab Âä†ÂÖ•
/dev/sdb /data xfs defaults,noatime,nodiratime,nobarrier

- defaults    ÈªòËÆ§ÂÄºÂåÖÊã¨rw„ÄÅsuid„ÄÅdev„ÄÅexec„ÄÅauto„ÄÅnouserÂíåasync,Êñá‰ª∂ÊåÇËΩΩÈÖçÁΩÆÁöÑÂæàÂ§öÊÉÖÂÜµ‰∏ãÈÉΩ‰ΩøÁî®ÈªòËÆ§ÂÄº
- noatime     ‰∏çÊõ¥Êñ∞Êñá‰ª∂ËÆøÈóÆÊó∂Èó¥
- nodiratime  ‰∏çÊõ¥Êñ∞ÁõÆÂΩïËÆøÈóÆÊó∂Èó¥
- nobarrier   ‰∏çÂºÄÂêØbarrier

=====================================================================
‰∏ç‰ΩøÁî®LVM

=====================================================================
ioË∞ÉÂ∫¶
SAS: deadline
SSD&amp;PCI-E: noop   

- deadline ÂØπËØªÂÜôËØ∑Ê±ÇËøõË°å‰∫ÜÂàÜÁ±ªÁÆ°ÁêÜÔºåÂπ∂‰∏îÂú®Ë∞ÉÂ∫¶Â§ÑÁêÜÁöÑËøáÁ®ã‰∏≠ËØªËØ∑Ê±ÇÂÖ∑ÊúâËæÉÈ´ò‰ºòÂÖàÁ∫ß„ÄÇËøô‰∏ªË¶ÅÊòØÂõ†‰∏∫ËØªËØ∑Ê±ÇÂæÄÂæÄÊòØÂêåÊ≠•Êìç‰ΩúÔºåÂØπÂª∂ËøüÊó∂Èó¥ÊØîËæÉÊïèÊÑüÔºåËÄåÂÜôÊìç‰ΩúÂæÄÂæÄÊòØÂºÇÊ≠•Êìç‰ΩúÔºåÂèØ‰ª•Â∞ΩÂèØËÉΩÁöÑÂ∞ÜÁõ∏ÈÇªËÆøÈóÆÂú∞ÂùÄÁöÑËØ∑Ê±ÇËøõË°åÂêàÂπ∂Ôºå‰ΩÜÊòØÔºåÂêàÂπ∂ÁöÑÊïàÁéáË∂äÈ´òÔºåÂª∂ËøüÊó∂Èó¥‰ºöË∂äÈïø„ÄÇ
- noopÁîµÊ¢ØÂºèË∞ÉÂ∫¶Âô®ÔºåÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÁÆÄÂçïÁöÑFIFOÈòüÂàó,ÂÆÉÂÉèÁîµÊ¢ØÁöÑÂ∑•‰ΩúÊñπÂºè‰∏ÄÊ†∑ÂØπI/OËØ∑Ê±ÇËøõË°åÁªÑÁªá„ÄÇÂÆÉÊòØÂü∫‰∫éÂÖàÂÖ•ÂÖàÂá∫ÔºàFIFOÔºâÈòüÂàóÊ¶ÇÂøµÁöÑ Linux ÂÜÖÊ†∏ÈáåÊúÄÁÆÄÂçïÁöÑI/O Ë∞ÉÂ∫¶Âô®„ÄÇÊ≠§Ë∞ÉÂ∫¶Á®ãÂ∫èÊúÄÈÄÇÂêà‰∫éÂõ∫ÊÄÅÁ°¨Áõò„ÄÇ

centos 7 ÈªòËÆ§ÊòØdeadlineÔºå‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§Êü•Áúã
cat /sys/block/sda/queue/scheduler

‰øÆÊîπË∞ÉÂ∫¶ÁÆóÊ≥ï
grubby --update-kernel=ALL --args=&#34;elevator=noop&#34;
</code></pre></li>
<li>
<p>È¢ÑË£ÖMySQLÂâçÁ°¨‰ª∂ÁÉ§Êú∫ÂéãÊµã</p>
<pre tabindex="0"><code>yum install -y epel-release
yum install -y stress

# ÁÉ§Êú∫CPU
stress -c 4
# ÁÉ§Êú∫ MEM
stress -m 3 --vm-bytes 300M
# ÁÉ§Êú∫Â§öÂèÇÊï∞
stress -c 4 -m 2 -d 1

# ÈáçË¶ÅÂèÇÊï∞Ëß£ËØª
-c                # forks ‰∫ßÁîüÂ§ö‰∏™Â§ÑÁêÜsqrt()ÂáΩÊï∞ÁöÑCPUËøõÁ®ã
-m                # ‰∫ßÁîüÂ§ö‰∏™Â§ÑÁêÜmalloc()ÂÜÖÂ≠òÂàÜÈÖç
--vm-bytes bytes  # ÊåáÂÆöÂÜÖÂ≠òÁöÑbyteÊï∞ÔºåÈªòËÆ§ÂÄºÊòØ1
-d                # ÂÜôËøõÁ®ãÔºåÂÜôÂÖ•Âõ∫ÂÆöÂ§ßÂ∞èÔºåÈÄöËøámkstemp()ÂáΩÊï∞ÂÜôÂÖ•ÂΩìÂâçÁõÆÂΩï
--hdd-bytes bytes # ÊåáÂÆöÂÜôÁöÑÂ≠óËäÇÊï∞ÔºåÈªòËÆ§1G
</code></pre></li>
</ul>
<h2 id="2mysql80‰∫åËøõÂà∂ÂÆâË£ÖËøáÁ®ã">2„ÄÅMySQL8.0‰∫åËøõÂà∂ÂÆâË£ÖËøáÁ®ã</h2>
<p>‚ë†„ÄÅÂàõÂª∫Áî®Êà∑ÔºåÁî®Êà∑ÁªÑ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂàõÂª∫Áî®Êà∑ÁªÑ</span>
</span></span><span style="display:flex;"><span>groupadd mysql
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂàõÂª∫Áî®Êà∑Âä†ÂÖ•Áî®Êà∑ÁªÑÔºå‰∏î‰∏çÂÖÅËÆ∏ÁôªÂΩï</span>
</span></span><span style="display:flex;"><span>useradd -r -g mysql -s /bin/false mysql
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂÆâË£ÖÂü∫Á°ÄÂ∫ì</span>
</span></span><span style="display:flex;"><span>yum install libaio 
</span></span><span style="display:flex;"><span>yum install library
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚ë°„ÄÅËß£Âéã</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -xvf mysql-8.0.30-linux-glibc2.12-x86_64.tar.xz -C /opt/module/
</span></span><span style="display:flex;"><span>mv /opt/module/Êñá‰ª∂Â§π /opt/module/mysql80
</span></span><span style="display:flex;"><span>ln -s /opt/module/mysql80 /usr/local/mysql
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚ë¢„ÄÅÂä†ÂÖ•PATH</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ‰øÆÊîπ /etc/profile,Âä†ÂÖ•</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">PATH</span><span style="color:#000;font-weight:bold">=</span>/usr/local/mysql/bin:<span style="color:#008080">$PATH</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Êõ¥Êñ∞ÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">source</span> /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÊµãËØïÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span style="display:flex;"><span>mysql -V
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚ë£„ÄÅÊåÇËΩΩÁ°¨Áõò</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Êü•ÁúãÊú™ÊåÇËΩΩÁöÑÁ°¨Áõò</span>
</span></span><span style="display:flex;"><span>fdisk -l
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ‰æùÊ¨°ÂÆâË£ÖÊèêÁ§∫ÈîÆÂÖ•</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># p n l w</span>
</span></span><span style="display:flex;"><span>fdisk /dev/Êú™ÊåÇËΩΩÁöÑÁ°¨Áõò
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Ê†ºÂºèÂåñÊñá‰ª∂Á≥ªÁªü</span>
</span></span><span style="display:flex;"><span>mkfs.xfs Êú™ÊåÇËΩΩÁ°¨Áõò
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÊåÇËΩΩ</span>
</span></span><span style="display:flex;"><span>mount /dev/Êú™ÊåÇËΩΩÁ°¨Áõò /data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂºÄÊú∫ÊåÇËΩΩÔºå‰øÆÊîπ/etc/fstabÔºåÂä†ÂÖ•</span>
</span></span><span style="display:flex;"><span>/dev/Êú™ÊåÇËΩΩÁ°¨Áõò /data  defaults,noatime,nodiratime,nobarrier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Êü•ÁúãÊåÇËΩΩ</span>
</span></span><span style="display:flex;"><span>df -hT /dev/Êú™ÊåÇËΩΩÁöÑÁ°¨Áõò
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚ë§„ÄÅ‰øÆÊîπÁõÆÂΩïÊùÉÈôê</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/mysql80
</span></span><span style="display:flex;"><span>chown -R mysql:mysql /data
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚ë•„ÄÅÂàõÂª∫/etc/my.cnf</p>
<pre tabindex="0"><code>[mysqld]
user=mysql                   # ÁÆ°ÁêÜÁî®Êà∑
datadir=/data/mysql80        # Êï∞ÊçÆË∑ØÂæÑ
basedir=/usr/local/mysql     # ËΩØ‰ª∂Ë∑ØÂæÑ
socket=/tmp/mysql.sock       # socketÊñá‰ª∂‰ΩçÁΩÆ
server_id=51                 # ÊúçÂä°Âô®ID,‰∏ª‰ªéÊó∂Ê†áËØÜ‰∏çÂêå‰∏ªÊú∫
default_authentication_plugin=mysql_native_password   #‰ΩøÁî®ÊóßÁâàÊú¨ÂØÜÁ†ÅÊèí‰ª∂
log_bin=/data/mysql80/binlog # ‰∫åËøõÂà∂Êó•Âøó
binlog_format=row            # ‰∫åËøõÂà∂Êó•ÂøóË°åÊ†ºÂºè
gtid-mode=on                 # ÂºÄÂêØgtidÊ®°ÂºèÔºå‰ºöËÆ∞ÂΩïgtidÁöÑÊ†áËØÜÁ¨¶
enforce-gtid-consistency=on  # Âº∫Âà∂GTID‰∏ÄËá¥ÊÄßÔºå‰øùËØÅ‰∫ãÂä°ÁöÑÂÆâÂÖ®
log-slave-updates=on         # MySQL5.7‰πãÂâçÂøÖÈ°ªÈÖçÁΩÆ
port=3306                    # Á´ØÂè£
log_error=/data/mysql80/log/mysql-err.log  # ÈîôËØØÊó•ÂøóË∑ØÂæÑ
log_bin=/data/mysql80/log/mysql-bin        # binlogÊó•ÂøóË∑ØÂæÑ
slow_query_log=on                          # ÂºÄÂêØÊÖ¢Êü•ËØ¢Êó•Âøó
slow_query_log_file=/data/mysql80/log/mysql-slow.log # ÊÖ¢Êü•ËØ¢Êó•Âøó‰ΩçÁΩÆ
long_query_time=0.5                           # ËÆ∞ÂΩïÊâßË°åÊó∂Èó¥Ôºàreal timeÔºâË∂ÖËøáËØ•ÂÄº‰ª•‰∏äÁöÑSQLÔºåÈªòËÆ§ÂÄº‰∏∫10Áßí
log_queries_not_using_indexes=1               # Êú™‰ΩøÁî®Á¥¢ÂºïÁöÑÊü•ËØ¢ÊòØÂê¶ÂÜôÂÖ•ÊÖ¢Êó•Âøó
log_throttle_queries_not_using_indexes=1000   # ÈôêÂà∂ÊØèÂàÜÈíüÊâÄËÆ∞ÂΩïÁöÑslow logÊï∞Èáè
innodb_log_file_size=2048M                    # redo logÂ§ßÂ∞èÔºåÂª∫ËÆÆÂ§ßÂ∞è 512M-4G
innodb_log_files_in_group=4                   # redo logÁªÑÊï∞ÔºåÂª∫ËÆÆ 2-4ÁªÑ
innodb_temp_data_file_path=ibtmp1:512M;ibtmp2:512M:autoextend:max:512M # ‰∏¥Êó∂Ë°®Á©∫Èó¥Ôºå‰∏ÄËà¨2-3‰∏™ÔºåÂ§ßÂ∞è512M-1G
innodb_undo_tablespaces=4                     #undoÊñá‰ª∂‰∏™Êï∞ÔºåÂª∫ËÆÆ3-5‰∏™

[mysql]

[client]

[server]

[mysqld_safe]

[mysqldump]
</code></pre><p>‚ë¶„ÄÅÂàùÂßãÂåñ&amp;ÂêØÂä®&amp;ÁôªÂΩï</p>
<p>ÂàùÂßãÂåñ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ‰∏çËÆæÁΩÆÂØÜÁ†ÅÔºårootÂØÜÁ†Å‰∏∫Á©∫</span>
</span></span><span style="display:flex;"><span>mysqld --initialize-insecure
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêØÂä®ÊñπÂºè</p>
<p>systemd„ÄêÁ≥ªÁªüÁÆ°ÁêÜ„Äë -&gt;  /etc/init.d/mysqld „ÄêÁ≥ªÁªüÁÆ°ÁêÜ„Äë -&gt;mysql.server „ÄêÁ≥ªÁªüÁÆ°ÁêÜ„Äë-&gt; mysqld_safe„ÄêÂÆâÂÖ®ÂêØÂä®Ôºåcrash‰ºöÈáçÂêØÊúçÂä°„Äë-&gt;mysqld</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysqld_safe --defaults-file<span style="color:#000;font-weight:bold">=</span>/etc/my.cnf &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ÂèØÂä†ÂèÇÊï∞
</span></span><span style="display:flex;"><span>--skip-grant-tables ÔºöË∑≥ËøáÊéàÊùÉË°®
</span></span><span style="display:flex;"><span>--skip-networking   Ôºö‰∏çÂêØÂä®ÁΩëÁªú
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ≥Èó≠ÂëΩ‰ª§<code>shutdown</code></p>
<h2 id="3mysql‰ΩìÁ≥ªÊÄªËßà">3„ÄÅMySQL‰ΩìÁ≥ªÊÄªËßà</h2>
<h3 id="Êû∂ÊûÑ‰ªãÁªç">Êû∂ÊûÑ‰ªãÁªç</h3>
<img src="/img/dba/mysql-struct.jpg" alt="mysql-struct" style="zoom:80%;" />
<p><strong>ÂÆ¢Êà∑Á´ØËøûÊé•Âô® „ÄêConnectors„Äë</strong></p>
<p>Êèê‰æõÁºñÁ®ãËØ≠Ë®ÄÂ±ÇÁ∫ßÂíåMySQL‰∫§‰∫íÁöÑAPIÊé•Âè£Ôºå‰ª•ÂèäÊú¨Âú∞MySQLÂÆ¢Êà∑Á´ØÁ®ãÂ∫èÂíåMySQLÊúçÂä°Á´ØËøûÊé•‰∫§‰∫í</p>
<ul>
<li>
<p>Êú¨Âú∞ËøûÊé•SocketÊñπÂºèÔºömysql -uÁî®Êà∑Âêç -pÂØÜÁ†Å -S socketÊñá‰ª∂Ë∑ØÂæÑ</p>
</li>
<li>
<p>TCP/IPËøúÁ®ãËøûÊé•Ôºömysql  -uÁî®Êà∑Âêç -pÂØÜÁ†Å -hÂú∞ÂùÄ -PÁ´ØÂè£</p>
</li>
</ul>
<p><strong>ÊúçÂä°Â±Ç„ÄêMySQL Server„Äë</strong>
ÊúçÂä°Â±ÇÊòØMySQL ServerÁöÑÊ†∏ÂøÉÔºå‰∏ªË¶ÅÂåÖÂê´Á≥ªÁªüÁÆ°ÁêÜÂíåÊéßÂà∂Â∑•ÂÖ∑„ÄÅËøûÊé•Ê±†„ÄÅSQLÊé•Âè£„ÄÅËß£ÊûêÂô®„ÄÅÊü•ËØ¢‰ºòÂåñÂô®ÂíåÁºìÂ≠òÂÖ≠‰∏™ÈÉ®ÂàÜ</p>
<table>
<thead>
<tr>
<th>ÁªÑ‰ª∂</th>
<th>ÂäüËÉΩ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ËøûÊé•Ê±†ÔºàConnection PoolÔºâ</td>
<td>Ë¥üË¥£Â≠òÂÇ®ÂíåÁÆ°ÁêÜÂÆ¢Êà∑Á´Ø‰∏éÊï∞ÊçÆÂ∫ìÁöÑËøûÊé•Ôºå‰∏Ä‰∏™Á∫øÁ®ãË¥üË¥£ÁÆ°ÁêÜ‰∏Ä‰∏™ËøûÊé•</td>
</tr>
<tr>
<td>Á≥ªÁªüÁÆ°ÁêÜÂíåÊéßÂà∂Â∑•ÂÖ∑ÔºàManagement Services &amp; UtilitiesÔºâ</td>
<td>‰æãÂ¶ÇÂ§á‰ªΩÊÅ¢Â§ç„ÄÅÂÆâÂÖ®ÁÆ°ÁêÜ„ÄÅÈõÜÁæ§ÁÆ°ÁêÜÁ≠â</td>
</tr>
<tr>
<td>SQLÊé•Âè£ÔºàSQL InterfaceÔºâ</td>
<td>Áî®‰∫éÊé•ÂèóÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑÂêÑÁßçSQLÂëΩ‰ª§ÔºåÂπ∂ËøîÂõûÁªìÊûú„ÄÇÊØîÂ¶ÇDML„ÄÅDDL„ÄÅÂ≠òÂÇ®ËøáÁ®ã„ÄÅËßÜÂõæ„ÄÅËß¶ÂèëÂô®Á≠â</td>
</tr>
<tr>
<td>Ëß£ÊûêÂô®ÔºàParserÔºâ</td>
<td>Ë¥üË¥£Â∞ÜËØ∑Ê±ÇÁöÑSQLËß£ÊûêÁîüÊàê‰∏Ä‰∏™&quot;Ëß£ÊûêÊ†ë&quot;„ÄÇÁÑ∂ÂêéÊ†πÊçÆ‰∏Ä‰∫õMySQLËßÑÂàôËøõ‰∏ÄÊ≠•Ê£ÄÊü•Ëß£ÊûêÊ†ëÊòØÂê¶ÂêàÊ≥ï</td>
</tr>
<tr>
<td>Êü•ËØ¢‰ºòÂåñÂô®ÔºàOptimizerÔºâ</td>
<td>ÂΩì‚ÄúËß£ÊûêÊ†ë‚ÄùÈÄöËøáËß£ÊûêÂô®ËØ≠Ê≥ïÊ£ÄÊü•ÂêéÔºåÂ∞Ü‰∫§Áî±‰ºòÂåñÂô®Â∞ÜÂÖ∂ËΩ¨ÂåñÊàêÊâßË°åËÆ°ÂàíÔºåÁÑ∂Âêé‰∏éÂ≠òÂÇ®ÂºïÊìé‰∫§‰∫í</td>
</tr>
<tr>
<td>ÁºìÂ≠òÔºàCache&amp;BufferÔºâ</td>
<td>ÁºìÂ≠òÊú∫Âà∂ÊòØÁî±‰∏ÄÁ≥ªÂàóÂ∞èÁºìÂ≠òÁªÑÊàêÁöÑ„ÄÇÊØîÂ¶ÇË°®ÁºìÂ≠òÔºåËÆ∞ÂΩïÁºìÂ≠òÔºåÊùÉÈôêÁºìÂ≠òÔºåÂºïÊìéÁºìÂ≠òÁ≠â„ÄÇÂ¶ÇÊûúÊü•ËØ¢ÁºìÂ≠òÊúâÂëΩ‰∏≠ÁöÑÊü•ËØ¢ÁªìÊûúÔºåÊü•ËØ¢ËØ≠Âè•Â∞±ÂèØ‰ª•Áõ¥Êé•ÂéªÊü•ËØ¢ÁºìÂ≠ò‰∏≠ÂèñÊï∞ÊçÆ</td>
</tr>
<tr>
<td>Â≠òÂÇ®ÂºïÊìéÂ±ÇÔºàPluggable Storage EnginesÔºâ</td>
<td>ÂÇ®ÂºïÊìéË¥üË¥£MySQL‰∏≠Êï∞ÊçÆÁöÑÂ≠òÂÇ®‰∏éÊèêÂèñÔºå‰∏éÂ∫ïÂ±ÇÁ≥ªÁªüÊñá‰ª∂ËøõË°å‰∫§‰∫í„ÄÇMySQLÂ≠òÂÇ®ÂºïÊìéÊòØÊèí‰ª∂ÂºèÁöÑÔºåÊúçÂä°Âô®‰∏≠ÁöÑÊü•ËØ¢ÊâßË°åÂºïÊìéÈÄöËøáÊé•Âè£‰∏éÂ≠òÂÇ®ÂºïÊìéËøõË°åÈÄö‰ø°ÔºåÊé•Âè£Â±èËîΩ‰∫Ü‰∏çÂêåÂ≠òÂÇ®ÂºïÊìé‰πãÈó¥ÁöÑÂ∑ÆÂºÇ „ÄÇÁé∞Âú®ÊúâÂæàÂ§öÁßçÂ≠òÂÇ®ÂºïÊìéÔºåÂêÑÊúâÂêÑÁöÑÁâπÁÇπÔºåÊúÄÂ∏∏ËßÅÁöÑÊòØMyISAMÂíåInnoDB</td>
</tr>
</tbody>
</table>
<h3 id="Á∫øÁ®ã‰ªãÁªç">Á∫øÁ®ã‰ªãÁªç</h3>
<p>![MySQL Thread](/img/dba/MySQL Thread.png)</p>
<p><strong>Master Thread</strong></p>
<p>Ê†∏ÂøÉÁ∫øÁ®ãÔºåË¥üË¥£ÁºìÂÜ≤Ê±†ÁöÑÊï∞ÊçÆÂºÇÊ≠•ÂÖ•ÁõòÔºåÂåÖÊã¨ËÑèÈ°µÂà∑Êñ∞„ÄÅÂêàÂπ∂ÊèíÂÖ•ÁºìÂÜ≤„ÄÅundoÈ°µÂõûÊî∂Á≠â</p>
<ol>
<li>ÊéßÂà∂Âà∑Êñ∞ËÑèÈ°µÂà∞Á£ÅÁõòÔºàCKPTÔºâ</li>
<li>ÊéßÂà∂Êó•ÂøóÁºìÂÜ≤Âà∑Êñ∞Âà∞Á£ÅÁõòÔºàlog buffer &ndash;&gt; redoÔºâ</li>
<li>undoÈ°µÂõûÊî∂</li>
<li>ÂêàÂπ∂ÊèíÂÖ•ÁºìÂÜ≤(change buffer)</li>
<li>ÊéßÂà∂IOÂà∑Êñ∞Êï∞Èáè</li>
</ol>
<p>ÂèÇÊï∞ËØ¥ÊòéÔºö</p>
<ul>
<li>
<p><code>innodb_io_capacity</code>ÔºöË°®Á§∫ÊØèÁßíÂà∑Êñ∞ËÑèÈ°µÁöÑÊï∞ÈáèÔºåÈªòËÆ§‰∏∫200„ÄÇ</p>
</li>
<li>
<p><code>innodb_max_dirty_pages_pct</code>ÔºöËÆæÁΩÆÂà∑ÁõòÁöÑËÑèÈ°µÁôæÂàÜÊØîÔºåÂç≥ÂΩìËÑèÈ°µÂç†Âà∞ÁºìÂÜ≤Âå∫Êï∞ÊçÆËææÂà∞Ëøô‰∏™ÁôæÂàÜÊØîÊó∂ÔºåÂ∞±‰ºöÂà∑Êñ∞<code>innodb_io_capacity</code>‰∏™ËÑèÈ°µÂà∞Á£ÅÁõò</p>
</li>
<li>
<p><code>innodb_adaptive_flushing</code>ÔºöËá™ÈÄÇÂ∫îÂà∑Êñ∞MySQLÊ†πÊçÆÂΩìÂâçËøêË°å‰ø°ÊÅØÁªùÂØπ‰ΩïÊó∂Âà∑Êñ∞ÔºåÈªòËÆ§ÂºÄÂêØ„ÄÇÂõûÂêà<code>innodb_max_dirty_pages_pct</code>ÈÖçÂêàÁÆ°ÁêÜ</p>
</li>
</ul>
<p><strong>IO Thread</strong></p>
<p>Âú®InnoDBÂ≠òÂÇ®ÂºïÊìé‰∏≠Â§ßÈáè‰ΩøÁî®Async IOÊù•Â§ÑÁêÜÂÜôIOËØ∑Ê±Ç,IO ThreadÁöÑÂ∑•‰Ωú‰∏ªË¶ÅÊòØË¥üË¥£Ëøô‰∫õIOËØ∑Ê±ÇÁöÑÂõûË∞ÉÂ§ÑÁêÜ„ÄÇÂÜôÁ∫øÁ®ãÂíåËØªÁ∫øÁ®ãÂàÜÂà´Áî±<code>innodb_write_threads</code>Âíå<code>innodb_read_threads</code>ÂèÇÊï∞ÊéßÂà∂ÔºåÈªòËÆ§ÈÉΩ‰∏∫4Ôºå‰ΩøÁî®<code>show variables like '%innodb_%io_thread%';</code>Êü•Áúã</p>
<p><strong>Purge Thread</strong></p>
<p>ÂõûÊî∂‰∫ãÂä°Êèê‰∫§Âêé‰∏çÂÜçÈúÄË¶ÅÁöÑundo logÔºåÂèØ‰ª•Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê∑ªÂä†<code>innodb_purge_threads=threadNum</code>Êù•ÂºÄÂêØÁã¨Á´ãÁöÑPurge ThreadÔºåÁ≠âÂè∑ÂêéËæπÊéßÂà∂ËØ•Á∫øÁ®ãÊï∞ÈáèÔºåÈªòËÆ§‰∏∫4‰∏™ÔºåÈÄöËøá<code>show variables like '%innodb_purge_threads%';</code> Êü•Áúã</p>
<p><strong>Page clear thread</strong></p>
<p>ËÑèÈ°µÁöÑÂà∑Êñ∞Êìç‰ΩúÔºå‰ªémaster threadÂàÜÁ¶ªÂá∫Êù•ÔºåÂáèËΩªmaster threadÁöÑÂ∑•‰ΩúÔºåÊèêÈ´òÊÄßËÉΩ</p>
<h3 id="mysql-80-innodbÁªìÊûÑ">MySQL 8.0 InnodbÁªìÊûÑ</h3>
<img src="/img/dba/Â≠òÂÇ®ÂºïÊìéÁªìÊûÑ.png" alt="Â≠òÂÇ®ÂºïÊìéÁªìÊûÑ" style="zoom:67%;" />
<p><strong>innodb buffer pool</strong></p>
<p>Êü•ÁúãMySQLÁöÑ<code>innodb_buffer_pool</code>Â§ßÂ∞è<code>select @@innodb_buffer_pool_size/1024/1024; --Âçï‰ΩçM</code></p>
<p><code>Buffer Pool</code>‰∏≠Â≠òÂú®‰∏â‰∏™ÂèåÂêëÈìæË°®„ÄÇÂàÜÂà´ÊòØ<code>FreeList</code>„ÄÅ<code>LRUList</code>‰ª•Âèä<code>FlushList</code></p>
<img src="/img/dba/innodb_buffer_pool.png" alt="innodb_buffer_pool" style="zoom:80%;" />
<p><code>FreeList</code>Â≠òÊîæ‰∫ÜÁ©∫Èó≤ÁöÑÁºìÂ≠òÈ°µÁöÑÊèèËø∞‰ø°ÊÅØÔºåÂç≥Âì™‰∫õÂå∫ÂüüÊòØÁ©∫Èó≤Áä∂ÊÄÅÔºåÁî®‰∫éÁÆ°ÁêÜÂàÜÈÖçÂÜÖÂ≠ò</p>
<p><code>LRUList</code>ÂÜ∑ÁÉ≠Êï∞ÊçÆÂàÜÁ¶ª‰ºòÂåñÔºå5/8ÁöÑÂå∫ÂüüÊòØÁÉ≠Êï∞ÊçÆÂå∫ÂüüÔºå3/8ÁöÑÂå∫ÂüüÁÆóÊòØÂÜ∑Êï∞ÊçÆÂå∫Âüü„ÄÇÊñ∞Âä†ËΩΩÁöÑÊï∞ÊçÆÈ°µ‰ºöË¢´ÊîæÂú®ÂÜ∑Êï∞ÊçÆÂå∫ÁöÑÈù†ÂâçÁöÑ‰ΩçÁΩÆ‰∏ä„ÄÇÂ¶ÇÊûúËØ•Êï∞ÊçÆÈ°µËØªÂèñÂá∫Êù•Âä†ËΩΩËøõÁºìÂ≠òÈ°µ‰∏≠ÂêéÔºåÈó¥ÈöîÊ≤°Âà∞1sÔºåÂ∞±‰ΩøÁî®ËØ•ÁºìÂ≠òÈ°µ„ÄÇÈÇ£‰πàÊòØ‰∏ç‰ºöÂ∞ÜËøô‰∏™ÊèèËø∞‰ø°ÊÅØÁßªÂä®Âà∞5/8ÁöÑÁÉ≠Êï∞ÊçÆÂå∫ÂüüÁöÑ„ÄÇ‰ΩÜÊòØÂΩìË∂ÖËøá1sÂêéÔºå‰Ω†ÂèàÂéªËØªËøô‰∏™Êï∞ÊçÆÈ°µ„ÄÇÈÇ£Ëøô‰∏™Êï∞ÊçÆÈ°µÁöÑÊèèËø∞‰ø°ÊÅØÂ∞±‰ºöË¢´ÊîæÂà∞ÁÉ≠Êï∞ÊçÆÂå∫Âüü„ÄÇ</p>
<p><code>FlushList</code>‰∏≠ÁöÑËäÇÁÇπÂ≠òÊîæÁöÑÊòØË¢´‰øÆÊîπ‰∫ÜËÑèÊï∞ÊçÆÈ°µÁöÑÊèèËø∞‰ø°ÊÅØÂùó„ÄÇÈöèÁùÄMySQLË¢´‰ΩøÁî®ÁöÑÊó∂Èó¥Ë∂äÊù•Ë∂äÈïøÔºå<code>BufferPool</code>ÁöÑÂ§ßÂ∞èÂ∞±Ë∂äÊù•Ë∂äÂ∞è„ÄÇÁ≠âÂÆÉ‰∏çÂ§üÁî®ÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöÂ∞ÜÈÉ®ÂàÜLRU‰∏≠ÁöÑÊï∞ÊçÆÈ°µÊèèËø∞‰ø°ÊÅØÁßªÈô§Âá∫ÂéªÔºåËøôÊó∂Â¶ÇÊûúÂèëÁé∞Ë¢´ÁßªÈô§Âá∫Êù•ÁöÑÊï∞ÊçÆÈ°µÂú®<code>FLushList</code>‰∏≠ÔºåÂ∞±‰ºöËß¶ÂèëfsyncÁöÑÊìç‰ΩúÔºåËß¶ÂèëÈöèÊú∫ÂÜôÁ£ÅÁõò„ÄÇÂ¶ÇÊûúËØ•Êï∞ÊçÆÈ°µÊòØÂπ≤ÂáÄÁöÑÔºåÈÇ£ÁßªÈô§Âá∫ÂéªÂ∞±Â•ΩÔºå‰∏çÈúÄË¶ÅÂÖ∂ÂÆÉÊìç‰Ωú</p>
<p><strong>change buffer</strong></p>
<p>MySQLÂÜôÁöÑÊÄßËÉΩÊèêÂçáÊèêÂçá‰∏ªË¶Å‰æùËµñ<code>change buffer</code>Ôºå‰ª•Ââç <code>change buffer</code>Áß∞‰∏∫<code>insert buffer</code>ÔºåÂõ†‰∏∫‰ª•ÂâçÂè™ÂÅö‰∫ÜinsertÊìç‰ΩúÁöÑÊÄßËÉΩ‰ºòÂåñÔºå‰πãÂêéÁâàÊú¨Êõ¥Êñ∞‰πãÂêéÔºå‰πüËÉΩÂØπ‰∫é‰øÆÊîπÂíåÂà†Èô§ÂÅöÁºìÂ≠òÂ§ÑÁêÜÔºåÊâÄ‰ª•ÊîπÂêç‰∏∫<code>change buffer</code></p>
<p>‰æãÂ¶ÇÔºöupdate xx set name = &ldquo;ËµêÊàë100w&rdquo; where id = 5Ôºõ„ÄênameÊòØ‰∏™ÈùûÂîØ‰∏ÄÁöÑ‰∫åÁ∫ßÁ¥¢Âºï„Äë</p>
<p>ÊâßË°åÊó∂‰∏ç‰ªÖË¶ÅÊõ¥Êñ∞ËÅöÁ∞áÁ¥¢ÂºïÔºåËøòË¶ÅÂä†ËΩΩnameËøô‰∏™ËæÖÂä©Á¥¢ÂºïËøõË°åÊõ¥Êñ∞ÔºåÂ¶ÇÊûúÁé∞Âú®nameËøô‰∏™ÈùûÂîØ‰∏Ä‰∫åÁ∫ßÁ¥¢ÂºïÊ≤°ÊúâÂú®ÂÜÖÂ≠ò‰∏≠ÔºåÂ∞Ü‰ºöËøõË°åIOÊìç‰ΩúÔºåÊµ™Ë¥πÊÄßËÉΩ„ÄÇÊâÄ‰ª•MySQLËøõË°å‰∫ÜÊîπËøõÔºöÂΩìËøô‰∫õ‰∫åÁ∫ßÁ¥¢ÂºïÈ°µ‰∏çÂú®ÂÜÖÂ≠ò‰∏≠Êó∂ÔºåÂØπÂÆÉ‰ª¨ÁöÑÊìç‰Ωú‰ºöË¢´ÁºìÂ≠òÂú®change buffer‰∏≠ÔºàÁõÆÁöÑÊòØÁúÅÂéªËøôÊ¨°ÈöèÊú∫ÁöÑÁ£ÅÁõòIOÔºâ„ÄÇÁ≠â‰πãÂêéMySQLÁ©∫Èó≤‰∫Ü„ÄÅÊàñËÄÖÊòØMySQLÂÖ≥Èó≠Ââç„ÄÅÊàñËÄÖÊòØÊúâËØªÂèñÊìç‰ΩúÊó∂ÂÜçÂ∞ÜËøôÈÉ®ÂàÜÁºìÂ≠òÊìç‰ΩúmergeÂà∞B+Tree‰∏≠</p>
<p>Ë¶ÅÊ±Ç‰∫åÁ∫ßÁ¥¢Âºï‰∏çËÉΩÂîØ‰∏Ä„ÄÇËøô‰∏™ÂæàÂ•ΩÁêÜËß£„ÄÇÂ¶ÇÊûúnameÂàóÊòØÂîØ‰∏ÄÁöÑ„ÄÇÈÇ£ÊàëÊØèÊ¨°DML‰πãÂâçÈÉΩÂøÖÈ°ªÂéªÁúã‰∏ãÊúâÊ≤°ÊúâÂ∑≤ÁªèÂ≠òÂú®ÁöÑÁõ∏ÂêåÂÄºÁöÑÁ¥¢Âºï„ÄÇËøô‰πüÂ∞±ÊÑèÂë≥ÁùÄËøô‰∏™DMLÊìç‰ΩúÂøÖÈ°ªÂä†ËΩΩÊó†Ê≥ïÁºìÂ≠ò</p>
<p><strong>adaptive Hash Index</strong></p>
<p>Ëá™ÈÄÇÂ∫îÂìàÂ∏åÁ¥¢ÂºïÔºåInnoDBÂ≠òÂÇ®ÂºïÊìé‰ºöÁõëÊéßÂØπË°®‰∏äÁ¥¢ÂºïÁöÑÊü•ÊâæÔºåÂ¶ÇÊûúËßÇÂØüÂà∞Âª∫Á´ãÂìàÂ∏åÁ¥¢ÂºïÂèØ‰ª•Â∏¶Êù•ÈÄüÂ∫¶ÁöÑÊèêÂçáÔºåÂàôÂª∫Á´ãËá™ÈÄÇÂ∫îÂìàÂ∏åÁ¥¢ÂºïÔºåÂÆûÁé∞Êú¨Ë¥®‰∏äÂ∞±ÊòØ‰∏Ä‰∏™ÂìàÂ∏åË°®Ôºö‰ªéÊüê‰∏™Ê£ÄÁ¥¢Êù°‰ª∂Âà∞Êüê‰∏™Êï∞ÊçÆÈ°µÁöÑÂìàÂ∏åË°®</p>
<p><strong>Log Buffer</strong></p>
<p><code>log buffer</code>ÁöÑ‰ΩúÁî®ÊòØÁºìÂ≠ò<code>redo log</code>ÁöÑÂÜôÂÖ•Êìç‰ΩúÔºåËÄÉËôëÂà∞‰∏Ä‰∏™Â§ß‰∫ãÂä°ÔºåÂú®‰∫ãÂä°ÊúüÈó¥ÂèØËÉΩ‰ºöÊúâÂæàÂ§öÊ¨°Êï∞ÊçÆÂ∫ìÊìç‰ΩúÔºå‰∏çÈúÄË¶ÅÂú®‰∫ãÂä°‰∏≠ÁöÑÊØè‰∏ÄÊ¨°Êìç‰ΩúÈÉΩÂÜôÂÖ•<code>redo log</code>ÔºåÂèØ‰ª•ÁºìÂ≠ò‰∏ÄÂÆöÈáèÁöÑ<code>redo log</code>ÔºåÂú®ÂêàÈÄÇÁöÑÊó∂Èó¥ËøõË°åÂÜôÁõò„ÄÇ</p>
<p>ÂêàÈÄÇÁöÑÊó∂Èó¥ÂèñÂÜ≥‰∫éMySQLÁöÑÈÖçÁΩÆÔºàinnodb_flush_log_at_trx_commitÔºâÔºåÂÄºÊúâ0„ÄÅ1„ÄÅ2ÔºåÈªòËÆ§ÊòØ1</p>
<ul>
<li>Â¶ÇÊûúËÆæÁΩÆ‰∏∫0ÔºåÊØèÈöî‰∏ÄÁßíÊää<code>log buffer</code>Âà∑Âà∞Êñá‰ª∂Á≥ªÁªü‰∏≠(os buffer)ÂéªÔºåÂπ∂‰∏îË∞ÉÁî®Êñá‰ª∂Á≥ªÁªüÁöÑ‚Äúflush‚ÄùÊìç‰ΩúÂ∞ÜÁºìÂ≠òÂà∑Êñ∞Âà∞Á£ÅÁõò‰∏äÂéª„ÄÇ‰πüÂ∞±ÊòØËØ¥‰∏ÄÁßí‰πãÂâçÁöÑÊó•ÂøóÈÉΩ‰øùÂ≠òÂú®Êó•ÂøóÁºìÂÜ≤Âå∫ÔºåÂ¶ÇÊûúÊú∫Âô®ÂÆïÊéâÔºåÂèØËÉΩ‰∏¢Â§±1ÁßíÁöÑ‰∫ãÂä°Êï∞ÊçÆ</li>
<li>Â¶ÇÊûúËÆæÁΩÆ‰∏∫1ÔºåÂú®ÊØèÊ¨°‰∫ãÂä°Êèê‰∫§ÁöÑÊó∂ÂÄô‰ºöÊää<code>log buffer</code>Âà∑Âà∞Êñá‰ª∂Á≥ªÁªü‰∏≠(os buffer)ÂéªÔºåÂπ∂‰∏îË∞ÉÁî®Êñá‰ª∂Á≥ªÁªüÁöÑ‚Äúflush‚ÄùÊìç‰ΩúÂ∞ÜÁºìÂ≠òÂà∑Êñ∞Âà∞Á£ÅÁõò‰∏äÂéª„ÄÇ‰øùËØÅACID</li>
<li>Â¶ÇÊûúËÆæÁΩÆ‰∏∫2ÔºåÂú®ÊØèÊ¨°‰∫ãÂä°Êèê‰∫§ÁöÑÊó∂ÂÄô‰ºöÊää<code>log buffer</code>Âà∑Âà∞Êñá‰ª∂Á≥ªÁªü‰∏≠ÂéªÔºå‰ΩÜÂπ∂‰∏ç‰ºöÁ´ãÂç≥Âà∑ÂÜôÂà∞Á£ÅÁõò</li>
</ul>
<h3 id="Â≠òÂÇ®ÁªìÊûÑ">Â≠òÂÇ®ÁªìÊûÑ</h3>
<p><strong>Êñá‰ª∂Â≠òÂÇ®ÁªìÊûÑÔºàÂÆèËßÇÔºâ</strong></p>
<p><img src="/img/dba/MySQL%E6%96%87%E4%BB%B6.png" alt="MySQLÊñá‰ª∂"></p>
<hr>
<p><strong>Ë°®ÁöÑÂ≠òÂÇ®ÁªìÊûÑÔºàÂæÆËßÇÔºâ</strong></p>
<img src="/img/dba/micr-store-file.png" alt="image-20230106144948002" style="zoom:50%;" />
<p>Ë°®ÊäΩË±°‰∏∫Ë°®Á©∫Èó¥ÔºåË°®Á©∫Èó¥Áî±segment„ÄÅextend„ÄÅpageÁªÑÊàê</p>
<p><strong>Segment (ÊÆµ)</strong></p>
<p>Â∏∏ËßÅÁöÑsegmentÊúâÊï∞ÊçÆÊÆµ„ÄÅÁ¥¢ÂºïÊÆµ„ÄÅÂõûÊªöÊÆµÁ≠âÔºå Êï∞ÊçÆÊÆµ‰∏∫B+Ê†ëÁöÑÂè∂Â≠êËäÇÁÇπ(Leaf node segment)„ÄÅÁ¥¢ÂºïÊÆµ‰∏∫B+Ê†ëÁöÑÈùûÂè∂Â≠êËäÇÁÇπ(Non-leaf node segment)</p>
<img src="/img/dba/Segment.png" alt="img" style="zoom:60%;" />
<p><strong>ExtentÔºàÂå∫„ÄÅÁ∞áÔºâ</strong></p>
<p>ÊØè‰∏™Âå∫Â§ßÂ∞èÂõ∫ÂÆö‰∏∫1MBÔºå‰∏∫‰øùËØÅÂå∫‰∏≠<code>page</code>ÁöÑËøûÁª≠ÊÄßÈÄöÂ∏∏InnoDB‰ºö‰∏ÄÊ¨°‰ªéÁ£ÅÁõò‰∏≠Áî≥ËØ∑4-5‰∏™Âå∫„ÄÇÂú®ÈªòËÆ§pageÁöÑÂ§ßÂ∞è‰∏∫16KBÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏Ä‰∏™Âå∫ÂàôÁî±64‰∏™ËøûÁª≠ÁöÑpageÁªÑÊàê</p>
<p><strong>PageÔºàÊï∞ÊçÆÈ°µÔºâ</strong></p>
<p>ÈªòËÆ§16KB„ÄÇInnoDBÊúÄÂ∞èÁöÑIOÂçïÂÖÉ„ÄÇMySQLÊúâÈ¢ÑËØªÊú∫Âà∂ÔºåÂ∞±ÊòØÂΩì‰ªéÁ£ÅÁõò‰∏äÂä†ËΩΩ‰∏Ä‰∏™Êï∞ÊçÆÈ°µÁöÑÊó∂ÂÄôÔºåÂèØËÉΩ‰ºöÊääËøô‰∏™ÂÆÉÁõ∏ÈÇªÁöÑÂÖ∂‰ªñÊï∞ÊçÆÈ°µ‰πüËøõË°åÂä†ËΩΩ</p>
<h3 id="Á≥ªÁªüÂ∫ìË°®‰ªãÁªç">Á≥ªÁªüÂ∫ìË°®‰ªãÁªç</h3>
<p><strong>MySQL ÁöÑÊï∞ÊçÆÂ≠óÂÖ∏ - information_schema</strong></p>
<p><code> information_schema</code>Êï∞ÊçÆÂ∫ì‰øùÂ≠òÁùÄÂÖ∂‰ªñÊï∞ÊçÆÂ∫ìÁöÑÂÖÉ‰ø°ÊÅØ</p>
<p><strong>ÊéßÂà∂ÂíåÁÆ°ÁêÜ‰ø°ÊÅØÂ∫ì - mysql</strong></p>
<p><code>mysql</code>Â∫ìÊòØMySQL ÊúçÂä°Âô®ÁöÑÊ†∏ÂøÉÊï∞ÊçÆÂ∫ìÔºå‰∏ªË¶ÅË¥üË¥£Â≠òÂÇ®Êï∞ÊçÆÂ∫ìÁöÑÁî®Êà∑„ÄÅÊùÉÈôê„ÄÅÂÖ≥ÈîÆÂ≠óÁ≠âÁ≠â</p>
<table>
<thead>
<tr>
<th>Ë°®Âêç</th>
<th>‰ªãÁªç</th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>Áî®Êà∑‰ø°ÊÅØ„ÄÅÁî®Êà∑ÂØÜÁ†Å„ÄÅÈíàÂØπÊâÄÊúâÂ∫ìÁöÑÊùÉÈôê</td>
</tr>
<tr>
<td>db</td>
<td>Áî®Êà∑ÂØπÊüê‰∏™Êï∞ÊçÆÂ∫ìÁöÑÊìç‰ΩúÊùÉÈôê‰ø°ÊÅØ</td>
</tr>
<tr>
<td>tables_priv</td>
<td>Âçï‰∏™Ë°®ËøõË°åÊùÉÈôêËÆæÁΩÆÊó∂‰ΩøÁî®</td>
</tr>
<tr>
<td>columns_priv</td>
<td>Âçï‰∏™Êï∞ÊçÆÂàóËøõË°åÊùÉÈôêËÆæÁΩÆÊó∂‰ΩøÁî®</td>
</tr>
<tr>
<td>procs_priv</td>
<td>Â≠òÂÇ®ËøáÁ®ãÂíåÂ≠òÂÇ®ÂáΩÊï∞ËøõË°åÊùÉÈôêËÆæÁΩÆ</td>
</tr>
<tr>
<td>slave_master_info</td>
<td>‰∏ª‰ªé‰ø°ÊÅØÂ≠òÂÇ®ÁöÑÂú∞Êñπ</td>
</tr>
<tr>
<td>slave_relay_log_info</td>
<td>salveÁöÑ‰∏≠ÁªßÊó•Âøó‰ø°ÊÅØ</td>
</tr>
<tr>
<td>slave_worker_info</td>
<td>slaveÁöÑÂ∑•‰Ωú‰ø°ÊÅØ</td>
</tr>
<tr>
<td>slow_log</td>
<td>ÊÖ¢Êü•ËØ¢Êó•Âøó</td>
</tr>
</tbody>
</table>
<p><strong>ÊúçÂä°Âô®ÊÄßËÉΩÊåáÊ†á - performance_schema</strong></p>
<p><code>performance_schema</code>ÊòØËøêË°åÂú®ËæÉ‰ΩéÁ∫ßÂà´ÁöÑÁî®‰∫éÁõëÊéßMySQL ServerËøêË°åËøáÁ®ã‰∏≠ÁöÑËµÑÊ∫êÊ∂àËÄó„ÄÅËµÑÊ∫êÁ≠âÂæÖÁ≠âÊÉÖÂÜµ</p>
<table>
<thead>
<tr>
<th>Ë°®Âêç</th>
<th>‰ªãÁªç</th>
</tr>
</thead>
<tbody>
<tr>
<td>processlist</td>
<td>ÂΩìÂâçËøûÊé•‰ø°ÊÅØ</td>
</tr>
<tr>
<td>threads</td>
<td></td>
</tr>
<tr>
<td>events_statements_current</td>
<td>ÂΩìÂâçËØ≠Âè•‰∫ã‰ª∂Ë°®</td>
</tr>
<tr>
<td>events_statements_history</td>
<td>ÂéÜÂè≤ËØ≠Âè•‰∫ã‰ª∂Ë°®</td>
</tr>
<tr>
<td>events_statements_history_long</td>
<td>ÈïøËØ≠Âè•ÂéÜÂè≤‰∫ã‰ª∂Ë°®</td>
</tr>
<tr>
<td>summary Á±ªË°®</td>
<td>ËÅöÂêàÂêéÁöÑÊëòË¶ÅË°®</td>
</tr>
</tbody>
</table>
<p><strong>DBA ÁöÑÂ•ΩÂ∏ÆÊâã - sys</strong></p>
<p><code>sys</code>Â∫ìÂØπ<code>information_schema</code>Âíå<code>performance_schema</code>ÁªüËÆ°ÁöÑÂêÑÁßç‰ø°ÊÅØËøõË°åËÆ∞ÂΩïÂπ∂ÁîüÊàêÊñ∞ÁöÑËßÜÂõæË°®ÔºåÈÄöËøá sysÔºåÊàë‰ª¨ÂèØ‰ª•Âø´ÈÄüÁöÑÊü•ËØ¢Âá∫ÔºöÂì™‰∫õËØ≠Âè•‰ΩøÁî®‰∫Ü‰∏¥Êó∂Ë°®„ÄÅÂì™‰∏™Á∫øÁ®ãÂç†Áî®‰∫ÜÊúÄÂ§öÁöÑÂÜÖÂ≠ò„ÄÅÂì™‰∫õÁ¥¢ÂºïÊòØÂÜó‰ΩôÁöÑÁ≠âÁ≠âÔºåsysÂ∫ìÁöÑÂäüËÉΩÈúÄË¶ÅÂçïÁã¨ÈÖçÁΩÆÂºÄÂêØ</p>
<h2 id="4mysqlÁöÑÊó•Â∏∏ÁÆ°ÁêÜ">4„ÄÅMySQLÁöÑÊó•Â∏∏ÁÆ°ÁêÜ</h2>
<h3 id="Áî®Êà∑ÁÆ°ÁêÜ">Áî®Êà∑ÁÆ°ÁêÜ</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÂàõÂª∫Áî®Êà∑ÔºåMYSQL8.0ÁöÑÂØÜÁ†ÅÊèí‰ª∂ÊúâÊõ¥ÊîπÔºåÂÖºÂÆπ‰∏çË°åÔºàÁâπÂà´ÊòØ‰∏ª‰ªéÔºâÔºåÂª∫ËÆÆËøòÊòØ‰ΩøÁî®mysql_native_password
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>identified<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">with</span><span style="color:#bbb"> </span>mysql_native_password<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;[ÂØÜÁ†Å]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ËØ¢Áî®Êà∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">host</span>,<span style="color:#bbb"> </span>plugin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>mysql.<span style="color:#000;font-weight:bold">user</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Âà†Èô§Áî®Êà∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">drop</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ‰øÆÊîπÁî®Êà∑ÂØÜÁ†Å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>identified<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">with</span><span style="color:#bbb"> </span>mysql_native_password<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;[ÂØÜÁ†Å]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂØÜÁ†ÅËøáÊúüËÆæÁΩÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>default_password_lifetime;<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">-- Êü•ÁúãËøáÊúüÊó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">ALTER</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USER</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>PASSWORD<span style="color:#bbb"> </span>EXPIRE<span style="color:#bbb"> </span><span style="color:#0086b3">INTERVAL</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Â§©Êï∞</span>]<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DAY</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">ALTER</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USER</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>PASSWORD<span style="color:#bbb"> </span>EXPIRE<span style="color:#bbb"> </span>NEVER;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÈîÅÂÆöÁî®Êà∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">ALTER</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USER</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>ACCOUNT<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">LOCK</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÊùÉÈôêÁÆ°ÁêÜ">ÊùÉÈôêÁÆ°ÁêÜ</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÊòæÁ§∫ÊâÄÊúâÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">privileges</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êéà‰∫àÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ÊùÉÈôê</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ÊùÉÈôêÁ∫ßÂà´</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ALL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">-- Êéà‰∫àÁî®Êà∑ÊâÄÊúâÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">update</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">delete</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Êï∞ÊçÆÂ∫ìÂêçÁß∞</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">-- Êéà‰∫àÁî®Êà∑DMLÁªôÊåáÂÆöÊï∞ÊçÆÂ∫ì
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ÁúãÁî®Êà∑ÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SHOW</span><span style="color:#bbb"> </span>GRANTS<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FOR</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span><span style="color:#bbb"> </span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂõûÊî∂ÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">REVOKE</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ÊùÉÈôê</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ËßíËâ≤ÂàõÂª∫ÂèäÊéàÊùÉ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ROLE</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">ËßíËâ≤Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ÊùÉÈôê</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">ËßíËâ≤Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ËßíËâ≤Âêç</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span>[<span style="color:#a61717;background-color:#e3d2d2">Áî®Êà∑Âêç</span>]<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;[IPÊèèËø∞]&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ÁúãËßíËâ≤ÂíåÁî®Êà∑ÁöÑÊò†Â∞ÑÂÖ≥Á≥ª
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>mysql.role_edges;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ÁúãÁî®Êà∑ÂíåËßíËâ≤ÁöÑÊùÉÈôê
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>information_schema.user_privileges;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Áîü‰∫ßÁéØÂ¢ÉÁöÑÊùÉÈôêÂàÜÈÖç</p>
<ul>
<li>ÁÆ°ÁêÜÂëòÔºöALL</li>
<li>ÂºÄÂèëÔºöcreate, create routine, create temporary tables, create view, show view, delete, event, execute, insert, references, select, trigger, update</li>
<li>ÁõëÊéßÔºöselect, replication slave, replication client, super</li>
<li>Â§á‰ªΩÔºöselect, show databases, process, lock tables, reload</li>
<li>‰∏ª‰ªéÔºöreplication slave, replication client</li>
<li>‰∏öÂä°Ôºöinsert, update, delete, select</li>
</ul>
<h2 id="5mysqlÁ≥ªÁªüÁöÑÊó•Âøó">5„ÄÅMySQLÁ≥ªÁªüÁöÑÊó•Âøó</h2>
<h3 id="Êó•ÂøóÁ±ªÂûã">Êó•ÂøóÁ±ªÂûã</h3>
<blockquote>
<p>Âª∫ËÆÆÊó•ÂøóÈÉΩËÆæÁΩÆÂà∞ÂçïÁã¨ÁöÑÊñá‰ª∂Â§πÔºå‰∏çË¶ÅÂíåÊï∞ÊçÆÁõÆÂΩïÊ∑∑ÁùÄ</p>
</blockquote>
<p><strong>ÈîôËØØÊó•Âøó</strong></p>
<p>ÈªòËÆ§‰ΩçÁΩÆÔºölog_error=$DATDDIR/hostname.errÔºåÈªòËÆ§ÊòØÂºÄÂêØÁöÑÔºåÁúãÈîôËØØÊó•ÂøóÊó∂‰∏ªË¶ÅÂÖ≥Ê≥® [ERROR],deadlock</p>
<pre tabindex="0"><code>log_error=/data/mysql80/log/mysql-err.log  #ÈîôËØØÊó•ÂøóË∑ØÂæÑ
</code></pre><p><strong>‰∫åËøõÂà∂Êó•ÂøóÔºàbinlogÔºâ</strong></p>
<p>ËÆ∞ÂΩï‰∫ÜMySQL ÂèëÁîüËøáÁöÑ‰øÆÊîπÁöÑÊìç‰ΩúÁöÑÊó•Âøó„ÄÇMySQL8.0 ÈªòËÆ§ÂºÄÂêØ binlogÔºåÈªòËÆ§Âú® datadir Êñá‰ª∂Â§πÂÜÖ</p>
<p>‚ë†Â§á‰ªΩÊÅ¢Â§çÂøÖÈ°ª‰æùËµñ‰∫åËøõÂà∂Êó•ÂøóÔºõ‚ë°Â§çÂà∂ÁéØÂ¢ÉÂøÖÈ°ª‰æùËµñ‰∫åËøõÂà∂Êó•Âøó</p>
<pre tabindex="0"><code>log_bin=/data/mysql80/log/mysql-bin    #binlogÊó•ÂøóË∑ØÂæÑ
</code></pre><p><strong>ÊÖ¢Êó•ÂøóÔºàslow_logÔºâ</strong></p>
<p>ËÆ∞ÂΩïMySQLÂ∑•‰Ωú‰∏≠ÔºåËøêË°åËæÉÊÖ¢ÁöÑËØ≠Âè•„ÄÇÁî®Êù•ÂÆö‰ΩçSQLËØ≠Âè•ÊÄßËÉΩÈóÆÈ¢òÔºåÈªòËÆ§ÂÖ≥Èó≠ÔºåÂª∫ËÆÆÂºÄÂêØ</p>
<pre tabindex="0"><code>slow_query_log=on                             # ÂºÄÂêØÊÖ¢Êü•ËØ¢Êó•Âøó
slow_query_log_file=/data/mysql80/log/mysql-slow.log # ÊÖ¢Êü•ËØ¢Êó•Âøó‰ΩçÁΩÆ
long_query_time=0.5                           # ËÆ∞ÂΩïÊâßË°åÊó∂Èó¥Ôºàreal timeÔºâË∂ÖËøáËØ•ÂÄº‰ª•‰∏äÁöÑSQLÔºåÈªòËÆ§ÂÄº‰∏∫10Áßí
log_queries_not_using_indexes=1               # Êú™‰ΩøÁî®Á¥¢ÂºïÁöÑÊü•ËØ¢ÊòØÂê¶ÂÜôÂÖ•ÊÖ¢Êó•Âøó
log_throttle_queries_not_using_indexes=1000   # ÈôêÂà∂ÊØèÂàÜÈíüÊâÄËÆ∞ÂΩïÁöÑslow logÊï∞Èáè

‰πüÂèØÁî® set global ËøõË°å‰øÆÊîπ
</code></pre><p><strong>ÊôÆÈÄöÊó•ÂøóÔºàgeneral_logÔºâ</strong></p>
<p>ÊôÆÈÄöÊó•ÂøóÔºå‰ºöËÆ∞ÂΩïÊâÄÊúâÊï∞ÊçÆÂ∫ìÂèëÁîüÁöÑ‰∫ã‰ª∂ÂèäËØ≠Âè•ÔºåÊñá‰ª∂‰ø°ÊÅØËæÉÂ§ßÔºåÁîüÊàê„ÄÅÊµãËØïÈÉΩ‰∏çÂª∫ËÆÆÊâìÂºÄÔºåÈªòËÆ§ÂÖ≥Èó≠</p>
<h3 id="Êó•ÂøóÂèÇÊï∞Êü•ËØ¢ËÆæÁΩÆ">Êó•ÂøóÂèÇÊï∞Êü•ËØ¢ËÆæÁΩÆ</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>variables<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;log_output&#39;</span>;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">-- ÁúãÁúãÊó•ÂøóËæìÂá∫Á±ªÂûã tableÊàñfile
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6sqlÁü•ËØÜÁõ∏ÂÖ≥">6„ÄÅSQLÁü•ËØÜÁõ∏ÂÖ≥</h2>
<h3 id="sql_mode">SQL_MODE</h3>
<p>Êü•ÁúãSQL_MODEL<code>select @@sql_mode;</code></p>
<table>
<thead>
<tr>
<th>SQL_MODE</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>ONLY_FULL_GROUP_BY</td>
<td>ÂØπ‰∫éGROUP BYËÅöÂêàÊìç‰ΩúÔºåÂ¶ÇÊûúÂú®SELECT‰∏≠ÁöÑÂàó„ÄÅHAVINGÊàñËÄÖORDER BYÂ≠êÂè•ÁöÑÂàóÔºåÊ≤°ÊúâÂú®GROUP BY‰∏≠Âá∫Áé∞ÔºåÊàñËÄÖ‰∏çÂú®ÂáΩÊï∞‰∏≠ËÅöÂêàÔºåÈÇ£‰πàËøô‰∏™SQLÊòØ‰∏çÂêàÊ≥ïÁöÑ</td>
</tr>
<tr>
<td>STRICT_TRANS_TABLES</td>
<td>‰∏•Ê†ºÊ®°ÂºèÔºåËøõË°åÊï∞ÊçÆÁöÑ‰∏•Ê†ºÊ†°È™åÔºåÈîôËØØÊï∞ÊçÆ‰∏çËÉΩÊèíÂÖ•ÔºåÊä•errorÈîôËØØ„ÄÇÂ¶ÇÊûú‰∏çËÉΩÂ∞ÜÁªôÂÆöÁöÑÂÄºÊèíÂÖ•Âà∞‰∫ãÂä°Ë°®‰∏≠ÔºåÂàôÊîæÂºÉËØ•ËØ≠Âè•„ÄÇÂØπ‰∫éÈùû‰∫ãÂä°Ë°®ÔºåÂ¶ÇÊûúÂÄºÂá∫Áé∞Âú®ÂçïË°åËØ≠Âè•ÊàñÂ§öË°åËØ≠Âè•ÁöÑÁ¨¨1Ë°åÔºåÂàôÊîæÂºÉËØ•ËØ≠Âè•</td>
</tr>
<tr>
<td>NO_ZERO_IN_DATE</td>
<td>Âú®‰∏•Ê†ºÊ®°ÂºèÔºå‰∏çÊé•ÂèóÊúàÊàñÊó•ÈÉ®ÂàÜ‰∏∫0ÁöÑÊó•Êúü</td>
</tr>
<tr>
<td>NO_ZERO_DATE</td>
<td>Âú®‰∏•Ê†ºÊ®°ÂºèÔºå‰∏çË¶ÅÂ∞Ü &lsquo;0000-00-00&rsquo;ÂÅö‰∏∫ÂêàÊ≥ïÊó•Êúü</td>
</tr>
<tr>
<td>ERROR_FOR_DIVISION_BY_ZERO</td>
<td>Âú®‰∏•Ê†ºÊ®°ÂºèÔºåÂú®INSERTÊàñUPDATEËøáÁ®ã‰∏≠ÔºåÂ¶ÇÊûúË¢´Èõ∂Èô§(ÊàñMOD(XÔºå0))ÔºåÂàô‰∫ßÁîüÈîôËØØ(Âê¶Âàô‰∏∫Ë≠¶Âëä)</td>
</tr>
<tr>
<td>NO_ENGINE_SUBSTITUTION</td>
<td>Â¶ÇÊûúÈúÄË¶ÅÁöÑÂ≠òÂÇ®ÂºïÊìéË¢´Á¶ÅÁî®ÊàñÊú™ÁºñËØëÔºåÈÇ£‰πàÊäõÂá∫ÈîôËØØ</td>
</tr>
</tbody>
</table>
<h3 id="ÂàóÁöÑÊï∞ÊçÆÁ±ªÂûã">ÂàóÁöÑÊï∞ÊçÆÁ±ªÂûã</h3>
<p><strong>Êï∞Â≠óÁ±ªÂûã-Êï¥Âûã</strong></p>
<table>
<thead>
<tr>
<th>Á±ªÂûã</th>
<th>Âç†Áî®Â≠óËäÇ</th>
<th>Êó†Á¨¶Âè∑ËåÉÂõ¥</th>
<th>ÊúâÁ¨¶Âè∑ËåÉÂõ¥</th>
<th>Êï∞ÊçÆÈïøÂ∫¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>tinyint</td>
<td>1</td>
<td>0-255</td>
<td>-128-127</td>
<td>3</td>
</tr>
<tr>
<td>smallint</td>
<td>2</td>
<td>0-65535</td>
<td>-32768~32767</td>
<td>5</td>
</tr>
<tr>
<td>mediumint</td>
<td>3</td>
<td>0~16777215</td>
<td>-8388608~8388607</td>
<td>8</td>
</tr>
<tr>
<td>int</td>
<td>4</td>
<td>0~2^32</td>
<td>-2^31~ 2^32-1</td>
<td>10</td>
</tr>
<tr>
<td>bigint</td>
<td>5</td>
<td>0~2^64</td>
<td>-2^63~ 2^63-1</td>
<td>20</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Ëß£ÊÉëÔºöint(11) Âï•ÊÑèÊÄùÔºü‰∏çÊòØÈïøÂ∫¶Â∑≤Áªè‰∏ÄÂÆö‰∫ÜÂêóÔºü</p>
<p>11 ‰ª£Ë°®ÁöÑÂπ∂‰∏çÊòØÈïøÂ∫¶ÔºåËÄåÊòØÂ≠óÁ¨¶ÁöÑÊòæÁ§∫ÂÆΩÂ∫¶ÔºåÂú®Êó†Á¨¶Âè∑‰∏îÂ°´ÂÖÖÈõ∂Ôºà<code>UNSIGNED ZEROFILL</code>Ôºâ‰∏ãÊâçÊúâ‰ΩúÁî®Ôºå‰æãÂ¶ÇÔºö<code>b INT(11) UNSIGNED ZEROFILL NOT NULL</code></p>
<pre tabindex="0"><code>+-------------+
| b           |
+-------------+
| 00000000001 |
| 01234567890 |
+-------------+
</code></pre></blockquote>
<p><strong>Êï∞Â≠óÁ±ªÂûã-ÊµÆÁÇπÂûã‰∏éÂÆöÁÇπÊï∞</strong></p>
<p>Âª∫ËÆÆÔºö‰ΩøÁî®Êï¥ÂΩ¢Á±ªÂûãÂ≠òÂÇ®Â∞èÊï∞</p>
<ul>
<li>FLoat</li>
</ul>
<p>‚Äã       FloatÔºöË°®Á§∫‰∏çÊåáÂÆöÂ∞èÊï∞‰ΩçÁöÑÊµÆÁÇπÊï∞</p>
<p>‚Äã       Float(M,D)ÔºöË°®Á§∫‰∏ÄÂÖ±Â≠òÂÇ®M‰∏™ÊúâÊïàÊï∞Â≠óÔºåÂÖ∂‰∏≠Â∞èÊï∞ÈÉ®ÂàÜÂç†D‰Ωç</p>
<p>‚Äã       Float(10,2)ÔºöÊï¥Êï∞ÈÉ®ÂàÜ‰∏∫8‰ΩçÔºåÂ∞èÊï∞ÈÉ®ÂàÜ‰∏∫2‰Ωç</p>
<ul>
<li>Double</li>
</ul>
<p>‚Äã       DoubleÂèàÁß∞‰πã‰∏∫ÂèåÁ≤æÂ∫¶ÔºöÁ≥ªÁªüÁî®8‰∏™Â≠óËäÇÊù•Â≠òÂÇ®Êï∞ÊçÆÔºåË°®Á§∫ÁöÑËåÉÂõ¥Êõ¥Â§ßÔºå10^308Ê¨°ÊñπÔºå‰ΩÜÊòØÁ≤æÂ∫¶‰πüÂè™Êúâ15‰ΩçÂ∑¶Âè≥</p>
<ul>
<li>Decimal</li>
</ul>
<p>‚Äã       DecimalÁ≥ªÁªüËá™Âä®Ê†πÊçÆÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÊù•ÂàÜÈÖçÂ≠òÂÇ®Á©∫Èó¥ÔºåÊØèÂ§ßÊ¶Ç9‰∏™Êï∞Â∞±‰ºöÂàÜÈÖçÂõõ‰∏™Â≠óËäÇÊù•ËøõË°åÂ≠òÂÇ®ÔºåÂêåÊó∂Â∞èÊï∞ÂíåÊï¥Êï∞ÈÉ®ÂàÜÊòØÂàÜÂºÄÁöÑ„ÄÇ</p>
<p>‚Äã       ÂÆöÁÇπÊï∞ÔºöËÉΩÂ§ü‰øùËØÅÊï∞ÊçÆÁ≤æÁ°ÆÁöÑÂ∞èÊï∞ÔºàÂ∞èÊï∞ÈÉ®ÂàÜÂèØËÉΩ‰∏çÁ≤æÁ°ÆÔºåË∂ÖÂá∫ÈïøÂ∫¶‰ºöÂõõËàç‰∫îÂÖ•ÔºâÔºåÊï¥Êï∞ÈÉ®ÂàÜ‰∏ÄÂÆöÁ≤æÁ°Æ</p>
<p>‚Äã       Decimal(M,D)ÔºöMË°®Á§∫ÊÄªÈïøÂ∫¶ÔºåÊúÄÂ§ßÂÄº‰∏çËÉΩË∂ÖËøá65ÔºåD‰ª£Ë°®Â∞èÊï∞ÈÉ®ÂàÜÈïøÂ∫¶ÔºåÊúÄÈïø‰∏çËÉΩË∂ÖËøá30</p>
<p><strong>Â≠óÁ¨¶‰∏≤Á±ªÂûã</strong></p>
<ul>
<li>
<p>Char(L)</p>
<p>Á≥ªÁªü‰∏ÄÂÆö‰ºöÂàÜÈÖçÊåáÂÆöÁöÑÁ©∫Èó¥Áî®‰∫éÂ≠òÂÇ®Êï∞ÊçÆÔºåLÂèñÂÄºËåÉÂõ¥0Âà∞255</p>
</li>
<li>
<p>Varchar(L)</p>
<p>ÂèòÈïøÂ≠óÁ¨¶ÔºöÊåáÂÆöÈïøÂ∫¶‰πãÂêéÔºåÁ≥ªÁªü‰ºöÊ†πÊçÆÂÆûÈôÖÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÈïøÂ∫¶ÂíåÊï∞ÊçÆÔºåÊâÄ‰ª•ÊØè‰∏™varcharÊï∞ÊçÆ‰∫ßÁîüÂêéÔºåÁ≥ªÁªüÈÉΩ‰ºöÂú®Êï∞ÊçÆÂêéÈù¢Â¢ûÂä†1-2‰∏™Â≠óËäÇÁöÑÈ¢ùÂ§ñÂºÄÈîÄ„ÄÇÂ¶ÇÊûúÊï∞ÊçÆÊú¨Ë∫´Â∞è‰∫é255‰∏™Â≠óÁ¨¶ÔºöÈ¢ùÂ§ñÂºÄÈîÄ‰∏Ä‰∏™Â≠óËäÇÔºõÂ¶ÇÊûúÂ§ß‰∫é255‰∏™ÔºåÂ∞±ÂºÄÈîÄ‰∏§‰∏™Â≠óËäÇ</p>
<p>Âü∫Êú¨ËØ≠Ê≥ïÔºöVarchar(L)ÔºåLÁöÑÈïøÂ∫¶ÁêÜËÆ∫ÂÄº‰Ωç0Âà∞65535</p>
</li>
</ul>
<p>‚Äã       <span style="color:red">Â¶ÇÊûúÊï∞ÊçÆÈïøÂ∫¶Ë∂ÖËøá255‰∏™Â≠óÁ¨¶Ôºå‰∏çËÆ∫ÊòØÂê¶Âõ∫ÂÆöÈïøÂ∫¶ÔºåÈÉΩ‰ºö‰ΩøÁî®textÔºå‰∏çÂÜç‰ΩøÁî®charÂíåvarchar</span></p>
<ul>
<li>
<p>ÈïøÊñáÊú¨Á±ªÂûã</p>
<p>TextÔºöÂÖÅËÆ∏Â≠òÊîæ65535Â≠óËäÇÂÜÖÁöÑÊñáÂ≠óÂ≠óÁ¨¶‰∏≤Â≠óÊÆµÁ±ªÂûã</p>
<p>MediumtextÔºöÂÖÅËÆ∏Â≠òÊîæ16777215Â≠óËäÇÂÜÖÁöÑÊñáÂ≠óÂ≠óÁ¨¶‰∏≤Â≠óÊÆµÁ±ªÂûã</p>
<p>LongtextÔºöÂÖÅËÆ∏Â≠òÊîæ2147483647Â≠óËäÇÂÜÖÁöÑÊñáÂ≠óÂ≠óÁ¨¶‰∏≤Â≠óÊÆµÁ±ªÂûã</p>
</li>
</ul>
<p><strong>Êó∂Èó¥Á±ªÂûã</strong></p>
<table>
<thead>
<tr>
<th>Á±ªÂûã</th>
<th>Âç†Áî®Â≠óËäÇ</th>
<th>ËåÉÂõ¥</th>
<th>Ê†ºÂºè</th>
<th>Áî®ÈÄî</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE</td>
<td>3</td>
<td>1000-01-01/9999-12-31</td>
<td>YYYY-MM-DD</td>
<td>Êó•Êúü</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>&lsquo;-838:59:59&rsquo;/&lsquo;838:59:59&rsquo;</td>
<td>HH:MM:SS</td>
<td>Êó∂Èó¥ÂÄºÊàñÊåÅÁª≠Êó∂Èó¥</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901/2155</td>
<td>YYYY</td>
<td>Âπ¥‰ªΩ</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>1000-01-01 00:00:00/<br />9999-12-31 23:59:59</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>Ê∑∑ÂêàÊó•ÊúüÂíåÊó∂Èó¥</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>1970-01-01 00:00:00/<br />2038-1-19 11:14:07</td>
<td>YYYYMMDD</td>
<td>Êó∂Èó¥Êà≥</td>
</tr>
</tbody>
</table>
<h3 id="Â∏∏Áî®ÂáΩÊï∞">Â∏∏Áî®ÂáΩÊï∞</h3>
<p><strong>Â≠óÁ¨¶ÂáΩÊï∞</strong></p>
<table>
<thead>
<tr>
<th>ÂáΩÊï∞Âêç</th>
<th>‰ΩúÁî®</th>
<th>Á§∫‰æã</th>
</tr>
</thead>
<tbody>
<tr>
<td>length</td>
<td>Ëé∑ÂèñÂ≠óËäÇÈáèÔºåÊî∂Âà∞Â≠óÁ¨¶ÈõÜÂΩ±Âìç</td>
<td>length(&lsquo;abc&rsquo;)</td>
</tr>
<tr>
<td>concat</td>
<td>ÊãºÊé•Â≠óÁ¨¶‰∏≤</td>
<td>concat(&rsquo;%&rsquo;, &lsquo;abc&rsquo;, &lsquo;%&rsquo;)</td>
</tr>
<tr>
<td>upper&amp;lower</td>
<td>ËΩ¨Êç¢Â§ßÂ∞èÂÜô</td>
<td>upper(&lsquo;abc&rsquo;)</td>
</tr>
<tr>
<td>substr</td>
<td>Êà™ÂèñÂ≠óÁ¨¶‰∏≤</td>
<td>substr(Â≠óÁ¨¶‰∏≤,pos,[len])</td>
</tr>
<tr>
<td>trim</td>
<td>ÊéêÂ§¥ÂéªÂ∞æ</td>
<td>trim(&rsquo; s &lsquo;)</td>
</tr>
<tr>
<td>lpad&amp;rpad</td>
<td>Â∑¶/Âè≥Â°´ÂÖÖ</td>
<td>lpad(&lsquo;1&rsquo;,2, 0)</td>
</tr>
<tr>
<td>replace</td>
<td>ÊõøÊç¢</td>
<td>replace(uuid(), &lsquo;-&rsquo;, &lsquo;&rsquo;)</td>
</tr>
</tbody>
</table>
<p><strong>Êï∞Â≠¶ÂáΩÊï∞</strong></p>
<table>
<thead>
<tr>
<th>ÂáΩÊï∞Âêç</th>
<th>‰ΩúÁî®</th>
<th>Á§∫‰æã</th>
</tr>
</thead>
<tbody>
<tr>
<td>round</td>
<td>ÂõõËàç‰∫îÂÖ•</td>
<td>round(3.1415, 2)</td>
</tr>
<tr>
<td>ceil</td>
<td>Âêë‰∏äÂèñÊï¥</td>
<td>ceil(3.14)</td>
</tr>
<tr>
<td>floor</td>
<td>Âêë‰∏ãÂèñÊï¥</td>
<td>floor(9.99)</td>
</tr>
<tr>
<td>truncate</td>
<td>Â∞èÊï∞ÁÇπ‰øùÁïôÊà™Êñ≠</td>
<td>truncate(3.15, 1)</td>
</tr>
<tr>
<td>mod</td>
<td>ÂèñÊ®°</td>
<td>mod(10, 3)</td>
</tr>
<tr>
<td>rand</td>
<td>ÁîüÊàêÔºà-‚àû, 0]ËåÉÂõ¥ÂÜÖÁöÑÈöèÊú∫Êï¥Êï∞</td>
<td>rand()*10</td>
</tr>
</tbody>
</table>
<p><strong>Êó•ÊúüÂáΩÊï∞</strong></p>
<table>
<thead>
<tr>
<th>ÂáΩÊï∞Âêç</th>
<th>‰ΩúÁî®</th>
<th>Á§∫‰æã</th>
</tr>
</thead>
<tbody>
<tr>
<td>now</td>
<td>ËøîÂõûÂΩìÂâçÊó∂Èó¥ÔºåÁ±ªÂûãDATETIME</td>
<td>now()</td>
</tr>
<tr>
<td>curdate</td>
<td>ËøîÂõûÊó•ÊúüÔºåÁ±ªÂûãDATE</td>
<td>curdate()</td>
</tr>
<tr>
<td>curtime</td>
<td>ËøîÂõûÊó∂Èó¥ÂÄºÔºåÁ±ªÂûãTIME</td>
<td>curtime()</td>
</tr>
<tr>
<td>current_timestamp</td>
<td>ËøîÂõûÊó∂Èó¥Êà≥ÔºåÁ±ªÂûãTIMESTAMP</td>
<td>current_timestamp()</td>
</tr>
<tr>
<td>month<br />day<br />hour<br />minute<br />second<br />year</td>
<td>Êà™ÂèñÊó∂Èó¥‰ø°ÊÅØ</td>
<td>year(now())</td>
</tr>
<tr>
<td>str_to_date</td>
<td>‰ª•ÊåáÂÆöÊ†ºÂºèËØÜÂà´Êó•Êúü</td>
<td>str_to_date(&lsquo;2023-01-07 14:57:00&rsquo;,&rsquo;%y-%m-%d %h:%i:%s&rsquo;)</td>
</tr>
<tr>
<td>date_format</td>
<td>‰ª•ÊåáÂÆöÂ≠óÁ¨¶‰∏≤Ê†ºÂºèËæìÂá∫Êó•Êúü</td>
<td>date_format(now(),&rsquo;%y-%m-%d %h:%i:%s&rsquo;)</td>
</tr>
</tbody>
</table>
<p><strong>ÂàÜÁªÑÁªüËÆ°</strong></p>
<table>
<thead>
<tr>
<th>ÂáΩÊï∞Âêç</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody>
<tr>
<td>sum</td>
<td>Êï∞ÂÄºÂûãÊï∞ÊçÆÁªüËÆ°</td>
</tr>
<tr>
<td>avg</td>
<td>Êï∞ÂÄºÂûãÊï∞ÊçÆÂπ≥ÂùáÂÄº</td>
</tr>
<tr>
<td>max</td>
<td>‰ªª‰ΩïÁ±ªÂûãÊï∞ÊçÆÊúÄÂ§ßÂÄº</td>
</tr>
<tr>
<td>min</td>
<td>‰ªª‰ΩïÁ±ªÂûãÊï∞ÊçÆÊúÄÂ∞èÂÄº</td>
</tr>
<tr>
<td>count</td>
<td>ÈùûÁ©∫ÂÄº‰∏™Êï∞</td>
</tr>
<tr>
<td>group_concat</td>
<td>Âêå‰∏Ä‰∏™ÂàÜÁªÑ‰∏≠ÁöÑÂÄº</td>
</tr>
</tbody>
</table>
<p><strong>ÊµÅÁ®ãÊéßÂà∂ÂáΩÊï∞</strong></p>
<p>ifÂáΩÊï∞ÔºåÁ§∫‰æãÔºö</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span>(<span style="color:#099">2</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">1</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;yes&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;no&#39;</span>)<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>caseÂáΩÊï∞ÔºåÁ§∫‰æãÔºö</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">CASE</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">		</span><span style="color:#099">110</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">		</span><span style="color:#000;font-weight:bold">WHEN</span><span style="color:#bbb"> </span><span style="color:#099">110</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">THEN</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;Ë≠¶ÂØü&#39;</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">		</span><span style="color:#000;font-weight:bold">WHEN</span><span style="color:#bbb"> </span><span style="color:#099">119</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">THEN</span><span style="color:#d14">&#39;Ê∂àÈò≤Èòü&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">ELSE</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ÂÖ∂ÂÆÉÂè∑Á†Å&#39;</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">END</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7Á¥¢ÂºïÊâßË°åËÆ°Âàí">7„ÄÅÁ¥¢Âºï&amp;ÊâßË°åËÆ°Âàí</h2>
<h3 id="sqlÁöÑÊâßË°åÊµÅÁ®ã">SQLÁöÑÊâßË°åÊµÅÁ®ã</h3>
<img src="/img/dba/SQLÁöÑÊâßË°åÊµÅÁ®ã.png" alt="SQLÁöÑÊâßË°åÊµÅÁ®ã" style="zoom:67%;" />
<p>‰∏ªË¶ÅÂàÜ‰∏∫Âõõ‰∏™Èò∂ÊÆµÔºöÈ¢ÑÂ§ÑÁêÜ„ÄÅËß£Êûê„ÄÅ‰ºòÂåñ„ÄÅÊâßË°åËØ≠Âè•</p>
<p><strong>È¢ÑÂ§ÑÁêÜ</strong>ÔºöÂà§Êñ≠ËØ≠Âè•‰∏≠ÁöÑËØ≠Ê≥ï„ÄÅËØ≠‰πâ„ÄÅÊùÉÈôêÂ§ÑÁêÜÁ≠â</p>
<p><strong>Ëß£Êûê</strong>    ÔºöÊ†°È™åOKÔºåÂ∞±ÁîüÊàê‚ÄúËß£ÊûêÊ†ë‚ÄùÔºåÊääËØ≠Âè•ÊãÜÂàÜÊàêÂ§ö‰∏™ÂùóÔºåÁîüÊàê‰∏ÄÁßçÊ†ëÂΩ¢ÁªìÊûÑÊù•Ë°®Á§∫ÊâßË°åÈ°∫Â∫è„ÄÇËß£ÊûêÂá∫Êù•ÁöÑÊ†ëÂè´ÊäΩÂÉèËØ≠Ê≥ïÊ†ëAST</p>
<p><strong>‰ºòÂåñ</strong>    ÔºöÂàÜ‰∏∫ÈÄªËæë‰ºòÂåñÂíåÁâ©ÁêÜ‰ºòÂåñ„ÄÇÈ¢Ñ‰º∞ÊØèÊù°ÊâßË°åÊñπÂºèÁöÑÊàêÊú¨ÔºåÈÄâÊã©ÊàêÊú¨ÊúÄÂ∞èÁöÑÊâßË°åÊñπÂºèÔºåÊúÄÁªàËΩ¨Âåñ‰∏∫ÊâßË°åËÆ°Âàíexplain</p>
<ol>
<li>ÈÄªËæë‰ºòÂåñÔºöÂ∞Ü SQL ËØ≠Ê≥ïÊ†ë‰∏≠ÁöÑË∞ìËØçËΩ¨Âåñ‰∏∫ÈÄªËæë‰ª£Êï∞Êìç‰ΩúÁ¨¶ÔºåÂØπÊù°‰ª∂Ë°®ËææÂºèËøõË°åÁ≠â‰ª∑Ë∞ìËØçÈáçÂÜô„ÄÅÊù°‰ª∂ÁÆÄÂåñÔºåÂØπËßÜÂõæËøõË°åÈáçÂÜôÔºåÂØπÂ≠êÊü•ËØ¢ËøõË°å‰ºòÂåñÔºåÂØπËøûÊé•ËØ≠‰πâËøõË°å‰∫ÜÂ§ñËøûÊé•Ê∂àÈô§„ÄÅÂµåÂ•óËøûÊé•Ê∂àÈô§Á≠â</li>
<li>Áâ©ÁêÜ‰ºòÂåñÔºöÁªüËÆ°‰ø°ÊÅØÔºàË°®ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÊØîÂ¶ÇË°®Âêç„ÄÅÊï∞ÊçÆË°å„ÄÅÊï∞ÊçÆÂàÜÂ∏É„ÄÅÁ¥¢ÂºïÁä∂ÊÄÅ‰ø°ÊÅØÔºâ„ÄÅÈÄâÊã©Á¥¢ÂºïÂíåÁÆóÊ≥ï</li>
</ol>
<p><strong>ÊâßË°å</strong>    ÔºöÊ†πÊçÆÊâßË°åËÆ°ÂàíÂéªÊâßË°åËØ≠Âè•</p>
<h3 id="Á¥¢Âºï">Á¥¢Âºï</h3>
<p><strong>BTREE Êü•ÊâæÁÆóÊ≥ïÊºîÂèò</strong></p>
<p><img src="/img/dba/B-Tree.png" alt="B-Tree"></p>
<p>B-Ê†ëÊúâÂ¶Ç‰∏ãÁâπÁÇπ:</p>
<ol>
<li>ÊâÄÊúâÈîÆÂÄºÂàÜÂ∏ÉÂú®Êï¥È¢óÊ†ë‰∏≠ÔºàÁ¥¢ÂºïÂÄºÂíåÂÖ∑‰ΩìdataÈÉΩÂú®ÊØè‰∏™ËäÇÁÇπÈáåÔºâ</li>
<li>‰ªª‰Ωï‰∏Ä‰∏™ÂÖ≥ÈîÆÂ≠óÂá∫Áé∞‰∏îÂè™Âá∫Áé∞Âú®‰∏Ä‰∏™ÁªìÁÇπ‰∏≠</li>
<li>ÊêúÁ¥¢ÊúâÂèØËÉΩÂú®ÈùûÂè∂Â≠êÁªìÁÇπÁªìÊùüÔºàÊúÄÂ•ΩÊÉÖÂÜµO(1)Â∞±ËÉΩÊâæÂà∞Êï∞ÊçÆÔºâ</li>
<li>Âú®ÂÖ≥ÈîÆÂ≠óÂÖ®ÈõÜÂÜÖÂÅö‰∏ÄÊ¨°Êü•Êâæ,ÊÄßËÉΩÈÄºËøë‰∫åÂàÜÊü•Êâæ</li>
</ol>
<p><img src="/img/dba/B+Tree.png" alt="B+Tree"></p>
<p>B+Ê†ëÊúâÂ¶Ç‰∏ãÁâπÁÇπ:</p>
<ol>
<li>ÊâÄÊúâÂÖ≥ÈîÆÂ≠óÂ≠òÂÇ®Âú®Âè∂Â≠êËäÇÁÇπÂá∫Áé∞,ÂÜÖÈÉ®ËäÇÁÇπ(ÈùûÂè∂Â≠êËäÇÁÇπÂπ∂‰∏çÂ≠òÂÇ®ÁúüÊ≠£ÁöÑ data)</li>
<li>‰∏∫ÊâÄÊúâÂè∂Â≠êÁªìÁÇπÂ¢ûÂä†‰∫Ü‰∏Ä‰∏™ÈìæÊåáÈíà</li>
</ol>
<p><strong>ËÅöÁ∞áÁ¥¢Âºï</strong></p>
<img src="/img/dba/ËÅöÁ∞áÁ¥¢Âºï.png" alt="ËÅöÁ∞áÁ¥¢Âºï" style="zoom:70%;" />
<p>InnoDBË°®‰∏≠‰∏ÄÂÆöÊòØÊúâËÅöÁ∞áÁ¥¢ÂºïÁöÑÔºåËÅöÁ∞áÁ¥¢ÂºïÁöÑÂª∫Á´ãËßÑÂàôÂ¶Ç‰∏ã</p>
<p>1„ÄÅ Â¶ÇÊûúË°®‰∏≠ËÆæÁΩÆ‰∫Ü‰∏ªÈîÆÔºà‰æãÂ¶ÇIDÂàóÔºâÔºåËá™Âä®Ê†πÊçÆIDÂàóÁîüÊàêËÅöÁ∞áÁ¥¢Âºï</p>
<p>2„ÄÅ Â¶ÇÊûúÊ≤°ÊúâËÆæÁΩÆ‰∏ªÈîÆÔºåËá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™ÈùûÁ©∫ÂîØ‰∏ÄÈîÆÁöÑÂàó‰Ωú‰∏∫ËÅöÁ∞áÁ¥¢Âºï</p>
<p>3„ÄÅ Ëá™Âä®ÁîüÊàêÈöêËóèÔºà6Â≠óËäÇrow_idÔºâÁöÑËÅöÁ∞áÁ¥¢Âºï</p>
<p><strong>ËæÖÂä©Á¥¢Âºï</strong></p>
<p>ÈúÄË¶Å‰∫∫‰∏∫ÂàõÂª∫ËæÖÂä©Á¥¢ÂºïÔºåÂ∞ÜÁªèÂ∏∏‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ÁöÑÂàóÂàõÂª∫ËæÖÂä©Á¥¢ÂºïÔºåËµ∑Âà∞Âä†ÈÄüÊü•ËØ¢ÁöÑÊïàÊûú„ÄÇÂè∂Â≠êËäÇÁÇπÂ≠òÂÇ®ÁöÑÊòØ‰∏ªÈîÆID„ÄÇ‰ΩøÁî®ËæÖÂä©Á¥¢ÂºïÊü•Âá∫ÂØπÂ∫îÁöÑ‰∏ªÈîÆIDÔºåÂèØËÉΩ‰ºöÁî®Ëøô‰∫õ‰∏ªÈîÆIDÊü•ËØ¢ËÅöÁ∞áÁ¥¢ÂºïÔºåËøô‰∏™ËøáÁ®ãÂè´ÂÅöÂõûË°®</p>
<img src="/img/dba/ËæÖÂä©Á¥¢Âºï.png" alt="ËæÖÂä©Á¥¢Âºï" style="zoom:67%;" />
<h3 id="ÊâßË°åËÆ°Âàí">ÊâßË°åËÆ°Âàí</h3>
<p>Ëé∑ÂèñËØ≠Âè•ÁöÑÊâßË°åËÆ°ÂàíÂ∑•ÂÖ∑ÔºåÂè™ÈíàÂØπÁ¥¢ÂºïÂ∫îÁî®Âíå‰ºòÂåñÂô®ÁÆóÊ≥ïÂ∫îÁî®ÈÉ®ÂàÜ‰ø°ÊÅØÔºå‰∏ç‰ºöÊâßË°åËØ≠Âè•„ÄÇ</p>
<p><strong>‰ΩøÁî®ÊñπÂºè</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explain</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span>[formrt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;json&#39;</span><span style="color:#000;font-weight:bold">/</span><span style="color:#d14">&#39;tree&#39;</span>]<span style="color:#bbb"> </span>SQLËØ≠Âè•<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊâßË°åËÆ°Âàí‰ø°ÊÅØ‰ªãÁªç</strong></p>
<ul>
<li>
<p><span style="color:RGB(247,153,5)">id</span>ÔºöÊü•ËØ¢ÁöÑÈ°∫Â∫èÔºåË°®Á§∫ÊâßË°åÁöÑÈ°∫Â∫èÔºåidË∂äÂ§ßË∂äÂÖàÊâßË°åÔºåid‰∏ÄÊ†∑ÁöÑ‰ªé‰∏äÂæÄ‰∏ãÊâßË°å</p>
<blockquote>
<p>‰ΩøÁî®formrt=&lsquo;tree&rsquo;ÂèØÊõ¥Âä†Áõ¥ËßÇÁúãÂá∫ÊâßË°åÈ°∫Â∫è„ÄÇ‰ªéÂè≥Âà∞Â∑¶Ôºå‰ªé‰∏äÂà∞‰∏ãÈòÖËØª</p>
</blockquote>
</li>
<li>
<p><span style="color:RGB(247,153,5)">select_type</span>ÔºöË°®Á§∫Êü•ËØ¢Á±ªÂûã</p>
<table>
<thead>
<tr>
<th>ÂÄº</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>simple</td>
<td>Ë°®Á§∫‰∏çÈúÄË¶ÅunionÊìç‰ΩúÊàñËÄÖ‰∏çÂåÖÂê´Â≠êÊü•ËØ¢ÁöÑÁÆÄÂçïÊü•ËØ¢</td>
</tr>
<tr>
<td>primary</td>
<td>Ë°®Á§∫ÊúÄÂ§ñÂ±ÇÊü•ËØ¢</td>
</tr>
<tr>
<td>union</td>
<td>unionÊìç‰Ωú‰∏≠Á¨¨‰∫å‰∏™Âèä‰πãÂêéÁöÑÊü•ËØ¢</td>
</tr>
<tr>
<td>dependent union</td>
<td>unionÊìç‰Ωú‰∏≠Á¨¨‰∫å‰∏™Âèä‰πãÂêéÁöÑÊü•ËØ¢ÔºåÂπ∂‰∏îËØ•Êü•ËØ¢‰æùËµñ‰∫éÂ§ñÈÉ®Êü•ËØ¢</td>
</tr>
<tr>
<td>subquery</td>
<td>Â≠êÊü•ËØ¢‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Êü•ËØ¢</td>
</tr>
<tr>
<td>dependent subquery</td>
<td>Â≠êÊü•ËØ¢‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Êü•ËØ¢ÔºåÂπ∂‰∏îËØ•Êü•ËØ¢‰æùËµñ‰∫éÂ§ñÈÉ®Êü•ËØ¢</td>
</tr>
<tr>
<td>derived</td>
<td>Ê¥æÁîüË°®Êü•ËØ¢ÔºåÊó¢fromÂ≠óÂè•‰∏≠ÁöÑÂ≠êÊü•ËØ¢</td>
</tr>
<tr>
<td>materialized</td>
<td>Áâ©ÂåñÊü•ËØ¢</td>
</tr>
<tr>
<td>uncacheable subquery</td>
<td>Êó†Ê≥ïË¢´ÁºìÂ≠òÁöÑÂ≠êÊü•ËØ¢ÔºåÂØπÂ§ñÈÉ®Êü•ËØ¢ÁöÑÊØè‰∏ÄË°åÈÉΩÈúÄË¶ÅÈáçÊñ∞ËøõË°åÊü•ËØ¢</td>
</tr>
<tr>
<td>uncacheable union</td>
<td>unionÊìç‰Ωú‰∏≠Á¨¨‰∫å‰∏™Âèä‰πãÂêéÁöÑÊü•ËØ¢ÔºåÂπ∂‰∏îËØ•Êü•ËØ¢Â±û‰∫éuncacheable subquery</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><span style="color:RGB(247,153,5)">table</span>ÔºöÊ≠§Ê¨°Êü•ËØ¢ËÆøÈóÆÁöÑË°®</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">partitions</span>ÔºöÂàÜÂå∫‰ø°ÊÅØÔºåÈùûÂàÜÂå∫Ë°®‰∏∫null</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">type</span>ÔºöÊü•ËØ¢Êó∂‰ΩøÁî®Á¥¢ÂºïÁöÑÁ±ªÂûã</p>
<table>
<thead>
<tr>
<th>ÂÄº</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALL</td>
<td>Ê≤°Êúâ‰ΩøÁî®Âà∞Á¥¢Âºï</td>
</tr>
<tr>
<td>index</td>
<td>ÂÖ®Á¥¢ÂºïÊâ´ÊèèÔºåÂ¶ÇÊûúÊó∂ËÅöÁ∞áÁ¥¢ÂºïÂàóÁõ∏ÂΩì‰∫éÂÖ®Ë°®Êâ´Êèè</td>
</tr>
<tr>
<td>range</td>
<td>Á¥¢ÂºïËåÉÂõ¥Êâ´Êèè</td>
</tr>
<tr>
<td>ref</td>
<td>ËæÖÂä©Á¥¢ÂºïÁ≠âÂÄºÊü•ËØ¢</td>
</tr>
<tr>
<td>eq_ref</td>
<td>Â§öË°®ËøûÊé•Êü•ËØ¢‰∏≠ÔºåÈùûÈ©±Âä®Ë°®ÁöÑËøûÊé•Êù°‰ª∂ÊòØ‰∏ªÈîÆÊàñÂîØ‰∏ÄÈîÆÊó∂</td>
</tr>
<tr>
<td>const / system</td>
<td>‰∏ªÈîÆÊàñÂîØ‰∏ÄÈîÆÁ≠âÂÄºÊü•ËØ¢</td>
</tr>
<tr>
<td>NULL</td>
<td>Êó†ÈúÄËÆøÈóÆË°®ÊàñËÄÖÁ¥¢Âºï</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><span style="color:RGB(247,153,5)">possible_keys</span>ÔºöÂèØËÉΩ‰ºöÂ∫îÁî®ÁöÑÁ¥¢Âºï</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">key</span>ÔºöÊúÄÁªàÈÄâÊã©ÁöÑÁ¥¢Âºï</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">key_len</span>ÔºöÁî®Êù•Âà§Êñ≠ËÅîÂêàÁ¥¢ÂºïÂ∫îÁî®ÁöÑÈÉ®ÂàÜ„ÄÇÂÄºÊòØÁúüÂÆûÂ≠óËäÇÊï∞ÔºåÂ¶ÇÊûú‰∏çÊòØÈùûÁ©∫Á∫¶ÊùüÂàóÔºåËÆ∞ÂæóË¶ÅÂä†1</p>
<blockquote>
<p>format=jsonÂú®used_key_partsÂ≠óÊÆµ‰∏äÂèØ‰ª•Áõ¥ËßÇÁöÑÁúãÂá∫</p>
</blockquote>
</li>
<li>
<p><span style="color:RGB(247,153,5)">ref</span>ÔºöË°®Á§∫ËøûÊé•Êü•ËØ¢ÁöÑËøûÊé•Êù°‰ª∂</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">rows</span>ÔºöÈúÄË¶ÅÊâ´ÊèèÁöÑË°åÊï∞</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">filtered</span>ÔºöÊüê‰∏™Ë°®ÁªèËøáÊêúÁ¥¢Êù°‰ª∂ËøáÊª§ÂêéÂâ©‰ΩôËÆ∞ÂΩïÊù°Êï∞ÁöÑÁôæÂàÜÊØî</p>
</li>
<li>
<p><span style="color:RGB(247,153,5)">Extra</span>ÔºöÈ¢ùÂ§ñ‰ø°ÊÅØÔºåÂ∏∏ËßÅÂ¶Ç‰∏ãÂÄº</p>
<table>
<thead>
<tr>
<th>‰ø°ÊÅØÊèèËø∞</th>
<th>Ëß£Èáä</th>
</tr>
</thead>
<tbody>
<tr>
<td>No tables used</td>
<td>ÂΩìÊü•ËØ¢ËØ≠Âè•ÁöÑÊ≤°Êúâ FROM Â≠êÂè•Êó∂Â∞Ü‰ºöÊèêÁ§∫ËØ•È¢ùÂ§ñ‰ø°ÊÅØ</td>
</tr>
<tr>
<td>Impossible WHERE</td>
<td>Êü•ËØ¢ËØ≠Âè•ÁöÑ WHERE Â≠êÂè•Ê∞∏Ëøú‰∏∫ FALSE Êó∂Â∞Ü‰ºöÊèêÁ§∫ËØ•È¢ùÂ§ñ‰ø°ÊÅØ</td>
</tr>
<tr>
<td>Using index</td>
<td>Á¥¢ÂºïË¶ÜÁõñÁöÑÊÉÖÂÜµ</td>
</tr>
<tr>
<td>Using index condition</td>
<td>Êúâ‰∫õÊêúÁ¥¢Êù°‰ª∂‰∏≠ËôΩÁÑ∂Âá∫Áé∞‰∫ÜÁ¥¢ÂºïÂàóÔºå‰ΩÜÂç¥‰∏çËÉΩ‰ΩøÁî®Âà∞Á¥¢Âºï</td>
</tr>
<tr>
<td>Using where</td>
<td>ÂÖ®Ë°®Êâ´ÊèèÊù•ÊâßË°åÂØπÊüê‰∏™Ë°®ÁöÑÊü•ËØ¢ÔºåÂπ∂‰∏îËØ•ËØ≠Âè•ÁöÑ WHERE Â≠êÂè•‰∏≠ÊúâÈíàÂØπËØ•Ë°®ÁöÑÊêúÁ¥¢Êù°‰ª∂Êó∂</td>
</tr>
<tr>
<td>Using filesort</td>
<td>Áî®Âà∞‰∫ÜÁ¥¢ÂºïÂÅöÊéíÂ∫è</td>
</tr>
<tr>
<td>Using temporary</td>
<td>‰ΩøÁî®‰∫Ü‰∏¥Êó∂Ë°®</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="‰ºòÂåñÂô®ÈíàÂØπÁ¥¢ÂºïÁöÑÁÆóÊ≥ï">‰ºòÂåñÂô®ÈíàÂØπÁ¥¢ÂºïÁöÑÁÆóÊ≥ï</h3>
<p><strong>‰ºòÂåñÂô®ÁÆóÊ≥ïÂèäÂºÄÂêØÁä∂ÊÄÅÊü•ËØ¢</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>optimizer_switch;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Á¥¢Âºï‰∏ãÊé®Ôºàindex_condition_pushdownÔºåICPÔºâ</strong></p>
<p>‰ΩúÁî®ÔºöÊ†πÊçÆË°®Êï∞ÊçÆÂàÜÊûêÔºåËÅîÂêàÁ¥¢ÂºïÂ∞ΩÂèØËÉΩÁöÑÂ§öËøáÊª§Êï∞ÊçÆÔºåÂáèÂ∞ëÂõûË°®</p>
<p>ÂéüÁêÜÔºö‰∏ãÊé®Âà∞ÂºïÊìéÂ±ÇËøáÊª§</p>
<p>‰æãÂ¶ÇÔºöËÅîÂêàÁ¥¢ÂºïÔºàa, b, cÔºâÔºåÊâßË°åÊü•ËØ¢Êù°‰ª∂ &quot; where a = and b &gt; and c = &quot;</p>
<p>SQLÂ±ÇÂÅöÂÆåËøáÊª§ÂêéÔºåËÅîÂêàÁ¥¢ÂºïÔºàa, b, cÔºâÂè™ËÉΩÁî®Ôºàa, bÔºâÈÉ®ÂàÜÔºåÁ¥¢Âºï‰∏ãÊé®ÂèØÂ∞ÜcÂàóÊù°‰ª∂ÁöÑËøáÊª§‰∏ãÊé®Âà∞engineÂ±ÇÔºåËøõË°åÂÜçÊ¨°ËøáÊª§ÔºåÊéíÈô§Êó†Áî®ÁöÑÊï∞ÊçÆÈ°µÔºåÊúÄÁªàÂéªÁ£ÅÁõò‰∏äÊãøÊï∞ÊçÆÈ°µ</p>
<p><strong>Á¥¢ÂºïÂ§öËåÉÂõ¥Êü•ÊâæÔºàMulti Range ReadÔºåMRRÔºâ</strong></p>
<p>‰ΩúÁî®ÔºöÂáèÂ∞ëÂØπÁ£ÅÁõòÁöÑÈöèÊú∫ËÆøÈóÆÔºåËøõËÄåÂØπÂü∫Ë°®ÊâßË°åÊõ¥Â§öÁöÑÈ°∫Â∫èÊâ´Êèè</p>
<p>ÂéüÁêÜÔºöÁî±‰∫éMySQL ËæÖÂä©Á¥¢ÂºïÁöÑÂ≠òÂÇ®È°∫Â∫èÂπ∂Èùû‰∏é‰∏ªÈîÆÁöÑÈ°∫Â∫è‰∏ÄËá¥ÔºåÊâÄ‰ª•Ê†πÊçÆËæÖÂä©Á¥¢ÂºïËé∑ÂèñÁöÑ‰∏ªÈîÆÊù•ËÆøÈóÆË°®‰∏≠ÁöÑÊï∞ÊçÆ‰ºöÂØºËá¥ÈöèÊú∫ÁöÑIO„ÄÇMRRÂ∞ÜÂ§ö‰∏™ÈúÄË¶ÅÂõûË°®ÁöÑ‰∫åÁ∫ßÁ¥¢ÂºïÊ†πÊçÆ‰∏ªÈîÆËøõË°åÊéíÂ∫èÔºåÁÑ∂Âêé‰∏ÄËµ∑ÂõûË°®ÔºåÂ∞ÜÂéüÊù•ÁöÑÂõûË°®Êó∂ËøõË°åÁöÑÈöèÊú∫IOÔºåËΩ¨ÂèòÊàêÈ°∫Â∫èIO</p>
<h3 id="Ë°®ËøûÊé•ÁÆóÊ≥ï">Ë°®ËøûÊé•ÁÆóÊ≥ï</h3>
<p><strong>ÊôÆÈÄöÂµåÂ•óÂæ™ÁéØËøûÊé•ÔºàSimple Nested-Loops JoinÔºåSNLJÔºâ</strong></p>
<p>‰ºòÂåñÂô®Ëá™Âä®ÈÄâÊã©ÁªìÊûúÈõÜÂ∞èÁöÑË°®‰Ωú‰∏∫È©±Âä®Ë°®„ÄÇÂØπ‰∫é‰∏§Ë°®ËøûÊé•ÔºåÈ©±Âä®Ë°®Âè™‰ºöË¢´ËÆøÈóÆ‰∏ÄÈÅçÔºåË¢´È©±Âä®Ë°®ÂÖ∑‰ΩìËÆøÈóÆÂá†ÈÅçÂèñÂÜ≥‰∫éÂØπÈ©±Âä®Ë°®ÊâßË°åÂçïË°®Êü•ËØ¢ÂêéÁöÑÁªìÊûúÈõÜ‰∏≠ÁöÑËÆ∞ÂΩïÊù°Êï∞„ÄÇËøôÁßçÈ©±Âä®Ë°®Âè™ËÆøÈóÆ‰∏ÄÊ¨°Ôºå‰ΩÜË¢´È©±Âä®Ë°®Âç¥ÂèØËÉΩË¢´Â§öÊ¨°ËÆøÈóÆÁöÑËøûÊé•ÊâßË°åÊñπÂºèÁß∞‰πã‰∏∫ÂµåÂ•óÂæ™ÁéØËøûÊé•„ÄÇ</p>
<p><img src="/img/dba/SNLJ.webp" alt="SNLJ"></p>
<blockquote>
<p>ÂèØ‰ª•Áî®<code>left join</code>Âº∫Âà∂È©±Âä®Ë°®</p>
</blockquote>
<p><strong>Á¥¢ÂºïÂµåÂ•óÂæ™ÁéØËøûÊé•ÔºàIndex Nested Loops Join, INLJÔºâ</strong></p>
<p>Êúâ‰∏ÄÊñπÂú®ËøûÊé•Â≠óÊÆµ‰∏äÊúâÁ¥¢ÂºïÔºå‰ºòÂåñÂô®‰ºöËÄÉËôëÈÄâÊã©ÊúâÁ¥¢ÂºïÁöÑ‰∏ÄÊñπ‰Ωú‰∏∫Ë¢´È©±Âä®Ë°®ÔºåÂèåÊñπÈÉΩÊúâÁ¥¢ÂºïÂàôÈÄâÊã©Á¥¢ÂºïÈ´òÂ∫¶‰ΩéÁöÑÔºåÁ¥¢ÂºïÈ´òÂ∫¶‰∏ÄÊ†∑ÂàôÈÄâÊã©ËÆ∞ÂΩïÊï∞Â§öÁöÑ‰Ωú‰∏∫Ë¢´È©±Âä®Ë°®ÔºåÂØπ‰∫éÈ©±Âä®Ë°®ÁöÑÊØè‰∏ÄÊù°ËÆ∞ÂΩïÔºåÂú®Ë¢´È©±Âä®Ë°®‰∏≠‰ΩøÁî®Á¥¢ÂºïÊü•ËØ¢ÔºåÂ§ßÂ§ßÂáèÂ∞ë‰∫ÜÊØîËæÉÊ¨°Êï∞ÔºåÊèêÈ´ò‰∫ÜÊü•ËØ¢ÊïàÁéá</p>
<img src="/img/dba/INLJ.webp" alt="INLJ" style="zoom:80%;" />
<p><strong>Âü∫‰∫éÂùóÁöÑÂµåÂ•óÂæ™ÁéØËøûÊé•ÔºàBlock Nested-Loop JoinÔºåBNLÔºâ</strong></p>
<p>Ë¢´È©±Âä®Ë°®Ë¶ÅË¢´ËÆøÈóÆÂ•ΩÂ§öÊ¨°ÔºåÂ¶ÇÊûúË¢´È©±Âä®Ë°®‰∏≠ÁöÑÊï∞ÊçÆÁâπÂà´Â§öËÄå‰∏î‰∏çËÉΩ‰ΩøÁî®Á¥¢ÂºïËÆøÈóÆÁöÑËØùÔºåÈÇ£Â∞±Áõ∏ÂΩì‰∫é‰ªéÁ£ÅÁõò‰∏äËØªÂ•ΩÂ§öÊ¨°Ëøô‰∏™Ë°®ÔºåËøô‰∏™IO‰ª£‰ª∑Â∞±ÈùûÂ∏∏Â§ßÔºåÊâÄ‰ª•Â∫îËØ•Â∞ΩÈáèÂáèÂ∞ëËÆøÈóÆË¢´È©±Âä®Ë°®ÁöÑÊ¨°Êï∞„ÄÇ</p>
<p>Âú®ÂµåÂ•óÂæ™ÁéØËøûÊé•‰∏≠ÔºåÈ©±Âä®Ë°®Êü•ËØ¢ÁªìÊûúÈõÜ‰∏≠ÊúâÂ§öÂ∞ëÊù°ËÆ∞ÂΩïÔºåÂ∞±ÈúÄË¶ÅÈ©±Âä®Ë°®Êï∞ÊçÆË¢´Âä†ËΩΩÂ§öÂ∞ëÊ¨°Êù•ËøõË°åÂåπÈÖçÔºåÈÇ£ÂèØ‰∏çÂèØ‰ª•ÊääË¢´È©±Âä®Ë°®ÁöÑËÆ∞ÂΩïÂä†ËΩΩÂà∞ÂÜÖÂ≠òÁöÑÊó∂ÂÄôÔºå‰∏ÄÊ¨°ÊÄßÂíåÂ§öÊù°È©±Âä®Ë°®‰∏≠ÁöÑËÆ∞ÂΩïÂÅöÂåπÈÖçÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Â§ßÂ§ßÂáèÂ∞ëÈáçÂ§ç‰ªéÁ£ÅÁõò‰∏äÂä†ËΩΩË¢´È©±Âä®Ë°®ÁöÑ‰ª£‰ª∑‰∫Ü„ÄÇ</p>
<p>ÊâÄ‰ª•ÊèêÂá∫ÂèØjoin bufferÁöÑÊ¶ÇÂøµÔºåjoin bufferÂ∞±ÊòØÊâßË°åËøûÊé•Êü•ËØ¢ÂâçÁî≥ËØ∑ÁöÑ‰∏ÄÂùóÂõ∫ÂÆöÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÔºåÂÖàÊääËã•Âπ≤Êù°È©±Âä®Ë°®ÁªìÊûúÈõÜ‰∏≠ÁöÑËÆ∞ÂΩïË£ÖÂú®Ëøô‰∏™join buffer‰∏≠ÔºåÁÑ∂ÂêéÊâ´ÊèèË¢´È©±Âä®Ë°®ÔºåÊØè‰∏ÄÊù°Ë¢´È©±Âä®Ë°®ÁöÑËÆ∞ÂΩï‰∏ÄÊ¨°ÊÄßÂíåjoin buffer‰∏≠ÁöÑÂ§öÊù°È©±Âä®Ë°®ËÆ∞ÂΩïËøõË°åÂåπÈÖçÔºåÂõ†‰∏∫ÂåπÈÖçÁöÑËøáÁ®ãÊòØÂú®ÂÜÖÂ≠ò‰∏≠ÂÆåÊàêÁöÑÔºåÊâÄ‰ª•ËøôÊ†∑ÂèØ‰ª•ÂáèÂ∞ëË¢´È©±Âä®Ë°®ÁöÑIO‰ª£‰ª∑„ÄÇ</p>
<p><img src="/img/dba/BNL.webp" alt="BNL"></p>
<p><strong>ÊâπÈáèÈîÆËÆøÈóÆËÅîÊé•ÔºàBatched Key Access JoinÔºåBKAÔºâ</strong></p>
<p>ÂΩìË¢´È©±Âä®Ë°®ÁöÑÈìæÊé•Â≠óÊÆµÊúâÈùû‰∏ªÈîÆÁ¥¢ÂºïÊó∂ÔºåÈÄöËøáËåÉÂõ¥Êâ´ÊèèËØªÂèñ‰∏ÄÈÉ®ÂàÜËÆ∞ÂΩïÊîæÂÖ•ÂÜÖÂ≠ò‰∏≠ÔºåÁÑ∂ÂêéÊåâÁÖß‰∏ªÈîÆÊéíÂ∫èÔºåËøôÊ†∑ÂåπÈÖçÂà∞Êï∞ÊçÆÂêéÈúÄË¶ÅÊåâÂØπÂ∫îÁöÑ‰∏ªÈîÆÁ¥¢ÂºïÂéªÊü•ËØ¢Ë¢´È©±Âä®Ë°®ÁöÑÁúüÂÆûÊï∞ÊçÆÊó∂ÔºåÂèØ‰ª•ÊåâÁÖßÊéíÂ•ΩÂ∫èÁöÑ‰∏ªÈîÆËøõË°åÈ°∫Â∫èËÆøÈóÆ„ÄÇÁõ∏ÂΩì‰∫éÔºàBNL + MRRÔºâ</p>
<p><img src="/img/dba/bak.jpeg" alt="bak"></p>
<p><strong>ÂìàÂ∏åËøûÊé•ÔºàHash JoinÔºâ</strong></p>
<p>Hash JoinË¢´Â∫îÁî®ÁöÑÊù°‰ª∂ÊòØÈÇ£‰∫õ‰∏çËµ∞Á¥¢ÂºïÔºåÊàñËÄÖÁ¥¢ÂºïÂ∫îÁî®‰∏çÂ•ΩÁöÑÊó∂ÂÄô„ÄÇ</p>
<p>Hash Join ÂåÖÂê´‰∏§‰∏™ÈÉ®ÂàÜÔºö<code>build</code>ÊûÑÂª∫Èò∂ÊÆµÂíå<code>probe</code>Êé¢ÊµãÈò∂ÊÆµ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>persons.name,<span style="color:#bbb"> </span>countries.country_name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>persons<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>countries<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span>persons.country_id<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>countries.country_id;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><span style="color:RGB(25,113,192)">build Èò∂ÊÆµ </span></p>
<p>ÈÅçÂéÜÈ©±Âä®Ë°®Ôºå‰ª•joinÊù°‰ª∂‰∏∫keyÔºàcountries.country_idÔºâÔºåÊü•ËØ¢ÈúÄË¶ÅÁöÑÂàó‰Ωú‰∏∫valueÔºàcountries.country_idÔºåcountries.country_nameÔºâÂàõÂª∫hashË°®„ÄÇ</p>
<img src="/img/dba/build-1.webp" alt="MySQL 8.0‰πãhash join_java" style="zoom:50%;" />
<p>Ê°à‰æã‰∏≠ÂØπ countries.country_id ËøõË°å hash ËÆ°ÁÆóÔºöhash(countries.country_id) ÁÑ∂ÂêéÂ∞ÜÂÄºÊîæÂÖ•ÂÜÖÂ≠ò‰∏≠ hash table ÁöÑÁõ∏Â∫î‰ΩçÁΩÆ„ÄÇcountries Ë°®‰∏≠ÁöÑÊâÄÊúâ country_id ÈÉΩÊîæÂÖ•ÂÜÖÂ≠òÁöÑÂìàÂ∏åË°®‰∏≠</p>
<p><span style="color:RGB(25,113,192)">probe Êé¢ÊµãÈò∂ÊÆµ</span></p>
<p>buildÈò∂ÊÆµÂÆåÊàêÂêéÔºåMySQLÈÄêË°åÈÅçÂéÜË¢´È©±Âä®Ë°®ÔºåÁÑ∂ÂêéËÆ°ÁÆó joinÊù°‰ª∂ÁöÑhashÂÄºÔºåÂπ∂Âú®hashË°®‰∏≠Êü•ÊâæÔºåÂ¶ÇÊûúÂåπÈÖçÔºåÂàôËæìÂá∫ÁªôÂÆ¢Êà∑Á´ØÔºåÂê¶ÂàôË∑≥Ëøá„ÄÇÊâÄÊúâÂÜÖË°®ËÆ∞ÂΩïÈÅçÂéÜÂÆåÔºåÂàôÊï¥‰∏™ËøáÁ®ãÂ∞±ÁªìÊùü‰∫Ü„ÄÇ</p>
<img src="/img/dba/probe-1.webp" alt="MySQL 8.0‰πãhash join_java_02" style="zoom:67%;" />
<p>Â¶ÇÂõæÊâÄÁ§∫ ,MySQL ÂØπ persons Ë°®‰∏≠ÊØèË°å‰∏≠ÁöÑ join Â≠óÊÆµÁöÑÂÄºËøõË°å hash ËÆ°ÁÆóÔºõhash(persons.country_id)ÔºåÊãøÁùÄËÆ°ÁÆóÁªìÊûúÂà∞ÂÜÖÂ≠ò hash table ‰∏≠ËøõË°åÊü•ÊâæÂåπÈÖç</p>
<p>Â¶ÇÊûúÈ©±Âä®Ë°®ÁöÑÊï∞ÊçÆËÆ∞ÂΩïÂú®ÂÜÖÂ≠ò‰∏≠Â≠ò‰∏ç‰∏ãÊó∂Â∞±‰ºöÂà©Áî®Á£ÅÁõòÊñá‰ª∂„ÄÇÊ≠§Êó∂MySQL Ë¶ÅÊûÑÂª∫‰∏¥Êó∂Êñá‰ª∂ÂÅöhash join„ÄÇÊ≠§Êó∂ÁöÑËøáÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>
<p>buildÈò∂ÊÆµ‰ºöÈ¶ñÂÖàÂà©Áî®hashÁÆóÂ∞ÜÂ§ñË°®ËøõË°åÂàÜÂå∫ÔºåÂπ∂‰∫ßÁîü‰∏¥Êó∂ÂàÜÁâáÂÜôÂà∞Á£ÅÁõò‰∏ä</p>
<img src="/img/dba/probe-2.webp" alt="MySQL 8.0‰πãhash join_java_03" style="zoom:50%;" />
</li>
<li>
<p>ÁÑ∂ÂêéÂú®probeÈò∂ÊÆµÔºåÂØπ‰∫éÂÜÖË°®‰ΩøÁî®ÂêåÊ†∑ÁöÑhashÁÆóÊ≥ïËøõË°åÂàÜÂå∫</p>
<img src="/img/dba/probe-3.webp" alt="MySQL 8.0‰πãhash join_java_04" style="zoom:50%;" />
</li>
<li>
<p>Áî±‰∫é‰ΩøÁî®ÂàÜÁâáhashÂáΩÊï∞Áõ∏ÂêåÔºåÈÇ£‰πàkeyÁõ∏Âêå(joinÊù°‰ª∂Áõ∏Âêå)ÂøÖÁÑ∂Âú®Âêå‰∏Ä‰∏™ÂàÜÁâáÁºñÂè∑‰∏≠„ÄÇÊé•‰∏ãÊù•ÔºåÂÜçÂØπÂ§ñË°®ÂíåÂÜÖË°®‰∏≠Áõ∏ÂêåÂàÜÁâáÁºñÂè∑ÁöÑÊï∞ÊçÆËøõË°åÂÜÖÂ≠òhash joinÁöÑËøáÁ®ãÔºåÊâÄÊúâÂàÜÁâáÁöÑÂÜÖÂ≠òhash joinÂÅöÂÆåÔºåÊï¥‰∏™joinËøáÁ®ãÂ∞±ÁªìÊùü‰∫Ü</p>
<img src="/img/dba/probe-4.webp" alt="MySQL 8.0‰πãhash join_java_05" style="zoom:50%;" />
</li>
</ol>
<p>ÂèØ‰ª•Ë∞ÉÊï¥<code>join_buffer_size</code>Âíå<code>open_files_limit</code>ÂèÇÊï∞ÊèêÈ´òÊÄßËÉΩ</p>
<h2 id="8innodb-Â≠òÂÇ®ÂºïÊìé">8„ÄÅInnoDB Â≠òÂÇ®ÂºïÊìé</h2>
<h3 id="Ê†∏ÂøÉÁâπÊÄßÊÄªËßà">Ê†∏ÂøÉÁâπÊÄßÊÄªËßà</h3>
<ul>
<li>MVCCÔºö Â§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂</li>
<li>ËÅöÁ∞áÁ¥¢Âºï Ôºö Áî®Êù•ÁªÑÁªáÂ≠òÂÇ®Êï∞ÊçÆÂíå‰ºòÂåñÊü•ËØ¢</li>
<li>ÊîØÊåÅ‰∫ãÂä° Ôºö Êï∞ÊçÆÊúÄÁªà‰∏ÄËá¥Êèê‰æõ‰øùËØÅ</li>
<li>ÊîØÊåÅË°åÁ∫ßÈîÅ Ôºö Âπ∂ÂèëÊéßÂà∂</li>
<li>Â§ñÈîÆ Ôºö Â§öË°®‰πãÈó¥ÁöÑÊï∞ÊçÆ‰∏ÄËá¥‰∏ÄËá¥ÊÄß</li>
<li>Â§öÁºìÂÜ≤Âå∫ÊîØÊåÅ</li>
<li>Ëá™ÈÄÇÂ∫îHashÁ¥¢ÂºïÔºö AHI</li>
<li>Â§çÂà∂‰∏≠ÊîØÊåÅÈ´òÁ∫ßÁâπÊÄß</li>
<li>Â§á‰ªΩÊÅ¢Â§çÔºö ÊîØÊåÅÁÉ≠Â§á</li>
<li>Ëá™Âä®ÊïÖÈöúÊÅ¢Â§çÔºöCR Crash Recovery</li>
<li>ÂèåÂÜôÊú∫Âà∂ Ôºö DWB Double Write Buffer</li>
</ul>
<h3 id="Â≠òÂÇ®ÂºïÊìéÁöÑÁÆ°ÁêÜ">Â≠òÂÇ®ÂºïÊìéÁöÑÁÆ°ÁêÜ</h3>
<p><strong>Êü•ÁúãÁ¢éÁâáÊÉÖÂÜµ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Êü•ÁúãÊüê‰∏™Êï∞ÊçÆÂ∫ì‰∏ãÁöÑÁ¢éÁâáÊÉÖÂÜµ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table_name</span>,data_free,engine<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>information_schema.tables<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>table_schema<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;[Êï∞ÊçÆÂ∫ìÂêçÁß∞]&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Êï¥ÁêÜÁ¢éÁâá</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ‰ª•‰∏ã‰∏§‰∏™Êìç‰ΩúÁõ∏ÂΩì‰∫éÈáçÊñ∞ÁîüÊàêË°®ÔºåÂπ∂Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Ë°®Âêç</span><span style="color:#bbb"> </span>engine<span style="color:#000;font-weight:bold">=</span>InnoDB;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">analyze</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Ë°®Âêç</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂØπÊï∞ÊçÆË°®‰ºòÂåñ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>optimize<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Ë°®Âêç</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Êü•ËØ¢Á∫øÁ®ã‰ø°ÊÅØ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÂâçÂè∞Á∫øÁ®ãÊü•ËØ¢ÔºàËøûÊé•Â±ÇÔºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>processlist<span style="color:#bbb"> </span>;<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">full</span><span style="color:#bbb"> </span>processlist;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>information_schema.processlist;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂêéÂè∞Á∫øÁ®ãÔºàServer\EngineÔºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>performance_schema.threads;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ËØ¢ËøûÊé•Á∫øÁ®ãÂíåSQLÁ∫øÁ®ãÂÖ≥Á≥ª
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>information_schema.processlist<span style="color:#bbb"> </span>;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">---&gt; ID=10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>performance_schema.threads<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>processlist_id<span style="color:#000;font-weight:bold">=</span><span style="color:#099">10</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>performance_schema.events_statements_history<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>thread_id<span style="color:#000;font-weight:bold">=?</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ë°®Á©∫Èó¥">Ë°®Á©∫Èó¥</h3>
<p><strong>Ë°®Á©∫Èó¥ÁöÑÂàÜÁ±ª</strong></p>
<ol>
<li>system tablespaceÔºàÁ≥ªÁªüË°®Á©∫Èó¥/ÂÖ±‰∫´Ë°®Á©∫Èó¥Ôºâ</li>
<li>file-per-table tablespaceÔºàÁã¨Á´ãË°®Á©∫Èó¥Ôºâ</li>
<li>undo tablespaceÔºàundo Ë°®Á©∫Èó¥Ôºâ</li>
<li>temp tablespaceÔºà‰∏¥Êó∂Ë°®Á©∫Èó¥Ôºâ</li>
</ol>
<p><strong>system tablespaceÔºàÁ≥ªÁªüË°®Á©∫Èó¥/ÂÖ±‰∫´Ë°®Á©∫Èó¥Ôºâ</strong></p>
<p><img src="/img/dba/%E5%85%B1%E4%BA%AB%E8%A1%A8%E7%A9%BA%E9%97%B4.png" alt="ÂÖ±‰∫´Ë°®Á©∫Èó¥"></p>
<p>Êü•ËØ¢ÂÖ±‰∫´Ë°®Á©∫Èó¥‰ø°ÊÅØ</p>
<p><code>select @@innodb_data_file_path;</code>ÈªòËÆ§Ôºàibdata1:12M:autoextendÔºâ</p>
<p><code>select @@innodb_autoextend_increment;</code>ÈªòËÆ§64M</p>
<p>Âç≥ibdata1Êñá‰ª∂ÔºåÈªòËÆ§ÂàùÂßãÂ§ßÂ∞è12MÔºå‰∏çÂ§üÁî®‰ºöËá™Âä®Êâ©Â±ïÔºåÈªòËÆ§ÊØèÊ¨°Êâ©Â±ï64M„ÄÇ‰∏çÂª∫ËÆÆ‰ΩøÁî®ÈªòËÆ§Â§ßÂ∞èÔºåÂπ∂ÂèëÂ§™Â∞è</p>
<pre tabindex="0"><code># Â¶ÇÊûúÂ∑≤ÁªèÂàùÂßãÂåñÔºåÁ¨¨‰∏Ä‰∏™Â§ßÂ∞èÂøÖÈ°ªÂíåÁ°¨Áõò‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Êñá‰ª∂ÂÆûÈôÖÂ§ßÂ∞è‰∏ÄËá¥ÔºåÂê¶Âàô‰ºöÊä•Èîô
innodb_data_file_path=ibdata1:1024M;ibdata2:1024M:autoextend
</code></pre><blockquote>
<p>5.7 ‰∏≠Âª∫ËÆÆÔºöËÆæÁΩÆÂÖ±‰∫´Ë°®Á©∫Èó¥2-3‰∏™ÔºåÂ§ßÂ∞èÂª∫ËÆÆ512MÊàñËÄÖ1GÔºåÊúÄÂêé‰∏Ä‰∏™ÂÆöÂà∂‰∏∫Ëá™Âä®Êâ©Â±ï„ÄÇ</p>
<p>8.0 ‰∏≠Âª∫ËÆÆÔºöËÆæÁΩÆ1-2‰∏™Â∞±okÔºåÂ§ßÂ∞èÂª∫ËÆÆ512MÊàñËÄÖ1G</p>
</blockquote>
<p><strong>file-per-table tablespaceÔºàÁã¨Á´ãË°®Á©∫Èó¥Ôºâ</strong></p>
<p>ÊØè‰∏™Ë°®ÁöÑË°®Á©∫Èó¥ÂåÖÂê´Âçï‰∏™ InnoDBË°®ÁöÑÊï∞ÊçÆÂíåÁ¥¢ÂºïÔºåÂπ∂Â≠òÂÇ®Âú®Êñá‰ª∂Á≥ªÁªü‰∏äÁöÑÂçï‰∏™Êï∞ÊçÆÊñá‰ª∂‰∏≠„ÄÇMySQLÊØèÂàõÂª∫‰∏Ä‰∏™Ë°®ÔºåÂ∞±‰ºöÁîüÊàê‰∏Ä‰∏™Áã¨Á´ãË°®Á©∫Èó¥‰ª• table_name.idb ÂëΩÂêçÁöÑ„ÄÇ</p>
<p><img src="/img/dba/%E7%8B%AC%E7%AB%8B%E8%A1%A8%E7%A9%BA%E9%97%B4.png" alt="Áã¨Á´ãË°®Á©∫Èó¥"></p>
<p><strong>undo tablespaceÔºàundo Ë°®Á©∫Èó¥Ôºâ</strong></p>
<p>Áî®‰ΩúÊí§ÈîÄÊó•ÂøóÔºåÂõûÊªöÊó•Âøó</p>
<p>5.7ÁâàÊú¨ÔºåÈªòËÆ§Â≠òÂÇ®Âú®ÂÖ±‰∫´Ë°®Á©∫Èó¥‰∏≠ÔºàibdataNÔºâÔºõ8.0ÁâàÊú¨‰ª•ÂêéÈªòËÆ§Â∞±ÊòØÁã¨Á´ãÁöÑÔºàundo_001-undo_002Ôºâ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_undo_tablespaces;<span style="color:#bbb">    </span><span style="color:#998;font-style:italic">-- ÊâìÂºÄÁã¨Á´ãundoÊ®°ÂºèÔºåÂπ∂ËÆæÁΩÆundoÁöÑ‰∏™Êï∞ÔºåÂª∫ËÆÆ3-5‰∏™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_max_undo_log_size;<span style="color:#bbb">   </span><span style="color:#998;font-style:italic">-- undoÊó•ÂøóÁöÑÂ§ßÂ∞èÔºåÈªòËÆ§1G„ÄÇ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_undo_log_truncate;<span style="color:#bbb">   </span><span style="color:#998;font-style:italic">-- ÂºÄÂêØundoËá™Âä®ÂõûÊî∂ÁöÑÊú∫Âà∂Ôºàundo_purgeÔºâ„ÄÇ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_purge_rseg_truncate_frequency;<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">-- Ëß¶ÂèëËá™Âä®ÂõûÊî∂ÁöÑÊù°‰ª∂ÔºåÂçï‰ΩçÊòØÊ£ÄÊµãÊ¨°Êï∞„ÄÇ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>temp tablespaceÔºà‰∏¥Êó∂Ë°®Á©∫Èó¥Ôºâ</strong></p>
<p>Êää‰∏¥Êó∂Ë°®ÁöÑÊï∞ÊçÆ‰ªéÁ≥ªÁªüË°®Á©∫Èó¥‰∏≠ÊäΩÁ¶ªÂá∫Êù•ÔºåÂΩ¢ÊàêÁã¨Á´ãÁöÑË°®Á©∫Èó¥ÂèÇÊï∞<code>innodb_temp_data_file_path</code>ÔºåÁã¨Á´ãË°®Á©∫Èó¥Êñá‰ª∂Âêç‰∏∫ ibtmp1ÔºåÈªòËÆ§Â§ßÂ∞è 12MB„ÄÇÂª∫ËÆÆËøõË°å‰øÆÊîπ„ÄÇ</p>
<pre tabindex="0"><code># Âª∫ËÆÆÊï∞ÊçÆÂàùÂßãÂåñ‰πãÂâçËÆæÂÆöÂ•ΩÔºå‰∏ÄËà¨2-3‰∏™ÔºåÂ§ßÂ∞è512M-1G
innodb_temp_data_file_path=ibtmp1:512M;ibtmp2:512M:autoextend:max:512M
</code></pre><h3 id="Ë°åÊ†ºÂºè">Ë°åÊ†ºÂºè</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>record_format_demo<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>c1<span style="color:#bbb"> </span><span style="color:#0086b3">VARCHAR</span><span style="color:#bbb"> </span>(<span style="color:#099">10</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>c2<span style="color:#bbb"> </span><span style="color:#0086b3">VARCHAR</span><span style="color:#bbb"> </span>(<span style="color:#099">10</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NOT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>c3<span style="color:#bbb"> </span><span style="color:#0086b3">CHAR</span>(<span style="color:#099">10</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>c4<span style="color:#bbb"> </span><span style="color:#0086b3">VARCHAR</span>(<span style="color:#099">10</span>))<span style="color:#bbb"> </span>CHARSET<span style="color:#000;font-weight:bold">=</span>ascii<span style="color:#bbb"> </span>ROW_FORMAT<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>COMPACT;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ËÆ∞ÂΩï1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>record_format_demo(c1,<span style="color:#bbb"> </span>c2,<span style="color:#bbb"> </span>c3,<span style="color:#bbb"> </span>c4)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">VALUES</span>(<span style="color:#d14">&#39;aaaa&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;bbb&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;cc&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;d&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ËÆ∞ÂΩï2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>record_format_demo(c1,<span style="color:#bbb"> </span>c2,<span style="color:#bbb"> </span>c3,<span style="color:#bbb"> </span>c4)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">VALUES</span>(<span style="color:#d14">&#39;eeee&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;fff&#39;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>COMPACTË°åÊ†ºÂºè</strong></p>
<p>‰∏ÄÊù°ÂÆåÊï¥ÁöÑËÆ∞ÂΩïÂÖ∂ÂÆûÂèØ‰ª•Ë¢´ÂàÜ‰∏∫<span style="color:RGB(25,113,192)"><strong>ËÆ∞ÂΩïÁöÑÈ¢ùÂ§ñ‰ø°ÊÅØ</strong></span>Âíå<span style="color:RGB(25,113,192)"><strong>ËÆ∞ÂΩïÁöÑÁúüÂÆûÊï∞ÊçÆ</strong></span>‰∏§Â§ßÈÉ®ÂàÜ</p>
<img src="/img/dba/COMPACT.png" alt="COMPACT" style="zoom:77%;" />
<p>ËÆ∞ÂΩïÁöÑÈ¢ùÂ§ñ‰ø°ÊÅØÔºö‰∏∫‰∫ÜÊèèËø∞ËøôÊù°ËÆ∞ÂΩïËÄå‰∏çÂæó‰∏çÈ¢ùÂ§ñÊ∑ªÂä†ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØÔºåËøô‰∫õÈ¢ùÂ§ñ‰ø°ÊÅØÂàÜ‰∏∫3Á±ªÔºåÂàÜÂà´ÊòØÂèòÈïøÂ≠óÊÆµÈïøÂ∫¶ÂàóË°®„ÄÅNULLÂÄºÂàóË°®ÂíåËÆ∞ÂΩïÂ§¥‰ø°ÊÅØ</p>
<ol>
<li>
<p>ÂèòÈïøÂ≠óÊÆµÈïøÂ∫¶ÂàóË°®</p>
<p>ÊâÄÊúâÂèòÈïøÂ≠óÊÆµÁöÑÁúüÂÆûÊï∞ÊçÆÂç†Áî®ÁöÑÂ≠óËäÇÈïøÂ∫¶ÈÉΩÂ≠òÊîæÂú®ËÆ∞ÂΩïÁöÑÂºÄÂ§¥ÈÉ®‰ΩçÔºå‰ªéËÄåÂΩ¢Êàê‰∏Ä‰∏™ÂèòÈïøÂ≠óÊÆµÈïøÂ∫¶ÂàóË°®ÔºåÂêÑÂèòÈïøÂ≠óÊÆµÊï∞ÊçÆÂç†Áî®ÁöÑÂ≠óËäÇÊï∞ÊåâÁÖßÂàóÁöÑÈ°∫Â∫è<span style="color:red">ÈÄÜÂ∫è</span>Â≠òÊîæÔºåÂèòÈïøÂ≠óÊÆµÈïøÂ∫¶ÂàóË°®‰∏≠Âè™Â≠òÂÇ®ÂÄº‰∏∫ ÈùûNULL ÁöÑÂàóÂÜÖÂÆπÂç†Áî®ÁöÑÈïøÂ∫¶ÔºåÂÄº‰∏∫ NULL ÁöÑÂàóÁöÑÈïøÂ∫¶ÊòØ‰∏çÂÇ®Â≠òÁöÑ</p>
<img src="/img/dba/COMPACT-2.png" alt="COMPACT-2" style="zoom:77%;" />
</li>
<li>
<p>NULLÂÄºÂàóË°®</p>
<p>Ë°®‰∏≠Â¶ÇÊûúÊ≤°ÊúâÂÖÅËÆ∏Â≠òÂÇ® NULL ÁöÑÂàóÔºåÂàô NULLÂÄºÂàóË°®‰πü‰∏çÂ≠òÂú®‰∫Ü„ÄÇÂê¶ÂàôÂ∞ÜÊØè‰∏™ÂÖÅËÆ∏Â≠òÂÇ®NULLÁöÑÂàóÂØπÂ∫î‰∏Ä‰∏™Ê†áËÆ∞„Äê1-NULLÔºå0-Not NULL„ÄëÔºåÊ†áËÆ∞‰ΩçÊåâÁÖßÂàóÁöÑÈ°∫Â∫èÈÄÜÂ∫èÊéíÂàó„ÄÇNULLÂÄºÂàóË°®ÂøÖÈ°ªÁî®Êï¥Êï∞‰∏™Â≠óËäÇÁöÑ‰ΩçË°®Á§∫ÔºåÂ¶ÇÊûú‰ΩøÁî®ÁöÑ‰∫åËøõÂà∂‰Ωç‰∏™Êï∞‰∏çÊòØÊï¥Êï∞‰∏™Â≠óËäÇÔºåÂàôÂú®Â≠óËäÇÁöÑÈ´ò‰ΩçË°•0</p>
<img src="/img/dba/COMPACT-3.png" alt="COMPACT-3" style="zoom:77%;" />
</li>
<li>
<p>ËÆ∞ÂΩïÂ§¥‰ø°ÊÅØ</p>
<p>Áî±Âõ∫ÂÆöÁöÑ5‰∏™Â≠óËäÇÁªÑÊàê„ÄÇ5‰∏™Â≠óËäÇ‰πüÂ∞±ÊòØ40‰∏™‰∫åËøõÂà∂‰ΩçÔºå‰∏çÂêåÁöÑ‰Ωç‰ª£Ë°®‰∏çÂêåÁöÑÊÑèÊÄù</p>
<img src="/img/dba/COMPACT-4.png" alt="COMPACT-4" />
<table>
<thead>
<tr>
<th>ÂêçÁß∞</th>
<th>Â§ßÂ∞èÔºàbitÔºâ</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>È¢ÑÁïô‰Ωç1</td>
<td>1</td>
<td>Ê≤°Êúâ‰ΩøÁî®</td>
</tr>
<tr>
<td>È¢ÑÁïô‰Ωç2</td>
<td>1</td>
<td>Ê≤°Êúâ‰ΩøÁî®</td>
</tr>
<tr>
<td>delete_mask</td>
<td>1</td>
<td>Ê†áËÆ∞ËØ•ËÆ∞ÂΩïÊòØÂê¶Ë¢´Âà†Èô§</td>
</tr>
<tr>
<td>min_rec_mask</td>
<td>1</td>
<td>B+Ê†ëÁöÑÊØèÂ±ÇÂè∂Â≠êËäÇÁÇπ‰∏≠ÁöÑÊúÄÂ∞èËÆ∞ÂΩïÈÉΩ‰ºöÊ∑ªÂä†ËØ•ËÆ∞Ê†áËÆ∞</td>
</tr>
<tr>
<td>n_owned</td>
<td>4</td>
<td>Ë°®Á§∫ÂΩìÂâçËÆ∞ÂΩïÊã•ÊúâÁöÑËÆ∞ÂΩïÊï∞</td>
</tr>
<tr>
<td>heap_no</td>
<td>13</td>
<td>Ë°®Á§∫ÂΩìÂâçËÆ∞ÂΩïÂú®ËÆ∞ÂΩïÂ†ÜÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ</td>
</tr>
<tr>
<td>record_type</td>
<td>3</td>
<td>Ë°®Á§∫ÂΩìÂâçËÆ∞ÂΩïÁöÑÁ±ªÂûãÔºå0Ë°®Á§∫ÊôÆÈÄöËÆ∞ÂΩïÔºå1Ë°®Á§∫B+Ê†ëÈùûÂè∂Â≠êËäÇÁÇπËÆ∞ÂΩïÔºå2Ë°®Á§∫ÊúÄÂ∞èËÆ∞ÂΩïÔºå3Ë°®Á§∫ÊúÄÂ§ßËÆ∞ÂΩï</td>
</tr>
<tr>
<td>next_record</td>
<td>16</td>
<td>Ë°®Á§∫‰∏ã‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÁõ∏ÂØπ‰ΩçÁΩÆ</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>ËÆ∞ÂΩïÁöÑÁúüÂÆûÊï∞ÊçÆÔºöÈô§‰∫ÜÊä•Èîô‰∫ÜËá™Â∑±ÂÆö‰πâÂàóÁöÑÂ≠òÂÇ®Êï∞ÊçÆ‰ª•Â§ñÔºåMySQËøòL‰ºö‰∏∫ÊØè‰∏™ËÆ∞ÂΩïÈªòËÆ§ÁöÑÊ∑ªÂä†‰∏Ä‰∫õÂàóÔºà‰πüÁß∞‰∏∫ÈöêËóèÂàóÔºâÔºåÂÖ∑‰ΩìÁöÑÂàóÂ¶Ç‰∏ã</p>
<table>
<thead>
<tr>
<th>ÂàóÂêç</th>
<th>ÊòØÂê¶ÂøÖÈ°ª</th>
<th>Âç†Áî®Á©∫Èó¥ÔºàÂçï‰ΩçÔºöBÔºâ</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>DB_ROW_ID</td>
<td>Âê¶</td>
<td>6</td>
<td>Ë°åIDÔºåÂîØ‰∏ÄÊ†áËØÜ‰∏ÄÊù°ËÆ∞ÂΩï</td>
</tr>
<tr>
<td>DB_TRX_ID</td>
<td>ÊòØ</td>
<td>6</td>
<td>‰∫ãÂä°ID</td>
</tr>
<tr>
<td>DB_ROLL_PTR</td>
<td>ÊòØ</td>
<td>7</td>
<td>ÂõûÊªöÊåáÈíà</td>
</tr>
</tbody>
</table>
<img src="/img/dba/COMPACT-5.png" alt="COMPACT-5" />
<p><strong>DYNAMICÂíåCOMPRESSEDË°åÊ†ºÂºè</strong></p>
<p>ÈªòËÆ§Â≠òÂÇ®Ê†ºÂºèÊòØDYNAMICÔºåËøô‰ø©Ë°åÊ†ºÂºèÂíåCompactË°åÊ†ºÂºèÊå∫ÂÉèÔºåÂè™‰∏çËøáÂú®Â§ÑÁêÜË°åÊ∫¢Âá∫Êï∞ÊçÆÊó∂ÊúâÁÇπÂÑøÂàÜÊ≠ßÔºåÂÆÉ‰ª¨‰∏ç‰ºöÂú®ËÆ∞ÂΩïÁöÑÁúüÂÆûÊï∞ÊçÆÂ§ÑÂ≠òÂÇ®Â≠óÊÆµÁúüÂÆûÊï∞ÊçÆÁöÑÂâç768‰∏™Â≠óËäÇÔºåËÄåÊòØÊääÊâÄÊúâÁöÑÂ≠óËäÇÈÉΩÂ≠òÂÇ®Âà∞ÂÖ∂‰ªñÈ°µÈù¢‰∏≠ÔºåÂè™Âú®ËÆ∞ÂΩïÁöÑÁúüÂÆûÊï∞ÊçÆÂ§ÑÂ≠òÂÇ®ÂÖ∂‰ªñÈ°µÈù¢ÁöÑÂú∞ÂùÄ**„ÄÇ**CompressedË°åÊ†ºÂºèÂíåDynamic‰∏çÂêåÁöÑ‰∏ÄÁÇπÊòØÔºåCompressedË°åÊ†ºÂºè‰ºöÈááÁî®ÂéãÁº©ÁÆóÊ≥ïÂØπÈ°µÈù¢ËøõË°åÂéãÁº©Ôºå‰ª•ËäÇÁúÅÁ©∫Èó¥„ÄÇ</p>
<h3 id="È°µÁªìÊûÑ">È°µÁªìÊûÑ</h3>
<img src="/img/dba/ÈÄöÁî®È°µÁªìÊûÑ.png" alt="ÈÄöÁî®È°µÁªìÊûÑ" style="zoom:67%;" />
<p><strong>È°µ‰∏≠‰ΩøÁî®/Êú™‰ΩøÁî®Á©∫Èó¥ÔºàUser Records / Free SpaceÔºâ</strong></p>
<p>ÂºÄÂßãÁîüÊàêÈ°µÁöÑÊó∂ÂÄôÔºåÂÖ∂ÂÆûÂπ∂Ê≤°Êúâ<code>User Records</code>Ëøô‰∏™ÈÉ®ÂàÜÔºåÊØèÂΩìÊàë‰ª¨ÊèíÂÖ•‰∏ÄÊù°ËÆ∞ÂΩïÔºåÈÉΩ‰ºö‰ªé<code>Free Space</code>ÈÉ®ÂàÜÔºå‰πüÂ∞±ÊòØÂ∞öÊú™‰ΩøÁî®ÁöÑÂ≠òÂÇ®Á©∫Èó¥‰∏≠Áî≥ËØ∑‰∏Ä‰∏™ËÆ∞ÂΩïÂ§ßÂ∞èÁöÑÁ©∫Èó¥ÂàíÂàÜÂà∞<code>User Records</code>ÈÉ®ÂàÜÔºåÂΩì<code>Free Space</code>ÈÉ®ÂàÜÁöÑÁ©∫Èó¥ÂÖ®ÈÉ®Ë¢´<code>User Records</code>ÈÉ®ÂàÜÊõø‰ª£Êéâ‰πãÂêéÔºå‰πüÂ∞±ÊÑèÂë≥ÁùÄËøô‰∏™È°µ‰ΩøÁî®ÂÆå‰∫ÜÔºåÂ¶ÇÊûúËøòÊúâÊñ∞ÁöÑËÆ∞ÂΩïÊèíÂÖ•ÁöÑËØùÔºåÂ∞±ÈúÄË¶ÅÂéªÁî≥ËØ∑Êñ∞ÁöÑÈ°µ‰∫Ü</p>
<p><img src="/img/dba/page-1.png" alt="page-1"></p>
<p><strong>ÊúÄÂ∞èËÆ∞ÂΩïÂíåÊúÄÂ§ßËÆ∞ÂΩïÔºàInfimum+SupremumÔºâ</strong></p>
<p><code>Infimum</code>Âíå<code>Supremum</code>Êú¨Ë¥®‰∏äÂ∞±ÊòØ‰∏§Êù°Êï∞ÊçÆË°åÔºåÂè™‰∏çËøáÊòØËôöÊãüÁöÑ„ÄÇ<code>Infimum</code>ËÆ∞ÂΩïÔºà‰πüÂ∞±ÊòØÊúÄÂ∞èËÆ∞ÂΩïÔºâ ÁöÑ<code>next_record</code>ËÆ∞ÂΩïÂ∞±ÊòØÊú¨È°µ‰∏≠‰∏ªÈîÆÂÄºÊúÄÂ∞èÁöÑÁî®Êà∑ËÆ∞ÂΩïÔºåËÄåÊú¨È°µ‰∏≠‰∏ªÈîÆÂÄºÊúÄÂ§ßÁöÑÁî®Êà∑ËÆ∞ÂΩïÁöÑ<code>next_record</code>ËÆ∞ÂΩïÂ∞±ÊòØ<code>Supremum</code>ËÆ∞ÂΩïÔºà‰πüÂ∞±ÊòØÊúÄÂ§ßËÆ∞ÂΩïÔºâ</p>
<p><img src="/img/dba/page-2.png" alt="page-2"></p>
<p>InnoDB‰ºöÁª¥Êä§‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÂçïÈìæË°®ÔºåÈìæË°®‰∏≠ÁöÑÂêÑ‰∏™ËäÇÁÇπÊòØÊåâÁÖß‰∏ªÈîÆÂÄºÁî±Â∞èÂà∞Â§ßÁöÑÈ°∫Â∫èËøûÊé•Ëµ∑Êù•ÁöÑ</p>
<blockquote>
<p><strong>ÂΩìÊï∞ÊçÆÈ°µ‰∏≠Â≠òÂú®Â§öÊù°Ë¢´Âà†Èô§ÊéâÁöÑËÆ∞ÂΩïÊó∂ÔºåËøô‰∫õËÆ∞ÂΩïÁöÑnext_recordÂ±ûÊÄßÂ∞Ü‰ºöÊääËøô‰∫õË¢´Âà†Èô§ÊéâÁöÑËÆ∞ÂΩïÁªÑÊàê‰∏Ä‰∏™ÂûÉÂúæÈìæË°®Ôºå‰ª•Â§á‰πãÂêéÈáçÁî®ËøôÈÉ®ÂàÜÂ≠òÂÇ®Á©∫Èó¥„ÄÇ‰∏äÈù¢Âà†Èô§‰∫Ü‰∏ÄË°åËÆ∞ÂΩïÔºåÂèàÂ∞ÜËÆ∞ÂΩïÂéüÂ∞Å‰∏çÂä®ÊèíÂõûÊù•ÁöÑÊÉÖÂÜµÔºåÂéüÊù•ÁöÑÂ≠òÂÇ®Á©∫Èó¥ÊòØ‰ºöË¢´ÈáçÁî®ÁöÑ„ÄÇ</strong></p>
<p><strong>ËøòÊúâ‰∏ÄÁßçÊÉÖÂÜµÊòØ‰∏ç‰ºöË¢´ÈáçÁî®ÁöÑÔºöÂà†Èô§ÂéüËÆ∞ÂΩïÂêéÔºåÊñ∞ÊèíÂÖ•ÁöÑËÆ∞ÂΩïÁúüÂÆûÊï∞ÊçÆÊâÄÂç†Â≠òÂÇ®Á©∫Èó¥Â§ß‰∫éÂéüÂÖàËÆ∞ÂΩïÂ≠òÂÇ®Á©∫Èó¥ÁöÑÊó∂ÂÄôÔºåËøôÊó∂ÂéüÁ©∫Èó¥‰∏ç‰ºöË¢´ÈáçÁî®‰∏îË¢´Âä†ÂÖ•ÂûÉÂúæÈìæË°®ÔºåÊñ∞ÊèíÂÖ•ÁöÑËÆ∞ÂΩï‰ºö‰ªéFree SpaceÁî≥ËØ∑Êñ∞ÁöÑÁ©∫Èó¥ÔºåÂíåÂ∑≤ÊúâÁöÑËÆ∞ÂΩïÁªÑÂêàÊàêÊñ∞ÁöÑÈìæË°®„ÄÇ</strong></p>
</blockquote>
<p><strong>È°µÁõÆÂΩïÔºàPage DirectoryÔºâ</strong></p>
<p>ÂÅöÂá∫È°µÁõÆÂΩïÁªìÊûÑÔºåÁî®‰∫éÂú®È°µÂÜÖÂø´ÈÄüÂÆö‰ΩçÊï∞ÊçÆ</p>
<ol>
<li>Â∞ÜÊâÄÊúâÊ≠£Â∏∏ÁöÑËÆ∞ÂΩïÔºàÂåÖÊã¨ÊúÄÂ§ßÂíåÊúÄÂ∞èËÆ∞ÂΩïÔºå‰∏çÂåÖÊã¨Ê†áËÆ∞‰∏∫Â∑≤Âà†Èô§ÁöÑËÆ∞ÂΩïÔºâÂàíÂàÜ‰∏∫Âá†‰∏™ÁªÑÔºåÊúâÁÇπÁ±ª‰ºº‰∏éË∑≥Ë°®ÊÄùÊÉ≥</li>
<li>ÊØè‰∏™ÁªÑÁöÑÊúÄÂêé‰∏ÄÊù°ËÆ∞ÂΩïÔºà‰πüÂ∞±ÊòØÁªÑÂÜÖÊúÄÂ§ßÁöÑÈÇ£Êù°ËÆ∞ÂΩïÔºâÁöÑÂ§¥‰ø°ÊÅØ‰∏≠ÁöÑn_ownedÂ±ûÊÄßË°®Á§∫ËØ•ËÆ∞ÂΩïÊã•ÊúâÂ§öÂ∞ëÊù°ËÆ∞ÂΩïÔºå‰πüÂ∞±ÊòØËØ•ÁªÑÂÜÖÂÖ±ÊúâÂá†Êù°ËÆ∞ÂΩï</li>
<li>Â∞ÜÊØè‰∏™ÁªÑÁöÑÊúÄÂêé‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÂú∞ÂùÄÂÅèÁßªÈáèÂçïÁã¨ÊèêÂèñÂá∫Êù•ÊåâÈ°∫Â∫èÂ≠òÂÇ®Âà∞Èù†ËøëÈ°µÁöÑÂ∞æÈÉ®ÁöÑÂú∞ÊñπÔºåËøô‰∏™Âú∞ÊñπÂ∞±ÊòØÊâÄË∞ìÁöÑPage DirectoryÔºå‰πüÂ∞±ÊòØÈ°µÁõÆÂΩï„ÄÇÈ°µÈù¢ÁõÆÂΩï‰∏≠ÁöÑËøô‰∫õÂú∞ÂùÄÂÅèÁßªÈáèË¢´Áß∞‰∏∫ÊßΩÔºàSlotÔºâÔºåÊâÄ‰ª•Ëøô‰∏™È°µÈù¢ÁõÆÂΩïÂ∞±ÊòØÁî±ÊßΩÁªÑÊàêÁöÑ</li>
</ol>
<p><img src="/img/dba/page-3.png" alt="page-3"></p>
<p><strong>È°µÈù¢Â§¥ÈÉ®Ôºàpage HeaderÔºâ</strong></p>
<p>InnoDB‰∏∫‰∫ÜËÉΩÂæóÂà∞‰∏Ä‰∏™Êï∞ÊçÆÈ°µ‰∏≠Â≠òÂÇ®ÁöÑËÆ∞ÂΩïÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÊØîÂ¶ÇÊú¨È°µ‰∏≠Â∑≤ÁªèÂ≠òÂÇ®‰∫ÜÂ§öÂ∞ëÊù°ËÆ∞ÂΩïÔºåÁ¨¨‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÂú∞ÂùÄÊòØ‰ªÄ‰πàÔºåÈ°µÁõÆÂΩï‰∏≠Â≠òÂÇ®‰∫ÜÂ§öÂ∞ë‰∏™ÊßΩÁ≠âÁ≠âÔºåÁâπÊÑèÂú®È°µ‰∏≠ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Âè´<code>Page Header</code>ÁöÑÈÉ®ÂàÜ</p>
<table>
<thead>
<tr>
<th>ÂêçÁß∞</th>
<th>Â§ßÂ∞èÔºàByteÔºâ</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>PAGE_N_DIR_SLOTS</td>
<td>2</td>
<td>È°µÁõÆÂΩïÁöÑÊèíÊßΩÊï∞</td>
</tr>
<tr>
<td>PAGE_HEAP_TOP</td>
<td>2</td>
<td>ËøòÊú™‰ΩøÁî®ÁöÑÁ©∫Èó¥ÊúÄÂ∞èÂú∞ÂùÄÔºå‰πüÂ∞±ÊòØËØ¥‰ªéËØ•Âú∞ÂùÄ‰πãÂêéÂ∞±ÊòØFree Space</td>
</tr>
<tr>
<td>PAGE_N_HEAP</td>
<td>2</td>
<td>Êú¨È°µ‰∏≠ÁöÑËÆ∞ÂΩïÁöÑÊï∞ÈáèÔºàÂåÖÊã¨ÊúÄÂ∞èÂíåÊúÄÂ§ßËÆ∞ÂΩï‰ª•ÂèäÊ†áËÆ∞‰∏∫Âà†Èô§ÁöÑËÆ∞ÂΩïÔºâ</td>
</tr>
<tr>
<td>PAGE_FREE</td>
<td>2</td>
<td>Á¨¨‰∏Ä‰∏™Â∑≤ÁªèÊ†áËÆ∞‰∏∫Âà†Èô§ÁöÑËÆ∞ÂΩïÂú∞ÂùÄÔºàÂêÑ‰∏™Â∑≤Âà†Èô§ÁöÑËÆ∞ÂΩïÈÄöËøánext_record‰πü‰ºöÁªÑÊàê‰∏Ä‰∏™ÂçïÈìæË°®ÔºåËøô‰∏™ÂçïÈìæË°®‰∏≠ÁöÑËÆ∞ÂΩïÂèØ‰ª•Ë¢´ÈáçÊñ∞Âà©Áî®Ôºâ</td>
</tr>
<tr>
<td>PAGE_GARBAGE</td>
<td>2</td>
<td>Â∑≤Âà†Èô§ËÆ∞ÂΩïÂç†Áî®ÁöÑÂ≠óËäÇÊï∞</td>
</tr>
<tr>
<td>PAGE_LAST_INSERT</td>
<td>2</td>
<td>ÊúÄÂêéÊèíÂÖ•ËÆ∞ÂΩïÁöÑ‰ΩçÁΩÆ</td>
</tr>
<tr>
<td>PAGE_DIRECTION</td>
<td>2</td>
<td>ËÆ∞ÂΩïÊèíÂÖ•ÁöÑÊñπÂêë</td>
</tr>
<tr>
<td>PAGE_N_DIRECTION</td>
<td>2</td>
<td>‰∏Ä‰∏™ÊñπÂêëËøûÁª≠ÊèíÂÖ•ÁöÑËÆ∞ÂΩïÊï∞Èáè</td>
</tr>
<tr>
<td>PAGE_N_RECS</td>
<td>2</td>
<td>È°µ‰∏≠ËÆ∞ÂΩïÁöÑÊï∞ÈáèÔºà‰∏çÂåÖÊã¨ÊúÄÂ∞èÂíåÊúÄÂ§ßËÆ∞ÂΩï‰ª•ÂèäË¢´Ê†áËÆ∞‰∏∫Âà†Èô§ÁöÑËÆ∞ÂΩïÔºâ</td>
</tr>
<tr>
<td>PAGE_MAX_TRX_ID</td>
<td>8</td>
<td>‰øÆÊîπÂΩìÂâçÈ°µÁöÑÊúÄÂ§ß‰∫ãÂä°IDÔºåËØ•ÂÄº‰ªÖÂú®‰∫åÁ∫ßÁ¥¢Âºï‰∏≠ÂÆö‰πâ</td>
</tr>
<tr>
<td>PAGE_LEVEL</td>
<td>2</td>
<td>ÂΩìÂâçÈ°µÂú®B+Ê†ë‰∏≠ÊâÄÂ§ÑÁöÑÂ±ÇÁ∫ß</td>
</tr>
<tr>
<td>PAGE_INDEX_ID</td>
<td>8</td>
<td>Á¥¢ÂºïIDÔºåË°®Á§∫ÂΩìÂâçÈ°µÂ±û‰∫éÂì™‰∏™Á¥¢Âºï</td>
</tr>
<tr>
<td>PAGE_BTR_SEG_LEAF</td>
<td>10</td>
<td>B+Ê†ëÂè∂Â≠êÊÆµÁöÑÂ§¥ÈÉ®‰ø°ÊÅØÔºå‰ªÖÂú®B+Ê†ëÁöÑRootÈ°µÂÆö‰πâ</td>
</tr>
<tr>
<td>PAGE_BTR_SEG_TOP</td>
<td>10</td>
<td>B+Ê†ëÈùûÂè∂Â≠êÊÆµÁöÑÂ§¥ÈÉ®‰ø°ÊÅØÔºå‰ªÖÂú®B+Ê†ëÁöÑRootÈ°µÂÆö‰πâ</td>
</tr>
</tbody>
</table>
<p><strong>Êñá‰ª∂Â§¥ÈÉ®ÔºàFile HeaderÔºâ</strong></p>
<p><code>File Header</code>ÊòØÈíàÂØπÂêÑÁßçÁ±ªÂûãÁöÑÈ°µÈÉΩÈÄöÁî®Êï∞ÊçÆÈÉ®ÂàÜÔºå‰πüÂ∞±ÊòØËØ¥‰∏çÂêåÁ±ªÂûãÁöÑÈ°µÈÉΩ‰ºö‰ª•<code>File Header</code>‰Ωú‰∏∫Á¨¨‰∏Ä‰∏™ÁªÑÊàêÈÉ®ÂàÜÔºåÂÆÉÊèèËø∞‰∫Ü‰∏Ä‰∫õÈíàÂØπÂêÑÁßçÈ°µÈÉΩÈÄöÁî®ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØÔºåÊØîÊñπËØ¥Ëøô‰∏™È°µÁöÑÁºñÂè∑ÊòØÂ§öÂ∞ëÔºåÂÆÉÁöÑ‰∏ä‰∏Ä‰∏™È°µ„ÄÅ‰∏ã‰∏Ä‰∏™È°µÊòØË∞ÅÁ≠â‰ø°ÊÅØÔºåËøô‰∏™ÈÉ®ÂàÜÂç†Áî®Âõ∫ÂÆöÁöÑ38‰∏™Â≠óËäÇÔºåÊòØÁî±‰∏ãËæπËøô‰∫õÂÜÖÂÆπÁªÑÊàêÁöÑ</p>
<table>
<thead>
<tr>
<th>ÂêçÁß∞</th>
<th>Â§ßÂ∞èÔºàByteÔºâ</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>FIL_PAGE_SPACE_OR_CHKSUM</td>
<td>4</td>
<td>È°µÁöÑÊ†°È™åÂíåÔºàchecksumÂÄºÔºâ</td>
</tr>
<tr>
<td>FIL_PAGE_OFFSET</td>
<td>4</td>
<td>È°µÂè∑</td>
</tr>
<tr>
<td>FIL_PAGE_PREV</td>
<td>4</td>
<td>‰∏ä‰∏Ä‰∏™È°µÁöÑÈ°µÂè∑</td>
</tr>
<tr>
<td>FIL_PAGE_NEXT</td>
<td>4</td>
<td>‰∏ã‰∏Ä‰∏™È°µÁöÑÈ°µÂè∑</td>
</tr>
<tr>
<td>FIL_PAGE_LSN</td>
<td>8</td>
<td>È°µÈù¢Ë¢´ÊúÄÂêé‰øÆÊîπÊó∂ÂØπÂ∫îÁöÑÊó•ÂøóÂ∫èÂàó‰ΩçÁΩÆ</td>
</tr>
<tr>
<td>FIL_PAGE_TYPE</td>
<td>2</td>
<td>ËØ•È°µÁöÑÁ±ªÂûã</td>
</tr>
<tr>
<td>FIL_PAGE_FILE_FLUSH_LSN</td>
<td>8</td>
<td>‰ªÖÂú®Á≥ªÁªüË°®Á©∫Èó¥ÁöÑ‰∏Ä‰∏™È°µ‰∏≠ÂÆö‰πâÔºå‰ª£Ë°®Êñá‰ª∂Ëá≥Â∞ëË¢´Âà∑Êñ∞Âà∞‰∫ÜÂØπÂ∫îÁöÑLSNÂÄº</td>
</tr>
<tr>
<td>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</td>
<td>4</td>
<td>È°µÂ±û‰∫éÂì™‰∏™Ë°®Á©∫Èó¥</td>
</tr>
</tbody>
</table>
<p><img src="/img/dba/page-4.png" alt="page-4"></p>
<p><strong>Êñá‰ª∂Â∞æÈÉ®ÔºàFile TrailerÔºâ</strong></p>
<ul>
<li>Ââç4‰∏™Â≠óËäÇ‰ª£Ë°®È°µÁöÑÊ†°È™åÂíåÔºåÂíåFile HeaderÁöÑÈÅ•Áõ∏ÂëºÂ∫îÔºåÂà∑ÁõòÊó∂ÂÖàÂÜôFile HeaderÁöÑÊ†°È™åÂíåÔºåÂÜçÂÜôFile TrailerÁöÑÔºåÂ¶ÇÊûú‰∏ç‰∏ÄËá¥ËØÅÊòéÈ°µÈù¢Âá∫Áé∞ÊçüÂùè</li>
<li>Âêé4‰∏™Â≠óËäÇ‰ª£Ë°®È°µÈù¢Ë¢´ÊúÄÂêé‰øÆÊîπÊó∂ÂØπÂ∫îÁöÑÊó•ÂøóÂ∫èÂàó‰ΩçÁΩÆÔºàLSNÔºâ</li>
</ul>
<h3 id="Êó•Âøó‰∏éÊï∞ÊçÆÂà∑Êñ∞">Êó•Âøó‰∏éÊï∞ÊçÆÂà∑Êñ∞</h3>
<p><strong>DWBÔºàdouble write buffffferÔºâ</strong></p>
<p>MySQLÁöÑ‰∏ÄÈ°µÁöÑÂ§ßÂ∞èÊòØ16KÔºåÊñá‰ª∂Á≥ªÁªü‰∏ÄÈ°µÁöÑÂ§ßÂ∞èÊòØ4KÔºåÂç≥MySQLÂ∞Übuffer‰∏≠‰∏ÄÈ°µÊï∞ÊçÆÂà∑ÂÖ•Á£ÅÁõòÔºåË¶ÅÂÜô4‰∏™Êñá‰ª∂Á≥ªÁªüÈáåÁöÑÈ°µ</p>
<p><img src="/img/dba/dwb-1.png" alt="dwb-1"></p>
<p>Ëøô‰∏™Êìç‰ΩúÂπ∂ÈùûÂéüÂ≠êÔºåÂ¶ÇÊûúÊâßË°åÂà∞‰∏ÄÂçäÊñ≠ÁîµÔºå‰ºö‰∏ç‰ºöÂá∫Áé∞ÈóÆÈ¢òÂë¢Ôºü‰ºöÔºåËøôÂ∞±ÊòØÊâÄË∞ìÁöÑ‚ÄúÈ°µÊï∞ÊçÆÊçüÂùè‚Äù</p>
<p><img src="/img/dba/dwb-2.png" alt="dwb-2"></p>
<blockquote>
<p>redoÊó†Ê≥ï‰øÆÂ§çËøôÁ±ª&quot;È°µÊï∞ÊçÆÊçüÂùè&quot;ÁöÑÂºÇÂ∏∏Ôºå‰øÆÂ§çÁöÑÂâçÊèêÊòØ&quot;È°µÊï∞ÊçÆÊ≠£Á°Æ&quot;Âπ∂‰∏îredoÊó•ÂøóÊ≠£Â∏∏</p>
</blockquote>
<p>‰∫éÊòØÂ∞±Êúâ‰∫ÜËß£ÂÜ≥ÊñπÊ°à<code>Double Write Buffer</code>Ôºå‰ΩÜÂÆÉ‰∏é‰º†ÁªüÁöÑbuffer‰∏çÂêåÔºåÂÆÉÂàÜ‰∏∫<span style="color:RGB(4,151,253)"><strong>ÂÜÖÂ≠ò</strong></span>Âíå<span style="color:RGB(4,151,253)"><strong>Á£ÅÁõò</strong></span>ÁöÑ‰∏§Â±ÇÊû∂ÊûÑ„ÄÇÂç≥‰º†ÁªüÁöÑbufferÔºåÂ§ßÈÉ®ÂàÜÊòØÂÜÖÂ≠òÂ≠òÂÇ®ÔºåËÄåDWBÈáåÁöÑÊï∞ÊçÆÔºåÊòØÈúÄË¶ÅËêΩÂú∞ÁöÑ</p>
<p><img src="/img/dba/dwb-3.png" alt="dwb-3"></p>
<p>Á¨¨‰∏ÄÊ≠•ÔºöÈ°µÊï∞ÊçÆÂÜÖÂ≠òÁöÑÊï∞ÊçÆÂÖàÊã∑Ë¥ùÂà∞DWBÁöÑÂÜÖÂ≠òÈáå</p>
<p>Á¨¨‰∫åÊ≠•ÔºöDWBÁöÑÂÜÖÂ≠òÂà∑Âà∞DWBÁöÑÁ£ÅÁõò‰∏ä</p>
<p>Á¨¨‰∏âÊ≠•ÔºöDWBÁöÑÂÜÖÂ≠òÂà∑Âà∞Êï∞ÊçÆÁ£ÅÁõòÂ≠òÂÇ®‰∏ä</p>
<p><span style="color:#DD001B">ÂÅáËÆæÊ≠•Á¨¨‰∫åÊ≠•Âá∫Áé∞ÈóÆÈ¢òÔºåÁ£ÅÁõòÈáå‰æùÁÑ∂ÊòØ1+2+3+4ÁöÑÂÆåÊï¥Êï∞ÊçÆÔºåÂè™Ë¶ÅÊúâÈ°µÊï∞ÊçÆÂÆåÊï¥ÔºåÂ∞±ËøòËÉΩÈÄöËøáredoËøòÂéüÊï∞ÊçÆ</span></p>
<p><span style="color:#DD001B">ÂÅáËÆæÊ≠•Á¨¨‰∏âÊ≠•Âá∫Áé∞ÈóÆÈ¢òÔºåDWBÈáåÂ≠òÂÇ®ÁùÄÂÆåÊï¥ÁöÑÊï∞ÊçÆÔºåÂèØÈÄöËøáDWBÁöÑÊï∞ÊçÆÊÅ¢Â§çÁ£ÅÁõòÊï∞ÊçÆ</span></p>
<p><strong>REDOÊó•Âøó</strong></p>
<p>Âú®È°µÈù¢‰øÆÊîπÂÆåÊàê‰πãÂêéÔºåÂú®ËÑèÈ°µÂà∑Âá∫Á£ÅÁõò‰πãÂâçÔºåË¶ÅÂÖàÂÜôÂÖ•RedoÊó•ÂøóÔºåÈò≤Ê≠¢ÂºÇÂ∏∏ÊÉÖÂÜµÂØºËá¥Êï∞ÊçÆÈîôËØØÔºåËÄå‰∏îRedoÊó•Âøó‰∏ÄÂÆöÊòØÂÖàË°åÁöÑÔºàËÅöÁ∞áÁ¥¢Âºï„ÄÅ‰∫åÁ∫ßÁ¥¢Âºï„ÄÅUndoÈ°µÈù¢‰øÆÊîπÔºåÂùáÈúÄË¶ÅËÆ∞ÂΩïRedoÊó•ÂøóÔºâ</p>
<p>Â≠òÂÇ®‰ΩçÁΩÆÔºöÊï∞ÊçÆË∑ØÂæÑ‰∏ãÔºåËøõË°åËΩÆÂ∫èË¶ÜÁõñËÆ∞ÂΩïÊó•ÂøóÔºàÂêçÁß∞ib_logfileNÔºâ</p>
<p>Êü•ËØ¢Redo logÊñá‰ª∂ÈÖçÁΩÆÔºö<code>show variables like '%innodb_log_file%';</code></p>
<p>Áîü‰∫ßÂª∫ËÆÆÔºö512M-4G 2-4ÁªÑ</p>
<p><span style="color:RGB(4,151,253)"><strong>‰ªéMySQL 8.0.30ÂºÄÂßãÔºåInnoDBÁöÑÈáçÂÅöÊó•ÂøóÊû∂ÊûÑÂèëÁîü‰∫ÜÈáçÂ§ßÂèòÂåñÔºåÈáçÂÅöÊó•ÂøóÊñá‰ª∂Ë¢´Âõ∫ÂÆö‰∏∫32‰∏™ÔºåÂπ∂Â≠òÊîæÂú®‰∏Ä‰∏™‰∏ìÈó®ÁöÑÁõÆÂΩï(#innodb_redo)‰∏ãÈù¢ÔºåÁî®Êà∑ÂèØ‰ª•‰ΩøÁî®Á≥ªÁªüÂèòÈáèinnodb_redo_log_capacityÔºàÈªòËÆ§100MÔºâÂú®Á∫ø‰øÆÊîπÈáçÂÅöÊó•ÂøóÂÆπÈáèÔºåÂéüÊù•ÁöÑinnodb_log_files_in_groupÂíåinnodb_log_file_size‰∏§‰∏™Á≥ªÁªüÂèòÈáèÂ∑≤ÁªèÂ∫üÂºÉ„ÄÇ</strong></span></p>
<p><strong>UNDO Êó•Âøó</strong></p>
<p>ÂΩì‰∫ãÂä°ÊâßË°åËøáÁ®ã‰∏≠Á™ÅÁÑ∂‰∏≠Ê≠¢Ôºå‰∏∫‰∫Ü‰øùËØÅ‰∫ãÂä°ÁöÑÂéüÂ≠êÊÄßÔºåÈúÄË¶ÅÂõûÊªöÂõûÂéüÊù•ÁöÑÊ†∑Â≠êÔºåÊØèÂΩìË¶ÅÂØπ‰∏ÄÊù°ËÆ∞ÂΩïËøõË°åÊîπÂä®Êó∂ÔºåÈÉΩÈúÄË¶ÅËÆ∞ÂΩï‰∏ã‰∏Ä‰∫õ‰ø°ÊÅØÔºå‰∏∫‰∫ÜÂõûÊªöËÄåËÆ∞ÂΩïÁöÑ‰∏úË•øÁß∞‰∏∫Êí§ÈîÄÊó•ÂøóÔºåÂç≥undoÊó•Âøó„ÄÇ‰∫åÁ∫ßÁ¥¢ÂºïËÆ∞ÂΩïÁöÑ‰øÆÊîπÔºå‰∏çËÆ∞ÂΩïUndoÊó•Âøó„ÄÇ</p>
<p><strong>LSNÔºàÊó•ÂøóÂ∫èÂàóÂè∑Ôºâ</strong></p>
<p><code>LSNÔºàlog sequence numberÔºâ</code>Êó•ÂøóÂ∫èÂàóÂè∑ÔºåÂç†Áî®8Â≠óËäÇÔºåLSN‰∏ªË¶ÅÁî®‰∫éÂèëÁîüÂÆïÊú∫Êó∂ÂØπÊï∞ÊçÆËøõË°åÊÅ¢Â§çÔºåLSNÊòØ‰∏Ä‰∏™‰∏ÄÁõ¥ÈÄíÂ¢ûÁöÑÊï¥ÂûãÊï∞Â≠óÔºåË°®Á§∫‰∫ãÂä°ÂÜôÂÖ•Âà∞Êó•ÂøóÁöÑÂ≠óËäÇÊÄªÈáè„ÄÇLSN‰∏ç‰ªÖÂè™Â≠òÂú®‰∫éÈáçÂÅöÊó•Âøó‰∏≠ÔºåÂú®ÊØè‰∏™Êï∞ÊçÆÈ°µÂ§¥ÈÉ®‰πü‰ºöÊúâÂØπÂ∫îÁöÑLSNÂè∑ÔºåËØ•LSNËÆ∞ÂΩïÂΩìÂâçÈ°µÊúÄÂêé‰∏ÄÊ¨°‰øÆÊîπÁöÑLSNÂè∑ÔºåÁî®‰∫éÂú®ÊÅ¢Â§çÊó∂ÂØπÊØîÈáçÂÅöÊó•ÂøóLSNÂè∑ÂÜ≥ÂÆöÊòØÂê¶ÂØπËØ•È°µËøõË°åÊÅ¢Â§çÊï∞ÊçÆ„ÄÇ<code>checkpoint</code>‰πüÊòØÊúâLSNÂè∑ËÆ∞ÂΩïÁöÑÔºåLSNÂè∑‰∏≤ËÅîËµ∑‰∏Ä‰∏™‰∫ãÂä°ÂºÄÂßãÂà∞ÊÅ¢Â§çÁöÑËøáÁ®ã</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Êü•ÁúãLSN‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>engine<span style="color:#bbb"> </span>innodb<span style="color:#bbb"> </span>status<span style="color:#a61717;background-color:#e3d2d2">\</span><span style="color:#000;font-weight:bold">G</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ËøîÂõû‰ø°ÊÅØËØ¥ÊòéÔºö
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Log sequence number: ÂΩìÂâçÁ≥ªÁªüÊúÄÂ§ßÁöÑLSNÂè∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- log flushed up to:ÂΩìÂâçÂ∑≤ÁªèÂÜôÂÖ•redoÊó•ÂøóÊñá‰ª∂ÁöÑLSN
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- pages flushed up toÔºöÂ∑≤ÁªèÂ∞ÜÊõ¥ÊîπÂÜôÂÖ•ËÑèÈ°µÁöÑlsnÂè∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Last checkpoint atÂ∞±ÊòØÁ≥ªÁªüÊúÄÂêé‰∏ÄÊ¨°Âà∑Êñ∞buffer poolËÑè‰∏≠È°µÊï∞ÊçÆÂà∞Á£ÅÁõòÁöÑcheckpoint
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ‰ª•‰∏ä4‰∏™LSNÊòØÈÄíÂáèÁöÑ: LSN1&gt;=LSN2&gt;=LSN3&gt;=LSN4
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>checkpointÔºàÊ£ÄÊü•ÁÇπÔºâ</strong></p>
<p>ÊåâÁÖßÁ±ªÂûãÂàÜÁ±ª</p>
<ul>
<li>sharp checkpointÔºöÂÆåÂÖ®Ê£ÄÊü•ÁÇπÔºåÊï∞ÊçÆÂ∫ìÊ≠£Â∏∏Âπ≤ÂáÄÂÖ≥Èó≠Êó∂Ôºå‰ºöËß¶ÂèëÊääÊâÄÊúâÁöÑËÑèÈ°µÈÉΩÂÜôÂÖ•Âà∞Á£ÅÁõò‰∏ä(ËøôÊó∂ÂÄôlogfileÁöÑÊó•ÂøóÂ∞±Ê≤°Áî®‰∫ÜÔºåËÑèÈ°µÂ∑≤ÁªèÂÜôÂà∞Á£ÅÁõò‰∏ä‰∫Ü)</li>
<li>fuzzy checkpointÔºöÊ®°Á≥äÊ£ÄÊü•ÁÇπÔºåÈÉ®ÂàÜÈ°µÂÜôÂÖ•Á£ÅÁõò„ÄÇ</li>
</ul>
<p>ÊåâÁÖßËß¶ÂèëÊ∫êÂ§¥ÂàÜÁ±ª</p>
<ul>
<li>
<p>master thread checkpointÔºöÂ∑Æ‰∏çÂ§ö‰ª•ÊØèÁßíÊàñÊØèÂçÅÁßíÁöÑÈÄüÂ∫¶‰ªéÁºìÂÜ≤Ê±†ÁöÑËÑèÈ°µÂàóË°®‰∏≠Âà∑Êñ∞‰∏ÄÂÆöÊØî‰æãÁöÑÈ°µÂõûÁ£ÅÁõòÔºåËøô‰∏™ËøáÁ®ãÊòØÂºÇÊ≠•ÁöÑÔºå‰∏ç‰ºöÈòªÂ°ûÁî®Êà∑Êü•ËØ¢</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- PCI-EÂª∫ËÆÆ 2000-3000 4000-6000
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- flashÂª∫ËÆÆ 5000-8000 10000-16000
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_io_capacity;<span style="color:#bbb">     </span><span style="color:#998;font-style:italic">-- ÈªòËÆ§200
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_io_capacity_max;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">-- ÈªòËÆ§2000
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>flush_lru_list checkpointÔºöÊéßÂà∂lruÂàóË°®‰∏≠ÂèØÁî®È°µÁöÑÊï∞ÈáèÔºåÈªòËÆ§ÊòØ1024</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>innodb_lru_scan_depth;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>async/sync flush checkpointÔºölog fileÂø´Êª°‰∫ÜÔºå‰ºöÊâπÈáèÁöÑËß¶ÂèëÊï∞ÊçÆÈ°µÂõûÂÜôÔºåËøô‰∏™‰∫ã‰ª∂Ëß¶ÂèëÁöÑÊó∂ÂÄôÂèàÂàÜ‰∏∫ÂºÇÊ≠•ÂíåÂêåÊ≠•</p>
<p>redo log Âç† log file ÁöÑÊØîÂÄºÂ§ß‰∫é75%ÊòØÂºÇÊ≠•ÔºõÂ§ß‰∫é90%ÊòØÂêåÊ≠•</p>
</li>
<li>
<p>dirty page too much checkpointÔºöËÑèÈ°µÂ§™Â§öÊ£ÄÊü•ÁÇπÔºå‰∏∫‰∫Ü‰øùËØÅbuffer poolÁöÑÁ©∫Èó¥ÂèØÁî®ÊÄßÁöÑ‰∏Ä‰∏™Ê£ÄÊü•ÁÇπ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_totalÔºöË°®Á§∫ËÑèÈ°µÂú®bufferÁöÑÂç†ÊØî
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>Innodb_buffer_pool_pages_dirty;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">@@</span>Innodb_buffer_pool_pages_total;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Â¶ÇÊûú&gt;0ÔºåËØ¥ÊòéÂá∫Áé∞ÊÄßËÉΩË¥üËΩΩÔºåbuffer pool‰∏≠Ê≤°ÊúâÂπ≤ÂáÄÂèØÁî®Âùó
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">global</span><span style="color:#bbb"> </span>status<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;%Innodb_buffer_pool_wait_free&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="innodb-‰∫ãÂä°ËØ¶Ëß£"><strong>InnoDB</strong> ‰∫ãÂä°ËØ¶Ëß£</h3>
<p><strong>‰∫ãÂä°ÁöÑACID</strong></p>
<p>AtomicityÔºöÂéüÂ≠êÊÄßÔºå‰∏Ä‰∏™‰∫ãÂä°ÁîüÂëΩÂë®Êúü‰∏≠ÁöÑDMLËØ≠Âè•ÔºåË¶Å‰πàÂÖ®ÊàêÂäüË¶Å‰πàÂÖ®Â§±Ë¥•Ôºå‰∏çÂèØ‰ª•Âá∫Áé∞‰∏≠Èó¥Áä∂ÊÄÅ</p>
<p>ÂÆûÁé∞Êú∫Âà∂Ôºöundo‰øùËØÅÁöÑ</p>
<p>ConsistencyÔºö‰∏ÄËá¥ÊÄßÔºå‰∫ãÂä°ÂèëÁîüÂâçÔºå‰∏≠ÔºåÂêéÔºåÊï∞ÊçÆÈÉΩÊúÄÁªà‰øùÊåÅ‰∏ÄËá¥</p>
<p>ÂÆûÁé∞Êú∫Âà∂ÔºöCR + DWB</p>
<p>IsolationÔºöÈöîÁ¶ªÊÄßÔºå‰∫ãÂä°Êìç‰ΩúÊï∞ÊçÆË°åÁöÑÊó∂ÂÄôÔºå‰∏ç‰ºöÂèóÂà∞ÂÖ∂‰ªñ‰∫ãÂä°ÁöÑÂΩ±Âìç</p>
<p>ÂÆûÁé∞Êú∫Âà∂ÔºöMVCC„ÄÅÈîÅ</p>
<p>DurabilityÔºöÊåÅ‰πÖÊÄßÔºå‰∏Ä‰ΩÜ‰∫ãÂä°Êèê‰∫§ÔºåÊ∞∏‰πÖÁîüÊïàÔºàËêΩÁõòÔºâ</p>
<p>ÂÆûÁé∞Êú∫Âà∂Ôºöredo„ÄÅckpt</p>
<p><strong>ÈöîÁ¶ªÁ∫ßÂà´</strong></p>
<p>READ-UNCOMMITTEDÔºàRUÔºâÔºöËØªÊú™Êèê‰∫§ÔºåÂèØ‰ª•ËØªÂèñÂà∞‰∫ãÂä°Êú™Êèê‰∫§ÁöÑÊï∞ÊçÆ„ÄÇÈöîÁ¶ªÊÄßÂ∑ÆÔºå‰ºöÂá∫Áé∞ËÑèËØªÔºàÂΩìÂâçÂÜÖÂ≠òËØªÔºâÔºå‰∏çÂèØÈáçÂ§çËØªÔºåÂπªËØªÈóÆÈ¢ò</p>
<p>READ-COMMITTEDÔºàRCÔºâÔºöËØªÂ∑≤Êèê‰∫§ÔºàÁîüÊàê‰∏ÄËà¨‰ΩøÁî®Ôºâ„ÄÇÂèØ‰ª•ËØªÂèñÂà∞‰∫ãÂä°Â∑≤Êèê‰∫§ÁöÑÊï∞ÊçÆ„ÄÇÈöîÁ¶ªÊÄß‰∏ÄËà¨Ôºå‰∏ç‰ºöÂá∫Áé∞ËÑèËØªÈóÆÈ¢òÔºå‰ΩÜÊòØ‰ºöÂá∫Áé∞‰∏çÂèØÈáçÂ§çËØªÔºåÂπªËØªÈóÆÈ¢ò</p>
<p>REPEATABLE-READÔºàRR ÔºâÔºöÂèØÈáçÂ§çËØªÔºàÈªòËÆ§Ôºâ„ÄÇÈò≤Ê≠¢ËÑèËØªÔºàÂΩìÂâçÂÜÖÂ≠òËØªÔºâÔºå‰∏çÂèØÈáçÂ§çËØªÔºåÂπªËØªÈóÆÈ¢ò„ÄÇÈúÄË¶ÅÈÖçÂêàÈîÅÊú∫Âà∂Êù•ÈÅøÂÖçÂπªËØª</p>
<p>SERIALIZABLEÔºàSEÔºâÔºöÂèØ‰∏≤Ë°åÂåñ</p>
<h3 id="innodb-ÈîÅÊú∫Âà∂">InnoDB ÈîÅÊú∫Âà∂</h3>
<p><strong>latch</strong></p>
<p>latchÔºåÈó©ÔºàshuƒÅnÔºâÈîÅÔºåÁõ¥ËØëËøáÊù•Â∞±ÊòØÈîÅÔºå‰ΩÜlatchÁöÑ‰ΩúÁî®ÊòØÁî®‰∫éÊéßÂà∂ÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆÁªìÊûÑÂπ∂ÂèëËÆøÈóÆÁöÑÔºàÈÄö‰øóÊù•ËÆ≤ÔºåÂ∞±ÊòØ‰øùÊä§ÂÜÖÂ≠ò‰∏≠Êï∞ÊçÆÁªìÊûÑÂÆåÊï¥ÊÄßÁöÑÔºâ„ÄÇ‰∏éÊï∞ÊçÆÂ∫ìÁöÑÈîÅÔºàLockÔºâ‰∏çÂêåÔºåÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÈîÅÂØπË±°‰∏çÊòØÂÜÖÂ≠òÁªìÊûÑÔºåÈîÅ‰ΩèÁöÑÊòØ‰∏ÄË°å‰∏ÄË°åÁöÑËÆ∞ÂΩïÔºåËÄålatchÈîÅ‰ΩèÁöÑÊòØÂπ∂ÂèëËµÑÊ∫êÁöÑÂØπË±°Ôºå‰πüÁß∞‰Ωú‰∏¥ÁïåÂå∫„ÄÇÂπ∂‰∏î‰∫åËÄÖÊåÅÁª≠ÁöÑÊó∂Èó¥‰∏ç‰∏ÄÊ†∑ÔºåLockÊòØË¥ØÁ©øÊï¥‰∏™‰∫ãÂä°Ôºå‰∫ãÂä°Êèê‰∫§‰∫ÜÔºåLockÊâç‰ºöÈáäÊîæ„ÄÇÂÖ∂ÂÆû‰ªª‰ΩïÁ≥ªÁªü‰∏≠ÈÉΩÊúâlatchÔºåÊó†Â§Ñ‰∏çÂú®„ÄÇÂ∞±ÂÉèjava‰∏≠ÁöÑLock</p>
<p>Âú®InnoDBÂ≠òÂÇ®ÂºïÊìé‰∏≠ÔºålatchÂèàÂèØ‰ª•ÂàÜ‰∏∫mutexÔºà‰∫íÊñ•ÈáèÔºâÂíårwlockÔºàËØªÂÜôÈîÅÔºâ„ÄÇÂÖ∂ÁõÆÁöÑÊòØÁî®Êù•‰øùËØÅÂπ∂ÂèëÁ∫øÁ®ãÊìç‰Ωú‰∏¥ÁïåËµÑÊ∫êÁöÑÊ≠£Á°ÆÊÄßÔºåÂπ∂‰∏îÈÄöÂ∏∏Ê≤°ÊúâÊ≠ªÈîÅÊ£ÄÊµãÊú∫Âà∂</p>
<p><img src="/img/dba/%E9%94%81%E6%AF%94%E8%BE%83.png" alt="ÈîÅÊØîËæÉ"></p>
<p><strong>InnoDBÁöÑSÈîÅ„ÄÅXÈîÅ</strong></p>
<p>ÂÖ±‰∫´ÈîÅÔºàSÔºâÂíåÊéí‰ªñÈîÅÔºàXÔºâÈÉΩÂ±û‰∫éË°åÁ∫ßÂà´Ôºàrow-levelÔºâÁöÑÈîÅÔºå‰∏îÈÉΩÊØîËæÉÂ•ΩÁêÜËß£ÔºåSÈîÅ‰∏éXÈîÅ‰∫íÁõ∏ÂÜ≤Á™ÅÔºåXÈîÅ‰∏éXÈîÅ‰πüÊòØ‰∫íÁõ∏ÂÜ≤Á™ÅÔºåSÈîÅ‰∏éSÈîÅ‰∏ç‰ºöÂÜ≤Á™Å</p>
<img src="/img/dba/x-s.png"  style="zoom:67%;" />
<ul>
<li>ÂΩìËØªÂèñ‰∏ÄË°åËÆ∞ÂΩïÊó∂Ôºå‰∏∫‰∫ÜÈò≤Ê≠¢Âà´‰∫∫‰øÆÊîπÔºåÈúÄË¶ÅÊ∑ªÂä†SÈîÅ„ÄÇ</li>
<li>ÂΩì‰øÆÊîπ‰∏ÄË°åËÆ∞ÂΩïÊó∂Ôºå‰∏∫‰∫ÜÈò≤Ê≠¢Âà´‰∫∫ÂêåÊó∂ËøõË°å‰øÆÊîπÔºåÈúÄË¶ÅÊ∑ªÂä†XÈîÅ</li>
</ul>
<p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÊôÆÈÄöÁöÑÊü•ËØ¢Â±û‰∫éÈùûÈîÅÂÆöËØªÔºå‰∏ç‰ºöÊ∑ªÂä†‰ªª‰ΩïÈîÅÔºàÂç≥‰∏ÄËá¥ÊÄßËØªÔºåÂà©Áî®MVCCÔºâ„ÄÇËøòÊúâ‰∏ÄÁßçÊòØÈîÅÂÆöËØªÔºàÂç≥ÂΩìÂâçËØªÔºâÔºåÈÇ£‰πà‰ª•‰∏ã‰∏§ÁßçÂΩìÂâçËØªÊÉÖÂÜµ‰ºöËß¶ÂèëÈîÅÔºö</p>
<ol>
<li><code>SELECT ... LOCK IN SHARE MODE; </code> Ëøô‰∏™ËØ≠Ê≥ï‰ºöÊ∑ªÂä†SÈîÅÔºåÂØπ‰∫éÂÖ∂‰ªñ‰∫ãÂä°ÂèØ‰ª•ËØª‰ΩÜ‰∏çÂèØ‰ª•‰øÆÊîπ</li>
<li><code>SELECT ... FOR UPDATE; </code> Ëøô‰∏™ËØ≠Ê≥ï‰ºöÊ∑ªÂä†XÈîÅÔºåÂÖ∂‰ªñ‰∫ãÂä°‰øÆÊîπÊàñËÄÖÊâßË°å<code>SELECT ... FOR UPDATE</code>Êìç‰ΩúÈÉΩ‰ºöË¢´ÈòªÂ°û</li>
</ol>
<p>‰ΩøÁî®<code>SET GLOBAL innodb_status_output_locks='ON'; SHOW ENGINE INNODB STATUS ;</code>ÂèØ‰ª•Êü•ÁúãÂΩìÂâçÈîÅÊòØ‰ªÄ‰πà</p>
<p><strong>InnoDBÁöÑISÈîÅÂíåIXÈîÅ</strong></p>
<p>SÈîÅÂíåXÈîÅÈÉΩÊòØË°åÁ∫ßÂà´ÔºåÊòØÂä†Âú®Á¥¢ÂºïÔºàËÆ∞ÂΩïÔºâ‰∏äÁöÑ„ÄÇInnoDBÂ≠òÂÇ®ÂºïÊìéÊòØÊîØÊåÅÂ§öÁ≤íÂ∫¶ÈîÅÂÆöÁöÑÔºåËøôÁßçÈîÅÂÆöÂÖÅËÆ∏‰∫ãÂä°Âú®Ë°åÁ∫ßÂà´‰∏äÂíåË°®Á∫ßÂà´‰∏äÂêåÊó∂Â≠òÂú®„ÄÇ‰∏∫‰∫ÜÊîØÊåÅÂú®‰∏çÂêåÁ≤íÂ∫¶‰∏äËøõË°åÂä†ÈîÅÊìç‰ΩúÔºåInnoDBÂ≠òÂÇ®ÂºïÊìéÊîØÊåÅ‰∏ÄÁßçÈ¢ùÂ§ñÁöÑÈîÅÊñπÂºèÔºåÁß∞‰πã‰∏∫ÊÑèÂêëÈîÅÔºàINTENTION LOCKÔºâ„ÄÇÊÑèÂêëÈîÅÊòØÂ∞ÜÈîÅÂÆöÁöÑÂØπË±°ÂàÜ‰∏∫Â§ö‰∏™Â±ÇÊ¨°ÔºåÊÑèÂë≥ÁùÄ‰∫ãÂä°Â∏åÊúõÂú®Êõ¥ÁªÜÁ≤íÂ∫¶‰∏äËøõË°åÂä†ÈîÅ„ÄÇ</p>
<p>Â¶ÇÊûúÈúÄË¶ÅÂØπË°åËÆ∞ÂΩïrÂä†XÈîÅÔºåÈÇ£‰πàÂàÜÂà´ÈúÄË¶ÅÂØπÊï∞ÊçÆÂ∫ì„ÄÅË°®„ÄÅÈ°µ‰∏äÂÖàÂä† IX ÊàñËÄÖ ISÈîÅÔºåÊúÄÂêéÂØπËÆ∞ÂΩïr‰∏äÂä†XÈîÅ„ÄÇ</p>
<p><img src="/img/dba/%E9%94%81%E5%86%B2%E7%AA%81.png" alt="ÈîÅÂÜ≤Á™Å"></p>
<p>InnoDBÂ≠òÂÇ®ÂºïÊìéÂ±ÇÁöÑÂä†ÈîÅÈ°∫Â∫èÊòØÔºöÂ∫ì ‚Üí Ë°® ‚Üí È°µ ‚Üí ËÆ∞ÂΩï</p>
<p>InnoDBÂ≠òÂÇ®ÂºïÊìéËÆæËÆ°ÊÑèÂêëÈîÅÁöÑ‰∏ªË¶ÅÁõÆÁöÑÂ∞±ÊòØÔºö‰∏∫‰∫ÜÂú®‰∏Ä‰∏™‰∫ãÂä°‰∏≠Êè≠Á§∫‰∏ã‰∏ÄÂ±ÇÂ∞ÜË¢´ËØ∑Ê±ÇÁöÑÈîÅÁ±ªÂûã„ÄÇÂç≥ÊÑèÂêëÈîÅË°®Á§∫ÁöÑÊòØ‰∏ã‰∏ÄÂ±ÇÁ∫ßË¶ÅÂä†‰ªÄ‰πàÈîÅÔºåÂØπ‰∫éÂΩìÂâçËøô‰∏™Â±ÇÁ∫ßÔºåÂ§ßÂÆ∂ÈÉΩÊòØ‰∫íÁõ∏ÂÖºÂÆπÁöÑÔºàÂ§ßÂÆ∂Âä†ÁöÑÈÉΩÊòØÈîÅÁöÑÊÑèÂêë„ÄêÊúâÊÉ≥Ê≥ïÔºå‰ΩÜËøòÊú™ËêΩÂÆûÔºåËêΩÂÆûÁöÑ‰∫ãÊÉÖ‰∫§Áªô‰∏ã‰∏ÄÂ±ÇÊâã‰∏ãÁöÑ‰∫∫ÂéªÂÅö„ÄëÔºâÔºåÊâÄ‰ª•ÈîÅÂÖºÂÆπÁü©Èòµ‰∏≠ ‚Üí ÊÑèÂêëÈîÅ‰πãÈó¥ÈÉΩÊòØ‰∫íÁõ∏ÂÖºÂÆπÁöÑ</p>
<blockquote>
<p>‰πüÂèØÊâãÂä®ÁªôË°®Á∫ßÂà´Âä†S/XÈîÅÔºåÈùûÂ∏∏ÁâπÊÆäÊÉÖÂÜµÊâç‰ºö‰ΩøÁî®</p>
<p>lock tables t readÔºö</p>
<p>lock tables t writeÔºöÂØπË°®tÂä†XÈîÅ</p>
</blockquote>
<p><strong>InnoDB engineÁ∫ßÂà´ÈîÅ</strong></p>
<p>RCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÂè™ÊúâRecord LockÔºàËÆ∞ÂΩïÈîÅÔºâÔºåÊ≤°ÊúâGap LockÔºàÈó¥ÈöôÈîÅÔºâÂíåNext-Key LockÔºà‰∏¥ÈîÆÈîÅÔºâ</p>
<p><img src="/img/dba/%E9%94%81-%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB.png" alt="ÈîÅ-ÈöîÁ¶ªÁ∫ßÂà´"></p>
<p>‰ΩøÁî®ÈùûËÅöÈõÜÁ¥¢ÂºïÂàóËøõË°åÊï∞ÊçÆÊõ¥Êñ∞Êó∂ÔºåMySQL‰ºö‰ΩøÁî®ÈùûËÅöÈõÜÁ¥¢ÂºïËøõË°åÊü•ÊâæÔºåÂØπ‰∫éÊü•ÊâæÂà∞Êª°Ë∂≥ËøáÊª§Êù°‰ª∂ÁöÑÊØè‰∏ÄË°åÁ¥¢ÂºïËÆ∞ÂΩï</p>
<ol>
<li>Âú®Êü•ÊâæÂà∞ÁöÑÈùûËÅöÈõÜÁ¥¢ÂºïËÆ∞ÂΩï‰∏äÂä†ÈîÅ</li>
<li>Ê†πÊçÆÈùûËÅöÈõÜÁ¥¢ÂºïËÆ∞ÂΩï‰∏äÂåÖÂê´ÁöÑËÅöÈõÜÁ¥¢ÂºïÈîÆÂÄºËøõË°åÂõûË°®Êü•Êâæ</li>
<li>Âú®Êü•ÊâæÂà∞ÁöÑËÅöÈõÜÁ¥¢ÂºïËÆ∞ÂΩï‰∏äÂä†ÈîÅ</li>
<li>Âæ™ÁéØ1„ÄÅ2„ÄÅ3Ê≠•Â§ÑÁêÜ‰∏ã‰∏ÄÊù°Êª°Ë∂≥ËøáÊª§Êù°‰ª∂ÁöÑÊï∞ÊçÆ</li>
</ol>
<p><span style="color:RGB(4,151,253)">Record Lock ÔºàËÆ∞ÂΩïÈîÅÔºâÔºöÂçï‰∏™Á¥¢ÂºïËÆ∞ÂΩï‰∏äÁöÑÈîÅ„ÄÇ</span>ÈîÅÂÆöÁöÑÊòØ‰∏ÄÊù°ËÆ∞ÂΩï</p>
<p><span style="color:RGB(4,151,253)">GAP (Èó¥ÈöôÈîÅ)ÔºöÈîÅÂÆö‰∏Ä‰∏™ËåÉÂõ¥Ôºå‰ΩÜ‰∏çÂåÖÂê´ËÆ∞ÂΩïÊú¨Ë∫´Ôºàx, yÔºâ„ÄÇ</span>Èó¥ÈöôÈîÅÂ≠òÂú®‰∫éRRÔºàÂèØÈáçÂ§çËØªÔºâÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºå‰∏∫Èò≤Ê≠¢ÂπªËØªÂèëÁîüËÆæËÆ°Âá∫Êù•ÁöÑ‰∏ÄÁßçÊâãÊÆµÔºåÂõ†RCÔºàËØªÂ∑≤Êèê‰∫§ÔºâÈöîÁ¶ªÁ∫ßÂà´ÂèØËÉΩÂèëÁîüÂπªËØªÔºåÊïÖRCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÊ≤°ÊúâÈó¥ÈöôÈîÅ„ÄÇ</p>
<p><span style="color:RGB(4,151,253)">Next-Key LockÔºà‰∏¥ÈîÆÈîÅÔºâÔºöGap Lock + Record LockÔºåÈîÅÂÆö‰∏Ä‰∏™ËåÉÂõ¥ÔºåÂπ∂‰∏îÈîÅÂÆöËÆ∞ÂΩïÊú¨Ë∫´Ôºàx, y]„ÄÇ</span>Èó¥ÈöôÈîÅÂ≠òÂú®‰∫éRRÔºàÂèØÈáçÂ§çËØªÔºâÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºå‰∏∫Èò≤Ê≠¢ÂπªËØªÂèëÁîüËÆæËÆ°Âá∫Êù•ÁöÑ‰∏ÄÁßçÊâãÊÆµÔºåÂõ†RCÔºàËØªÂ∑≤Êèê‰∫§ÔºâÈöîÁ¶ªÁ∫ßÂà´ÂèØËÉΩÂèëÁîüÂπªËØªÔºåÊïÖRCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÊ≤°ÊúâÈó¥ÈöôÈîÅ„ÄÇ</p>
<blockquote>
<p>performance_schema.data_locksË°®ËÉΩÁúãÂà∞Âä†‰∫ÜÂì™‰∫õÈîÅ</p>
</blockquote>
<p>Âú®RRÁ∫ßÂà´‰∏ãÁöÑÂä†ÈîÅÁªÜËäÇ</p>
<p>ÂéüÂàô 1ÔºöÂä†ÈîÅÁöÑÂü∫Êú¨Âçï‰ΩçÊòØ next-key lock„ÄÇÂπ∂‰∏înext-key lock ÊòØÂâçÂºÄÂêéÈó≠Âå∫Èó¥„ÄÇ(5,10]</p>
<p>ÂéüÂàô 2ÔºöÊü•ÊâæËøáÁ®ã‰∏≠ËÆøÈóÆÂà∞ÁöÑÁ¥¢ÂºïÊâç‰ºöÂä†ÈîÅ</p>
<p>ÂéüÂàô 3ÔºöÁ¥¢Âºï‰∏äÁöÑÁ≠âÂÄºÊü•ËØ¢ÔºåÁªôÂîØ‰∏ÄÁ¥¢ÂºïÂä†ÈîÅÁöÑÊó∂ÂÄôÔºånext-key lock ÈÄÄÂåñ‰∏∫Ë°åÈîÅ</p>
<p>Â∏∏ËßÅÂú∫ÊôØÔºö</p>
<p><code>update ... where id=?</code>ÔºåRC\RRÊ®°Âºè‰∏ãÈÉΩÊòØRecord Lock</p>
<p><code>update ... where id in (?,?,?)</code>ÔºåRC\RRÊ®°Âºè‰∏ãÈÉΩÊòØRecord Lock</p>
<p><code>update ... where id &lt; ?</code>ÔºåRCÊ®°Âºè‰∏ãRecord LockÔºåRRÊ®°Âºè‰∏ãGAP</p>
<p><code>update ... where id &lt;= ?</code>ÔºåRCÊ®°Âºè‰∏ãRecord LockÔºåRRÊ®°Âºè<code>id</code>Â≠òÂú®ÊòØNext-Key LockÔºåÂê¶ÂàôÊòØGAP</p>
<h3 id="‰∏çÂêåÊÉÖÂÜµ‰∏ãÁöÑÈîÅÂ§ÑÁêÜÁ§∫‰æã">‰∏çÂêåÊÉÖÂÜµ‰∏ãÁöÑÈîÅÂ§ÑÁêÜÁ§∫‰æã</h3>
<p><strong>ÁªÑÂêà‰∏ÄÔºöid‰∏ªÈîÆ+RC</strong></p>
<p>ÁªôÂÆöSQLÔºödelete from t1 where id = 10; Âè™ÈúÄË¶ÅÂ∞Ü‰∏ªÈîÆ‰∏äÔºåid = 10ÁöÑËÆ∞ÂΩïÂä†‰∏äXÈîÅÂç≥ÂèØ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫</p>
<img src="/img/dba/id‰∏ªÈîÆ+RC.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p><strong>ÁªÑÂêà‰∫åÔºöidÂîØ‰∏ÄÁ¥¢Âºï+RC</strong></p>
<p>Ëøô‰∏™ÁªÑÂêàÔºåid‰∏çÊòØ‰∏ªÈîÆÔºåËÄåÊòØ‰∏Ä‰∏™UniqueÁöÑ‰∫åÁ∫ßÁ¥¢ÂºïÈîÆÂÄº„ÄÇÈÇ£‰πàÂú®RCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºådelete from t1 where id = 10;</p>
<img src="/img/dba/idÂîØ‰∏ÄÁ¥¢Âºï+RC.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p>Ê≠§Êó∂ÔºåÂä†ÈîÅÁöÑÊÉÖÂÜµÁî±‰∫éÁªÑÂêà‰∏ÄÊúâÊâÄ‰∏çÂêå„ÄÇÁî±‰∫éidÊòØuniqueÁ¥¢ÂºïÔºåÂõ†Ê≠§deleteËØ≠Âè•‰ºöÈÄâÊã©Ëµ∞idÂàóÁöÑÁ¥¢ÂºïËøõË°åwhereÊù°‰ª∂ÁöÑËøáÊª§ÔºåÂú®ÊâæÂà∞id=10ÁöÑËÆ∞ÂΩïÂêéÔºåÈ¶ñÂÖà‰ºöÂ∞ÜuniqueÁ¥¢Âºï‰∏äÁöÑid=10Á¥¢ÂºïËÆ∞ÂΩïÂä†‰∏äXÈîÅÔºåÂêåÊó∂Ôºå‰ºöÊ†πÊçÆËØªÂèñÂà∞ÁöÑnameÂàóÔºåÂõû‰∏ªÈîÆÁ¥¢Âºï(ËÅöÁ∞áÁ¥¢Âºï)ÔºåÁÑ∂ÂêéÂ∞ÜËÅöÁ∞áÁ¥¢Âºï‰∏äÁöÑname = ‚Äòd‚Äô ÂØπÂ∫îÁöÑ‰∏ªÈîÆÁ¥¢ÂºïÈ°πÂä†XÈîÅ„ÄÇ</p>
<p><strong>ÁªÑÂêà‰∏âÔºöidÈùûÂîØ‰∏ÄÁ¥¢Âºï+RC</strong></p>
<img src="/img/dba/idÈùûÂîØ‰∏ÄÁ¥¢Âºï+RC.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p>È¶ñÂÖàÔºåidÂàóÁ¥¢Âºï‰∏äÔºåÊª°Ë∂≥id = 10Êü•ËØ¢Êù°‰ª∂ÁöÑËÆ∞ÂΩïÔºåÂùáÂ∑≤Âä†ÈîÅ„ÄÇÂêåÊó∂ÔºåËøô‰∫õËÆ∞ÂΩïÂØπÂ∫îÁöÑ‰∏ªÈîÆÁ¥¢Âºï‰∏äÁöÑËÆ∞ÂΩï‰πüÈÉΩÂä†‰∏ä‰∫ÜÈîÅ„ÄÇ‰∏éÁªÑÂêà‰∫åÂîØ‰∏ÄÁöÑÂå∫Âà´Âú®‰∫éÔºåÁªÑÂêà‰∫åÊúÄÂ§öÂè™Êúâ‰∏Ä‰∏™Êª°Ë∂≥Á≠âÂÄºÊü•ËØ¢ÁöÑËÆ∞ÂΩïÔºåËÄåÁªÑÂêà‰∏â‰ºöÂ∞ÜÊâÄÊúâÊª°Ë∂≥Êü•ËØ¢Êù°‰ª∂ÁöÑËÆ∞ÂΩïÈÉΩÂä†ÈîÅ„ÄÅ</p>
<p><strong>ÁªÑÂêàÂõõÔºöidÊó†Á¥¢Âºï+RC</strong></p>
<img src="/img/dba/idÊó†Á¥¢Âºï+RC.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p>Áî±‰∫éidÂàó‰∏äÊ≤°ÊúâÁ¥¢ÂºïÔºåÂõ†Ê≠§Âè™ËÉΩËµ∞ËÅöÁ∞áÁ¥¢ÂºïÔºåËøõË°åÂÖ®ÈÉ®Êâ´Êèè„ÄÇ‰ªéÂõæ‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºåÊª°Ë∂≥Âà†Èô§Êù°‰ª∂ÁöÑËÆ∞ÂΩïÊúâ‰∏§Êù°Ôºå‰ΩÜÊòØÔºåËÅöÁ∞áÁ¥¢Âºï‰∏äÊâÄÊúâÁöÑËÆ∞ÂΩïÔºåÈÉΩË¢´Âä†‰∏ä‰∫ÜXÈîÅ„ÄÇÊó†ËÆ∫ËÆ∞ÂΩïÊòØÂê¶Êª°Ë∂≥Êù°‰ª∂ÔºåÂÖ®ÈÉ®Ë¢´Âä†‰∏äXÈîÅ„ÄÇÊó¢‰∏çÊòØÂä†Ë°®ÈîÅÔºå‰πü‰∏çÊòØÂú®Êª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩï‰∏äÂä†Ë°åÈîÅ„ÄÇ</p>
<p>‰∏∫‰ªÄ‰πà‰∏çÊòØÂè™Âú®Êª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩï‰∏äÂä†ÈîÅÂë¢ÔºüËøôÊòØÁî±‰∫éMySQLÁöÑÂÆûÁé∞ÂÜ≥ÂÆöÁöÑ„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Êù°‰ª∂Êó†Ê≥ïÈÄöËøáÁ¥¢ÂºïÂø´ÈÄüËøáÊª§ÔºåÈÇ£‰πàÂ≠òÂÇ®ÂºïÊìéÂ±ÇÈù¢Â∞±‰ºöÂ∞ÜÊâÄÊúâËÆ∞ÂΩïÂä†ÈîÅÂêéËøîÂõûÔºåÁÑ∂ÂêéÁî±MySQL ServerÂ±ÇËøõË°åËøáÊª§„ÄÇÂõ†Ê≠§‰πüÂ∞±ÊääÊâÄÊúâÁöÑËÆ∞ÂΩïÔºåÈÉΩÈîÅ‰∏ä‰∫Ü„ÄÇÂú®ÂÆûÈôÖÁöÑÂÆûÁé∞‰∏≠ÔºåMySQLÊúâ‰∏Ä‰∫õÊîπËøõÔºåÂú®MySQL ServerËøáÊª§Êù°‰ª∂ÔºåÂèëÁé∞‰∏çÊª°Ë∂≥ÂêéÔºå‰ºöË∞ÉÁî®unlock_rowÊñπÊ≥ïÔºåÊää‰∏çÊª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩïÊîæÈîÅ (ËøùËÉå‰∫Ü2PLÁöÑÁ∫¶Êùü)„ÄÇËøôÊ†∑ÂÅöÔºå‰øùËØÅ‰∫ÜÊúÄÂêéÂè™‰ºöÊåÅÊúâÊª°Ë∂≥Êù°‰ª∂ËÆ∞ÂΩï‰∏äÁöÑÈîÅÔºå‰ΩÜÊòØÊØèÊù°ËÆ∞ÂΩïÁöÑÂä†ÈîÅÊìç‰ΩúËøòÊòØ‰∏çËÉΩÁúÅÁï•ÁöÑ„ÄÇ</p>
<p><strong>ÁªÑÂêà‰∫îÔºöid‰∏ªÈîÆ+RR</strong></p>
<p>ÁªÑÂêà‰∏ÄÔºö[id‰∏ªÈîÆÔºåRead Committed]‰∏ÄËá¥</p>
<p><strong>ÁªÑÂêàÂÖ≠ÔºöidÂîØ‰∏ÄÁ¥¢Âºï+RR</strong></p>
<p>‰∏éÁªÑÂêà‰∫å[idÂîØ‰∏ÄÁ¥¢ÂºïÔºåRead Committed]‰∏ÄËá¥„ÄÇ‰∏§‰∏™XÈîÅÔºåidÂîØ‰∏ÄÁ¥¢ÂºïÊª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩï‰∏ä‰∏Ä‰∏™ÔºåÂØπÂ∫îÁöÑËÅöÁ∞áÁ¥¢Âºï‰∏äÁöÑËÆ∞ÂΩï‰∏Ä‰∏™</p>
<p><strong>ÁªÑÂêà‰∏ÉÔºöidÈùûÂîØ‰∏ÄÁ¥¢Âºï+RR</strong></p>
<img src="/img/dba/idÈùûÂîØ‰∏ÄÁ¥¢Âºï+RR.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p>Key(id) ÈîÅÂÆö‰∫ÜÔºà„Äê6, c„Äë, „Äê10, b„ÄëÔºâ + „Äê10, b„Äë; Ôºà„Äê10, b„Äë, „Äê10, d„ÄëÔºâ + „Äê10, d„Äë; + Ôºà„Äê10, d„Äë, „Äê11, f„ÄëÔºâ</p>
<p>Primary Key ÈîÅÂÆö‰∫Ü„Äêb„Äë,„Äêd„Äë</p>
<p>RRÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåidÂàó‰∏äÊúâ‰∏Ä‰∏™ÈùûÂîØ‰∏ÄÁ¥¢ÂºïÔºåÂØπÂ∫îSQLÔºödelete from t1 where id = 10; È¶ñÂÖàÔºåÈÄöËøáidÁ¥¢ÂºïÂÆö‰ΩçÂà∞Á¨¨‰∏ÄÊù°Êª°Ë∂≥Êü•ËØ¢Êù°‰ª∂ÁöÑËÆ∞ÂΩïÔºåÂä†ËÆ∞ÂΩï‰∏äÁöÑXÈîÅÔºåÂä†GAP‰∏äÁöÑGAPÈîÅÔºåÁÑ∂ÂêéÂä†‰∏ªÈîÆËÅöÁ∞áÁ¥¢Âºï‰∏äÁöÑËÆ∞ÂΩïXÈîÅÔºåÁÑ∂ÂêéËøîÂõûÔºõÁÑ∂ÂêéËØªÂèñ‰∏ã‰∏ÄÊù°ÔºåÈáçÂ§çËøõË°å„ÄÇÁõ¥Ëá≥ËøõË°åÂà∞Á¨¨‰∏ÄÊù°‰∏çÊª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩï[11,f]ÔºåÊ≠§Êó∂Ôºå‰∏çÈúÄË¶ÅÂä†ËÆ∞ÂΩïXÈîÅÔºå‰ΩÜÊòØ‰ªçÊóßÈúÄË¶ÅÂä†GAPÈîÅÔºåÊúÄÂêéËøîÂõûÁªìÊùü</p>
<p><strong>ÁªÑÂêàÂÖ´ÔºöidÊó†Á¥¢Âºï+RR</strong></p>
<img src="/img/dba/idÊó†Á¥¢Âºï+RR.jpg" alt="MYSQLÂä†ÈîÅËøáÁ®ãËØ¶Ëß£" style="zoom:67%;" />
<p>ËøôÊòØ‰∏Ä‰∏™ÂæàÊÅêÊÄñÁöÑÁé∞Ë±°„ÄÇÈ¶ñÂÖàÔºåËÅöÁ∞áÁ¥¢Âºï‰∏äÁöÑÊâÄÊúâËÆ∞ÂΩïÔºåÈÉΩË¢´Âä†‰∏ä‰∫ÜXÈîÅ„ÄÇÂÖ∂Ê¨°ÔºåËÅöÁ∞áÁ¥¢ÂºïÊØèÊù°ËÆ∞ÂΩïÈó¥ÁöÑÈó¥Èöô(GAP)Ôºå‰πüÂêåÊó∂Ë¢´Âä†‰∏ä‰∫ÜGAPÈîÅ„ÄÇËøô‰∏™Á§∫‰æãË°®ÔºåÂè™Êúâ6Êù°ËÆ∞ÂΩïÔºå‰∏ÄÂÖ±ÈúÄË¶Å6‰∏™ËÆ∞ÂΩïÈîÅÔºå7‰∏™GAPÈîÅ„ÄÇËØïÊÉ≥ÔºåÂ¶ÇÊûúË°®‰∏äÊúâ1000‰∏áÊù°ËÆ∞ÂΩïÂë¢ÔºÅ</p>
<h3 id="mvcc-Â§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂">MVCC Â§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂</h3>
<p>Âú®InnoDB‰∏≠ÁöÑÊØè‰∏ÄÊù°ËÆ∞ÂΩïÂÆûÈôÖÈÉΩ‰ºöÂ≠òÂú®‰∏â‰∏™ÈöêËóèÂàóÔºö</p>
<ul>
<li>DB_TRX_IDÔºö‰∫ãÂä° IDÔºåÊòØÊ†πÊçÆ‰∫ãÂä°‰∫ßÁîüÊó∂Èó¥È°∫Â∫èËá™Âä®ÈÄíÂ¢ûÁöÑÔºåÊòØÁã¨‰∏ÄÊó†‰∫åÁöÑ„ÄÇÂ¶ÇÊûúÊüê‰∏™‰∫ãÂä°ÊâßË°åËøáÁ®ã‰∏≠ÂØπËØ•ËÆ∞ÂΩïÊâßË°å‰∫ÜÂ¢û„ÄÅÂà†„ÄÅÊîπÊìç‰ΩúÔºåÈÇ£‰πàInnoDBÂ≠òÂÇ®ÂºïÊìéÂ∞±‰ºöËÆ∞ÂΩï‰∏ãËØ•Êù°‰∫ãÂä°ÁöÑ id</li>
<li>DB_ROLL_PTRÔºöÂõûÊªöÊåáÈíàÔºåÊú¨Ë¥®‰∏äÂ∞±ÊòØ‰∏Ä‰∏™ÊåáÂêëËÆ∞ÂΩïÂØπÂ∫îÁöÑundo logÁöÑ‰∏Ä‰∏™ÊåáÈíàÔºåInnoDB ÈÄöËøáËøô‰∏™ÊåáÈíàÊâæÂà∞‰πãÂâçÁâàÊú¨ÁöÑÊï∞ÊçÆ</li>
<li>DB_ROW_IDÔºö‰∏ªÈîÆÔºåÂ¶ÇÊûúÊúâËá™ÂÆö‰πâ‰∏ªÈîÆÔºåÈÇ£‰πàËØ•ÂÄºÂ∞±ÊòØ‰∏ªÈîÆÔºõÂ¶ÇÊûúÊ≤°Êúâ‰∏ªÈîÆÔºåÈÇ£‰πàÂ∞±‰ºö‰ΩøÁî®ÂÆö‰πâÁöÑÁ¨¨‰∏Ä‰∏™ÂîØ‰∏ÄÁ¥¢ÂºïÔºõÂ¶ÇÊûúÊ≤°ÊúâÂîØ‰∏ÄÁ¥¢ÂºïÔºåÈÇ£‰πàÂ∞±‰ºöÈªòËÆ§ÁîüÊàê‰∏Ä‰∏™ÈöêËóèÂàó‰Ωú‰∏∫‰∏ªÈîÆ</li>
</ul>
<p><img src="/img/dba/mvcc.webp" alt="img"></p>
<p><strong>Read View</strong></p>
<p>Read ViewÊòØInnoDBÂú®ÂÆûÁé∞MVCCÊó∂Áî®Âà∞ÁöÑ‰∏ÄËá¥ÊÄßËØªËßÜÂõæÔºåÁî®‰∫éÊîØÊåÅËØªÊèê‰∫§ÂíåÂèØÈáçÂ§çËØªÈöîÁ¶ªÁ∫ßÂà´ÁöÑÂÆûÁé∞Ôºå‰ΩúÁî®ÊòØÊâßË°åÊúüÈó¥Âà§Êñ≠ÁâàÊú¨Èìæ‰∏≠ÁöÑÂì™‰∏™ÁâàÊú¨ÊòØÂΩìÂâç‰∫ãÂä°ÂèØËßÅÁöÑ„ÄÇÊú¨Ë¥®‰∏äÊòØInnoDB‰∏∫ÊØè‰∏™‰∫ãÂä°ÊûÑÈÄ†‰∫Ü‰∏Ä‰∏™Êï∞ÁªÑÔºåÁî®Êù•‰øùÂ≠òÂΩìÂâçÊ≠£Âú®Ê¥ªË∑ÉÔºàÂêØÂä®‰∫Ü‰ΩÜËøòÊ≤°Êèê‰∫§ÔºâÁöÑÊâÄÊúâ‰∫ãÂä°ID„ÄÇ</p>
<p>Êï∞ÁªÑÈáåÈù¢‰∫ãÂä°IDÁöÑÊúÄÂ∞èÂÄºËÆ∞‰∏∫‰ΩéÊ∞¥‰ΩçÔºåÂΩìÂâçÁ≥ªÁªüÈáåÈù¢Â∑≤ÁªèÂàõÂª∫ËøáÁöÑ‰∫ãÂä°IDÁöÑÊúÄÂ§ßÂÄºÂä†1ËÆ∞‰∏∫È´òÊ∞¥‰ΩçÔºõËøô‰∏™ËßÜÂõæÊï∞ÁªÑÂíåÈ´òÊ∞¥‰ΩçÔºåÂ∞±ÁªÑÊàê‰∫ÜÂΩìÂâç‰∫ãÂä°ÁöÑ‰∏ÄËá¥ÊÄßËßÜÂõæÔºàread-viewÔºâ„ÄÇ</p>
<p><strong>MVCC‰∏éÈöîÁ¶ªÁ∫ßÂà´</strong></p>
<p>MVCC Âè™Âú® **Read CommitedÔºàËØªÂ∑≤Êèê‰∫§Ôºâ Âíå Repeatable ReadÔºàÂèØÈáçËØªËØªÔºâ **‰∏§ÁßçÈöîÁ¶ªÁ∫ßÂà´‰∏ãÂ∑•‰Ωú„ÄÇ</p>
<ul>
<li>Âú®RCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÊòØ<strong>ÊØè‰∏™Âø´ÁÖßËØªÈÉΩ‰ºöÁîüÊàêÂπ∂Ëé∑ÂèñÊúÄÊñ∞ÁöÑRead View</strong>ÔºåËøôÂ∞±ÊòØÊàë‰ª¨Âú®RCÁ∫ßÂà´‰∏ãÁöÑ‰∫ãÂä°‰∏≠ÂèØ‰ª•ÁúãÂà∞Âà´ÁöÑ‰∫ãÂä°Êèê‰∫§ÁöÑÊõ¥Êñ∞ÁöÑÂéüÂõ†</li>
<li>Âú®RRÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÂàôÊòØÂêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Âø´ÁÖßËØªÊâç‰ºöÂàõÂª∫Read View, ‰πãÂêéÁöÑÂø´ÁÖßËØªËé∑ÂèñÁöÑÈÉΩÊòØÂêå‰∏Ä‰∏™Read ViewÔºå‰ªéËÄåÂÅöÂà∞ÂèØÈáçÂ§çËØª</li>
</ul>
<h3 id="rrÁ∫ßÂà´‰∏ãÂΩìÂâçËØªÁöÑÂπªËØªÈóÆÈ¢ò">RRÁ∫ßÂà´‰∏ãÂΩìÂâçËØªÁöÑÂπªËØªÈóÆÈ¢ò</h3>
<table>
<thead>
<tr>
<th>Êó∂Âàª</th>
<th>‰∫ãÂä°1</th>
<th>‰∫ãÂä°2</th>
</tr>
</thead>
<tbody>
<tr>
<td>T1</td>
<td>select * from user where id&gt;100;</td>
<td></td>
</tr>
<tr>
<td>T2</td>
<td># ËæìÂá∫NÊù°ËÆ∞ÂΩï</td>
<td>insert into user values(103, ‚Äòwangwu‚Äô, 20);</td>
</tr>
<tr>
<td>T3</td>
<td></td>
<td>commit;</td>
</tr>
<tr>
<td>T4</td>
<td>update user set age=21 where id&gt;100;</td>
<td></td>
</tr>
<tr>
<td>T5</td>
<td>select * from user where id&gt;100;</td>
<td></td>
</tr>
<tr>
<td>T6</td>
<td># ËæìÂá∫N+1Êù°ËÆ∞ÂΩï</td>
<td></td>
</tr>
</tbody>
</table>
<p>‰∫ßÁîüÂπªËØªÁöÑÂéüÂõ†Ôºö</p>
<p>Âú®T4Êó∂ÂàªÔºåÁî±‰∫éupdateËØ≠Âè•ÈááÁî®ÁöÑÊòØÂΩìÂâçËØªÔºå‰ºöÂØπ‰∫ãÂä°2Êñ∞Â¢ûÁöÑËÆ∞ÂΩïËøõË°åÂä†ÈîÅ„ÄÅ‰øÆÊîπageÂ≠óÊÆµÂÄº„ÄÅ‰øÆÊîπDB_TRX_IDÈöêËóèÂ≠óÊÆµÂÄº„ÄÇ</p>
<p>Âú®T5Êó∂Âàª‰ΩøÁî®Âø´ÁÖßËØªÊó∂ÔºåÊ†πÊçÆÂèØËßÅÊÄßÁÆóÊ≥ïÔºåËøôÊù°Êñ∞Â¢ûËÆ∞ÂΩïÁöÑDB_TRX_IDÊòØÂΩìÂâç‰∫ãÂä°ÔºåÊâÄ‰ª•ÊòØÂèØËßÅÁöÑÔºåÊâÄ‰ª•ËæìÂá∫‰∫ÜN+1Êù°ËÆ∞ÂΩï</p>
<p>Ëß£ÂÜ≥ÊñπÊ°àÔºö<code>select</code>ÁöÑÊó∂ÂÄôÂä†<code>for update;</code>ÊàñËÄÖ<code>lock in share mode;</code></p>
<h2 id="9Â§á‰ªΩÊÅ¢Â§ç‰∏éËøÅÁßª">9„ÄÅÂ§á‰ªΩÊÅ¢Â§ç‰∏éËøÅÁßª</h2>
<h3 id="binlog-Êó•ÂøóÁöÑÊ†ºÂºè">binlog Êó•ÂøóÁöÑÊ†ºÂºè</h3>
<ul>
<li>
<p>StatementÔºàStatement-Based Replication,SBRÔºâÔºöÊØè‰∏ÄÊù°‰ºö‰øÆÊîπÊï∞ÊçÆÁöÑ SQLËØ≠Âè• ÈÉΩ‰ºöËÆ∞ÂΩïÂú® binlog ‰∏≠ÔºåÂ¶ÇÊûú‰ΩøÁî®uuid()Á≠âÂáΩÊï∞‰ºöÂá∫Áé∞ÈóÆÈ¢ò</p>
</li>
<li>
<p>RowÔºàRow-Based Replication,RBRÔºâÔºö‰∏çËÆ∞ÂΩï SQL ËØ≠Âè•‰∏ä‰∏ãÊñá‰ø°ÊÅØÔºå‰ªÖ‰øùÂ≠òÂì™Êù°ËÆ∞ÂΩïË¢´‰øÆÊîπ</p>
</li>
<li>
<p>MixedÔºàMixed-Based Replication,MBRÔºâÔºöStatement Âíå Row ÁöÑÊ∑∑Âêà‰ΩìÔºåÁ≥ªÁªü‰ºöËá™Âä®Âà§Êñ≠ÊâßË°åËØ≠Âè•ËØ•Áî® Statement Ôºà‰ºòÂÖà‰ΩøÁî®ÔºâËøòÊòØ Row</p>
</li>
</ul>
<h3 id="gtid">GTID</h3>
<p>Âú®‰º†ÁªüÁöÑmysqlÂü∫‰∫é‰∫åËøõÂà∂Êó•ÂøóÁöÑÊ®°ÂºèÂ§çÂà∂‰∏≠Ôºå‰ªéÂ∫ìÈúÄË¶ÅÂëäÁü•‰∏ªÂ∫ìË¶Å‰ªéÂì™‰∏™‰∫åËøõÂà∂Êó•ÂøóÊñá‰ª∂‰∏≠ÁöÑÈÇ£‰∏™<strong>ÂÅèÁßªÈáè</strong>ËøõË°åÂ¢ûÈáèÂêåÊ≠•ÔºåÂ¶ÇÊûúÊåáÂÆöÈîôËØØ‰ºöÈÄ†ÊàêÊï∞ÊçÆÁöÑÈÅóÊºèÔºå‰ªéËÄåÈÄ†ÊàêÊï∞ÊçÆÁöÑ‰∏ç‰∏ÄËá¥„ÄÇÂÄüÂä©gtidÔºåÂú®ÂèëÁîü‰∏ªÂ§áÂàáÊç¢ÁöÑÊÉÖÂÜµ‰∏ãÔºåmysqlÁöÑÂÖ∂ÂÆÉ‰ªéÂ∫ìÂèØ‰ª•Ëá™Âä®Âú®Êñ∞‰∏ªÂ∫ì‰∏äÊâæÂà∞Ê≠£Á°ÆÁöÑÂ§çÂà∂‰ΩçÁΩÆÔºåËøôÂ§ßÂ§ßÁÆÄÂåñ‰∫ÜÂ§çÊùÇÂ§çÂà∂ÊãìÊâë‰∏ãÈõÜÁæ§ÁöÑÁª¥Êä§Ôºå‰πüÂáèÂ∞ë‰∫Ü‰∫∫‰∏∫ËÆæÁΩÆÂ§çÂà∂‰ΩçÁΩÆÂèëÁîüËØØÊìç‰ΩúÁöÑÈ£éÈô©„ÄÇÂè¶Â§ñÔºåÂü∫‰∫égtidÁöÑÂ§çÂà∂ÂèØ‰ª•ÂøΩÁï•Â∑≤ÁªèÊâßË°åËøáÁöÑ‰∫ãÂä°ÔºåÂáèÂ∞ë‰∫ÜÊï∞ÊçÆÂèëÁîü‰∏ç‰∏ÄËá¥ÁöÑÈ£éÈô©„ÄÇÊâÄ‰ª•ËØ¥ÔºåÁõ∏ÊØîmysql‰º†ÁªüÁöÑ‰∏ª‰ªéÂ§çÂà∂Ê®°ÂºèÔºågtidÊ®°ÂºèÁöÑÂ§çÂà∂ÂØπ‰∫é DBA/ÂºÄÂèë‰∫∫Âëò/ËøêÁª¥ Á≠âÁõ∏ÂÖ≥ÊäÄÊúØ‰∫∫ÂëòÊõ¥Âä†ÂèãÂ•Ω„ÄÇ</p>
<h3 id="binlogÊìç‰Ωú">binlogÊìç‰Ωú</h3>
<p><strong>Âü∫Êú¨Êìç‰Ωú</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Êü•Áúã‰∫åËøõÂà∂Êñá‰ª∂ÂàóË°®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">binary</span><span style="color:#bbb"> </span>logs;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ÁúãÊ≠£Âú®‰ΩøÁî®ÁöÑ‰∫åËøõÂà∂Êñá‰ª∂ÔºåÂåÖÂê´‰∫ÜÂÅèÁßªÈáèÂíåGTID‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>master<span style="color:#bbb"> </span>status;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•Áúã‰∫åËøõÂà∂Êñá‰ª∂Â≠òÂÇ®ÁöÑÂÜÖÂÆπ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>binlog<span style="color:#bbb"> </span>events<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;‰∫åËøõÂà∂Êó•ÂøóÊñá‰ª∂&#39;</span><span style="color:#a61717;background-color:#e3d2d2">\</span>G;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ‰ΩøÁî®Â∑•ÂÖ∑Êü•Áúã
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>mysqlbinlog<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">--</span><span style="color:#000;font-weight:bold">read</span><span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">from</span><span style="color:#000;font-weight:bold">-</span>remote<span style="color:#000;font-weight:bold">-</span>server<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>hÂú∞ÂùÄ<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>PÁ´ØÂè£<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>uÁî®Êà∑Âêç<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>pÂØÜÁ†Å<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>d<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">Êï∞ÊçÆÂ∫ì</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">‰∫åËøõÂà∂Êñá‰ª∂</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëá™Âä®Ê∏ÖÁêÜÊó•Âøó</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Êü•ÁúãÊó•ÂøóËá™Âä®Ê∏ÖÁêÜÊó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- 8.0‰πãÂâçexpire_logs_days
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- 8.0‰πãÂêéexpire_logs_days
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ‰ºÅ‰∏öÂª∫ËÆÆ,Ëá≥Â∞ë‰øùÁïô‰∏§‰∏™ÂÖ®Â§áÂë®Êúü+1ÁöÑbinlog
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>variables<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;%expire%&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>my2sql Â∫îÁî®</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂÆâË£ÖÈÖçÁΩÆ</span>
</span></span><span style="display:flex;"><span>wget https://github.com/liuhr/my2sql/blob/master/releases/centOS_release_7.x/my2sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Ëß£ÊûêÊó•Âøó‰∫ã‰ª∂SQL</span>
</span></span><span style="display:flex;"><span>./my2sql -user Áî®Êà∑Âêç -password ÂØÜÁ†Å -host Âú∞ÂùÄ -port Á´ØÂè£ -mode repl -work-type 2sql -start-file ‰∫åËøõÂà∂Êñá‰ª∂ -start-datetime ÂºÄÂßãÊó∂Èó¥ -output-dir ./tmpdir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ÁîüÊàêÊåáÂÆö‰∫ã‰ª∂ÂõûÊªöËØ≠Âè•</span>
</span></span><span style="display:flex;"><span>./my2sql -user Áî®Êà∑Âêç -password ÂØÜÁ†Å -host Âú∞ÂùÄ -port Á´ØÂè£ -mode repl -work-type rollback -start-file ‰∫åËøõÂà∂Êñá‰ª∂ -start-pos ÂºÄÂßã‰ΩçÁΩÆ   -stop-file ‰∫åËøõÂà∂Êñá‰ª∂ -stop-pos ÁªìÊùü‰ΩçÁΩÆ  -output-dir ./tmpdir
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="slow-logÁöÑÊü•Áúã">slow logÁöÑÊü•Áúã</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -s c ÂÆâË£ÖÊâßË°å‰∏™Êï∞ÊéíÂ∫è</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -t top</span>
</span></span><span style="display:flex;"><span>mysqldumpslow -s c -t <span style="color:#099">10</span> ÊÖ¢Êü•ËØ¢Êñá‰ª∂Ë∑ØÂæÑ
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Áâ©ÁêÜÂ§á‰ªΩ">Áâ©ÁêÜÂ§á‰ªΩ</h3>
<p><a href="https://mynamelancelot.github.io/database/PXC.html#%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%86%B7%E7%83%AD%E5%A4%87%E4%BB%BD">ÈìæÊé•</a></p>
<h3 id="clone-plugin">Clone Plugin</h3>
<p>MySQL 8.0Êé®Âá∫‰∫Ü<code>Clone Plugin</code>Êèí‰ª∂Êúâ‰∏§ÁßçÊ®°Âºè</p>
<p>Êú¨Âú∞ÂÖãÈöÜÔºöÂêØÂä®ÂÖãÈöÜÊìç‰ΩúÁöÑMySQLÊúçÂä°Âô®ÂÆû‰æã‰∏≠ÁöÑÊï∞ÊçÆÔºåÂÖãÈöÜÂà∞ÂêåÊúçÂä°Âô®ÊàñÂêåËäÇÁÇπ‰∏äÁöÑ‰∏Ä‰∏™ÁõÆÂΩïÈáå</p>
<p>ËøúÁ®ãÂÖãÈöÜÔºöÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåËøúÁ®ãÂÖãÈöÜÊìç‰Ωú‰ºöÂà†Èô§Êé•ÂèóËÄÖ(recipient)Êï∞ÊçÆÁõÆÂΩï‰∏≠ÁöÑÊï∞ÊçÆÔºåÂπ∂Â∞ÜÂÖ∂ÊõøÊç¢‰∏∫ÊçêËµ†ËÄÖ(donor)ÁöÑ</p>
<p>ÂÖãÈöÜÊï∞ÊçÆ„ÄÇÊÇ®‰πüÂèØ‰ª•Â∞ÜÊï∞ÊçÆÂÖãÈöÜÂà∞Êé•ÂèóËÄÖÁöÑÂÖ∂‰ªñÁõÆÂΩïÔºå‰ª•ÈÅøÂÖçÂà†Èô§Áé∞ÊúâÊï∞ÊçÆ„ÄÇ(ÂèØÈÄâ)</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Âä†ËΩΩÊèí‰ª∂
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÊàñËÄÖÈÖçÁΩÆmy.cnf
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- plugin-load-add=mysql_clone.so
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- clone=FORCE_PLUS_PERMANENT
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>INSTALL<span style="color:#bbb"> </span>PLUGIN<span style="color:#bbb"> </span>clone<span style="color:#bbb"> </span>SONAME<span style="color:#bbb"> </span><span style="color:#d14">&#39;mysql_clone.so&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êü•ÁúãÊèí‰ª∂‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>PLUGIN_NAME,<span style="color:#bbb"> </span>PLUGIN_STATUS<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>INFORMATION_SCHEMA.PLUGINS<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>PLUGIN_NAME<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">LIKE</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;clone&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂàõÂª∫ÂÖãÈöÜ‰∏ìÁî®Áî®Êà∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USER</span><span style="color:#bbb"> </span>clone_user<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span><span style="color:#bbb"> </span>IDENTIFIED<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">with</span><span style="color:#bbb"> </span>mysql_native_password<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;password&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">GRANT</span><span style="color:#bbb"> </span>BACKUP_ADMIN<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ON</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TO</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;clone_user&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êú¨Âú∞ÂÖãÈöÜ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>mkdir<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>p<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">data</span><span style="color:#000;font-weight:bold">/</span>backup<span style="color:#000;font-weight:bold">/</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>chown<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>R<span style="color:#bbb"> </span>mysql.mysql<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">data</span><span style="color:#000;font-weight:bold">/</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>mysql<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>uclone_user<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>ppassword<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>e<span style="color:#d14">&#34;CLONE LOCAL DATA DIRECTORY = &#39;/data/backup/clonedir&#39;&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ËßÇÂØüÁä∂ÊÄÅ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>STAGE,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">STATE</span>,<span style="color:#bbb"> </span>END_TIME<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>performance_schema.clone_progress;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êó•ÂøóËßÇÊµã
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">global</span><span style="color:#bbb"> </span>log_error_verbosity<span style="color:#000;font-weight:bold">=</span><span style="color:#099">3</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>tail<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>f<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">ÈîôËØØÊó•Âøó</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÂÖãÈöÜËøúÁ®ãÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÂàõÂª∫ËøúÁ®ãcloneÁî®Êà∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ÊçêËµ†ËÄÖÊéàÊùÉ(Ê∫êÁ´Ø)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>clone_s<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span><span style="color:#bbb"> </span>identified<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;Ê∫êÁ´ØÂØÜÁ†Å&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">grant</span><span style="color:#bbb"> </span>backup_admin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">to</span><span style="color:#bbb"> </span>clone_s<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Êé•ÂèóËÄÖÊéàÊùÉÔºàÁõÆÊ†áÁ´ØÔºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>clone_t<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span><span style="color:#bbb"> </span>identified<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ÁõÆÊ†áÁ´ØÂØÜÁ†Å&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">grant</span><span style="color:#bbb"> </span>clone_admin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">to</span><span style="color:#bbb"> </span>clone_t<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ÁõÆÊ†áÁ´ØÂºÄÂßãÂÖãÈöÜ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SET</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">GLOBAL</span><span style="color:#bbb"> </span>clone_valid_donor_list<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;Ê∫êÁ´Øip:Ê∫êÁ´ØÂè£&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>mysql<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>uclone_t<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>p123<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>hÁõÆÊ†áÁ´ØIP<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>PÁõÆÊ†áÁ´ØÁ´ØÂè£<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>e<span style="color:#bbb"> </span><span style="color:#d14">&#34;CLONE INSTANCE FROM clone_s@&#39;Ê∫êÁ´ØIP&#39;:Á´ØÂè£ IDENTIFIED BY &#39;Ê∫êÁ´ØÂØÜÁ†Å&#39;;&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="10ÂêÑÁßçÊû∂ÊûÑ‰ΩìÁ≥ª">10„ÄÅÂêÑÁßçÊû∂ÊûÑ‰ΩìÁ≥ª</h2>
<table>
<thead>
<tr>
<th>Êó†ÊïÖÈöúÊó∂Èó¥</th>
<th>ÊïÖÈöúÊó∂Èó¥</th>
<th>ÊñπÊ°à</th>
</tr>
</thead>
<tbody>
<tr>
<td>99.9%</td>
<td>0.1% = 525.6 min</td>
<td>KA+Âèå‰∏ª Ôºö‰∫∫‰∏∫Âπ≤È¢Ñ</td>
</tr>
<tr>
<td>99.99%</td>
<td>0.01% = 52.56 min</td>
<td><a href="https://mynamelancelot.github.io/database/MySQL.html#mhamaster-high-availability">MHA</a></td>
</tr>
<tr>
<td>99.999%</td>
<td>0.001% = 5.256 min</td>
<td><a href="https://mynamelancelot.github.io/database/PXC.htm">PXC</a>„ÄÅ MGR</td>
</tr>
<tr>
<td>99.9999%</td>
<td>0.5256 min</td>
<td>Ëá™Âä®Âåñ„ÄÅ‰∫ëÂåñ„ÄÅÂπ≥Âè∞Âåñ„ÄÅÂàÜÂ∏ÉÂºè</td>
</tr>
</tbody>
</table>
<h2 id="ÈôÑÂΩï">ÈôÑÂΩï</h2>
<h3 id="80ÁâàÊú¨Áõ∏ÂØπ‰∫é57ÁâàÊú¨ÁöÑÂèòÂåñ">8.0ÁâàÊú¨Áõ∏ÂØπ‰∫é5.7ÁâàÊú¨ÁöÑÂèòÂåñ</h3>
<ul>
<li>
<p>ÊîØÊåÅ‰∫ãÂä°ÊÄßDDLÔºåÂ¥©Ê∫ÉÂèØ‰ª•ÂõûÊªöÔºå‰øùËØÅ‰∏ÄËá¥</p>
</li>
<li>
<p>‰øùÁïô‰∏Ä‰ªΩÊï∞ÊçÆÂ≠óÂÖ∏‰ø°ÊÅØÔºåÂèñÊ∂àfrmÊï∞ÊçÆÂ≠óÂÖ∏„ÄÇ</p>
</li>
<li>
<p>Êï∞ÊçÆÂ≠óÂÖ∏Â≠òÊîæËá≥InnoDBË°®‰∏≠</p>
</li>
<li>
<p>ÈááÁî®Â•óÈîÅÊú∫Âà∂ÔºåÁÆ°ÁêÜÊï∞ÊçÆÂ≠óÂÖ∏ÁöÑÂπ∂ÂèëËÆøÈóÆÔºàMDLÔºâ</p>
</li>
<li>
<p>ÂÖ®Êñ∞ÁöÑPluginÊîØÊåÅÔºå8.0.17+ Âä†ÂÖ•Clone Plugin,Êõ¥Â•ΩÁöÑÊîØÊåÅMGRÔºåInnoDB ClusterÁöÑËäÇÁÇπÁÆ°ÁêÜ</p>
</li>
<li>
<p>ÂÆâÂÖ®Âä†ÂØÜÊñπÂºèÊîπÂèòÔºåÊîπÂèòÂä†ÂØÜÊñπÂºè‰∏∫caching_sha2_password</p>
</li>
<li>
<p>ÊîπÂèòÊéàÊùÉÁÆ°ÁêÜÊñπÂºè</p>
</li>
<li>
<p>Âä†ÂÖ•roleËßíËâ≤ÁÆ°ÁêÜ</p>
</li>
<li>
<p>ÂèñÊ∂àQuery Cache</p>
</li>
</ul>
<h3 id="ÂêÑÁâàÊú¨innodbË°®Êñá‰ª∂ÁªìÊûÑÁöÑÂèòÂåñ">ÂêÑÁâàÊú¨InnoDBË°®Êñá‰ª∂ÁªìÊûÑÁöÑÂèòÂåñ</h3>
<p>8.0 ‰ª•Ââç InnoDBË°®Ôºö</p>
<ul>
<li>ibd Ôºö Êï∞ÊçÆÂíåÁ¥¢Âºï</li>
<li>frm : Â≠òÁßÅÊúâÁöÑÊï∞ÊçÆÂ≠óÂÖ∏‰ø°ÊÅØ</li>
</ul>
<p>8.0 ‰πãÂêé InnoDBË°®Ôºö</p>
<ul>
<li>
<p>ibdÔºöÊï∞ÊçÆÂíåÁ¥¢Âºï</p>
</li>
<li>
<p>ÂÖ¨ÂÖ±sdiÔºàÂÜó‰ΩôÁöÑÁßÅÊúâÊï∞ÊçÆÂ≠óÂÖ∏‰ø°ÊÅØÔºâ</p>
</li>
</ul>
<h3 id="mysql57ÂçáÁ∫ßÂà∞80">MySQL5.7ÂçáÁ∫ßÂà∞8.0</h3>
<p>ÂçáÁ∫ßÂâç‰∏ÄÂÆöË¶ÅÂÖàÂÅöÂÜ∑Â§áÔºåÊñπ‰æøÂ§±Ë¥•ÂõûÈÄÄ„ÄÇ</p>
<p>‰∏ãËΩΩÂÆâË£Ö<a href="https://downloads.mysql.com/archives/">mysql-shell</a>Â∑•ÂÖ∑Ôºå8.0‰ª•ÂêéÂèØ‰ª•Ë∞ÉÁî®Ëøô‰∏™ÂëΩ‰ª§ÔºåÂçáÁ∫ß‰πãÂâçÁöÑÈ¢ÑÊ£ÄÊü•„ÄÇ</p>
<ol>
<li>
<p>ÂàõÂª∫ËøûÊé•Áî®Êà∑</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">grant</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">all</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span>.<span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">to</span><span style="color:#bbb"> </span>root<span style="color:#000;font-weight:bold">@</span><span style="color:#d14">&#39;%&#39;</span><span style="color:#bbb"> </span>identified<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ÂØÜÁ†Å&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>È¢ÑÊ£ÄÊü•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mysqlsh root:ÂØÜÁ†Å@<span style="color:#d14">&#39;%&#39;</span>:Á´ØÂè£ -e <span style="color:#d14">&#34;util.checkForServerUpgrade()&#34;</span> &gt;/tmp/up.log
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÂÅúÂéüÂ∫ì</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 0‰ª£Ë°®ÂΩìMYSQLÂÖ≥Èó≠Êó∂ÔºåInnodbÈúÄË¶ÅÂÆåÊàêÊâÄÊúâfull purgeÂíåmerge insert bufferÊìç‰Ωú„ÄÇÂ¶ÇÊûúÂÅöÂçáÁ∫ßÔºåÈÄöÂ∏∏ÈúÄË¶ÅÂ∞ÜËøô‰∏™ÂèÇÊï∞Ë∞É‰∏∫0ÔºåÁÑ∂ÂêéÂú®ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ì</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">set</span> global <span style="color:#008080">innodb_fast_shutdown</span><span style="color:#000;font-weight:bold">=</span>0;
</span></span><span style="display:flex;"><span>mysqladmin -S socketÊñá‰ª∂Ë∑ØÂæÑ shutdown
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>‰ΩøÁî®È´òÁâàÊú¨ËΩØ‰ª∂ÊåÇ‰ΩéÁâàÊú¨Êï∞ÊçÆÂêØÂä®</p>
</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ËÆ©Êï∞ÊçÆÂ∫ìÂçáÁ∫ß</span>
</span></span><span style="display:flex;"><span>/usr/local/mysql/bin/mysqld_safe --defaults <span style="color:#008080">file</span><span style="color:#000;font-weight:bold">=</span>5.7Â∫ìÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ --skip-grant-tables --skip-networking &amp;
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìÔºåÂπ∂ÈáçÊñ∞ÂêØÂä®Êï∞ÊçÆÂ∫ì</span>
</span></span><span style="display:flex;"><span>/usr/local/mysql/bin/mysqld_safe --defaults <span style="color:#008080">file</span><span style="color:#000;font-weight:bold">=</span>5.7Â∫ìÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ &amp;
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ËÆæÁΩÆÂõûÈªòËÆ§ÂÄº</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">set</span> global <span style="color:#008080">innodb_fast_shutdown</span><span style="color:#000;font-weight:bold">=</span>1;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="innodb-undoredoÂú®Â¢ûÂà†ÊîπÊìç‰ΩúÊó∂ÁöÑÂ∑•‰Ωú">InnoDB Undo„ÄÅRedoÂú®Â¢ûÂà†ÊîπÊìç‰ΩúÊó∂ÁöÑÂ∑•‰Ωú</h3>
<p><strong>INSERT</strong></p>
<ul>
<li>
<p>Undo</p>
<p>Â∞ÜÊèíÂÖ•ËÆ∞ÂΩïÁöÑ‰∏ªÈîÆÂÄºÔºåÂÜôÂÖ•UndoÔºõ</p>
</li>
<li>
<p>Redo</p>
<p>Â∞ÜÂÆåÊï¥Êï∞ÊçÆË°å‰ø°ÊÅØÂÜôÂÖ•RedoÔºõ</p>
</li>
</ul>
<img src="/img/dba/INSERT-Â∑•‰Ωú.png" style="zoom:67%;" />
<p><strong>DELETE</strong></p>
<ul>
<li>
<p>Undo</p>
<ol>
<li>DeleteÔºåÂú®InnoDBÂÜÖÈÉ®‰∏∫Delete MarkÊìç‰ΩúÔºåÂ∞ÜËÆ∞ÂΩï‰∏äÊ†áËØÜDelete_BitÔºåËÄå‰∏çÂà†Èô§ËÆ∞ÂΩï</li>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑÁ≥ªÁªüÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑ‰∏ªÈîÆÂàóÂÜôÂÖ•</li>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑÊâÄÊúâÁ¥¢ÂºïÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜUndo PageÁöÑ‰øÆÊîπÔºåÂÜôÂÖ•Redo</li>
</ol>
</li>
<li>
<p>Redo</p>
<p>Â∞ÜÂÆåÊï¥Êï∞ÊçÆË°å‰ø°ÊÅØÂÜôÂÖ•Redo</p>
</li>
</ul>
<img src="/img/dba/DELETE-Â∑•‰Ωú.png" style="zoom:67%;" />
<p><strong>UPDATE</strong></p>
<p>ÊÉÖÂÜµ‰∏ÄÔºöUpdateÔºàÊú™‰øÆÊîπËÅöÁ∞áÁ¥¢ÂºïÈîÆÂÄºÔºåÂ±ûÊÄßÂàóÈïøÂ∫¶Êú™ÂèòÂåñÔºâ</p>
<ul>
<li>UndoÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâ
<ol>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑÁ≥ªÁªüÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑ‰∏ªÈîÆÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜÂΩìÂâçUpdateÂàóÁöÑÂâçÈïúÂÉèÂÜôÂÖ•Undo</li>
<li>Ëã•UpdateÂàó‰∏≠ÂåÖÂê´‰∫åÁ∫ßÁ¥¢ÂºïÂàóÔºåÂàôÂ∞Ü‰∫åÁ∫ßÁ¥¢ÂºïÂÖ∂‰ªñÊú™‰øÆÊîπÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜUndoÈ°µÈù¢ÁöÑ‰øÆÊîπÔºåÂÜôÂÖ•Redo</li>
</ol>
</li>
<li>Redo
<ol>
<li>ËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïUpdate RedoÊó•ÂøóÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâ</li>
<li>Ëã•Êõ¥Êñ∞ÂàóÂåÖÂê´‰∫åÁ∫ßÁ¥¢ÂºïÂàóÔºå‰∫åÁ∫ßÁ¥¢ÂºïËÇØÂÆö‰∏çËÉΩËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïDelete Mark + Insert Êó•Âøó</li>
</ol>
</li>
</ul>
<img src="/img/dba/UPDATE-Â∑•‰Ωú1.png" style="zoom:67%;" />
<p>ÊÉÖÂÜµ‰∫åÔºö UpdateÔºàÊú™‰øÆÊîπËÅöÁ∞áÁ¥¢ÂºïÈîÆÂÄºÔºåÂ±ûÊÄßÂàóÈïøÂ∫¶ÂèëÁîüÂèòÂåñÔºâ</p>
<ul>
<li>UndoÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâ
<ol>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑÁ≥ªÁªüÂàóÂÜôÂÖ•</li>
<li>Â∞ÜÂΩìÂâçËÆ∞ÂΩïÁöÑ‰∏ªÈîÆÂàóÂÜôÂÖ•</li>
<li>Â∞ÜÂΩìÂâçUpdateÂàóÁöÑÂâçÈïúÂÉèÂÜôÂÖ•</li>
<li>Ëã•UpdateÂàó‰∏≠ÂåÖÂê´‰∫åÁ∫ßÁ¥¢ÂºïÂàóÔºåÂàôÂ∞Ü‰∫åÁ∫ßÁ¥¢ÂºïÂÖ∂‰ªñÊú™‰øÆÊîπÂàóÂÜôÂÖ•Undo</li>
<li>Â∞ÜUndoÈ°µÈù¢ÁöÑ‰øÆÊîπÔºåÂÜôÂÖ•Redo</li>
</ol>
</li>
<li>Redo
<ol>
<li>‰∏çÂèØËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïDelete + Insert RedoÊó•Âøó(ËÅöÁ∞áÁ¥¢Âºï)</li>
<li>Ëã•Êõ¥Êñ∞ÂàóÂåÖÂê´‰∫åÁ∫ßÁ¥¢ÂºïÂàóÔºå‰∫åÁ∫ßÁ¥¢ÂºïËÇØÂÆö‰∏çËÉΩËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïDelete Mark + Insert RedoÊó•Âøó</li>
</ol>
</li>
</ul>
<img src="/img/dba/UPDATE-Â∑•‰Ωú2.png"  style="zoom:67%;" />
<p>ÊÉÖÂÜµ‰∏âÔºöUpdateÔºà‰øÆÊîπËÅöÁ∞áÁ¥¢ÂºïÈîÆÂÄºÔºâ</p>
<ul>
<li>
<p>Undo (ËÅöÁ∞áÁ¥¢Âºï)</p>
<ol>
<li>‰∏çÂèØËøõË°åIn Place Update„ÄÇUpdate = Delete Mark + Insert</li>
<li>ÂØπÂéüÊúâËÆ∞ÂΩïËøõË°åDelete MarkÊìç‰ΩúÔºåÂÜôÂÖ•Delete MarkÊìç‰ΩúUndo</li>
<li>Â∞ÜÊñ∞Á∫™ÂΩïÊèíÂÖ•ËÅöÁ∞áÁ¥¢ÂºïÔºåÂÜôÂÖ•InsertÊìç‰ΩúUndo</li>
<li>Â∞ÜUndoÈ°µÈù¢ÁöÑ‰øÆÊîπÔºåÂÜôÂÖ•Redo</li>
</ol>
</li>
<li>
<p>Redo</p>
<ol>
<li>‰∏çÂèØËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïDelete Mark + Insert RedoÊó•ÂøóÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâ</li>
<li>Ëã•Êõ¥Êñ∞ÂàóÂåÖÂê´‰∫åÁ∫ßÁ¥¢ÂºïÂàóÔºå‰∫åÁ∫ßÁ¥¢ÂºïËÇØÂÆö‰∏çËÉΩËøõË°åIn Place UpdateÔºåËÆ∞ÂΩïDelete Mark + Insert Êó•Âøó</li>
</ol>
</li>
</ul>
<p><img src="/img/dba/UPDATE-%E5%B7%A5%E4%BD%9C3.png" alt="UPDATE-Â∑•‰Ωú3"></p>

    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">üïäÔ∏è</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
