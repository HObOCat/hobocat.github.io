<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="nginxæœåŠ¡ - https://hobocat.github.io/post/nginx/2019-06-04-nginx/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>nginxæœåŠ¡</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">nginxæœåŠ¡</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2019-06-04&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            11993 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            24 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/nginx">nginx</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€nginxæ¦‚è¿°">ä¸€ã€Nginxæ¦‚è¿°</a>
      <ul>
        <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
        <li><a href="#yumå®‰è£…nginx">YUMå®‰è£…Nginx</a></li>
        <li><a href="#nginxæºç å®‰è£…">Nginxæºç å®‰è£…</a></li>
        <li><a href="#å®‰è£…ç¼–è¯‘å‚æ•°">å®‰è£…ç¼–è¯‘å‚æ•°</a></li>
      </ul>
    </li>
    <li><a href="#äºŒnginxåŸºæœ¬å‘½ä»¤">äºŒã€NginxåŸºæœ¬å‘½ä»¤</a></li>
    <li><a href="#ä¸‰ç®€å•é…ç½®">ä¸‰ã€ç®€å•é…ç½®</a>
      <ul>
        <li><a href="#é…ç½®æ–‡ä»¶ä½ç½®">é…ç½®æ–‡ä»¶ä½ç½®</a></li>
        <li><a href="#nginxconfé…ç½®">nginx.confé…ç½®</a></li>
        <li><a href="#nginxé…ç½®ç»“æ„">Nginxé…ç½®ç»“æ„</a></li>
        <li><a href="#nginxæ—¥å¿—æ ¼å¼">Nginxæ—¥å¿—æ ¼å¼</a></li>
      </ul>
    </li>
    <li><a href="#å››å®˜æ–¹æ¨¡å—">å››ã€å®˜æ–¹æ¨¡å—</a>
      <ul>
        <li><a href="#http_stub_status_module">http_stub_status_module</a></li>
        <li><a href="#http_random_index_module">http_random_index_module</a></li>
        <li><a href="#http_sub_module">http_sub_module</a></li>
        <li><a href="#http_limit_conn_module">http_limit_conn_module</a></li>
        <li><a href="#http_limit_req_module">http_limit_req_module</a></li>
        <li><a href="#http_access_module">http_access_module</a></li>
        <li><a href="#http_auth_basic_module">http_auth_basic_module</a></li>
        <li><a href="#http_secure_link_module">http_secure_link_module</a></li>
        <li><a href="#http_geoip2_module">http_geoip2_module</a></li>
      </ul>
    </li>
    <li><a href="#äº”nginxæœåŠ¡">äº”ã€NginxæœåŠ¡</a>
      <ul>
        <li><a href="#nginxä½œä¸ºé™æ€webæœåŠ¡">Nginxä½œä¸ºé™æ€webæœåŠ¡</a></li>
        <li><a href="#nginxä½œä¸ºä»£ç†æœåŠ¡">Nginxä½œä¸ºä»£ç†æœåŠ¡</a></li>
        <li><a href="#nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡">Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡</a></li>
        <li><a href="#nginxä½œä¸ºç¼“å­˜æœåŠ¡">Nginxä½œä¸ºç¼“å­˜æœåŠ¡</a></li>
      </ul>
    </li>
    <li><a href="#å…­åŠ¨é™åˆ†ç¦»">å…­ã€åŠ¨é™åˆ†ç¦»</a></li>
    <li><a href="#ä¸ƒrewriteè§„åˆ™">ä¸ƒã€rewriteè§„åˆ™</a></li>
    <li><a href="#å…«https">å…«ã€Https</a>
      <ul>
        <li><a href="#å¯¹ç§°åŠ å¯†åŸç†">å¯¹ç§°åŠ å¯†åŸç†</a></li>
        <li><a href="#éå¯¹ç§°åŠ å¯†åŸç†">éå¯¹ç§°åŠ å¯†åŸç†</a></li>
        <li><a href="#httpsåŠ å¯†åŸç†">HttpsåŠ å¯†åŸç†</a></li>
        <li><a href="#è‡ªå»ºcaè¯ä¹¦ç”Ÿæˆéå—ä¿¡æœºæ„é¢å‘">è‡ªå»ºCAè¯ä¹¦ç”Ÿæˆï¼ˆéå—ä¿¡æœºæ„é¢å‘ï¼‰</a></li>
        <li><a href="#é…ç½®åº”ç”¨">é…ç½®åº”ç”¨</a></li>
      </ul>
    </li>
    <li><a href="#ä¹nginxä¸luaå¼€å‘">ä¹ã€Nginxä¸Luaå¼€å‘</a>
      <ul>
        <li><a href="#æºç å®‰è£…æ­¥éª¤">æºç å®‰è£…æ­¥éª¤</a></li>
        <li><a href="#nginxè°ƒç”¨luaæ¨¡å—æŒ‡ä»¤é¡ºåº">Nginxè°ƒç”¨Luaæ¨¡å—æŒ‡ä»¤é¡ºåº</a></li>
        <li><a href="#nginx-lua-api">Nginx Lua API</a></li>
      </ul>
    </li>
    <li><a href="#åå¸¸è§é—®é¢˜">åã€å¸¸è§é—®é¢˜</a>
      <ul>
        <li><a href="#server_nameå¤šè™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§è®¿é—®">server_nameå¤šè™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§è®¿é—®</a></li>
        <li><a href="#locationåŒ¹é…ä¼˜å…ˆçº§">LocationåŒ¹é…ä¼˜å…ˆçº§</a></li>
        <li><a href="#try_filesçš„ä½¿ç”¨">try_filesçš„ä½¿ç”¨</a></li>
        <li><a href="#aliaså’ŒrootåŒºåˆ«">aliaså’ŒrootåŒºåˆ«</a></li>
        <li><a href="#å¦‚ä½•è·å–ç”¨æˆ·çš„çœŸå®ip">å¦‚ä½•è·å–ç”¨æˆ·çš„çœŸå®IP</a></li>
        <li><a href="#å¸¸è§é”™è¯¯ç ">å¸¸è§é”™è¯¯ç </a></li>
      </ul>
    </li>
    <li><a href="#åä¸€nginxæ€§èƒ½ä¼˜åŒ–">åä¸€ã€Nginxæ€§èƒ½ä¼˜åŒ–</a>
      <ul>
        <li><a href="#æ–‡ä»¶å¥æŸ„è®¾ç½®">æ–‡ä»¶å¥æŸ„è®¾ç½®</a></li>
        <li><a href="#cpuäº²å’Œ">CPUäº²å’Œ</a></li>
        <li><a href="#é€šç”¨é…ç½®ä¼˜åŒ–">é€šç”¨é…ç½®ä¼˜åŒ–</a></li>
      </ul>
    </li>
    <li><a href="#åäºŒnginx_luaé˜²ç«å¢™">åäºŒã€Nginx_Luaé˜²ç«å¢™</a></li>
    <li><a href="#é™„å½•">é™„å½•</a>
      <ul>
        <li><a href="#curlå‘½ä»¤">curlå‘½ä»¤</a></li>
        <li><a href="#abå‘½ä»¤">abå‘½ä»¤</a></li>
        <li><a href="#gzipå‘½ä»¤">gzipå‘½ä»¤</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€nginxæ¦‚è¿°">ä¸€ã€Nginxæ¦‚è¿°</h2>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p>â€‹	Nginxæ˜¯ä¸€ä¸ªå¼€æºä¸”é«˜æ•ˆã€å¯é çš„HTTPä¸­é—´ä»¶ã€ä»£ç†æœåŠ¡ã€‚</p>
<p><strong>nginxä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>IOå¤šè·¯å¤ç”¨çš„epoll</li>
<li>è½»é‡çº§ã€åŠŸèƒ½æ¨¡å—å°‘ã€ä»£ç æ¨¡å—åŒ–ã€‘</li>
<li>CPUäº²å’Œã€å°†ä¸€ä¸ªè¿›ç¨‹&quot;ç»‘å®š&quot; åˆ°ä¸€ä¸ªæˆ–ä¸€ç»„CPUä¸Šï¼Œé¿å…Cacahe Missã€‘</li>
<li>å¤„ç†æ–‡ä»¶é‡‡ç”¨SendFileæ–¹å¼ã€mmapç³»ç»Ÿè°ƒç”¨ã€‘</li>
</ul>
<p><strong>nginxç‰ˆæœ¬é€‰æ‹©</strong></p>
<ul>
<li>Mainline Version		å¼€å‘ç‰ˆ</li>
<li>Stable Version			ç¨³å®šç‰ˆ</li>
<li>Legacy Version			å†å²ç‰ˆæœ¬</li>
</ul>
<h3 id="yumå®‰è£…nginx">YUMå®‰è£…Nginx</h3>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå®‰è£…å‰å‡†å¤‡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å®‰è£…nginxå¿…è¦åº“</span>
</span></span><span style="display:flex;"><span>yum -y install gcc-c++ gcc autoconf pcre-devel make automake
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å®‰è£…å¯é€‰å‘½ä»¤å·¥å…·</span>
</span></span><span style="display:flex;"><span>yum -y install wget httpd-tools
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å®˜æ–¹è¦æ±‚æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>sudo yum install yum-utils
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ï¼šä¿®æ”¹<code>/etc/yum.repos.d/nginx.repo</code></strong></p>
<pre tabindex="0"><code class="language-repo" data-lang="repo">[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
</code></pre><p><strong>ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œå®‰è£…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo yum install nginx
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å®‰è£…æ–‡ä»¶</strong></p>
<p><code>rpm -ql nginx</code>æŸ¥çœ‹å®‰è£…ç›®å½•åŠæ–‡ä»¶</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>/etc/logrotate.d/nginx          #Nginxæ—¥å¿—è½®è½¬ï¼Œç”¨äºæ—¥å¿—åˆ‡å‰²
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/nginx/nginx.conf           #nginxä¸»è¦é…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>/etc/nginx/conf.d/default.conf  #å®‰è£…ä¹‹åé»˜è®¤åŠ è½½çš„æ–‡ä»¶
</span></span><span style="display:flex;"><span>/etc/nginx/fastcgi_params       #cgié…ç½®
</span></span><span style="display:flex;"><span>/etc/nginx/scgi_params          #cgié…ç½®
</span></span><span style="display:flex;"><span>/etc/nginx/uwsgi_params         #cgié…ç½®
</span></span><span style="display:flex;"><span>/etc/nginx/koi-utf              #ç¼–ç è½¬æ¢çš„æ˜ å°„æ–‡ä»¶
</span></span><span style="display:flex;"><span>/etc/nginx/koi-win              #ç¼–ç è½¬æ¢çš„æ˜ å°„æ–‡ä»¶
</span></span><span style="display:flex;"><span>/etc/nginx/win-utf              #ç¼–ç è½¬æ¢çš„æ˜ å°„æ–‡ä»¶
</span></span><span style="display:flex;"><span>/etc/nginx/mime.types           #è®¾ç½®Httpåè®®Content-Typeä¸æ‰©å±•åå¯¹åº”å…³ç³»
</span></span><span style="display:flex;"><span>/etc/nginx/modules              #nginxæ¨¡å—ç›®å½•æŒ‡å‘/usr/lib64/nginx/modules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/usr/lib64/nginx/modules        #nginxæ¨¡å—ç›®å½•
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/sysconfig/nginx                         #ç”¨äºå®ˆæŠ¤è¿›ç¨‹
</span></span><span style="display:flex;"><span>/etc/sysconfig/nginx-debug                   #ç”¨äºå®ˆæŠ¤è¿›ç¨‹
</span></span><span style="display:flex;"><span>/usr/lib/systemd/system/nginx-debug.service  #ç”¨äºå®ˆæŠ¤è¿›ç¨‹	
</span></span><span style="display:flex;"><span>/usr/lib/systemd/system/nginx.service        #ç”¨äºå®ˆæŠ¤è¿›ç¨‹
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/usr/sbin/nginx                 #nginxå‘½ä»¤
</span></span><span style="display:flex;"><span>/usr/sbin/nginx-debug           #nginx-debugå‘½ä»¤
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/usr/share/doc/nginx-1.16.0            #nginxæ‰‹å†Œ
</span></span><span style="display:flex;"><span>/usr/share/doc/nginx-1.16.0/COPYRIGHT  #nginxæ‰‹å†Œ
</span></span><span style="display:flex;"><span>/usr/share/man/man8/nginx.8.gz         #nginxå¸®åŠ©æ–‡ä»¶
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/usr/share/nginx/html/50x.html     #nginxé»˜è®¤50xç•Œé¢
</span></span><span style="display:flex;"><span>/usr/share/nginx/html/index.html   #nginxé»˜è®¤indexç•Œé¢
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/var/cache/nginx  #nginxç¼“å†²ç›®å½•
</span></span><span style="display:flex;"><span>/var/log/nginx    #nginxæ—¥å¿—ç›®å½•
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxæºç å®‰è£…">Nginxæºç å®‰è£…</h3>
<p>æå‰å‡†å¤‡ï¼š</p>
<ul>
<li>ä¸‹è½½å¹¶è§£å‹æºç </li>
<li>å®‰è£…å¿…è¦åº“</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum -y install gcc-c++ gcc autoconf pcre-devel make automake zlib-devel openssl openssl-devel
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸€æ­¥ï¼šè®¾ç½®ç¼–è¯‘å‚æ•°</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>./configure <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--prefix<span style="color:#000;font-weight:bold">=</span>/etc/nginx <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--sbin-path<span style="color:#000;font-weight:bold">=</span>/usr/sbin/nginx <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--modules-path<span style="color:#000;font-weight:bold">=</span>/usr/lib64/nginx/modules <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--conf-path<span style="color:#000;font-weight:bold">=</span>/etc/nginx/nginx.conf <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--error-log-path<span style="color:#000;font-weight:bold">=</span>/var/log/nginx/error.log <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-log-path<span style="color:#000;font-weight:bold">=</span>/var/log/nginx/access.log <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--pid-path<span style="color:#000;font-weight:bold">=</span>/var/run/nginx.pid <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--lock-path<span style="color:#000;font-weight:bold">=</span>/var/run/nginx.lock <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-client-body-temp-path<span style="color:#000;font-weight:bold">=</span>/var/cache/nginx/client_temp <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-proxy-temp-path<span style="color:#000;font-weight:bold">=</span>/var/cache/nginx/proxy_temp <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-fastcgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/cache/nginx/fastcgi_temp <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-uwsgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/cache/nginx/uwsgi_temp <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--http-scgi-temp-path<span style="color:#000;font-weight:bold">=</span>/var/cache/nginx/scgi_temp <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--user<span style="color:#000;font-weight:bold">=</span>nginx <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--group<span style="color:#000;font-weight:bold">=</span>nginx <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-compat <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-file-aio <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-threads <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_addition_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_auth_request_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_dav_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_flv_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_gunzip_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_gzip_static_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_mp4_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_random_index_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_realip_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_secure_link_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_slice_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_ssl_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_stub_status_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_sub_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-http_v2_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-mail <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-mail_ssl_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-stream <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-stream_realip_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-stream_ssl_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-stream_ssl_preread_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-cc-opt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;</span> <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>--with-ld-opt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ï¼šç¼–è¯‘&amp;å®‰è£…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…ç¼–è¯‘å‚æ•°">å®‰è£…ç¼–è¯‘å‚æ•°</h3>
<p>ä½¿ç”¨<code>nginx -V</code>æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯å’Œå®‰è£…ç¼–è¯‘å‚æ•°</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>#å®‰è£…ç›®å½•æˆ–æ–‡ä»¶è·¯å¾„
</span></span><span style="display:flex;"><span>--prefix=/etc/nginx 										
</span></span><span style="display:flex;"><span>--sbin-path=/usr/sbin/nginx 
</span></span><span style="display:flex;"><span>--modules-path=/usr/lib64/nginx/modules 
</span></span><span style="display:flex;"><span>--conf-path=/etc/nginx/nginx.conf 
</span></span><span style="display:flex;"><span>--error-log-path=/var/log/nginx/error.log 
</span></span><span style="display:flex;"><span>--http-log-path=/var/log/nginx/access.log 
</span></span><span style="display:flex;"><span>--pid-path=/var/run/nginx.pid 
</span></span><span style="display:flex;"><span>--lock-path=/var/run/nginx.lock 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æ‰§è¡Œå¯¹åº”æ¨¡å—æ—¶ï¼Œnginxæ‰€ä¿ç•™çš„ä¸´æ—¶æ–‡ä»¶
</span></span><span style="display:flex;"><span>--http-client-body-temp-path=/var/cache/nginx/client_temp 	
</span></span><span style="display:flex;"><span>--http-proxy-temp-path=/var/cache/nginx/proxy_temp 
</span></span><span style="display:flex;"><span>--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp 
</span></span><span style="display:flex;"><span>--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp 
</span></span><span style="display:flex;"><span>--http-scgi-temp-path=/var/cache/nginx/scgi_temp 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#nginxè¿›ç¨‹å¯åŠ¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„
</span></span><span style="display:flex;"><span>--user=nginx												
</span></span><span style="display:flex;"><span>--group=nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--with-compat 
</span></span><span style="display:flex;"><span>--with-file-aio                   #ä½¿ç”¨aioä¼ è¾“æ–‡ä»¶ï¼Œæ•ˆç‡ä¸ä¸€å®šæ¯”sendfileé«˜
</span></span><span style="display:flex;"><span>--with-threads
</span></span><span style="display:flex;"><span>--with-http_addition_module
</span></span><span style="display:flex;"><span>--with-http_auth_request_module
</span></span><span style="display:flex;"><span>--with-http_dav_module
</span></span><span style="display:flex;"><span>--with-http_flv_module
</span></span><span style="display:flex;"><span>--with-http_gunzip_module         #æ”¯æŒgunzipçš„å‹ç¼©æ–¹å¼ã€‚ç”¨äºå®¢æˆ·ç«¯ä¸æ”¯æŒgzipå‹ç¼©åŠŸèƒ½ä¸‹
</span></span><span style="display:flex;"><span>--with-http_gzip_static_module    #é¢„è¯»gzipåŠŸèƒ½
</span></span><span style="display:flex;"><span>--with-http_mp4_module
</span></span><span style="display:flex;"><span>--with-http_random_index_module   #ç›®å½•ä¸­éšæœºé€‰å–ä¸»é¡µæ¨¡å—
</span></span><span style="display:flex;"><span>--with-http_realip_module
</span></span><span style="display:flex;"><span>--with-http_secure_link_module    #å®‰å…¨ä¸‹è½½é“¾æ¥æ¨¡å—
</span></span><span style="display:flex;"><span>--with-http_slice_module          #å¤§æ–‡ä»¶æ‹†åˆ†ä½¿ç”¨
</span></span><span style="display:flex;"><span>--with-http_ssl_module            #httpsçš„è¯ä¹¦ç›¸å…³
</span></span><span style="display:flex;"><span>--with-http_stub_status_module    #æŸ¥çœ‹nginxå®¢æˆ·ç«¯çŠ¶æ€æ¨¡å—
</span></span><span style="display:flex;"><span>--with-http_sub_module            #HTTPå†…å®¹æ›¿æ¢æ¨¡å—
</span></span><span style="display:flex;"><span>--with-http_v2_module
</span></span><span style="display:flex;"><span>--with-mail 
</span></span><span style="display:flex;"><span>--with-mail_ssl_module 
</span></span><span style="display:flex;"><span>--with-stream                     #ç¼–è¯‘ngx_stream_core_module
</span></span><span style="display:flex;"><span>--with-stream_realip_module 
</span></span><span style="display:flex;"><span>--with-stream_ssl_module 
</span></span><span style="display:flex;"><span>--with-stream_ssl_preread_module 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>#å®šä¹‰è¦ä¼ é€’åˆ°Cç¼–è¯‘å™¨å‘½ä»¤è¡Œçš„å…¶ä»–é€‰é¡¹
</span></span><span style="display:flex;"><span>--with-cc-opt=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;  
</span></span><span style="display:flex;"><span>#å®šä¹‰è¦ä¼ é€’åˆ°Cé“¾æ¥å™¨å‘½ä»¤è¡Œçš„å…¶ä»–é€‰é¡¹
</span></span><span style="display:flex;"><span>--with-ld-opt=&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äºŒnginxåŸºæœ¬å‘½ä»¤">äºŒã€NginxåŸºæœ¬å‘½ä»¤</h2>
<ul>
<li>
<p><strong>æ£€æŸ¥nginxé…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -t -c nginx.conf          <span style="color:#998;font-style:italic">#tä»£è¡¨æ£€æŸ¥ cæŒ‡å®šæ–‡ä»¶è·¯å¾„</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -s reload -c nginx.conf 	<span style="color:#998;font-style:italic">#sä»£è¡¨ä¿¡å·relaodå‚æ•°è¡¨ç¤ºé‡åŠ è½½ cæŒ‡å®šæ–‡ä»¶è·¯å¾„</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>æŸ¥çœ‹å®‰è£…æ¨¡å—</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx  -V                       <span style="color:#998;font-style:italic">#æŸ¥çœ‹ç¼–è¯‘æ—¶è‡ªå·±è®¾ç½®çš„å‚æ•°åŒ…å«æ¨¡å—ä¿¡æ¯</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>å¿«é€Ÿåœæ­¢</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -s stop
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¼˜é›…åœæœºï¼ˆç°æœ‰ä»»åŠ¡è¿è¡Œå®Œæˆï¼Œå…¶å®ƒè¯·æ±‚æ‹’ç»ï¼‰</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -s quit
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="ä¸‰ç®€å•é…ç½®">ä¸‰ã€ç®€å•é…ç½®</h2>
<h3 id="é…ç½®æ–‡ä»¶ä½ç½®">é…ç½®æ–‡ä»¶ä½ç½®</h3>
<p><code>/etc/nginx/nginx.conf</code>ä¸ºä¸»è¦é…ç½®æ–‡ä»¶ï¼Œåœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­é»˜è®¤é…ç½®äº†<code> include /etc/nginx/conf.d/*.conf</code>å³ä¼šåŠ è½½conf.dä¸‹çš„é…ç½®æ–‡ä»¶</p>
<h3 id="nginxconfé…ç½®">nginx.confé…ç½®</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">user</span>  <span style="color:#d14">nginx</span>;                                <span style="color:#998;font-style:italic">#è®¾ç½®nginxæœåŠ¡çš„ç³»ç»Ÿå¯åŠ¨ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">worker_processes</span>  <span style="color:#099">1</span>;                        <span style="color:#998;font-style:italic">#å·¥ä½œè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä½CPUæ ¸å¿ƒæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">error_log</span>  <span style="color:#d14">/var/log/nginx/error.log</span> <span style="color:#d14">warn</span>;   <span style="color:#998;font-style:italic">#nginxé”™è¯¯æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">pid</span>        <span style="color:#d14">/var/run/nginx.pid</span>;              <span style="color:#998;font-style:italic">#pidæ–‡ä»¶ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">worker_connections</span>  <span style="color:#099">1024</span>;               <span style="color:#998;font-style:italic">#æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œç”Ÿæˆç¯å¢ƒå¿…é¡»è°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">include</span>       <span style="color:#d14">/etc/nginx/mime.types</span>;    <span style="color:#998;font-style:italic">#Content_Typeé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">default_type</span>  <span style="color:#d14">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#æ—¥å¿—æ ¼å¼å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">log_format</span>  <span style="color:#d14">main</span>  <span style="color:#d14">&#39;</span><span style="color:#008080">$remote_addr</span> <span style="color:#d14">-</span> <span style="color:#008080">$remote_user</span> <span style="color:#d14">[</span><span style="color:#008080">$time_local]</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$request&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;</span><span style="color:#008080">$status</span> <span style="color:#008080">$body_bytes_sent</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_referer&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;&#34;</span><span style="color:#008080">$http_user_agent&#34;</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#è®¿é—®æ—¥å¿—å®šä¹‰ä½¿ç”¨mainæ ¼å¼æ‰“å°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">access_log</span>  <span style="color:#d14">/var/log/nginx/access.log</span>  <span style="color:#d14">main</span>;	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">sendfile</span>        <span style="color:#008080">on</span>;       <span style="color:#998;font-style:italic">#æ˜¯å¦å¼€å¯sendfile
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">#tcp_nopush     on;       #æ˜¯å¦ä¸ç«‹å³ä¼ è¾“è€Œæ˜¯ç­‰å¾…åŒ…å¤§å°æˆ–è€…æ—¶é—´åˆ°è¾¾æ¡ä»¶ï¼Œä»¥æé«˜æ•ˆç‡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">keepalive_timeout</span>  <span style="color:#099">65</span>;    <span style="color:#998;font-style:italic">#å®¢æˆ·ç«¯å’ŒæœåŠ¡çš„keepaliveè¶…å¸‚æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#gzip  on;                          #å‹ç¼©ä¼ è¾“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">include</span> <span style="color:#d14">/etc/nginx/conf.d/*.conf</span>;   <span style="color:#998;font-style:italic">#å¼•å…¥è¾…åŠ©é…ç½®æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxé…ç½®ç»“æ„">Nginxé…ç½®ç»“æ„</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">http</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span> <span style="color:#099">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span> <span style="color:#d14">localhost</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span>   <span style="color:#d14">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">index</span>  <span style="color:#d14">index.html</span> <span style="color:#d14">index.htm</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">error_page</span>   <span style="color:#099">500</span> <span style="color:#099">502</span> <span style="color:#099">503</span> <span style="color:#099">504</span>  <span style="color:#d14">/50x.html</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> = <span style="color:#d14">/50x.html</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span>   <span style="color:#d14">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxæ—¥å¿—æ ¼å¼">Nginxæ—¥å¿—æ ¼å¼</h3>
<p><strong>Nginxå¯ç”¨æ—¥å¿—å˜é‡</strong></p>
<ul>
<li>
<p>HTTPè¯·æ±‚å˜é‡ï¼š$arg_PARAMETERã€$http_HEADERã€$sent_http_HEADER</p>
</li>
<li>
<p>å†…ç½®å˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>$bytes_sent</td>
<td>å‘é€åˆ°å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°</td>
</tr>
<tr>
<td>$connection</td>
<td>è¿æ¥åºåˆ—å·</td>
</tr>
<tr>
<td>$connection_requests</td>
<td>é€šè¿‡è¿æ¥å‘å‡ºçš„å½“å‰è¯·æ±‚æ•°</td>
</tr>
<tr>
<td>$msec</td>
<td>ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´</td>
</tr>
<tr>
<td>$pipe</td>
<td><code>p</code>ä»£è¡¨pipelinedæ–¹å¼è¯·æ±‚ï¼Œ<code>.</code>ä»£è¡¨å…¶å®ƒæ–¹å¼</td>
</tr>
<tr>
<td>$request_length</td>
<td>è¯·æ±‚é•¿åº¦ï¼ˆåŒ…æ‹¬è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´å’Œè¯·æ±‚æ­£æ–‡ï¼‰</td>
</tr>
<tr>
<td>$request_time</td>
<td>ä»¥æ¯«ç§’ä¸ºå•ä½è¯·æ±‚å¤„ç†æ—¶é—´</td>
</tr>
<tr>
<td>$status</td>
<td>å›åº”çŠ¶æ€</td>
</tr>
<tr>
<td>$time_iso8601</td>
<td>ISO 8601æ ¼å¼çš„å½“åœ°æ—¶é—´</td>
</tr>
<tr>
<td>$time_local</td>
<td>æœ¬åœ°æ—¶é—´æ ¼å¼</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>è‡ªå®šä¹‰å˜é‡</p>
</li>
</ul>
<p><strong>Nginxé»˜è®¤æ—¥å¿—æ ¼å¼</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">log_format</span>  <span style="color:#d14">main</span>  <span style="color:#d14">&#39;</span><span style="color:#008080">$remote_addr</span> <span style="color:#008080">$status</span> <span style="color:#d14">-</span> <span style="color:#008080">$remote_user</span> <span style="color:#d14">[</span><span style="color:#008080">$time_local]</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$request&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;</span><span style="color:#008080">$status</span> <span style="color:#008080">$body_bytes_sent</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_referer&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;&#34;</span><span style="color:#008080">$http_user_agent&#34;</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_x_forwarded_for&#34;&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å››å®˜æ–¹æ¨¡å—">å››ã€å®˜æ–¹æ¨¡å—</h2>
<h3 id="http_stub_status_module">http_stub_status_module</h3>
<p><strong>ä½œç”¨ï¼šç›‘æ§nginxå®¢æˆ·ç«¯çŠ¶æ€</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:	 stub_status;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/stub_status</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">stub_status</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------------------------------è®¿é—®/stub_statusè¿”å›æ•°æ®--------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Active connections: 2 					å½“å‰è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#server accepts handled requests
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 13 13 16                            æ¡æ‰‹æ¬¡æ•° è¿æ¥æ¬¡æ•° è¯·æ±‚æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Reading: 0 Writing: 1 Waiting: 1     è¯»ä¸ªæ•°   å†™ä¸ªæ•°   ç­‰å¾…ä¸ªæ•°
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_random_index_module">http_random_index_module</h3>
<p><strong>ä½œç”¨ï¼šè®¿é—®éšæœºä¸»é¡µ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:	 random_index on | off;
</span></span><span style="display:flex;"><span>Default: random_index off;
</span></span><span style="display:flex;"><span>Context: location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#åªèƒ½é…ç½®åœ¨â€œ/â€ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {		
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>         <span style="color:#d14">/opt/nginx/app/randmon_page</span>;	
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">random_index</span> <span style="color:#008080">on</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_sub_module">http_sub_module</h3>
<p><strong>ä½œç”¨ï¼šHTTPå†…å®¹æ›¿æ¢</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€æ›¿æ¢æŒ‡å®šå­—ç¬¦ä¸²ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 sub_filter string replacement;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€æ˜¯å¦é˜»æ­¢response headerä¸­å†™å…¥Last-Modifiedï¼Œé˜²æ­¢ç¼“å­˜ï¼Œé»˜è®¤æ˜¯offï¼Œå³é˜²æ­¢ç¼“å­˜ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 sub_filter_last_modified on | off;
</span></span><span style="display:flex;"><span>Default: sub_filter_last_modified off;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€æ˜¯å¦åªæ›¿æ¢ä¸€æ¬¡å­—ç¬¦ä¸²ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 sub_filter_once on | off;
</span></span><span style="display:flex;"><span>Default: sub_filter_once on;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:	 sub_filter_types mime-type ...;
</span></span><span style="display:flex;"><span>Default: sub_filter_types text/html;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">sub_filter</span>      <span style="color:#d14">&#39;kun&#39;</span> <span style="color:#d14">&#39;KUN&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">sub_filter_once</span> <span style="color:#008080">off</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>            <span style="color:#d14">/opt/nginx/app/sub_module</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">index</span>           <span style="color:#d14">submodule.html</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_limit_conn_module">http_limit_conn_module</h3>
<p><strong>ä½œç”¨ï¼šé™åˆ¶è¿æ¥é¢‘ç‡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€å¼€è¾Ÿä¿å­˜è¿æ¥ä¿¡æ¯çš„ç©ºé—´ key:å­˜å‚¨ä¿¡æ¯ï¼Œnameç©ºé—´åç§°ï¼Œsizeç©ºé—´å¤§å°ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 limit_conn_zone key zone=name:size;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€é™åˆ¶åŒæ—¶è¿æ¥çš„å¹¶å‘æ•°é‡ zone:ç©ºé—´åç§°ï¼Œnumber:é™åˆ¶ä¸ªæ•°ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 limit_conn zone number;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">limit_conn_zone</span> <span style="color:#008080">$binary_remote_addr</span> <span style="color:#d14">zone=coon_addr:10m</span>;   <span style="color:#998;font-style:italic">#å¼€è¾Ÿ10Mç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">limit_conn</span>   <span style="color:#d14">addr</span> <span style="color:#099">1</span>;                              <span style="color:#998;font-style:italic">#æ¯æ¬¡ä¸€ä¸ªipåªå…è®¸1æ¬¡è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">root</span>        <span style="color:#d14">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">index</span>       <span style="color:#d14">index.html</span> <span style="color:#d14">index.htm</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_limit_req_module">http_limit_req_module</h3>
<p><strong>ä½œç”¨ï¼šé™åˆ¶è¯·æ±‚é¢‘ç‡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€å¼€è¾Ÿä¿å­˜è¯·æ±‚ä¿¡æ¯çš„ç©ºé—´ key:å­˜å‚¨ä¿¡æ¯ï¼Œnameç©ºé—´åç§°ï¼Œsizeç©ºé—´å¤§å°ï¼Œrateè¯·æ±‚é€Ÿç‡ã€‘
</span></span><span style="display:flex;"><span>Syntax:  limit_req_zone key zone=name:size rate=rate [sync];
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€é™åˆ¶åŒæ—¶è¯·æ±‚çš„å¹¶å‘æ•°é‡ zone:ç©ºé—´åç§°ï¼Œburstå…è®¸è¶…è¿‡ä¸ªæ•°ï¼Œnodelayæ˜¯å¦å»¶è¿Ÿæ‰§è¡Œburst ã€‘
</span></span><span style="display:flex;"><span>Syntax:	limit_req zone=name [burst=number] [nodelay | delay=number];
</span></span><span style="display:flex;"><span>Default:	â€”
</span></span><span style="display:flex;"><span>Context:	http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¼€è¾Ÿ10Mç©ºé—´ï¼Œæ¯IPæ¯ç§’åªå…è®¸è¯·æ±‚ä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">limit_req_zone</span>  <span style="color:#008080">$binary_remote_addr</span> <span style="color:#d14">zone=req_addr:10m</span> <span style="color:#d14">rate=1r/s</span>; 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">limit_req</span>   <span style="color:#d14">zone=req_addr</span> <span style="color:#d14">burst=3</span> <span style="color:#d14">nodelay</span>;	<span style="color:#998;font-style:italic">#å…è®¸çªå‘è¿æ¥æ•°ä¸º3ï¼Œä¸å»¶è¿Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">root</span>        <span style="color:#d14">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">index</span>       <span style="color:#d14">index.html</span> <span style="color:#d14">index.htm</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#------------------------------------ä½¿ç”¨abå·¥å…·å‹æµ‹#-----------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ab -n 20 -c 20 http://localhost/
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ç»“æœæˆåŠŸ4ä¸ªè¯·æ±‚ï¼Œå¤±è´¥16ä¸ªè¯·æ±‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_access_module">http_access_module</h3>
<p><strong>ä½œç”¨ï¼šæ§åˆ¶è®¿é—®çš„ipï¼Œå¦‚æœå¤šå±‚ä»£ç†æ­¤ç§æ–¹å¼æœ‰é—®é¢˜ã€åŸºäºremote_addrè¯†åˆ«ã€‘</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€å…è®¸è®¿é—®åå•ã€‘
</span></span><span style="display:flex;"><span>Syntax:  allow address | CIDR | unix: | all;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location, limit_except
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€æ‹’ç»è®¿é—®åå•ã€‘
</span></span><span style="display:flex;"><span>Syntax:  deny address | CIDR | unix: | all;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location, limit_except
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/admin.html</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/access_module</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">index</span>   <span style="color:#d14">admin.html</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">allow</span>   <span style="color:#099">192</span><span style="color:#d14">.168.1.0/24</span>;         <span style="color:#998;font-style:italic">#å…è®¸æ¬¡ç½‘æ®µè®¿é—®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">deny</span>    <span style="color:#d14">all</span>;                    <span style="color:#998;font-style:italic">#ä¸å…è®¸å…¶å®ƒäººè®¿é—®ï¼Œæ³¨æ„å¸¦allå‚æ•°çš„æ”¾æœ€å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_auth_basic_module">http_auth_basic_module</h3>
<p><strong>ä½œç”¨ï¼šç”¨æˆ·ç™»é™†è®¤è¯</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€éœ€å¼€å¯æ¬¡æ¨¡å—è¿›è¡Œè®¤è¯ï¼Œstringä»£è¡¨é¡µé¢ä¸Šçš„ç™»é™†æç¤ºä¿¡æ¯ã€‘
</span></span><span style="display:flex;"><span>Syntax:  auth_basic string | off;
</span></span><span style="display:flex;"><span>Default: auth_basic off;
</span></span><span style="display:flex;"><span>Context: http, server, location, limit_excep
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€å­˜å‚¨ç”¨æˆ·åã€å¯†ç ä¿¡æ¯çš„æ¨¡å—ã€‘
</span></span><span style="display:flex;"><span>Syntax:  auth_basic_user_file file;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location, limit_except
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/auth.html</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>        	<span style="color:#d14">/opt/nginx/app/auth_module</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auth_basic</span>  	<span style="color:#d14">&#34;manager</span> <span style="color:#d14">site&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">auth_basic_user_file</span> <span style="color:#d14">/etc/nginx/auth_conf</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ä½¿ç”¨ã€htpasswd -c /etc/nginx/auth_conf username ã€‘åˆ¶ä½œå­˜æ”¾å¯†ç æ–‡ä»¶
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_secure_link_module">http_secure_link_module</h3>
<p><img src="/img/nginx/secure_link.png" alt="secure_link"></p>
<p>ä½œç”¨ï¼šåˆ¶å®šå¹¶å…è®¸æ£€æŸ¥è¯·æ±‚çš„çœŸå®æ€§ä»¥åŠä¿æŠ¤èµ„æºå…é­æœªæˆæƒçš„è®¿é—®ä¹Ÿå¯é™åˆ¶é“¾æ¥ç”Ÿæ•ˆæ—¶é•¿</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:  secure_link expression;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:  secure_link_md5 expression;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#echo -n &#39;$expire$uri kun&#39;| openssl md5 -binary | openssl base64 | tr +/ -_ | tr -d =
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å³å¯ç­‰å¾…md5å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/download</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#å®šä¹‰md5å’Œexpireå˜é‡ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">secure_link</span>  <span style="color:#008080">$arg_md5,$arg_expire</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#kunæœªæ··æ·†ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">secure_link_md5</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$secure_link_expires$uri</span> <span style="color:#d14">kun&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#å¦‚æœmd5ä¸æ­£ç¡®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">(</span><span style="color:#008080">$secure_link</span> = <span style="color:#d14">&#34;&#34;)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">403</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#å¦‚æœexpireå·²ç»å¤±æ•ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">(</span><span style="color:#008080">$secure_link</span> = <span style="color:#d14">&#34;0&#34;)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">410</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/opt/nginx/app/secure_link</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http_geoip2_module">http_geoip2_module</h3>
<p>ä½œç”¨ï¼šåŸºäºIPåœ°å€åŒ¹é…MaxMind GeoIPäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯»å–IPæ‰€åœ¨åœ°åŸŸä¿¡æ¯ã€‚</p>
<p>åœºæ™¯ï¼šåŒºåˆ«å›½å†…å›½å¤–ä½œHttpè®¿é—®è§„åˆ™ï¼ŒåŒºåˆ«å›½å†…åŸå¸‚ä½œHTTPè®¿é—®è§„åˆ™</p>
<p>å‡†å¤‡ï¼š<a href="https://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz">ä¸‹è½½åŸå¸‚ä¿¡æ¯</a>   <a href="https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.tar.gz">ä¸‹è½½å›½å®¶ä¿¡æ¯</a></p>
<p>å®‰è£…ï¼š</p>
<ul>
<li>å®‰è£…libmaxminddbï¼Œ<a href="https://github.com/maxmind/libmaxminddb">è¯¦è§åœ°å€</a></li>
<li>ä¸‹è½½ngx_http_geoip2_moduleæ¨¡å—ï¼Œ<a href="https://github.com/leev/ngx_http_geoip2_module">è¯¦è§åœ°å€</a></li>
<li>nginxé‡æ–°ç¼–è¯‘å®‰è£…ï¼Œæ·»åŠ ç¼–è¯‘å‚æ•°</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è·¯å¾„åœ°å€ä¸ºè§£å‹çš„ngx_http_geoip2_moduleæ¨¡å—çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>./configure ã€åŸå‚æ•°ã€‘ --add-dynamic-module<span style="color:#000;font-weight:bold">=</span>/path/to/ngx_http_geoip2_module
</span></span></code></pre></td></tr></table>
</div>
</div><p>nginx.confé…ç½®ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">load_module</span> <span style="color:#d14">modules/ngx_http_geoip2_module.so</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">geoip2</span> <span style="color:#d14">/etc/maxmind-country.mmdb</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">auto_reload</span> <span style="color:#099">5m</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">$geoip2_metadata_country_build</span> <span style="color:#d14">metadata</span> <span style="color:#d14">build_epoch</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">#$variable_with_ipä¸ºç”¨äºè¾¨åˆ«IPåœ°å€çš„å˜é‡ï¼Œå¯è®¾ç½®ä¸º$remote_addræˆ–è‡ªå®šä¹‰å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">$geoip2_data_country_code</span> <span style="color:#d14">default=US</span> <span style="color:#d14">source=</span><span style="color:#008080">$variable_with_ip</span> <span style="color:#d14">country</span> <span style="color:#d14">iso_code</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">$geoip2_data_country_name</span> <span style="color:#d14">country</span> <span style="color:#d14">names</span> <span style="color:#d14">en</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">geoip2</span> <span style="color:#d14">/etc/maxmind-city.mmdb</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">$geoip2_data_city_name</span> <span style="color:#d14">default=London</span> <span style="color:#d14">city</span> <span style="color:#d14">names</span> <span style="color:#d14">en</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”nginxæœåŠ¡">äº”ã€NginxæœåŠ¡</h2>
<h3 id="nginxä½œä¸ºé™æ€webæœåŠ¡">Nginxä½œä¸ºé™æ€webæœåŠ¡</h3>
<p><strong>CDNæœåŠ¡ç®€ä»‹</strong></p>
<p><img src="/img/nginx/cdn.png" alt="cdn"></p>
<p>ç”¨æˆ·è¯·æ±‚åŸŸåï¼Œé€šè¿‡DNSæœåŠ¡å™¨è§£æä¹‹åï¼Œå¯¼å‘äº†æœ€è¿‘çš„æœåŠ¡å™¨ä»¥å–å¾—æœ€å¿«çš„è®¿é—®æœåŠ¡ã€‚nginxä½œä¸ºé™æ€èµ„æºç¼“å­˜è½½ä½“ååˆ†é«˜æ•ˆ</p>
<p><strong>é…ç½®Nginxæ–‡ä»¶è¯»å–ç›¸å…³</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>ã€é‡‡å–epollæ–¹å¼å‘é€æ–‡ä»¶ã€‘
</span></span><span style="display:flex;"><span>Syntax:  sendfile on | off;
</span></span><span style="display:flex;"><span>Default: sendfile off;
</span></span><span style="display:flex;"><span>Context: http, server, location, if in location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ä¸ç«‹å³å‘é€æ•°æ®åŒ…ï¼Œå°†å¤šä¸ªåŒ…æ•´ä½“è¿›è¡Œæ•´åˆä¸€æ¬¡å‘é€ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼Œsendfileå¼€å¯æ—¶æ‰èƒ½ä½¿ç”¨ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 tcp_nopush on | off;
</span></span><span style="display:flex;"><span>Default: tcp_nopush off;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ä¸tcp_nopushç›¸åï¼Œç«‹å³å‘é€æ•°æ®åŒ…ï¼Œkeepaliveå¼€å¯æ—¶æ‰èƒ½ä½¿ç”¨ã€‘
</span></span><span style="display:flex;"><span>Syntax:  tcp_nodelay on | off;
</span></span><span style="display:flex;"><span>Default: tcp_nodelay on;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--------------------------------ngx_http_gzip_module---------------------------------
</span></span><span style="display:flex;"><span>ã€å…è®¸ä¼ è¾“gzipæ–‡ä»¶ï¼Œåœ¨å®¢æˆ·ç«¯è§£å‹ï¼Œå‡å°‘å¸¦å®½å‹åŠ›ã€‘
</span></span><span style="display:flex;"><span>Syntax:  gzip on | off;
</span></span><span style="display:flex;"><span>Default: gzip off;
</span></span><span style="display:flex;"><span>Context: http, server, location, if in location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€å‹ç¼©çº§åˆ«ï¼ˆ1-9ï¼‰ä¾æ¬¡ä¸Šå‡ã€‘
</span></span><span style="display:flex;"><span>Syntax:  gzip_comp_level level;
</span></span><span style="display:flex;"><span>Default: gzip_comp_level 1;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€gzipçš„httpåè®®ç‰ˆæœ¬ã€‘
</span></span><span style="display:flex;"><span>Syntax:  gzip_http_version 1.0 | 1.1;
</span></span><span style="display:flex;"><span>Default: gzip_http_version 1.1;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------------------------------http_gzip_static_module-------------------------------
</span></span><span style="display:flex;"><span>ã€é¢„è¯»gzipåŠŸèƒ½ã€‘
</span></span><span style="display:flex;"><span>Syntax:  gzip_static on | off | always;
</span></span><span style="display:flex;"><span>Default: gzip_static off;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">.*\.(jpg|gif|png)$</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">gzip</span>    <span style="color:#008080">on</span>;				      <span style="color:#998;font-style:italic">#å¼€å¯å‹ç¼©
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_http_version</span> <span style="color:#099">1</span><span style="color:#d14">.1</span>;  <span style="color:#998;font-style:italic">#ç‰ˆæœ¬1.1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_comp_level</span> <span style="color:#099">2</span>;      <span style="color:#998;font-style:italic">#å‹ç¼©ç­‰çº§2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_types</span> <span style="color:#d14">text/plain</span> <span style="color:#d14">application/javascript</span> <span style="color:#d14">application/x-javascript</span> <span style="color:#d14">text/css</span> <span style="color:#d14">application/xml</span> <span style="color:#d14">text/javascript</span> <span style="color:#d14">application/x-httpd-php</span> <span style="color:#d14">image/jpeg</span> <span style="color:#d14">image/gif</span> <span style="color:#d14">image/png</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/gzip/img</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">.*\.(txt|xml)$</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">gzip</span>    <span style="color:#008080">on</span>;             <span style="color:#998;font-style:italic">#å¼€å¯å‹ç¼©
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_http_version</span> <span style="color:#099">1</span><span style="color:#d14">.1</span>;  <span style="color:#998;font-style:italic">#ç‰ˆæœ¬1.1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_comp_level</span> <span style="color:#099">2</span>;      <span style="color:#998;font-style:italic">#å‹ç¼©ç­‰çº§2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_types</span> <span style="color:#d14">text/plain</span> <span style="color:#d14">application/javascript</span> <span style="color:#d14">application/x-javascript</span> <span style="color:#d14">text/css</span> <span style="color:#d14">application/xml</span> <span style="color:#d14">text/javascript</span> <span style="color:#d14">application/x-httpd-php</span> <span style="color:#d14">image/jpeg</span> <span style="color:#d14">image/gif</span> <span style="color:#d14">image/png</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/gzip/doc</span>;
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/download</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">gzip_static</span> <span style="color:#008080">on</span>;     <span style="color:#998;font-style:italic">#å¼€å¯gzipé¢„è¯»å–ï¼Œå¿…é¡»è¦å­˜åœ¨gzipå‹ç¼©æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">tcp_nopush</span> <span style="color:#008080">on</span>;      <span style="color:#998;font-style:italic">#å¼€å¯tcp_nopushï¼Œç´¯è®¡åŒ…ä¸€èµ·å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/gzip</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®Nginxæµè§ˆå™¨ç¼“å­˜ç›¸å…³</strong></p>
<p><img src="/img/nginx/cache-read.png" alt="cache-read"></p>
<ul>
<li>æ£€éªŒæ˜¯å¦è¿‡æœŸçš„æ–¹æ³•ï¼šexpiresã€http1.0ã€‘ã€Cache-control(max-age)ã€http1.1ã€‘</li>
</ul>
<p>ç›¸å…³è¯­æ³•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>----------------------------------http_headers_module---------------------------------
</span></span><span style="display:flex;"><span>ã€è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‘
</span></span><span style="display:flex;"><span>Syntax:  expires [modified] time;
</span></span><span style="display:flex;"><span>Default: expires off;
</span></span><span style="display:flex;"><span>Context: http, server, location, if in location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å“åº”å¤´è¿”å›max-age=86400,ä½†æµè§ˆå™¨å¯èƒ½ä¼šå‘é€max-age=0å¹¶ä¸ä½¿ç”¨ï¼Œç›®çš„æ˜¯æ¯æ¬¡äº¤äº’æ‹¿åˆ°æœ€æ–°æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">.*\.html$</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">expires</span> <span style="color:#d14">24h</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/opt/nginx/app/expires</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è·¨åŸŸè®¿é—®</strong></p>
<p>ä¸ºé¿å…CSRFæ”»å‡»ï¼Œæµè§ˆå™¨é»˜è®¤ç¦æ­¢è·¨åŸŸè®¿é—®ã€‚ä½†å› ä¸ºä¸šåŠ¡è®¾è®¡æˆ–è€…å…¶å®ƒåŸå› æˆ‘ä»¬æœ‰æ—¶éœ€è¦æ‰“å¼€è·¨åŸŸè®¿é—®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>---------------------------------http_headers_module----------------------------------
</span></span><span style="display:flex;"><span>ã€æ·»åŠ Access-Control-Allow-Originä¸Access-Control-Allow-Methodsè¯·æ±‚å¤´ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 add_header name value [always];
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location, if in location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {		
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span>       <span style="color:#099">81</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span>  <span style="color:#d14">www.kun.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">.*\.html$</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/oringin</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#è¢«å‘èµ·ajaxè¯·æ±‚çš„é¡µé¢å¼€å¯å…è®¸è·¨åŸŸè®¿é—®ï¼Œ*ä»£è¡¨å…è®¸æ‰€æœ‰ipè·¨åŸŸè®¿é—®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">add_header</span>  <span style="color:#d14">Access-Control-Allow-Origin</span>  <span style="color:#d14">http://192.168.1.155</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">add_header</span>  <span style="color:#d14">Access-Control-Allow-Methods</span> <span style="color:#d14">GET,POST,PUT,DELETE,OPTIONS</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åŸºäºhttp_referé˜²ç›—é“¾</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>----------------------------------http_referer_module---------------------------------
</span></span><span style="display:flex;"><span>ã€æœ‰æ•ˆçš„referersä¿¡æ¯ï¼Œnoneä»£è¡¨ç©ºï¼Œblockä»£è¡¨å…è®¸ä¸å¸¦åè®®ä¿¡æ¯çš„ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 valid_referers none | blocked | server_names | string ...;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">.*\.(jpg|gif|png)$</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#å…è®¸çš„referersä¿¡æ¯ï¼Œnoneä»£è¡¨ç©ºï¼Œblockä»£è¡¨å…è®¸ä¸å¸¦åè®®ä¿¡æ¯çš„
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">valid_referers</span> <span style="color:#d14">none</span> <span style="color:#d14">blocked</span> <span style="color:#099">192</span><span style="color:#d14">.168.1.155</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#å½“invalid_refererä¿¡æ¯æ— æ•ˆæ—¶$invalid_refererä¸º1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">(</span><span style="color:#008080">$invalid_referer</span><span style="color:#d14">)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">403</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/gzip/img</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#------------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#curl -I http://192.168.1.155/wei.png  è¿”å›200
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#curl -I http://192.168.1.155/wei.png -e &#34;http://www.baidu.com&#34;	è¿”å›403
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxä½œä¸ºä»£ç†æœåŠ¡">Nginxä½œä¸ºä»£ç†æœåŠ¡</h3>
<p><img src="/img/nginx/proxy-type.png" alt="proxy-type"></p>
<p><strong>æ­£å‘ä»£ç†&amp;åå‘ä»£ç†</strong></p>
<p>æ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯æ˜ç¡®è¦åˆ°è¾¾çš„ç›®çš„æœåŠ¡å™¨ï¼Œå•æ— æ³•è‡ªå·±å»è®¿é—®ï¼Œå€ŸåŠ©æ­£å‘ä»£ç†è®¿é—®ç›®çš„æœåŠ¡å™¨ï¼Œå¦‚ç¿»å¢™ã€é€šè¿‡ä¸€å°èƒ½ä¸Šç½‘çš„ä¸»æœºä»£ç†ä¸Šç½‘</p>
<p>æ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯çŸ¥é“è¦è®¿é—®çš„æœåŠ¡å™¨ä½†æ˜¯å¹¶ä¸äº†è§£æœ€ç»ˆæä¾›æœåŠ¡çš„æœåŠ¡å™¨ï¼Œå¦‚è®¿é—®/adminå’Œ/merchantå®é™…è¢«ä»£ç†åˆ°ä¸¤æ¡ä¸åŒæœåŠ¡å™¨</p>
<p><strong>æ­£å‘ä»£ç†åŒºåˆ«å’Œåå‘ä»£ç†çš„åŒºåˆ«åœ¨äºä»£ç†çš„å¯¹è±¡ä¸ä¸€æ ·</strong></p>
<ul>
<li>æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯</li>
<li>åå‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯æœåŠ¡å™¨</li>
</ul>
<p>é…ç½®ä»£ç†</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>-----------------------------------http_proxy_module---------------------------------
</span></span><span style="display:flex;"><span>ã€è®¾ç½®ä»£ç†çš„ç›®çš„åœ°å€ã€‘
</span></span><span style="display:flex;"><span>Syntax:  proxy_pass URL;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: location, if in location, limit_except
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ç¼“å­˜ç›¸å…³ã€æ˜¯å¦å°½å¯èƒ½å¤šçš„ç¼“å­˜å“åº”ä¿¡æ¯ç„¶åä¸€æ¬¡æ€§å‘é€ç»™å®¢æˆ·ç«¯ã€‘
</span></span><span style="display:flex;"><span>Syntax:  proxy_buffering on | off;
</span></span><span style="display:flex;"><span>Default: proxy_buffering on;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:  proxy_buffer_size size;
</span></span><span style="display:flex;"><span>Default: proxy_buffer_size 4k|8k;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:	 proxy_buffers number size;
</span></span><span style="display:flex;"><span>Default: proxy_buffers 8 4k|8k;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:  proxy_busy_buffers_size size;
</span></span><span style="display:flex;"><span>Default: proxy_busy_buffers_size 8k|16k;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€é‡å®šå‘ç›¸å…³ã€å¯¹é‡å®šå‘çš„ä¿¡æ¯æ˜¯å¦é‡å†™ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 proxy_redirect default;
</span></span><span style="display:flex;"><span>         proxy_redirect off;
</span></span><span style="display:flex;"><span>         proxy_redirect redirect replacement;
</span></span><span style="display:flex;"><span>Default: proxy_redirect default;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€è¯·æ±‚ç›¸å…³ã€æ›´æ”¹è¯·æ±‚ä¿¡æ¯ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 proxy_set_header field value;
</span></span><span style="display:flex;"><span>Default: proxy_set_header Host $proxy_host;
</span></span><span style="display:flex;"><span>         proxy_set_header Connection close;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:  proxy_hide_header field;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:  proxy_set_body value;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€è¶…æ—¶ç›¸å…³ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 proxy_connect_timeout time;
</span></span><span style="display:flex;"><span>Default: proxy_connect_timeout 60s;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:	 proxy_read_timeout time;
</span></span><span style="display:flex;"><span>Default: proxy_read_timeout 60s;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Syntax:	 proxy_send_timeout time;
</span></span><span style="display:flex;"><span>Default: proxy_send_timeout 60s;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#---------------------------------------åå‘ä»£ç†--------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span>       <span style="color:#099">81</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span>  <span style="color:#d14">www.kun.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span>    <span style="color:#d14">/opt/nginx/app/proxy</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è®¾ç½®åå‘ä»£ç†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/proxy.html$</span> {				
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">http://192.168.1.155:81</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#--------------------------------------httpæ­£å‘ä»£ç†------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#é…ç½®DNSè§£æIPåœ°å€ï¼Œä»¥åŠè¶…æ—¶æ—¶é—´ï¼ˆ5ç§’ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">resolver</span> <span style="color:#099">8</span><span style="color:#d14">.8.8.8</span>;    <span style="color:#998;font-style:italic"># å¿…éœ€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">resolver_timeout</span> <span style="color:#d14">5s</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#é…ç½®æ­£å‘ä»£ç†å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">http://</span><span style="color:#008080">$host$request_uri</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_set_header</span> <span style="color:#d14">Host</span> <span style="color:#008080">$http_host</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_set_header</span> <span style="color:#d14">X-Real-IP</span> <span style="color:#008080">$remote_addr</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#é‡å®šå‘è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#d14">proxy_redirect</span> <span style="color:#d14">default</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#è®¾ç½®è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_connect_timeout</span> <span style="color:#099">30</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_send_timeout</span> <span style="color:#d14">60s</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_read_timeout</span> <span style="color:#d14">60s</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#é…ç½®ç¼“å­˜å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_buffering</span> <span style="color:#008080">on</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_buffer_size</span> <span style="color:#099">32k</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_buffers</span> <span style="color:#099">8</span> <span style="color:#099">128k</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_busy_buffers_size</span> <span style="color:#099">256k</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#å…³é—­ç£ç›˜ç¼“å­˜è¯»å†™å‡å°‘I/O
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_max_temp_file_size</span> <span style="color:#099">256k</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------------------------------------httpsæ­£å‘ä»£ç†------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">server{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">resolver</span> <span style="color:#099">8</span><span style="color:#d14">.8.8.8</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">access_log</span> <span style="color:#d14">/var/log/nginx/access_proxy-443.log</span> <span style="color:#d14">main</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span> <span style="color:#099">443</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">html</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">index</span> <span style="color:#d14">index.html</span> <span style="color:#d14">index.htm</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">https://</span><span style="color:#008080">$host$request_uri</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_buffers</span> <span style="color:#099">8</span> <span style="color:#099">128k</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_max_temp_file_size</span> <span style="color:#099">0k</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_connect_timeout</span> <span style="color:#099">30</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_send_timeout</span> <span style="color:#099">60</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_read_timeout</span> <span style="color:#099">60</span>;
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">proxy_next_upstream</span> <span style="color:#d14">error</span> <span style="color:#d14">timeout</span> <span style="color:#d14">invalid_header</span> <span style="color:#d14">http_502</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">error_page</span> <span style="color:#099">500</span> <span style="color:#099">502</span> <span style="color:#099">503</span> <span style="color:#099">504</span> <span style="color:#d14">/50x.html</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> = <span style="color:#d14">/50x.html</span> {
</span></span><span style="display:flex;"><span>    	<span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">html</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#curl --proxy proxy.cn:443 http://www.alipay.comæµ‹è¯•ä»£ç†æ˜¯å¦å¯ç”¨
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡">Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡</h3>
<p><img src="/img/nginx/Load-balancing.png" alt="Load-balancing"></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>--------------------------------stream_upstream_module--------------------------------
</span></span><span style="display:flex;"><span>Syntax:  upstream name { ... }
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: stream
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€url_hashç­–ç•¥ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 hash key [consistent];
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: upstream
</span></span></code></pre></td></tr></table>
</div>
</div><p>åç«¯æœåŠ¡å™¨åœ¨è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>down</td>
<td>å½“å‰serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</td>
</tr>
<tr>
<td>backup</td>
<td>é¢„ç•™çš„å¤‡ä»½æœåŠ¡å™¨ï¼Œå½“æä¾›æœåŠ¡çš„serverå®•æœºé¡¶ä¸Š,æ¢å¤æ—¶éšé€€</td>
</tr>
<tr>
<td>max_fails</td>
<td>å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°</td>
</tr>
<tr>
<td>fail_timeout</td>
<td>ç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´</td>
</tr>
<tr>
<td>max_conns</td>
<td>é™åˆ¶æœ€å¤§çš„æ¥æ”¶çš„è¿æ¥æ•°</td>
</tr>
</tbody>
</table>
<p>è°ƒåº¦ç®—æ³•</p>
<table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>ç®€ä»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>è½®è¯¢</td>
<td>é»˜è®¤ç®—æ³•ï¼ŒæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨</td>
</tr>
<tr>
<td>weight</td>
<td>åŠ æƒè½®è¯¢weightå€¼è¶Šå¤§ï¼Œåˆ†é…è®¿é—®å‡ ç‡è¶Šé«˜</td>
</tr>
<tr>
<td>ip_hash</td>
<td>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…</td>
</tr>
<tr>
<td>least_conn</td>
<td>è¿æ¥æ•°æœ€å°‘çš„æœºå™¨è¢«è¿æ¥</td>
</tr>
<tr>
<td>hash å…³é”®æ•°å€¼</td>
<td>hashè‡ªå®šä¹‰çš„key</td>
</tr>
</tbody>
</table>
<p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">upstream</span> <span style="color:#d14">app</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#ip_hash;             #ç­–ç•¥é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">#hash  $request_uri;  #ä½¿ç”¨uriä½œä¸ºhashçš„key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8001</span> <span style="color:#d14">backup</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8002</span> <span style="color:#d14">down</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8003</span> <span style="color:#d14">max_fails=3</span> <span style="color:#d14">fail_timeout=30s</span> <span style="color:#d14">weight=3</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">http://app</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxä½œä¸ºç¼“å­˜æœåŠ¡">Nginxä½œä¸ºç¼“å­˜æœåŠ¡</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>----------------------------------http_proxy_module----------------------------------
</span></span><span style="display:flex;"><span>ã€ç¼“å­˜æ–‡ä»¶å®šä¹‰ã€‘
</span></span><span style="display:flex;"><span>Syntax:  proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€æ˜¯å¦å¼€å¯ç¼“å­˜ã€‘
</span></span><span style="display:flex;"><span>Syntax:	proxy_cache zone | off;
</span></span><span style="display:flex;"><span>Default:	
</span></span><span style="display:flex;"><span>proxy_cache off;
</span></span><span style="display:flex;"><span>Context:	http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ç¼“å­˜è¿‡æœŸå‘¨æœŸã€‘
</span></span><span style="display:flex;"><span>Syntax:  proxy_cache_valid [code ...] time;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ç¼“å­˜çš„ç»´åº¦ã€‘
</span></span><span style="display:flex;"><span>Syntax:  proxy_cache_key string;
</span></span><span style="display:flex;"><span>Default: proxy_cache_key $scheme$proxy_host$request_uri;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¸…é™¤æŒ‡å®šç¼“å­˜çš„æ–¹å¼</p>
<ul>
<li>rm -rf ç¼“å­˜ç›®å½•</li>
<li>ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ngx_cache_purge</li>
</ul>
<p>éƒ¨åˆ†é¡µé¢ä¸ç¼“å­˜æ–¹å¼</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:  proxy_no_cache string ...;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">upstream</span> <span style="color:#d14">app</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8001</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8002</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.158:<span style="color:#099">8003</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ç¼“å­˜æ–‡ä»¶é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®1ï¼šè·¯å¾„ã€ç›®å½•å¿…é¡»å­˜åœ¨ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®2ï¼šç›®å½•ç»“æ„ï¼Œæ¨è1:2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®3ï¼šzoneåç§°:zoneç©ºé—´å¤§å°ã€1må¤§çº¦èƒ½å­˜8åƒkeyä¿¡æ¯ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®4ï¼šç¼“å­˜æ–‡ä»¶æœ€å¤§å ç”¨ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®5ï¼šæŸä¸ªç¼“å­˜åœ¨inactiveæŒ‡å®šçš„æ—¶é—´å†…å¦‚æœä¸è®¿é—®ï¼Œå°†ä¼šä»ç¼“å­˜ä¸­åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å‚æ•°ä½ç½®6ï¼šæ˜¯å¦ä½¿ç”¨ä¸´æ—¶è·¯å¾„å­˜å‚¨ï¼Œå»ºè®®å…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">proxy_cache_path</span> <span style="color:#d14">/var/cache/nginx/app</span> <span style="color:#d14">levels=1:2</span> <span style="color:#d14">keys_zone=proxy_cache_zone:10m</span> <span style="color:#d14">max_size=10g</span> <span style="color:#d14">inactive=60m</span> <span style="color:#d14">use_temp_path=off</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_cache</span> <span style="color:#d14">proxy_cache_zone</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_cache_valid</span> <span style="color:#099">200</span> <span style="color:#099">304</span> <span style="color:#d14">12h</span>;                   <span style="color:#998;font-style:italic">#200ã€304å“åº”ä¿å­˜12å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_cache_valid</span> <span style="color:#d14">any</span> <span style="color:#099">10m</span>;                       <span style="color:#998;font-style:italic">#ä»»ä½•å“åº”ä¿å­˜10åˆ†é’Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_cache_key</span> <span style="color:#008080">$host$uri$is_args$args</span>;          <span style="color:#998;font-style:italic">#ç¼“å­˜çš„key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">add_header</span> <span style="color:#d14">Nginx-Cache</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$upstream_cache_status&#34;</span>; <span style="color:#998;font-style:italic">#è¿”å›å‰ç«¯å“åº”å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">#å½“å‘ç”Ÿé”™è¯¯æ—¶é‡æ–°è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">proxy_next_upstream</span> <span style="color:#d14">error</span> <span style="color:#d14">timeout</span> <span style="color:#d14">invalid_header</span> <span style="color:#d14">http_500</span> <span style="color:#d14">http_502</span> <span style="color:#d14">http_503</span> <span style="color:#d14">http_504</span>;	
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">http://app</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§æ–‡ä»¶åˆ†ç‰‡è¯·æ±‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>-----------------------------------http_slice_module----------------------------------
</span></span><span style="display:flex;"><span>ã€å°†è¯·æ±‚çš„å¤§æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†åˆ«å‘å‡ å°åç«¯æœåŠ¡å™¨å‘é€è¯»å–è¯·æ±‚ã€‘
</span></span><span style="display:flex;"><span>Syntax:  slice size;
</span></span><span style="display:flex;"><span>Default: slice 0;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼˜åŠ¿ï¼šæ¯ä¸ªå­è¯·æ±‚æ”¶åˆ°çš„æ•°æ®éƒ½ä¼šå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œä¸€ä¸ªè¯·æ±‚æ–­äº†ï¼Œå…¶å®ƒè¯·æ±‚ä¸å—å½±å“</p>
<p>ç¼ºç‚¹ï¼šsliceè®¾ç½®ä¸åˆç†æ—¶å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦è€—å°½ç­‰æƒ…å†µ</p>
<h2 id="å…­åŠ¨é™åˆ†ç¦»">å…­ã€åŠ¨é™åˆ†ç¦»</h2>
<p>å°†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºåˆ†ç¦»ï¼Œæé«˜ç¨‹åºæ•ˆç‡ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›è€Œä¸”å½“åå°æœåŠ¡æ— æ³•æ­£å¸¸æä¾›æ—¶é™æ€æœåŠ¡ä¾æ—§å¯ç”¨ã€‚ç­–ç•¥æ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†çš„æ–¹å¼è½¬å‘è¯·æ±‚åˆ°åå°æœåŠ¡å™¨ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">upstream</span> <span style="color:#d14">api</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server</span> 192.168.1.117:<span style="color:#099">8080</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/opt/nginx/app/dynamic</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/api</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">proxy_pass</span> <span style="color:#d14">http://api</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸ƒrewriteè§„åˆ™">ä¸ƒã€rewriteè§„åˆ™</h2>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>URLè®¿é—®è·³è½¬ï¼Œæ”¯æŒå¼€å‘è®¾è®¡ï¼ˆé¡µé¢è·³è½¬ã€å…¼å®¹æ€§æ”¯æŒã€å±•ç¤ºæ•ˆæœç­‰ï¼‰</li>
<li>SEOä¼˜åŒ–ï¼Œä¾¿äºæ’åé å‰</li>
<li>ç»´æŠ¤ï¼ˆåå°ç»´æŠ¤ã€æµé‡è½¬å‘ï¼‰</li>
<li>å®‰å…¨</li>
</ol>
<p>é…ç½®è¯­æ³•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>---------------------------------http_rewrite_module---------------------------------
</span></span><span style="display:flex;"><span>Syntax:  rewrite regex replacement [flag];
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location, if
</span></span></code></pre></td></tr></table>
</div>
</div><p>flagé€‰é¡¹è¯´æ˜</p>
<table>
<thead>
<tr>
<th>å€¼</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>last</td>
<td>åœæ­¢åç»­rewriteæŒ‡ä»¤é›†ï¼Œåˆ©ç”¨ä¿®æ”¹åçš„uriåœ¨nginxä¸­é‡æ–°åŒ¹é…</td>
</tr>
<tr>
<td>break</td>
<td>åœæ­¢åç»­rewriteæŒ‡ä»¤é›†ï¼Œè¡¨ç¤ºå®Œæˆrewriteå¯»æ‰¾ç»“æœæ–‡ä»¶</td>
</tr>
<tr>
<td>redirect</td>
<td>è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œç”¨æˆ·ä¸‹æ¬¡è¿˜è®¿é—®æ­¤é“¾æ¥</td>
</tr>
<tr>
<td>permanent</td>
<td>è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜ï¼Œç”¨æˆ·ä¸‹æ¬¡ç›´æ¥è®¿é—®å³ä½¿nginxå…³é—­ä¹Ÿä¼šé‡å®šå‘é“¾æ¥</td>
</tr>
</tbody>
</table>
<p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#------------------------------------break&amp;last--------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è¯·æ±‚ http://hostname/last  ä¼šå®šä½åˆ°/testè¿”å›200å“åº”ç ï¼Œæµè§ˆå™¨åœ°å€ä¸å˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è¯·æ±‚ http://hostname/break å›å»å¯»æ‰¾rootä¸‹/testæ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°è¿”å›404å“åº”ç ï¼Œæµè§ˆå™¨åœ°å€ä¸å˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/break</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">^/break</span> <span style="color:#d14">/test</span> <span style="color:#d14">break</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/last</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">^/last</span> <span style="color:#d14">/test</span> <span style="color:#d14">last</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/test</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">default_type</span> <span style="color:#d14">application/json</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">200</span> <span style="color:#d14">&#39;</span>{<span style="color:#000;font-weight:bold">&#34;status&#34;:&#34;success&#34;}&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#---------------------------------redirect&amp;permanent---------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è¯·æ±‚ http://hostname/redirect ä¼šè¢«ä¸´æ—¶é‡å®šå‘åˆ°www.baidu.com
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è¯·æ±‚ http://hostname/permanent ä¼šè¢«æ°¸ä¹…é‡å®šå‘åˆ°www.baidu.comï¼Œä¸‹æ¬¡ä¸ä¼šå†è¯·æ±‚æ¬¡nginx
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">/redirect</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">/redirect</span> <span style="color:#d14">http://www.baidu.com</span> <span style="color:#d14">redirect</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">/permanent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">/permanent</span> <span style="color:#d14">http://www.baidu.com</span> <span style="color:#d14">permanent</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>rewirteåŠ å…¥æ§åˆ¶æµç¨‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:	 if (condition) { ... }
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>=ï¼Œ!=</td>
<td>åšæ˜¯å¦å®Œå…¨åŒ¹é…</td>
</tr>
<tr>
<td>~ï¼Œ!~</td>
<td>åŒºåˆ†å¤§å°å†™æ˜¯å¦åŒ¹é…å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>~*ï¼Œ!~*</td>
<td>ä¸åŒºåˆ†å¤§å°å†™æ˜¯å¦åŒ¹é…å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>-fï¼Œ!-f</td>
<td>æ–‡ä»¶å­˜åœ¨ï¼Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>-dï¼Œ!-d</td>
<td>ç›®å½•å­˜åœ¨ï¼Œç›®å½•æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>-e ï¼Œ!-e</td>
<td>æ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>-x ï¼Œ!-x</td>
<td>æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ</td>
</tr>
</tbody>
</table>
<p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#http://hostname/course-11-22-33.htmlä¼šå¯»æ‰¾/opt/nginx/app/course/11/22/course_33.html
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¦‚æœé¡µé¢å­˜åœ¨åˆ™è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›404
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¦‚æœè®¿é—®è·¯å¾„æœ‰è¯¯åˆ™è¿›å…¥ifåˆ¤æ–­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¦‚æœæ˜¯chromeåˆ™é‡å®šå‘åˆ°163
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™é‡å®šå‘åˆ°baidu
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> ~ <span style="color:#009926">^/course</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">/course-(\d+)-(\d+)-(\d+).html</span> <span style="color:#d14">/course/</span><span style="color:#008080">$1/$2/course_$3.html</span> <span style="color:#d14">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">(</span><span style="color:#008080">$http_user_agent</span> ~<span style="color:#009926">*</span> <span style="color:#d14">chrome)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">^/(.*)</span>$ <span style="color:#d14">http://www.163.com</span> <span style="color:#d14">redirect</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">(!-f</span> <span style="color:#008080">$request_filename</span><span style="color:#d14">)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">rewrite</span> <span style="color:#d14">^/(.*)</span>$ <span style="color:#d14">http://www.baidu.com?wd=</span><span style="color:#008080">$1</span> <span style="color:#d14">redirect</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/opt/nginx/app</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>rewirteçš„ä¼˜å…ˆçº§ï¼šhttp&gt;server&gt;location</p>
<p>ä¾‹ï¼šå°†è¯·æ±‚å…¨éƒ¨å®šå‘åˆ°ç»´æŠ¤é¡µ rewrite ^(.*)$ /pages/maintain.html break;</p>
</blockquote>
<h2 id="å…«https">å…«ã€Https</h2>
<h3 id="å¯¹ç§°åŠ å¯†åŸç†">å¯¹ç§°åŠ å¯†åŸç†</h3>
<p><img src="/img/nginx/sy-encry.png" alt="sy-encry"></p>
<h3 id="éå¯¹ç§°åŠ å¯†åŸç†">éå¯¹ç§°åŠ å¯†åŸç†</h3>
<p><img src="/img/nginx/asy-encry.png" alt="asy-encry"></p>
<h3 id="httpsåŠ å¯†åŸç†">HttpsåŠ å¯†åŸç†</h3>
<p><img src="/img/nginx/https-principle.png" alt="https-principle"></p>
<h3 id="è‡ªå»ºcaè¯ä¹¦ç”Ÿæˆéå—ä¿¡æœºæ„é¢å‘">è‡ªå»ºCAè¯ä¹¦ç”Ÿæˆï¼ˆéå—ä¿¡æœºæ„é¢å‘ï¼‰</h3>
<p>æ­¥éª¤ä¸€ï¼šç”Ÿæˆkeyå¯†é’¥</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>openssl genrsa -idea -out kun.key <span style="color:#099">1024</span>       <span style="color:#998;font-style:italic">#ideaä¸ºåŠ å¯†ç®—æ³•ï¼Œè¿‡ç¨‹ä¸­éœ€è¦å¡«å†™å¯†ç ï¼Œéœ€è¦è®°ä½</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¥éª¤äºŒï¼šç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ï¼ˆCSRæ–‡ä»¶ï¼‰</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>openssl req -new -key kun.key -out kun.csr   <span style="color:#998;font-style:italic">#å¦‚æœç»™ç¬¬ä¸‰æ–¹æœºæ„éœ€è¦æŒ‰éœ€å¡«å†™</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¥éª¤ä¸‰ï¼šç”Ÿæˆè¯ä¹¦ç­¾åæ–‡ä»¶ï¼ˆCAæ–‡ä»¶ï¼‰</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>openssl x509 -req -days <span style="color:#099">3650</span> -in kun.csr -signkey kun.key -out kun.crt <span style="color:#998;font-style:italic">#daysæœ‰æ•ˆæœŸ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™„keyè„±å¯†æ­¥éª¤</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å½“keyæ–‡ä»¶æœ‰å¯†ç æ—¶ï¼Œæ¯æ¬¡å¯åŠ¨nginxå¿…é¡»è¾“å…¥å¯†ç ï¼Œé€ æˆä¸ä¾¿</span>
</span></span><span style="display:flex;"><span>openssl rsa -in kun.key -out kun_nopass.key
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®è‹¹æœè¦æ±‚ç”Ÿæˆè¯ä¹¦æ–¹å¼</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#1ã€opensslç‰ˆæœ¬è¦æ±‚1.2ä»¥ä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#2ã€HTTPSè¯ä¹¦å¿…é¡»ä½¿ç”¨SHA256ä»¥ä¸Šå“ˆå¸Œç®—æ³•ç­¾å</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#3ã€HTTPSè¯ä¹¦å¿…é¡»ä½¿ç”¨RSA 2048ä½æˆ–ECC 256ä»¥ä¸Šå…¬é’¥ç®—æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#4ã€ä½¿ç”¨å‰å‘åŠ å¯†æŠ€æœ¯</span>
</span></span><span style="display:flex;"><span>openssl genrsa -idea -out kun.key <span style="color:#099">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-keyout ä¼šé‡æ–°ç”Ÿæˆä¸éœ€è¦å¯†ç è®¿é—®çš„key</span>
</span></span><span style="display:flex;"><span>openssl req -days <span style="color:#099">3650</span> -x509 -sha256 -nodes -newkey rsa:2048 -keyout kun.key -out kun_apple.crt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é…ç½®åº”ç”¨">é…ç½®åº”ç”¨</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>-----------------------------------http_ssl_module-----------------------------------
</span></span><span style="display:flex;"><span>ã€å¼€å¯SSlï¼Œæ­¤è¯­æ³•åœ¨1.15.0ä»¥ååºŸå¼ƒï¼Œç›´æ¥åœ¨ç›‘å¬ç«¯å£ååŠ sslå³å¯ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 ssl on | off;
</span></span><span style="display:flex;"><span>Default: ssl off;
</span></span><span style="display:flex;"><span>Context: http, server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€crtæ–‡ä»¶ä½ç½®ã€‘
</span></span><span style="display:flex;"><span>Syntax:  ssl_certificate file;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€keyæ–‡ä»¶ä½ç½®ã€‘
</span></span><span style="display:flex;"><span>Syntax:  ssl_certificate_key file;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: http, server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ssl sessionç¼“å­˜ã€‘
</span></span><span style="display:flex;"><span>Syntax:	ssl_session_cache off | none | [builtin[:size]] [shared:name:size];
</span></span><span style="display:flex;"><span>Default: ssl_session_cache none;
</span></span><span style="display:flex;"><span>Context: http, server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ã€ssl sessionç¼“å­˜æ—¶é•¿ã€‘
</span></span><span style="display:flex;"><span>Syntax:	 ssl_session_timeout time;
</span></span><span style="display:flex;"><span>Default: ssl_session_timeout 5m;
</span></span><span style="display:flex;"><span>Context: http, server
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å¦‚æœcrtæ²¡æœ‰è„±å¯†ï¼Œè¦ä½¿ç”¨nginx -c /etc/nginx/nginx.confå¯åŠ¨ï¼Œä¸å¯ä½¿ç”¨æœåŠ¡é‡å¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">server{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#ç›‘å¬443
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#d14">listen</span> <span style="color:#099">443</span> <span style="color:#d14">ssl</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span> <span style="color:#d14">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ssl_certificate</span> <span style="color:#d14">/etc/nginx/ssl_key/kun.crt</span>;     <span style="color:#998;font-style:italic">#crtæ–‡ä»¶ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">ssl_certificate_key</span> <span style="color:#d14">/etc/nginx/ssl_key/kun.key</span>; <span style="color:#998;font-style:italic">#keyæ–‡ä»¶ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">ssl_session_cache</span> <span style="color:#d14">shared:SSL:10m</span>;               <span style="color:#998;font-style:italic">#10mè´¡çŒ®ç¼“å­˜å¤§çº¦å¯å­˜å‚¨8k-10kä¼šè¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">ssl_session_timeout</span> <span style="color:#099">10m</span>;                        <span style="color:#998;font-style:italic">#10åˆ†é’Ÿsessionè¿‡æœŸ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">index</span> <span style="color:#d14">index.html</span> <span style="color:#d14">index.htm</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å»ºè®®æ¿€æ´»keepaliveé•¿è¿æ¥ã€å‡å°‘SSLæ¡æ‰‹ç½‘ç»œçš„æ¶ˆè€—ã€‘å’Œè®¾ç½®ssl sessionç¼“å­˜</p>
</blockquote>
<h2 id="ä¹nginxä¸luaå¼€å‘">ä¹ã€Nginxä¸Luaå¼€å‘</h2>
<p>Nginxç›´æ¥ä½¿ç”¨æ·»åŠ Luaæ¨¡å—å·²ç»ä¸å»ºè®®ä½¿ç”¨ï¼Œä¼šå¸¦æ¥æ•ˆç‡æŸå¤±ï¼Œå·²ç»ä¸ç¨³å®šã€‚å»ºè®®ä½¿ç”¨OpenRestyã€‚</p>
<p>OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸Luaçš„é«˜æ€§èƒ½Webå¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„Luaåº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚</p>
<h3 id="æºç å®‰è£…æ­¥éª¤">æºç å®‰è£…æ­¥éª¤</h3>
<p>ç¬¬ä¸€æ­¥ï¼šå®‰è£…pcreå’Œopenssl</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>yum install -y pcre openssl
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œæ„å»ºå‘½ä»¤</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#é…ç½®å®‰è£…æ¨¡å—ï¼Œå¯æ›´å…·ç¯å¢ƒè‡ªå·±æŒ‘é€‰ï¼Œä½¿ç”¨./configure --helpå¯æŸ¥çœ‹å¯ç¼–è¯‘æ¨¡å—</span>
</span></span><span style="display:flex;"><span>./configure --prefix<span style="color:#000;font-weight:bold">=</span>/opt/openresty <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>            --with-luajit <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>            --without-http_redis2_module <span style="color:#d14">\
</span></span></span><span style="display:flex;"><span><span style="color:#d14"></span>            --with-http_iconv_module 
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šå°†å‘½ä»¤åŠ å…¥PATHå˜é‡ã€å¯é€‰ã€‘</p>
<p>ç¬¬å››æ­¥ï¼šæµ‹è¯•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å°†ä¸€ä¸‹ä»£ç åŠ å…¥/opt/openresty/nginx/conf/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/hello_lua</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">default_type</span> <span style="color:#d14">&#39;text/plain&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">content_by_lua</span> <span style="color:#d14">&#39;ngx.say(&#34;hello,</span> <span style="color:#d14">lua&#34;)&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è®¿é—®http://hostname/hello_luaæŸ¥çœ‹æ˜¯å¦æ‰“å°å‡ºhello, lua
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginxè°ƒç”¨luaæ¨¡å—æŒ‡ä»¤é¡ºåº">Nginxè°ƒç”¨Luaæ¨¡å—æŒ‡ä»¤é¡ºåº</h3>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ—¶é—´</th>
</tr>
</thead>
<tbody>
<tr>
<td>init_by_luaã€init_by_lua_file</td>
<td>å½“nginx masterè¿›ç¨‹åœ¨åŠ è½½nginxé…ç½®æ–‡ä»¶æ—¶è¿è¡ŒæŒ‡å®šçš„luaè„šæœ¬ï¼Œé€šå¸¸ç”¨æ¥æ³¨å†Œ lua çš„å…¨å±€å˜é‡æˆ–åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶é¢„åŠ è½½luaæ¨¡å—å’Œåˆ†é…å†…å­˜</td>
</tr>
<tr>
<td>init_worker_by_luaã€init_worker_by_lua_file</td>
<td>åœ¨æ¯ä¸ªnginx workerè¿›ç¨‹å¯åŠ¨æ—¶è°ƒç”¨æŒ‡å®šçš„luaä»£ç </td>
</tr>
<tr>
<td>set_by_luaã€set_by_lua_file</td>
<td>è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œå¸¸ç”¨ä¸è®¡ç®—ä¸€ä¸ªé€»è¾‘ï¼Œç„¶åè¿”å›ç»“æœ è¯¥é˜¶æ®µä¸èƒ½è¿è¡ŒOutput APIã€Control APIã€Subrequest APIã€Cosocket API</td>
</tr>
<tr>
<td>rewrite_by_luaã€rewrite_by_lua_file</td>
<td>ä½œä¸ºrewriteé˜¶æ®µçš„å¤„ç†ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚æ‰§è¡ŒæŒ‡å®šçš„luaä»£ç </td>
</tr>
<tr>
<td>access_by_luaï¼Œaccess_by_lua_file</td>
<td>æ¯ä¸ªè¯·æ±‚åœ¨è®¿é—®é˜¶æ®µçš„è°ƒç”¨luaè„šæœ¬è¿›è¡Œå¤„ç†</td>
</tr>
<tr>
<td>content_by_luaï¼Œcontent_by_lua_file</td>
<td>ä½œä¸ºâ€œcontent handlerâ€ä¸ºæ¯ä¸ªè¯·æ±‚æ‰§è¡Œluaä»£ç ï¼Œä¸ºè¯·æ±‚è€…è¾“å‡ºå“åº”å†…å®¹</td>
</tr>
<tr>
<td>header_filter_by_luaï¼Œheader_filter_by_lua_file</td>
<td>ä¸€èˆ¬ç”¨æ¥è®¾ç½®cookieå’Œheaders</td>
</tr>
<tr>
<td>body_filter_by_luaï¼Œbody_filter_by_lua_file</td>
<td>ä¸€èˆ¬ä¼šåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­è¢«è°ƒç”¨å¤šæ¬¡, å› ä¸ºè¿™æ˜¯å®ç°åŸºäº HTTP 1.1 chunked ç¼–ç çš„æ‰€è°“â€œæµå¼è¾“å‡ºâ€çš„</td>
</tr>
<tr>
<td>log_by_luaï¼Œlog_by_lua_file</td>
<td>åœ¨logé˜¶æ®µè°ƒç”¨æŒ‡å®šçš„luaè„šæœ¬ï¼Œå¹¶ä¸ä¼šæ›¿æ¢access logï¼Œè€Œæ˜¯åœ¨é‚£ä¹‹åè¿›è¡Œè°ƒç”¨</td>
</tr>
</tbody>
</table>
<h3 id="nginx-lua-api">Nginx Lua API</h3>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ngx.cookie_time</td>
<td>è®¾ç½®cookieæ—¶é—´</td>
</tr>
<tr>
<td>ngx.ctx</td>
<td>å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡</td>
</tr>
<tr>
<td>ngx.exec</td>
<td>å†…éƒ¨é‡å®šå‘</td>
</tr>
<tr>
<td>ngx.var</td>
<td>nginxå˜é‡</td>
</tr>
<tr>
<td>ngx.req.get_header</td>
<td>è·å–è¯·æ±‚å¤´</td>
</tr>
<tr>
<td>ngx.req.get_url_args</td>
<td>è·å–urlè¯·æ±‚å‚æ•°</td>
</tr>
<tr>
<td>ngx.redirct</td>
<td>é‡å®šå‘</td>
</tr>
<tr>
<td>ngx.print</td>
<td>è¾“å‡ºå“åº”å†…å®¹ä½“</td>
</tr>
<tr>
<td>ngx.say</td>
<td>åŒngx.printï¼Œå•ä¼šåŠ å…¥æ¢è¡Œç¬¦</td>
</tr>
</tbody>
</table>
<h2 id="åå¸¸è§é—®é¢˜">åã€å¸¸è§é—®é¢˜</h2>
<h3 id="server_nameå¤šè™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§è®¿é—®">server_nameå¤šè™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§è®¿é—®</h3>
<p>å½“å‡ºç°åŒååŒç«¯å£çš„è™šæ‹Ÿä¸»æœºæ—¶ï¼Œnginxåœ¨åŠ è½½é…ç½®æ—¶ä¼šæŠ¥å†²çªè­¦å‘Šï¼Œä½†æ˜¯ä¸ä¼šæŠ¥é”™ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span> <span style="color:#099">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span> <span style="color:#d14">www.test_server1.com</span> <span style="color:#d14">www.kun.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#a61717;background-color:#e3d2d2">}</span>
</span></span><span style="display:flex;"><span><span style="color:#d14">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">listen</span> <span style="color:#099">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">server_name</span> <span style="color:#d14">www.test_server2.com</span> <span style="color:#d14">www.kun.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#a61717;background-color:#e3d2d2">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨<code>www.test_server1.com</code>æˆ–è€…<code>www.test_server2.com</code>è®¿é—®ä¼šå®šä½åˆ°ç›¸åº”çš„è™šæ‹Ÿä¸»æœº</li>
<li>ä½¿ç”¨<code>www.kun.com</code>è®¿é—®ä¼šå®šä½åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è™šæ‹Ÿä¸»æœºï¼Œå³å’Œ<code>www.test_server1.com</code>åŒå°</li>
<li>ä½¿ç”¨IPåœ°å€è®¿é—®ä¼šåŒ¹é…ç¬¬ä¸€ä¸ªå‡ºç°çš„è™šæ‹Ÿä¸»æœºï¼Œå³å’Œ<code>www.test_server1.com</code>åŒå°</li>
</ul>
<h3 id="locationåŒ¹é…ä¼˜å…ˆçº§">LocationåŒ¹é…ä¼˜å…ˆçº§</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:	 location [ = | ~ | ~* | ^~ ] uri { ... }
</span></span><span style="display:flex;"><span>         location @name { ... }
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>~ </code>å’Œ<code>~* </code>å‰ç¼€è¡¨ç¤ºæ­£åˆ™location</p>
<p><code>=</code>ï¼Œ<code>^~ </code>ã€<code>@ </code>å’Œ<code>æ— ä»»ä½•å‰ç¼€</code>çš„éƒ½å±äºæ™®é€šlocation</p>
<p>åŒ¹é…ä¼˜å…ˆçº§</p>
<ul>
<li>æ™®é€šlocationä¼˜å…ˆçº§å¤§äºæ­£åˆ™location</li>
<li>æ™®é€šlocationåŒ¹é…æ—¶ç²¾ç¡®åŒ¹é…<code>=</code>çº§åˆ«æœ€é«˜ï¼Œ<code>^~</code>å¦‚æœåŒæ—¶åŒ¹é…ä¸Šå¤šä¸ªï¼ŒåŒ¹é…é•¿åº¦æœ€é•¿çš„ä¼˜å…ˆï¼ˆæœ€å¤§å‰ç¼€åŒ¹é…ï¼‰</li>
<li>æ­£åˆ™locationåŒ¹é…æ—¶è°ç‰©ç†é¡ºåºå…ˆï¼Œè°æœ€ä¼˜å…ˆ</li>
<li>å½“æ™®é€šlocationä¸­çš„å‰ç¼€åŒ¹é…å’Œæ­£åˆ™åŒ¹é…å‡å­˜åœ¨æ—¶ã€‚åŒ¹é…åˆ°æœ€å¤§å‰ç¼€åŒ¹é…ä¹‹åç»§ç»­æ­£åˆ™åŒ¹é…ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…ä¸Šåˆ™è¦†ç›–å‰ç¼€åŒ¹é…ç»“æœ</li>
<li>å¦‚æœä½¿ç”¨<code>=</code>æˆ–è€…<code>^~</code>æ—¶ï¼Œä¼šç»ˆæ­¢åç»­çš„æ­£åˆ™åŒ¹é…</li>
</ul>
<h3 id="try_filesçš„ä½¿ç”¨">try_filesçš„ä½¿ç”¨</h3>
<p>å½“èµ„æºæ–‡ä»¶æœªæ‰¾åˆ°æ—¶çš„è‡ªå®šä¹‰å¤„ç†</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:	 try_files file ... uri;
</span></span><span style="display:flex;"><span>         try_files file ... =code;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®ç¤ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span>   <span style="color:#d14">/opt/nginx/app/try_files</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try_files</span> <span style="color:#008080">$uri</span>  <span style="color:#d14">@resource_not_ready</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#èµ„æºæœªæ‰¾åˆ°ï¼Œç›´æ¥è¿”å›é¡µé¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">@resource_not_ready</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;200&#34;</span> <span style="color:#d14">&#34;èµ„æºæœªå‡†å¤‡å¥½ï¼Œè¯·ç¨åå†è¯•&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="aliaså’ŒrootåŒºåˆ«">aliaså’ŒrootåŒºåˆ«</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#----------------------------------------root----------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/request_path/image/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">root</span> <span style="color:#d14">/local_path/image/</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è®¿é—® http:www.kun.com/request_path/image/cat.png
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ–‡ä»¶ /local_path/image/request_path/image/cat.png
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#----------------------------------------root----------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">/request_path/image/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">alias</span> <span style="color:#d14">/local_path/image/</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è®¿é—® http:www.kun.com/request_path/image/cat.png
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ–‡ä»¶ /local_path/image/cat.png
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¦‚ä½•è·å–ç”¨æˆ·çš„çœŸå®ip">å¦‚ä½•è·å–ç”¨æˆ·çš„çœŸå®IP</h3>
<p><img src="/img/nginx/Real-IP.png" alt="Real-IP"></p>
<p>åœ¨ç¬¬ä¸€å±‚ä»£ç†è®¾ç½®<code>X-Real-IP</code>ï¼Œåç»­ä»£ç†ä¸å¯è®¾ç½®æ­¤å¤´ä¿¡æ¯</p>
<h3 id="å¸¸è§é”™è¯¯ç ">å¸¸è§é”™è¯¯ç </h3>
<p>Nginx:413 Request Entity Too Large</p>
<p>åŸå› ï¼šç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶å¤§å°å—é™ï¼ˆæ–‡ä»¶ä¿¡æ¯åœ¨request bodyå†…ï¼‰</p>
<p>è§£å†³æ–¹æ¡ˆï¼šåˆç†è®¾ç½®client_max_body_sizeå¤§å°</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Syntax:  client_max_body_size size;
</span></span><span style="display:flex;"><span>Default: client_max_body_size 1m;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>502 bad gateway</p>
<p>åŸå› ï¼šåç«¯æœåŠ¡æœªå“åº”</p>
<hr>
<p>504 Gateway Time-out</p>
<p>åŸå› ï¼šåç«¯æœåŠ¡æ‰§è¡Œè¶…æ—¶</p>
<h2 id="åä¸€nginxæ€§èƒ½ä¼˜åŒ–">åä¸€ã€Nginxæ€§èƒ½ä¼˜åŒ–</h2>
<h3 id="æ–‡ä»¶å¥æŸ„è®¾ç½®">æ–‡ä»¶å¥æŸ„è®¾ç½®</h3>
<p><strong>ç³»ç»Ÿæ§åˆ¶</strong></p>
<p>ä¿®æ”¹<code>/etc/security/limits.conf</code>é…ç½®ï¼Œæ·»åŠ nginxç”¨æˆ·é™åˆ¶</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">nginx    hard    nproc    65535
nginx    soft    nproc    65535
</code></pre><p><strong>nginxå†…éƒ¨æ§åˆ¶</strong></p>
<p>æ­¤è®¾ç½®å€¼è¦è®¾ç½®æ¯”ç³»ç»Ÿæ§åˆ¶å°</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">worker_rlimit_core</span> <span style="color:#099">65535</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cpuäº²å’Œ">CPUäº²å’Œ</h3>
<p>ä½¿ç”¨<code>cat /proc/cpuinfo | grep &quot;processor&quot;</code>æŸ¥çœ‹å½“å‰CPUæ ¸å¿ƒæ•°</p>
<p>ä½¿ç”¨<code>ps -eo pid,args,psr |grep nginx</code>æŸ¥çœ‹è¿›ç¨‹è¿è¡Œåœ¨å“ªäº›CPUæ ¸å¿ƒ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">worker_processes</span>  <span style="color:#099">4</span>;                     <span style="color:#998;font-style:italic">#è®¾ç½®nginxè¿›ç¨‹æ•°å»ºè®®å’ŒCPUæ ¸å¿ƒæ•°ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#worker_cpu_affinity 0001 0010 0100 1000 #æŒ‡å®šç»‘å®šçš„CPUæ ¸å¿ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#worker_cpu_affinity auto;               #è‡ªåŠ¨ç»‘å®š
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é€šç”¨é…ç½®ä¼˜åŒ–">é€šç”¨é…ç½®ä¼˜åŒ–</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">user</span>  <span style="color:#d14">nginx</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">worker_processes</span>  <span style="color:#099">4</span>;      <span style="color:#998;font-style:italic">#å»ºè®®å’ŒCPUæ ¸å¿ƒæ•°ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">worker_cpu_affinity</span> <span style="color:#d14">auto</span>; <span style="color:#998;font-style:italic">#è‡ªåŠ¨ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">error_log</span>  <span style="color:#d14">/var/log/nginx/error.log</span> <span style="color:#d14">warn</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">pid</span>        <span style="color:#d14">/var/run/nginx.pid</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">use</span> <span style="color:#d14">epoll</span>;                  <span style="color:#998;font-style:italic">#ä½¿ç”¨epollæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">worker_connections</span>  <span style="color:#099">10240</span>;  <span style="color:#998;font-style:italic">#è°ƒèŠ‚è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">include</span>       <span style="color:#d14">/etc/nginx/mime.types</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">default_type</span>  <span style="color:#d14">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">charset</span> <span style="color:#d14">utf-8</span>;     <span style="color:#998;font-style:italic">#è®¾ç½®å­—ç¬¦é›†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">log_format</span>  <span style="color:#d14">main</span>  <span style="color:#d14">&#39;</span><span style="color:#008080">$remote_addr</span> <span style="color:#d14">-</span> <span style="color:#008080">$remote_user</span> <span style="color:#d14">[</span><span style="color:#008080">$time_local]</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$request&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;</span><span style="color:#008080">$status</span> <span style="color:#008080">$body_bytes_sent</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_referer&#34;</span> <span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d14">&#39;&#34;</span><span style="color:#008080">$http_user_agent&#34;</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">access_log</span>  <span style="color:#d14">/var/log/nginx/access.log</span>  <span style="color:#d14">main</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">sendfile</span>        <span style="color:#008080">on</span>;     <span style="color:#998;font-style:italic">#ä½¿ç”¨sendfile
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">tcp_nopush</span>      <span style="color:#008080">on</span>;     <span style="color:#998;font-style:italic">#å°½é‡å¤šçš„åˆå¹¶åŒ…å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">#tcp_nodeny     on;     #å®æ—¶æ€§è¾ƒé«˜çš„åœºæ‰€å¯ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">keepalive_timeout</span>  <span style="color:#099">65</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">gzip</span>  <span style="color:#008080">on</span>;                   <span style="color:#998;font-style:italic">#å¼€å¯å‹ç¼©
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_disable</span> <span style="color:#d14">&#34;MIS</span> <span style="color:#d14">[1-6]\.&#34;</span>; <span style="color:#998;font-style:italic">#å¯¹IEå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">gzip_http_version</span> <span style="color:#099">1</span><span style="color:#d14">.1</span>;      <span style="color:#998;font-style:italic">#ç‰ˆæœ¬1.1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">include</span> <span style="color:#d14">/etc/nginx/conf.d/*.conf</span>;
</span></span><span style="display:flex;"><span>}                 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åäºŒnginx_luaé˜²ç«å¢™">åäºŒã€Nginx_Luaé˜²ç«å¢™</h2>
<p>ngx_lua_wafå¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨å®˜æ–¹çš„<a href="https://docs.nginx.com/nginx/admin-guide/dynamic-modules/nginx-waf">wafæ¨¡å—</a></p>
<p><a href="https://github.com/loveshell/ngx_lua_waf">Nginx-Luaå¼€æºé˜²ç«å¢™ä¸‹è½½åœ°å€</a></p>
<p><strong>å®‰è£…æ­¥éª¤</strong></p>
<ul>
<li>
<p>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºæ–‡ä»¶å¤¹æ”¾ç½®waf</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å­˜æ”¾Nginx_Lua</span>
</span></span><span style="display:flex;"><span>mkdir /etc/nginx/waf
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç¬¬äºŒæ­¥ï¼šè§£å‹æ–‡ä»¶å½“wafç›®å½•ä¸‹</p>
</li>
<li>
<p>ç¬¬ä¸‰æ­¥ï¼šnginx.confçš„httpæ®µåŠ å…¥é…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">lua_package_path</span> <span style="color:#d14">&#34;/etc/nginx/waf/?.lua&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">lua_shared_dict</span> <span style="color:#d14">limit</span> <span style="color:#099">10m</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">init_by_lua_file</span>   <span style="color:#d14">/etc/nginx/waf/init.lua</span>;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">access_by_lua_file</span> <span style="color:#d14">/etc/nginx/waf/waf.lua</span>;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç¬¬å››æ­¥ï¼šä¿®æ”¹<code>/etc/nginx/waf/config.lua</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>RulePath <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/etc/nginx/waf/wafconf/&#34;</span>    <span style="color:#998;font-style:italic">--wafconfè§„åˆ™ç›®å½•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>attacklog <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;on&#34;</span>                        <span style="color:#998;font-style:italic">--æ˜¯å¦å¼€å¯æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>logdir <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/var/log/nginx/hack/&#34;</span>         <span style="color:#998;font-style:italic">--hackæ–‡ä»¶å¤¹éœ€è¦æ–°å»º</span>
</span></span><span style="display:flex;"><span>UrlDeny<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                            <span style="color:#998;font-style:italic">--æ˜¯å¦æ‹¦æˆªurlè®¿é—®</span>
</span></span><span style="display:flex;"><span>Redirect<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                           <span style="color:#998;font-style:italic">--æ‹¦æˆªåæ˜¯å¦é‡å®šå‘</span>
</span></span><span style="display:flex;"><span>CookieMatch<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                        <span style="color:#998;font-style:italic">--æ˜¯å¦æ‹¦æˆªcookieæ”»å‡»</span>
</span></span><span style="display:flex;"><span>postMatch<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                          <span style="color:#998;font-style:italic">--æ˜¯å¦æ‹¦æˆªpostæ”»å‡»</span>
</span></span><span style="display:flex;"><span>whiteModule<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                        <span style="color:#998;font-style:italic">--æ˜¯å¦å¼€å¯URLç™½åå•</span>
</span></span><span style="display:flex;"><span>black_fileExt<span style="color:#000;font-weight:bold">=</span>{<span style="color:#d14">&#34;php&#34;</span>,<span style="color:#d14">&#34;jsp&#34;</span>}             <span style="color:#998;font-style:italic">--å¡«å†™ä¸å…è®¸ä¸Šä¼ æ–‡ä»¶åç¼€ç±»å‹</span>
</span></span><span style="display:flex;"><span>ipWhitelist<span style="color:#000;font-weight:bold">=</span>{<span style="color:#d14">&#34;127.0.0.1&#34;</span>}               <span style="color:#998;font-style:italic">--ipç™½åå•ï¼Œå¤šä¸ªipç”¨é€—å·åˆ†éš”</span>
</span></span><span style="display:flex;"><span>ipBlocklist<span style="color:#000;font-weight:bold">=</span>{<span style="color:#d14">&#34;1.0.0.1&#34;</span>}                 <span style="color:#998;font-style:italic">--ipé»‘åå•ï¼Œå¤šä¸ªipç”¨é€—å·åˆ†éš”</span>
</span></span><span style="display:flex;"><span>CCDeny<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on&#34;</span>                             <span style="color:#998;font-style:italic">--æ˜¯å¦å¼€å¯æ‹¦æˆªccæ”»å‡»</span>
</span></span><span style="display:flex;"><span>CCrate<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;100/60&#34;</span>                         <span style="color:#998;font-style:italic">--è®¾ç½®ccæ”»å‡»é¢‘ç‡ï¼Œå•ä½ä¸ºç§’.æ¯åˆ†é’Ÿé»˜è®¤é’ŸåŒä¸€ä¸ªIPåªèƒ½è¯·æ±‚åŒä¸€ä¸ªåœ°å€100æ¬¡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--è­¦å‘Šå†…å®¹,å¯åœ¨ä¸­æ‹¬å·å†…è‡ªå®šä¹‰</span>
</span></span><span style="display:flex;"><span>html<span style="color:#000;font-weight:bold">=</span>[[
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>html xmlns<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;http://www.w3.org/1999/xhtml&#34;</span><span style="color:#000;font-weight:bold">&gt;&lt;</span>head<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>meta http<span style="color:#000;font-weight:bold">-</span>equiv<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;Content-Type&#34;</span> content<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/html; charset=utf-8&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>title<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#a61717;background-color:#e3d2d2">ç½‘ç«™é˜²ç«å¢™</span><span style="color:#000;font-weight:bold">&lt;/</span>title<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>style<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>p {
</span></span><span style="display:flex;"><span>        line<span style="color:#000;font-weight:bold">-</span>height:<span style="color:#099">20</span>px;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>ul{ list<span style="color:#000;font-weight:bold">-</span>style<span style="color:#000;font-weight:bold">-</span>type:none;}
</span></span><span style="display:flex;"><span>li{ list<span style="color:#000;font-weight:bold">-</span>style<span style="color:#000;font-weight:bold">-</span>type:none;}
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>style<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>head<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>body style<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34; padding:0; margin:0; font:14px/1.5 Microsoft Yahei, å®‹ä½“,sans-serif; color:#555;&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>é‡æ–°åŠ è½½nginxé…ç½®æ–‡ä»¶å³å¯</p>
</li>
</ul>
<h2 id="é™„å½•">é™„å½•</h2>
<h3 id="curlå‘½ä»¤">curlå‘½ä»¤</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://www.baidu.com                                      <span style="color:#998;font-style:italic">#ä»…è¿”å›æœåŠ¡ç«¯çš„çš„å“åº”æŠ¥æ–‡</span>
</span></span><span style="display:flex;"><span>curl -v http://www.baidu.com &gt;/dev/null                        <span style="color:#998;font-style:italic">#è¿”å›è¯·æ±‚å¤´å’Œå“åº”å¤´ä¿¡æ¯å¹¶å°†å“åº”æŠ¥æ–‡é‡å®šå‘ç©ºè®¾å¤‡</span>
</span></span><span style="display:flex;"><span>curl -I http://192.168.1.155/wei.png                           <span style="color:#998;font-style:italic">#Iä»…æŸ¥çœ‹è¿”å›å¤´ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>curl -I http://192.168.1.155/wei.png -e <span style="color:#d14">&#34;http://www.baidu.com&#34;</span> <span style="color:#998;font-style:italic">#eè®¾ç½®refererå€¼</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="abå‘½ä»¤">abå‘½ä»¤</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ab -n50 -c20 http://www.baidu.com/       <span style="color:#998;font-style:italic">#å‹æµ‹å‘½ä»¤ï¼Œnä»£è¡¨è¯·æ±‚æ€»ä¸ªæ•°ï¼Œcä»£è¡¨åŒæ—¶å¹¶å‘ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>ab -n50 -c20 -k http://www.baidu.com/    <span style="color:#998;font-style:italic">#-kä»£è¡¨é•¿è¿æ¥ </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‡æ ‡å±•ç¤º</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Server Software:        BWS/1.1
</span></span><span style="display:flex;"><span>Server Hostname:        www.baidu.com
</span></span><span style="display:flex;"><span>Server Port:            80
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Document Path:          /
</span></span><span style="display:flex;"><span>Document Length:        153380 bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Concurrency Level:      20              #å¹¶å‘çº§åˆ«
</span></span><span style="display:flex;"><span>Time taken for tests:   3.636 seconds   #èŠ±è´¹æ€»æ—¶æ‰
</span></span><span style="display:flex;"><span>Complete requests:      50              #å®Œæˆè¯·æ±‚ä¸ªæ•°
</span></span><span style="display:flex;"><span>Failed requests:        45              #å¤±è´¥ä¸ªæ•°
</span></span><span style="display:flex;"><span>   (Connect: 0, Receive: 0, Length: 45, Exceptions: 0)
</span></span><span style="display:flex;"><span>Write errors:           0
</span></span><span style="display:flex;"><span>Keep-Alive requests:    0
</span></span><span style="display:flex;"><span>Total transferred:      7728364 bytes
</span></span><span style="display:flex;"><span>HTML transferred:       7680157 bytes
</span></span><span style="display:flex;"><span>Requests per second:    13.75 [#/sec] (mean)          #QPSã€æ¯ç§’è¯·æ±‚é‡ã€‘
</span></span><span style="display:flex;"><span>Time per request:       1454.312 [ms] (mean)          #ä¸€ä¸ªè¯·æ±‚æ¶ˆè€—çš„æ—¶é—´
</span></span><span style="display:flex;"><span>Time per request:       72.716 [ms] (mean, across all concurrent requests) #æœåŠ¡ç«¯å¤„ç†è¯·æ±‚æ—¶é—´ï¼Œä¸åŒ…å«ç½‘ç»œæ—¶é—´
</span></span><span style="display:flex;"><span>Transfer rate:          2075.82 [Kbytes/sec] received                      #ç½‘ç»œä¼ è¾“é€Ÿç‡
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connection Times (ms)
</span></span><span style="display:flex;"><span>              min  mean[+/-sd] median   max
</span></span><span style="display:flex;"><span>Connect:        4    8   2.0      9      14
</span></span><span style="display:flex;"><span>Processing:   358 1288 716.1   1075    3609
</span></span><span style="display:flex;"><span>Waiting:        9  196 157.0    193     576
</span></span><span style="display:flex;"><span>Total:        366 1296 716.6   1086    3617
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Percentage of the requests served within a certain time (ms)
</span></span><span style="display:flex;"><span>  50%   1086						
</span></span><span style="display:flex;"><span>  66%   1408
</span></span><span style="display:flex;"><span>  75%   1570
</span></span><span style="display:flex;"><span>  80%   1932
</span></span><span style="display:flex;"><span>  90%   2421
</span></span><span style="display:flex;"><span>  95%   2853
</span></span><span style="display:flex;"><span>  98%   3617
</span></span><span style="display:flex;"><span>  99%   3617
</span></span><span style="display:flex;"><span> 100%   3617 (longest request)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="gzipå‘½ä»¤">gzipå‘½ä»¤</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gzip â€“c filename &gt; filename.gz  <span style="color:#998;font-style:italic">#å‹ç¼©ä¸ºgzipæ ¼å¼ï¼Œå¹¶ä¿ç•™æºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>gunzip filename                 <span style="color:#998;font-style:italic">#è§£å‹gzipæ–‡ä»¶haproxy</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
