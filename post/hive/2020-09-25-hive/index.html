<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="hiveä½¿ç”¨ - https://hobocat.github.io/post/hive/2020-09-25-hive/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>hiveä½¿ç”¨</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">hiveä½¿ç”¨</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2020-09-25&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            7707 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            16 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€hiveçš„æ¦‚å¿µ">ä¸€ã€Hiveçš„æ¦‚å¿µ</a></li>
    <li><a href="#äºŒå®‰è£…éƒ¨ç½²hivejdbc">äºŒã€å®‰è£…éƒ¨ç½²&amp;HiveJDBC</a>
      <ul>
        <li><a href="#å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</a></li>
        <li><a href="#hivejdbc">HiveJDBC</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰ddlè¯­å¥">ä¸‰ã€DDLè¯­å¥</a>
      <ul>
        <li><a href="#æ“ä½œæ•°æ®åº“è¯­å¥">æ“ä½œæ•°æ®åº“è¯­å¥</a></li>
        <li><a href="#æ“ä½œè¡¨">æ“ä½œè¡¨</a></li>
      </ul>
    </li>
    <li><a href="#å››dmlè¯­å¥">å››ã€DMLè¯­å¥</a>
      <ul>
        <li><a href="#æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</a></li>
        <li><a href="#æ•°æ®å¯¼å‡ºæ•°æ®å¯¼å…¥">æ•°æ®å¯¼å‡º&amp;æ•°æ®å¯¼å…¥</a></li>
        <li><a href="#æ¸…é™¤è¡¨æ•°æ®">æ¸…é™¤è¡¨æ•°æ®</a></li>
      </ul>
    </li>
    <li><a href="#äº”dqlè¯­å¥">äº”ã€DQLè¯­å¥</a>
      <ul>
        <li><a href="#æ’åº">æ’åº</a></li>
        <li><a href="#åˆ†æ¡¶æŸ¥è¯¢">åˆ†æ¡¶æŸ¥è¯¢</a></li>
        <li><a href="#å¸¸ç”¨å‡½æ•°">å¸¸ç”¨å‡½æ•°</a></li>
      </ul>
    </li>
    <li><a href="#å…­å‡½æ•°">å…­ã€å‡½æ•°</a>
      <ul>
        <li><a href="#æŸ¥çœ‹ç³»ç»Ÿå†…ç½®å‡½æ•°">æŸ¥çœ‹ç³»ç»Ÿå†…ç½®å‡½æ•°</a></li>
        <li><a href="#è‡ªå®šä¹‰å‡½æ•°">è‡ªå®šä¹‰å‡½æ•°</a></li>
        <li><a href="#è‡ªå®šä¹‰å‡½æ•°æ­¥éª¤">è‡ªå®šä¹‰å‡½æ•°æ­¥éª¤</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒsnappyå‹ç¼©æ–‡ä»¶æ ¼å¼">ä¸ƒã€Snappyå‹ç¼©&amp;æ–‡ä»¶æ ¼å¼</a>
      <ul>
        <li><a href="#snappyå‹ç¼©">Snappyå‹ç¼©</a></li>
        <li><a href="#æ–‡ä»¶æ ¼å¼">æ–‡ä»¶æ ¼å¼</a></li>
      </ul>
    </li>
    <li><a href="#å…«ä¼˜åŒ–">å…«ã€ä¼˜åŒ–</a>
      <ul>
        <li><a href="#fetchæŠ“å–">FetchæŠ“å–</a></li>
        <li><a href="#æœ¬åœ°æ¨¡å¼">æœ¬åœ°æ¨¡å¼</a></li>
        <li><a href="#è¡¨æŸ¥è¯¢ä¼˜åŒ–">è¡¨æŸ¥è¯¢ä¼˜åŒ–</a></li>
        <li><a href="#mrä¼˜åŒ–">MRä¼˜åŒ–</a></li>
        <li><a href="#å¹¶è¡Œæ‰§è¡Œ">å¹¶è¡Œæ‰§è¡Œ</a></li>
        <li><a href="#ä¸¥æ ¼æ¨¡å¼">ä¸¥æ ¼æ¨¡å¼</a></li>
        <li><a href="#hadoopå¼€å¯jvmé‡ç”¨æ¨æµ‹æ‰§è¡Œhttpsmynamelancelotgithubiohadoophadoophtml"><a href="https://mynamelancelot.github.io/hadoop/hadoop.html">Hadoopå¼€å¯JVMé‡ç”¨&amp;æ¨æµ‹æ‰§è¡Œ</a></a></li>
        <li><a href="#æ‰§è¡Œè®¡åˆ’">æ‰§è¡Œè®¡åˆ’</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€hiveçš„æ¦‚å¿µ">ä¸€ã€Hiveçš„æ¦‚å¿µ</h2>
<p>Hiveç”±Facebookå¼€æºåŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œç”¨äºè§£å†³æµ·é‡ç»“æ„åŒ–æ—¥å¿—çš„æ•°æ®ç»Ÿè®¡ï¼ŒHiveå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ è¡¨ï¼Œå¹¶æä¾›ç±»SQL æŸ¥è¯¢åŠŸèƒ½ã€æœ¬è´¨æ˜¯å°†HQLè½¬åŒ–æˆMapReduceç¨‹åºã€‘</p>
<p><strong>Hiveçš„æ‰§è¡ŒåŸç†</strong></p>
<img src="/img/hive/HIVE-concept.png" alt="HIVE-concept" style="zoom:67%;" />
<p>1ï¼‰Hiveå¤„ç†çš„æ•°æ®å­˜å‚¨åœ¨HDFS</p>
<p>2ï¼‰Hiveåˆ†ææ•°æ®åº•å±‚çš„é»˜è®¤å®ç°æ˜¯MapReduce</p>
<p>3ï¼‰æ‰§è¡Œç¨‹åºè¿è¡Œåœ¨Yarnä¸Š</p>
<p><strong>Hiveçš„ä¼˜ç‚¹ï¼š</strong></p>
<p>1ï¼‰æ“ä½œæ¥å£é‡‡ç”¨ç±»SQLè¯­æ³•ï¼Œæä¾›å¿«é€Ÿå¼€å‘çš„èƒ½åŠ›ï¼ˆç®€å•ã€å®¹æ˜“ä¸Šæ‰‹ï¼‰</p>
<p>2ï¼‰é¿å…äº†å»å†™MapReduceï¼Œå‡å°‘å¼€å‘äººå‘˜çš„å­¦ä¹ æˆæœ¬</p>
<p>3ï¼‰Hive ä¼˜åŠ¿åœ¨äºå¤„ç†å¤§æ•°æ®ï¼Œå¯¹äºå¤„ç†å°æ•°æ®æ²¡æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºHive çš„æ‰§è¡Œå»¶è¿Ÿæ¯”è¾ƒé«˜</p>
<p>4ï¼‰Hive æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®ç°è‡ªå·±çš„å‡½æ•°</p>
<p><strong>Hiveçš„ç¼ºç‚¹ï¼š</strong></p>
<p>1ï¼‰Hive çš„æ‰§è¡Œå»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œå› æ­¤Hive å¸¸ç”¨äºæ•°æ®åˆ†æï¼Œå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºåˆ</p>
<p>2ï¼‰Hive è‡ªåŠ¨ç”Ÿæˆçš„MapReduce ä½œä¸šï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸å¤Ÿæ™ºèƒ½åŒ–ï¼Œè°ƒä¼˜æ¯”è¾ƒå›°éš¾ï¼Œç²’åº¦è¾ƒç²—</p>
<p>3ï¼‰è¿­ä»£å¼ç®—æ³•æ— æ³•è¡¨è¾¾ï¼Œæ•°æ®æŒ–æ˜æ–¹é¢ä¸æ“…é•¿</p>
<p><strong>Hiveçš„æ¶æ„åŸç†</strong></p>
<img src="/img/hive/HIVE-sturct.png" style="zoom: 67%;" />
<p><strong>Hiveçš„æ•°æ®ç±»å‹</strong></p>
<ul>
<li><code>tinyint</code>/<code>samlint</code>/<code>int</code>/<code>bigint</code>/<code>float</code>/<code>double</code></li>
<li><code>boolean</code></li>
<li><code>string</code></li>
<li><code>timestamp</code></li>
<li><code>binary</code></li>
<li><code>struct</code></li>
<li><code>map</code></li>
<li><code>array</code></li>
</ul>
<p><strong>Hiveçš„äº¤äº’æ–¹å¼</strong></p>
<p>â‘ hiveç™»é™†ï¼›â‘¡HiveJDBCï¼›â‘¢<code>hive -e &quot;cmd&quot;</code>ç›´æ¥å¾—åˆ°ç»“æœï¼›â‘£æ‰§è¡ŒSQLæ–‡ä»¶<code>bin/hive -f hive_file.sql</code></p>
<h2 id="äºŒå®‰è£…éƒ¨ç½²hivejdbc">äºŒã€å®‰è£…éƒ¨ç½²&amp;HiveJDBC</h2>
<h3 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</h3>
<p><a href="https://hive.apache.org/downloads.html">ä¸‹è½½hive</a>è§£å‹ï¼Œé…ç½®</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ‹·è´<code>conf/hive-env.sh.template </code>ä¸º<code>conf/hive-env.sh</code>å¹¶é…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#008080">HADOOP_HOME</span><span style="color:#000;font-weight:bold">=</span>/opt/module/hadoop
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">HIVE_CONF_DIR</span><span style="color:#000;font-weight:bold">=</span>/opt/module/hive/conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šæ‹·è´MySQLé©±åŠ¨åˆ°hiveçš„<code>lib</code>æ–‡ä»¶å¤¹ä¸‹</p>
<p>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º<code>conf/hive-site.xml</code>æ–‡ä»¶é…ç½®MySQL</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;configuration.xsl&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>javax.jdo.option.ConnectionURL<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>jdbc:mysql://192.168.22.1:3306/hive?createDatabaseIfNotExist=true<span style="color:#800080">&amp;amp;</span>useUnicode=true<span style="color:#800080">&amp;amp;</span>characterEncoding=utf-8<span style="color:#800080">&amp;amp;</span>allowMultiQueries=true<span style="color:#800080">&amp;amp;</span>rewriteBatchedStatements=true<span style="color:#800080">&amp;amp;</span>serverTimezone=Asia/Shanghai<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>javax.jdo.option.ConnectionDriverName<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>com.mysql.cj.jdbc.Driver<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!-- hiveè¿æ¥è´¦æˆ·å¯†ç  --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>javax.jdo.option.ConnectionUserName<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>root<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>javax.jdo.option.ConnectionPassword<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>123456<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!-- æ•°æ®å­˜å‚¨åœ¨HDFSçš„ç›®å½• --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>hive.metastore.warehouse.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>/user/hive/warehouse<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!-- è¿”å›è¡¨å¤´ --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>hive.cli.print.header<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!-- è¿”å›å½“å‰çš„åº“ --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>hive.cli.print.current.db<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å››æ­¥ï¼šé…ç½®æ—¥å¿—</p>
<p>æ‹·è´ <code>conf/hive-log4j2.properties.template</code>åˆ°<code>conf/hive-log4j2.properties</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># logç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">property.hive.log.dir</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">/opt/module/hive/log</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–å…ƒæ•°æ®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>schematool -dbType mysql -initSchema
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hivejdbc">HiveJDBC</h3>
<p><strong>å¼€å¯HiveJDBCæœåŠ¡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nohup bin/hiveserver2 &gt; hiveserver2.log 2&gt;&amp;<span style="color:#099">1</span> &amp;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>beelineè¿æ¥</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bin/beeline
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># è¿›å…¥ä¹‹åè¿æ¥</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># !connect jdbc:hive2://centos162:10000 </span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸‰ddlè¯­å¥">ä¸‰ã€DDLè¯­å¥</h2>
<h3 id="æ“ä½œæ•°æ®åº“è¯­å¥">æ“ä½œæ•°æ®åº“è¯­å¥</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ########################################## å»ºåº“è¯­å¥ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>db_emp;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>db_emp;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>db_emp<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">location</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;/hive/resposistion/db_emp&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## æŸ¥è¯¢åº“è¯­å¥ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>databases;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>extended<span style="color:#bbb"> </span>db_emp;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ####################################### ä¿®æ”¹å±æ€§ã€æ·»åŠ è‡ªå®šä¹‰å±æ€§ã€‘########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>db_emp<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>dbproperties(<span style="color:#d14">&#39;createOwn&#39;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;kun&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## åˆ åº“è¯­å¥ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- åˆ é™¤è¯­å¥ã€åˆ é™¤ç©ºæ•°æ®åº“ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">drop</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>db_emp;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¼ºåˆ¶åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">drop</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">database</span><span style="color:#bbb"> </span>db_emp<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">cascade</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## åˆ‡åº“è¯­å¥ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>use<span style="color:#bbb"> </span>db_emp;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ“ä½œè¡¨">æ“ä½œè¡¨</h3>
<p>ç®¡ç†è¡¨ã€å†…éƒ¨è¡¨ã€‘ï¼šåˆ é™¤æ—¶å…ƒæ•°æ®å’ŒHDFSå­˜å‚¨æ•°æ®ä¸€èµ·åˆ é™¤</p>
<p>å¤–éƒ¨è¡¨ï¼šåˆ é™¤æ—¶åªåˆ é™¤å…ƒæ•°æ®</p>
<h4 id="æ“ä½œä¸€èˆ¬è¡¨">æ“ä½œä¸€èˆ¬è¡¨</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ########################################## æŸ¥è¯¢è¡¨ç»“æ„ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span>extended<span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span>formatted<span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## åˆ›å»ºè¡¨ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ç›´æ¥åˆ›å»ºè¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">external</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>student(id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>string);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ä½¿ç”¨åˆ«çš„è¡¨çš„æŸ¥è¯¢æ•°æ®åˆ›å»ºè¡¨ï¼Œä¸å…è®¸ä½¿ç”¨å¤–éƒ¨è¡¨æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>student_new<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ä½¿ç”¨åˆ«çš„è¡¨ç»“æ„åˆ›å»ºè¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">external</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>student_like<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">like</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ›å»ºè¡¨ä½¿ç”¨å„ç§åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ•°æ®æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- kangkang,lili_xiangxiang,lili:18_xiangxiang:19,fengtai_beijing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- YueYue,lili_sisi,lili:18_sisi:19,daxiao_beijing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>persion_info(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>name<span style="color:#bbb"> </span>string,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>friends<span style="color:#bbb"> </span><span style="color:#0086b3">array</span><span style="color:#000;font-weight:bold">&lt;</span>string<span style="color:#000;font-weight:bold">&gt;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>children<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">map</span><span style="color:#000;font-weight:bold">&lt;</span>string,<span style="color:#0086b3">int</span><span style="color:#000;font-weight:bold">&gt;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>address<span style="color:#bbb"> </span>struct<span style="color:#000;font-weight:bold">&lt;</span>stree:string,<span style="color:#bbb"> </span>city:string<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;,&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>collection<span style="color:#bbb"> </span>items<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;_&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">map</span><span style="color:#bbb"> </span>keys<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;:&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>lines<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\n&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## ä¿®æ”¹è¡¨ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- è¡¨ç±»å‹è½¬æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>tblproperties(<span style="color:#d14">&#39;EXTERNAL&#39;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;TRUE&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>tblproperties(<span style="color:#d14">&#39;EXTERNAL&#39;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;FALSE&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- é‡å‘½å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition_old<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">rename</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">to</span><span style="color:#bbb"> </span>student_partition_new;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ä¿®æ”¹åˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span>change<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">column</span><span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>stu_id<span style="color:#bbb"> </span>string;<span style="color:#998;font-style:italic">-- å¢åŠ åˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¢åŠ åˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">add</span><span style="color:#bbb"> </span>columns(sex<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>age<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ›¿æ¢åˆ—ã€å…¨é‡ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">replace</span><span style="color:#bbb"> </span>columns(id<span style="color:#bbb"> </span>string,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>string,<span style="color:#bbb"> </span>sex<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ é™¤è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">drop</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ“ä½œåˆ†åŒºè¡¨">æ“ä½œåˆ†åŒºè¡¨</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ########################################## åˆ›å»ºåˆ†åŒºè¡¨ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- åˆ›å»ºåˆ†åŒºè¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>student_partition(id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>string)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>partitioned<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">year</span><span style="color:#bbb"> </span>string)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ›å»ºäºŒçº§åˆ†åŒºè¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">exists</span><span style="color:#bbb"> </span>student_partition(id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>string)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>partitioned<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">month</span><span style="color:#bbb"> </span>string,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">year</span><span style="color:#bbb"> </span>string)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## æ’å…¥æ•°æ®è¡¨ ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ’å…¥åˆ†åŒºè¡¨æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">load</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">local</span><span style="color:#bbb"> </span>inpath<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/student.txt&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2019&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ’å…¥äºŒçº§åˆ†åŒºè¡¨æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">load</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">local</span><span style="color:#bbb"> </span>inpath<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/student.txt&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition_day<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">month</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2019-01&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">day</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;01&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## åˆ›å»º&amp;åˆ é™¤&amp;æŸ¥è¯¢åˆ†åŒº ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- åˆ›å»ºåˆ†åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">add</span><span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2020&#34;</span>)<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2018&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ é™¤åˆ†åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">drop</span><span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2020&#34;</span>)<span style="color:#bbb"> </span>,<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2018&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŸ¥çœ‹è¡¨åˆ†åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>partitions<span style="color:#bbb"> </span>student_partition;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## ä¿®å¤åˆ†åŒºæ•°æ® ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ä¸Šä¼ æ•°æ®ï¼Œå®Œæˆä¹‹åå› ä¸ºæ²¡æœ‰å…ƒæ•°æ®ä¿¡æ¯æ‰€æœ‰æ— æ³•æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>hadoop<span style="color:#bbb"> </span>fs<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>mkdir<span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">user</span><span style="color:#000;font-weight:bold">/</span>hive<span style="color:#000;font-weight:bold">/</span>warehouse<span style="color:#000;font-weight:bold">/</span>student_partition<span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">2018</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>hadoop<span style="color:#bbb"> </span>fs<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>put<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">input</span><span style="color:#000;font-weight:bold">/</span>student.txt<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">user</span><span style="color:#000;font-weight:bold">/</span>hive<span style="color:#000;font-weight:bold">/</span>warehouse<span style="color:#000;font-weight:bold">/</span>student_partition<span style="color:#000;font-weight:bold">/</span><span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">2018</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ–¹å¼ä¸€ï¼šè‡ªåŠ¨ä¿®å¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>msck<span style="color:#bbb"> </span>repair<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ·»åŠ åˆ†åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">alter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">add</span><span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2017&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## åˆ›å»ºåŠ¨æ€åˆ†åŒº ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¼€å¯åŠ¨æ€åˆ†åŒºåŠŸèƒ½(é»˜è®¤true)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- è®¾ç½®ä¸ºéä¸¥æ ¼æ¨¡å¼(åŠ¨æ€åˆ†åŒºçš„æ¨¡å¼ï¼Œé»˜è®¤strict,è¡¨ç¤ºå¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ªåˆ†åŒºä¸ºé™æ€åˆ†åŒº)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition.<span style="color:#000;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">=</span>nonstrict;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åœ¨æ‰€æœ‰æ‰§è¡ŒMRçš„èŠ‚ç‚¹ä¸Šï¼Œæœ€å¤§ä¸€å…±å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªåŠ¨æ€åˆ†åŒºï¼Œé»˜è®¤1000ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">max</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partitions<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1000</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åœ¨æ¯ä¸ªæ‰§è¡ŒMRçš„èŠ‚ç‚¹ä¸Šï¼Œæœ€å¤§å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªåŠ¨æ€åˆ†åŒºï¼Œé»˜è®¤100ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">max</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partitions.pernode<span style="color:#000;font-weight:bold">=</span><span style="color:#099">100</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ•´ä¸ªMR Jobä¸­ï¼Œæœ€å¤§å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªHDFSæ–‡ä»¶ï¼Œé»˜è®¤100000ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">max</span>.created.files<span style="color:#000;font-weight:bold">=</span><span style="color:#099">100000</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å½“æœ‰ç©ºåˆ†åŒºç”Ÿæˆæ—¶ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚ä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>hive.error.<span style="color:#000;font-weight:bold">on</span>.empty.partition<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ›å»ºè¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_partition(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>empno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ename<span style="color:#bbb"> </span>string,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>job<span style="color:#bbb"> </span>string,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>mgr<span style="color:#bbb"> </span>string,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>hiredate<span style="color:#bbb"> </span>string,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>sal<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>comm<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>partitioned<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>(deptno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ’å…¥æ•°æ®ï¼Œæ­¤æ—¶ä¸ç”¨æŒ‡å®špartitionçš„å­—æ®µå€¼ï¼ŒåŠ¨æ€è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span>employee_partition<span style="color:#bbb"> </span>partition(deptno)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>empno,<span style="color:#bbb"> </span>ename,<span style="color:#bbb"> </span>job,<span style="color:#bbb"> </span>mgr,<span style="color:#bbb"> </span>hiredate,<span style="color:#bbb"> </span>sal,<span style="color:#bbb"> </span>comm,<span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å››dmlè¯­å¥">å››ã€DMLè¯­å¥</h2>
<h3 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ########################################## Loadè£…è½½æ•°æ® ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ•°æ®åœ¨æœ¬åœ°æ–‡ä»¶æ˜¯ä¸Šä¼ åˆ°HDFSï¼Œæ•°æ®åœ¨HDFSä¸Šæ˜¯å‰ªåˆ‡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- è¿½åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">load</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">data</span><span style="color:#bbb"> </span>[<span style="color:#000;font-weight:bold">local</span>]<span style="color:#bbb"> </span>inpath<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/student.txt&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ¸…ç©ºï¼Œè¦†ç›–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">load</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">data</span><span style="color:#bbb"> </span>[<span style="color:#000;font-weight:bold">local</span>]<span style="color:#bbb"> </span>inpath<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/student.txt&#39;</span><span style="color:#bbb"> </span>overwrite<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## Insertæ’å…¥æ•°æ® ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ’å…¥æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2000&#34;</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">values</span>(<span style="color:#d14">&#34;2&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;tom&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ä½¿ç”¨æ’å…¥æ•°æ®è¦†ç›–ï¼Œ æ³¨æ„å­—æ®µé¡ºåº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span>overwrite<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_partition<span style="color:#bbb"> </span>partition(<span style="color:#000;font-weight:bold">year</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2000&#34;</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>sex<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>student_bak;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ########################################## æŸ¥è¯¢å¹¶åˆ›å»ºæ•°æ® ##########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student_new<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ######################################## åˆ›å»ºè¡¨å¹¶æŒ‡å®šæ•°æ®æ–‡ä»¶å¤¹#########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- åˆ›å»ºè¡¨å¹¶æŒ‡å®šå­˜æ”¾æ•°æ®çš„HDFSæ–‡ä»¶å¤¹ä½ç½®ï¼Œç„¶åä¸Šä¼ æ–‡ä»¶åˆ°æ–‡ä»¶å¤¹å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>studeng_new(id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>string)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">location</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;/user/hive/warehouse/student_new&#39;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ•°æ®å¯¼å‡ºæ•°æ®å¯¼å…¥">æ•°æ®å¯¼å‡º&amp;æ•°æ®å¯¼å…¥</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ########################################## Insertå¯¼å‡º ###########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span>overwrite<span style="color:#bbb"> </span>[<span style="color:#000;font-weight:bold">local</span>]<span style="color:#bbb"> </span>directory<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/student.data&#39;</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ######################################## Exportå¯¼å‡ºImportå¯¼å…¥ ########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- exportå¯¼å‡ºåˆ°HDFSä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>export<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">to</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;/hive/export/student&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>import<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;/hive/export/student&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¸…é™¤è¡¨æ•°æ®">æ¸…é™¤è¡¨æ•°æ®</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¿…é¡»æ˜¯ç®¡ç†è¡¨æ‰èƒ½æˆªæ–­æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">truncate</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>student;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”dqlè¯­å¥">äº”ã€DQLè¯­å¥</h2>
<p>SQLè¯­å¥åº”è¯¥é¿å…äº§ç”Ÿç¬›å¡å°”ç§¯ï¼Œäº§ç”Ÿç¬›å¡å°”ç§¯çš„æ¡ä»¶</p>
<ul>
<li>çœç•¥è¿æ¥æ¡ä»¶</li>
<li>è¿æ¥æ¡ä»¶æ— æ•ˆ</li>
<li>æ‰€æœ‰è¡¨ä¸­æ‰€æœ‰è¡Œäº’ç›¸è¿æ¥</li>
</ul>
<blockquote>
<p>Oracleã€Hiveæ”¯æŒæ»¡å¤–è¿æ¥ï¼ˆfull joinï¼‰ï¼ŒMysqlä¸æ”¯æŒæ»¡å¤–è¿æ¥å¯ä½¿ç”¨å·¦è¿æ¥unionå³è¿æ¥</p>
</blockquote>
<h3 id="æ’åº">æ’åº</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- order by[å…¨å±€æ’åº,åªæœ‰ä¸€ä¸ªReduce]
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sal;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- sort by[å±€éƒ¨æ’åº,å¤šä¸ªReduce,åˆ†åŒºå­—æ®µéšæœº]	
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.job.reduces<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ†ä¸ºä¸¤ä¸ªåŒºï¼Œæ¯ä¸ªåŒºå†…æœ‰åº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno,sal<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sal;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- distribute by[åˆ†åŒºæ’åº],å…ˆæŒ‰ç…§ç»™å®šå­—æ®µåˆ†åŒºä¹‹åå†æ’åº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span>distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sal;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.job.reduces<span style="color:#000;font-weight:bold">=</span><span style="color:#099">3</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno,sal<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span>distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sal;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">--cluster by[å½“distribute by field sort by field ascç›¸åŒæ—¶å¯æ›¿ä»£]
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">cluster</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>deptno;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ†æ¡¶æŸ¥è¯¢">åˆ†æ¡¶æŸ¥è¯¢</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- åˆ›å»ºåˆ†æ¡¶è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_buck(empno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb"> </span>ename<span style="color:#bbb"> </span>string,<span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>clustered<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span>(deptno)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#099">3</span><span style="color:#bbb"> </span>buckets<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¯¼å…¥æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.enforce.bucketmapjoin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.job.reduces<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_buck<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>empno,<span style="color:#bbb"> </span>ename,<span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŸ¥è¯¢åˆ†æ¡¶æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_buck<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>deptno<span style="color:#000;font-weight:bold">=</span><span style="color:#099">10</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åˆ†æ¡¶æŠ½æ ·æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_buck<span style="color:#bbb"> </span>tablesample(bucket<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">out</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">of</span><span style="color:#bbb"> </span><span style="color:#099">6</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span>deptno);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- x out of y
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- x: å¼€å§‹çš„æ¡¶å·ï¼ŒåŸºæ•°ä¸º1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- y: æ¡¶æ•°çš„å› å­æˆ–å€æ•°ï¼Œå¦‚æœä¸ºå› å­åˆ™ä¸ºæŠ½å–buckets/yä¸ªï¼Œå¦‚æœæ˜¯å€æ•°åˆ™ä¸º(buckets/y) * bucketsä¸ª
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸¸ç”¨å‡½æ•°">å¸¸ç”¨å‡½æ•°</h3>
<h4 id="ç©ºå­—æ®µèµ‹å€¼å‡½æ•°">ç©ºå­—æ®µèµ‹å€¼å‡½æ•°</h4>
<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯NULLåˆ™ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œå‚æ•°ä¸ªæ•°ä¸ºå›ºå®šä¸¤ä¸ª</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>nvl(<span style="color:#000;font-weight:bold">NULL</span>,<span style="color:#bbb"> </span><span style="color:#099">100</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ—¶é—´ç±»å‡½æ•°">æ—¶é—´ç±»å‡½æ•°</h4>
<p><span style="color:red">date_formatæ—¶é—´æ ¼å¼åªè®¤<code>-</code></span></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å­—ç¬¦ä¸²è½¬æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>date_format(<span style="color:#d14">&#39;2020-09-22&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;yyyy-MM-dd&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ—¶é—´å¢åŠ ï¼Œæ•°å€¼å¯ä¸ºè´Ÿæ•°ä¸ºå‡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>date_add(<span style="color:#d14">&#39;2020-09-22&#39;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ—¶é—´å‡å°‘ï¼Œæ•°å€¼å¯ä¸ºè´Ÿæ•°ä¸ºå¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>date_sub(<span style="color:#d14">&#39;2020-09-22&#39;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ä¸¤æ—¶é—´ç›¸å‡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>datediff(<span style="color:#d14">&#39;2020-09-22&#39;</span>,<span style="color:#d14">&#39;2020-09-21&#39;</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ¤æ–­å‡½æ•°">åˆ¤æ–­å‡½æ•°</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- case when
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>classno,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">sum</span>(<span style="color:#000;font-weight:bold">case</span><span style="color:#bbb"> </span>sex<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">when</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;ç”·&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">then</span><span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">end</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>male,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">sum</span>(<span style="color:#000;font-weight:bold">case</span><span style="color:#bbb"> </span>sex<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">when</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;å¥³&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">then</span><span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">end</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>female<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>emp_sex<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>classno;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- if
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span>(mgr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;é¢†å¯¼&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;å‘˜å·¥&#34;</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å­—ç¬¦ä¸²æ‹¼æ¥">å­—ç¬¦ä¸²æ‹¼æ¥</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ‹¼æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>concat(<span style="color:#d14">&#34;hello&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;_&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;world&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ‹¼æ¥æŒ‡å®šåˆ†éš”ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>concat_ws(<span style="color:#d14">&#34;_&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;hello&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;world&#34;</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å­—æ®µæ•°æ®æ±‡æ€»">å­—æ®µæ•°æ®æ±‡æ€»</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- collect_setè¿”å›ä¸€ä¸ªarray
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno,<span style="color:#bbb"> </span>collect_set(ename)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>deptno;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="explode">explode</h4>
<p><code>explode</code>ï¼šå°†hiveä¸€åˆ—ä¸­å¤æ‚çš„arrayæˆ–è€…mapç»“æ„æ‹†åˆ†æˆå¤šè¡Œ</p>
<p><code>lateral view</code>ï¼šç”¨äºå’Œ<code>split</code>ï¼Œ<code>explode</code>å½¢æˆä¾§å†™ï¼Œå®ƒå°†ä¸€åˆ—æ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno,<span style="color:#bbb"> </span>ename<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>emp_dept<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">lateral</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">view</span><span style="color:#bbb"> </span>explode(enames)<span style="color:#bbb"> </span>table_tmp<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>ename;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="over">over</h4>
<p>OVER()ï¼šæŒ‡å®šåˆ†æå‡½æ•°å·¥ä½œçš„æ®çª—å£å¤§å°ï¼Œè¿™ä¸ªå¯èƒ½ä¼šéšç€è¡Œçš„å˜åŒ–è€Œå˜åŒ–</p>
<p>OVERå†…å¯åŠ å‚æ•°</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>CURRENT ROW</td>
<td>å½“å‰è¡Œ</td>
</tr>
<tr>
<td>n PRECEDING</td>
<td>å¾€å‰nè¡Œæ•°æ®</td>
</tr>
<tr>
<td>n FOLLOWING</td>
<td>å¾€ånè¡Œæ•°æ®</td>
</tr>
<tr>
<td>UNBOUNDED</td>
<td>èµ·ç‚¹</td>
</tr>
<tr>
<td>UNBOUNDED PRECEDING</td>
<td>è¡¨ç¤ºä»å‰é¢çš„èµ·ç‚¹</td>
</tr>
<tr>
<td>UNBOUNDED FOLLOWING</td>
<td>è¡¨ç¤ºåˆ°åé¢çš„ç»ˆç‚¹</td>
</tr>
</tbody>
</table>
<p>OVERå·¦ä¾§å‡½æ•°</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>lag(col,n)</td>
<td>å¾€å‰ç¬¬nè¡Œæ•°æ®</td>
</tr>
<tr>
<td>lead(col,n)</td>
<td>å¾€åç¬¬nè¡Œæ•°æ®</td>
</tr>
<tr>
<td>ntile(n)</td>
<td>æŠŠæœ‰åºåˆ†åŒºä¸­çš„è¡Œå‘åˆ°æŒ‡å®šæ•°æ®ç»„ï¼Œå„ä¸ªç¼–å·ä»1å¼€å§‹</td>
</tr>
<tr>
<td>rank()</td>
<td>å­˜åœ¨å¹¶åˆ—æ’åºï¼Œ1ã€1ã€3ã€4</td>
</tr>
<tr>
<td>dense_rank()</td>
<td>å­˜åœ¨å¹¶åˆ—æ’åºï¼Œ1ã€1ã€2ã€3</td>
</tr>
<tr>
<td>row_number()</td>
<td>é¡ºåºè®¡ç®—ï¼Œ1ã€2ã€3ã€4</td>
</tr>
</tbody>
</table>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * name sale_date   price
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack	2020-01-01	10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack	2020-01-02	20
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack	2020-01-03	30
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack	2020-01-05	5
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane	2020-01-01	8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane	2020-01-02	12
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane	2020-01-08	1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes	2020-01-08	100
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŒ‰ç…§åç§°ç»Ÿè®¡ï¼Œæ¶ˆè´¹æ—¶é—´æ’åºï¼Œè®¡ç®—ç´¯åŠ æ¶ˆè´¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>sale_date,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">sum</span>(price)<span style="color:#bbb"> </span>over(distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sale_date)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>sale_date,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">sum</span>(price)<span style="color:#bbb"> </span>over(partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sale_date)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç»“æœå¦‚ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * name    sale_date       sum_window_0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-01      10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-02      30
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-03      60
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-05      65
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-01      8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-02      20
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-08      21
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes    2020-01-08      100
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŸ¥è¯¢ä¸Šæ¬¡æ¶ˆè´¹å’Œæœ¬æ¬¡æ¶ˆè´¹çš„æ€»è®¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>sale_date,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">sum</span>(price)<span style="color:#bbb"> </span>over(distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sale_date<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">rows</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">between</span><span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span>PRECEDING<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">and</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">CURRENT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">ROW</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç»“æœå¦‚ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-01      10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-02      30
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-03      50
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-05      35
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-01      8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-02      20
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-08      13
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes    2020-01-08      100
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŸ¥è¯¢é¡¾å®¢ä¸Šæ¬¡è´­ä¹°æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>sale_date,<span style="color:#bbb"> </span>lag(sale_data,<span style="color:#bbb"> </span><span style="color:#099">1</span>)<span style="color:#bbb"> </span>over(distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sale_date)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç»“æœå¦‚ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-01      NULL
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-02      2020-01-01
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-03      2020-01-02
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-05      2020-01-03
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-01      NULL
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-02      2020-01-01
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-08      2020-01-02
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes    2020-01-08      NULL
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æŸ¥è¯¢æ¶ˆè´¹æ—¥æœŸ25%ä¸ºä¸€ç»„çš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>sale_date,<span style="color:#bbb">  </span>ntile(<span style="color:#099">4</span>)<span style="color:#bbb"> </span>over(sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sale_data)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>percent<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>percent;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç»“æœå¦‚ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-01      1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-01      1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-02      2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-02      2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-05      3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    2020-01-03      3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    2020-01-08      4
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes    2020-01-08      4
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ¶ˆè´¹è€…è‡ªèº«æ¶ˆè´¹é‡‘é¢æ’åº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>sale_date,<span style="color:#bbb"> </span>rank()<span style="color:#bbb"> </span>over(distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">desc</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>business;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç»“æœå¦‚ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    30      2020-01-03      1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    20      2020-01-02      2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    10      2020-01-01      3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jack    5       2020-01-05      4
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    12      2020-01-02      1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    8       2020-01-01      2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Jane    1       2020-01-08      3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Roes    100     2020-01-08      1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­å‡½æ•°">å…­ã€å‡½æ•°</h2>
<h3 id="æŸ¥çœ‹ç³»ç»Ÿå†…ç½®å‡½æ•°">æŸ¥çœ‹ç³»ç»Ÿå†…ç½®å‡½æ•°</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æŸ¥çœ‹ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">show</span><span style="color:#bbb"> </span>functions;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ˜¾ç¤ºè‡ªå¸¦çš„å‡½æ•°çš„ç”¨æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">function</span><span style="color:#bbb"> </span>[funcName];<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">desc</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">function</span><span style="color:#bbb"> </span>extended<span style="color:#bbb"> </span>[funcName];<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªå®šä¹‰å‡½æ•°">è‡ªå®šä¹‰å‡½æ•°</h3>
<p>å½“Hiveæä¾›çš„å†…ç½®å‡½æ•°æ— æ³•æ»¡è¶³ä½ çš„ä¸šåŠ¡å¤„ç†éœ€è¦æ—¶ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼šuser-defined functionï¼‰</p>
<p>æ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p>
<ol>
<li>UDFï¼ˆuser-defined functionï¼‰ï¼šä¸€è¿›ä¸€å‡º</li>
<li>UDAFï¼ˆuser-defined aggregation functionï¼‰ï¼šå¤šè¿›ä¸€å‡º</li>
<li>UDTFï¼ˆuser-defined table-generating functionsï¼‰ï¼šä¸€è¿›å¤šå‡º</li>
</ol>
<h3 id="è‡ªå®šä¹‰å‡½æ•°æ­¥éª¤">è‡ªå®šä¹‰å‡½æ•°æ­¥éª¤</h3>
<p>ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ jaråˆ°hiveæœåŠ¡å™¨</p>
<p>ç¬¬äºŒæ­¥ï¼š<code>add jar /opt/module/hive/lib/xxx.jar;</code></p>
<p>ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ ç±»<code>CREATE TEMPORARY FUNCTION [funcName]AS [className];</code></p>
<h4 id="udfå‡½æ•°å®šä¹‰">UDFå‡½æ•°å®šä¹‰</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Description</span>(name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;lower_concat&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>value<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;_FUNC_(param_1,param_2) - Returns concat lower string &#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>extended<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;param can be one of:\n&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;1. primitive\n&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;2. null\n&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;Example:\n &#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;  &gt; SELECT _FUNC_(&#39;AAA&#39;, &#39;BBB&#39;)&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">LowerConcat</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>GenericUDF<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">transient</span><span style="color:#bbb"> </span>ObjectInspectorConverters.<span style="color:#008080">Converter</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>converters;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * è¿™ä¸ªæ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨evaluate()æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚è¯¥æ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªObjectInspectorsæ•°ç»„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * è¯¥æ–¹æ³•æ£€æŸ¥æ¥å—æ­£ç¡®çš„å‚æ•°ç±»å‹å’Œå‚æ•°ä¸ªæ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>ObjectInspector<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initialize</span>(ObjectInspector<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>arguments)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>UDFArgumentException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// é•¿åº¦æ ¡éªŒ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(arguments.<span style="color:#008080">length</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span>2)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">throw</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>UDFArgumentException(<span style="color:#d14">&#34;The function LOWER_CONCAT accepts 2 arguments.&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>converters<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ObjectInspectorConverters.<span style="color:#008080">Converter</span><span style="color:#000;font-weight:bold">[</span>arguments.<span style="color:#008080">length</span><span style="color:#000;font-weight:bold">]</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å‚æ•°ç±»å‹æ ¡éªŒ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">!</span>(arguments<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">getCategory</span>().<span style="color:#008080">equals</span>(ObjectInspector.<span style="color:#008080">Category</span>.<span style="color:#008080">PRIMITIVE</span>)))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">throw</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>UDFArgumentTypeException(0,<span style="color:#bbb"> </span><span style="color:#d14">&#34;\&#34;primitive\&#34; expected at function LOWER_CONCAT, but \&#34;&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                         </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>arguments<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">getTypeName</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;\&#34; &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;is found&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>converters<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ObjectInspectorConverters.<span style="color:#008080">getConverter</span>(arguments<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>,<span style="color:#bbb"> </span>PrimitiveObjectInspectorFactory.<span style="color:#008080">writableStringObjectInspector</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">!</span>(arguments<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">getCategory</span>().<span style="color:#008080">equals</span>(ObjectInspector.<span style="color:#008080">Category</span>.<span style="color:#008080">PRIMITIVE</span>)))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">throw</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>UDFArgumentTypeException(0,<span style="color:#bbb"> </span><span style="color:#d14">&#34;\&#34;primitive\&#34; expected at function LOWER_CONCAT, but \&#34;&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                         </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>arguments<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">getTypeName</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;\&#34; &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;is found&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>converters<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ObjectInspectorConverters.<span style="color:#008080">getConverter</span>(arguments<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>,<span style="color:#bbb"> </span>PrimitiveObjectInspectorFactory.<span style="color:#008080">writableStringObjectInspector</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>PrimitiveObjectInspectorFactory.<span style="color:#008080">writableStringObjectInspector</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>Object<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">evaluate</span>(DeferredObject<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>arguments)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>HiveException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Text<span style="color:#bbb"> </span>firstText<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(Text)<span style="color:#bbb"> </span>converters<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">convert</span>(arguments<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Text<span style="color:#bbb"> </span>secondText<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(Text)<span style="color:#bbb"> </span>converters<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">convert</span>(arguments<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>firstStr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(firstText<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>firstText.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>secondStr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(secondText<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>secondText.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text(firstStr.<span style="color:#008080">toLowerCase</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>secondStr.<span style="color:#008080">toLowerCase</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getDisplayString</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>children)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>getStandardDisplayString(getFuncName(),<span style="color:#bbb"> </span>children);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="udtfå‡½æ•°å®šä¹‰">UDTFå‡½æ•°å®šä¹‰</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Description</span>(name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;multi&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>value<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;_FUNC_(params...) - Returns concat lower string &#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>extended<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;param can be number\n&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;Example:\n &#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;  &gt; SELECT _FUNC_(1,2,3)&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Multi</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>GenericUDTF<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>StructObjectInspector<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initialize</span>(StructObjectInspector<span style="color:#bbb"> </span>argOIs)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>UDFArgumentException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 1.å®šä¹‰è¾“å‡ºæ•°æ®çš„åˆ—åå’Œç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>fieldNames<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>ObjectInspector<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>fieldOIS<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//2.æ·»åŠ è¾“å‡ºæ•°æ®å’Œåˆ—åå’Œç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>fieldNames.<span style="color:#008080">add</span>(<span style="color:#d14">&#34;multi&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>fieldOIS.<span style="color:#008080">add</span>(PrimitiveObjectInspectorFactory.<span style="color:#008080">javaLongObjectInspector</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>ObjectInspectorFactory.<span style="color:#008080">getStandardStructObjectInspector</span>(fieldNames,<span style="color:#bbb"> </span>fieldOIS);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">process</span>(Object<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>HiveException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>inputArg<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(Object<span style="color:#bbb"> </span>arg<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>inputArg.<span style="color:#008080">add</span>(((IntWritable)arg).<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Long<span style="color:#bbb"> </span>result<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>1L;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(Integer<span style="color:#bbb"> </span>aInt<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>inputArg)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>result<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>result<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>aInt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>forward(result);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">close</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>HiveException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸ƒsnappyå‹ç¼©æ–‡ä»¶æ ¼å¼">ä¸ƒã€Snappyå‹ç¼©&amp;æ–‡ä»¶æ ¼å¼</h2>
<h3 id="snappyå‹ç¼©">Snappyå‹ç¼©</h3>
<p>å‰ææ¡ä»¶ï¼š<a href="https://mynamelancelot.github.io/hadoop/hadoop.html#snappy%E5%AE%89%E8%A3%85">hadoopå…ˆç¼–è¯‘å®‰è£…å¥½æ”¯æŒSnappy</a></p>
<h4 id="å¼€å¯mapè¾“å‡ºé˜¶æ®µå‹ç¼©">å¼€å¯Mapè¾“å‡ºé˜¶æ®µå‹ç¼©</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¼€å¯hiveä¼ è¾“æ•°æ®å‹ç¼©åŠŸèƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.compress.intermediate<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¼€å¯map-reduceä¸­mapè¾“å‡ºå‹ç¼©åŠŸèƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.<span style="color:#000;font-weight:bold">map</span>.<span style="color:#000;font-weight:bold">output</span>.compress<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- è®¾ç½®map-reduceä¸­mapè¾“å‡ºæ•°æ®çš„å‹ç¼©æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.<span style="color:#000;font-weight:bold">map</span>.<span style="color:#000;font-weight:bold">output</span>.compress.codec<span style="color:#000;font-weight:bold">=</span>org.apache.hadoop.io.compress.SnappyCodec;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¼€å¯reduceè¾“å‡ºé˜¶æ®µå‹ç¼©">å¼€å¯Reduceè¾“å‡ºé˜¶æ®µå‹ç¼©</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¼€å¯hiveæœ€ç»ˆè¾“å‡ºæ•°æ®å‹ç¼©åŠŸèƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.compress.<span style="color:#000;font-weight:bold">output</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¼€å¯map-reduceæœ€ç»ˆè¾“å‡ºæ•°æ®å‹ç¼©
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- è®¾ç½®map-reduceä¸­mapè¾“å‡ºæ•°æ®çš„å‹ç¼©æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress.codec<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>org.apache.hadoop.io.compress.SnappyCodec;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- è®¾ç½®map-reduceæœ€ç»ˆæ•°æ®è¾“å‡ºå‹ç¼©ä¸ºå—å‹ç¼©
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress.<span style="color:#000;font-weight:bold">type</span><span style="color:#000;font-weight:bold">=</span>BLOCK;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æµ‹è¯•ä¸€ä¸‹è¾“å‡ºç»“æœæ˜¯å¦å‹ç¼©æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span>overwrite<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">local</span><span style="color:#bbb"> </span>directory<span style="color:#bbb"> </span><span style="color:#d14">&#39;/opt/module/hive/input/employee&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>deptno,<span style="color:#bbb"> </span>sal<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span>distribute<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>deptno<span style="color:#bbb"> </span>sort<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>sal;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–‡ä»¶æ ¼å¼">æ–‡ä»¶æ ¼å¼</h3>
<p>Hiveå¯ä½¿ç”¨çš„æ–‡ä»¶æ ¼å¼</p>
<ul>
<li>SEQUENCEFILEï¼šç”Ÿäº§ä¸­ç»å¯¹ä¸ä¼šç”¨ï¼Œk-væ ¼å¼ï¼Œæ¯”æºæ–‡æœ¬æ ¼å¼å ç”¨ç£ç›˜æ›´å¤š</li>
<li>TEXTFILEï¼šç”Ÿäº§ä¸­ç”¨çš„å¤šï¼Œè¡Œå¼å­˜å‚¨ï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ–‡ä»¶æ ¼å¼</li>
<li>ORCï¼šç”Ÿäº§ä¸­æœ€å¸¸ç”¨ï¼Œåˆ—å¼å­˜å‚¨</li>
<li>PARQUETï¼šç”Ÿäº§ä¸­æœ€å¸¸ç”¨ï¼Œåˆ—å¼å­˜å‚¨</li>
</ul>
<p>åˆ›å»ºä¸åŒæ–‡ä»¶æ ¼å¼çš„è¡¨</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- ######################################## TEXTFILE ########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_textfile(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>empno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ename<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>stored<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>textfile;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ######################################## ORC ########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_orc(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>empno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ename<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>stored<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>orc<span style="color:#bbb"> </span>tblproperties<span style="color:#bbb"> </span>(<span style="color:#d14">&#34;orc.compress&#34;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;SNAPPY&#34;</span>);<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- é»˜è®¤å‹ç¼©ä¸ºZLIB
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span>employee_orc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>empno,<span style="color:#bbb"> </span>ename<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_textfile;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- ######################################## PARQUET ########################################
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span>employee_parquet(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>empno<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ename<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">row</span><span style="color:#bbb"> </span>format<span style="color:#bbb"> </span>delimited<span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span>terminated<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>stored<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>parquet;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span>employee_parquet<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>empno,<span style="color:#bbb"> </span>ename<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_textfile;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…«ä¼˜åŒ–">å…«ã€ä¼˜åŒ–</h2>
<h3 id="fetchæŠ“å–">FetchæŠ“å–</h3>
<p>FetchæŠ“å–æ˜¯æŒ‡ï¼ŒHiveä¸­å¯¹æŸäº›æƒ…å†µçš„æŸ¥è¯¢å¯ä»¥ä¸å¿…ä½¿ç”¨MapReduceè®¡ç®—ã€‚ä¾‹å¦‚ï¼š<code>SELECT * FROM employee;</code>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHiveå¯ä»¥ç®€å•åœ°è¯»å–employeeå¯¹åº”çš„å­˜å‚¨ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç„¶åè¾“å‡ºæŸ¥è¯¢ç»“æœåˆ°æ§åˆ¶å°ã€‚</p>
<p>ä¿®æ”¹<code>hive-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hive.fetch.task.conversion<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    none : å…¨éƒ¨èµ°MR
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    minimal : select * ï¼Œlimitï¼Œfilteråœ¨ä¸€ä¸ªè¡¨æ‰€å±çš„åˆ†åŒºè¡¨ä¸Šæ“ä½œä¸èµ°MR
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    more    : selectï¼Œfilterï¼Œlimitï¼Œéƒ½æ˜¯è¿è¡Œæ•°æ®çš„fetchï¼Œä¸è·‘mr[é»˜è®¤å€¼]
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>more<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœ¬åœ°æ¨¡å¼">æœ¬åœ°æ¨¡å¼</h3>
<p>å¤§å¤šæ•°çš„Hadoop Jobæ˜¯éœ€è¦Hadoopæä¾›çš„å®Œæ•´çš„å¯æ‰©å±•æ€§æ¥å¤„ç†å¤§æ•°æ®é›†çš„ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶Hiveçš„è¾“å…¥æ•°æ®é‡æ˜¯éå¸¸å°çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºæŸ¥è¯¢è§¦å‘æ‰§è¡Œä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´å¯èƒ½ä¼šæ¯”å®é™…jobçš„æ‰§è¡Œæ—¶é—´è¦å¤šçš„å¤šã€‚å¯¹äºå¤§å¤šæ•°è¿™ç§æƒ…å†µï¼ŒHiveå¯ä»¥é€šè¿‡æœ¬åœ°æ¨¡å¼åœ¨å•å°æœºå™¨ä¸Šå¤„ç†æ‰€æœ‰çš„ä»»åŠ¡ã€‚å¯¹äºå°æ•°æ®é›†ï¼Œæ‰§è¡Œæ—¶é—´å¯ä»¥æ˜æ˜¾è¢«ç¼©çŸ­ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¼€å¯æœ¬åœ°æ¨¡å¼é»˜è®¤ä¸ºfalse
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">mode</span>.<span style="color:#000;font-weight:bold">local</span>.auto<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ•°æ®é‡å¿…é¡»å°äºæŒ‡å®šå‚æ•°æ‰ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œé»˜è®¤128M
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">mode</span>.<span style="color:#000;font-weight:bold">local</span>.auto.inputbytes.<span style="color:#000;font-weight:bold">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">50000000</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- jobçš„mapæ•°å¿…é¡»å°äºå‚æ•°æ‰ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œé»˜è®¤4
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">mode</span>.<span style="color:#000;font-weight:bold">local</span>.auto.tasks.<span style="color:#000;font-weight:bold">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">10</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¡¨æŸ¥è¯¢ä¼˜åŒ–">è¡¨æŸ¥è¯¢ä¼˜åŒ–</h3>
<h4 id="å°è¡¨joinå¤§è¡¨">å°è¡¨joinå¤§è¡¨</h4>
<p>æŸ¥è¯¢æ—¶åº”è¯¥å°†æ•°æ®é‡å°çš„è¡¨æ”¾åœ¨joinçš„å·¦è¾¹ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘å†…å­˜æº¢å‡ºé”™è¯¯å‘ç”Ÿçš„å‡ ç‡ã€‚å®é™…æ–°ç‰ˆçš„hiveå·²ç»å¯¹å°è¡¨JOINå¤§è¡¨å’Œå¤§è¡¨JOINå°è¡¨è¿›è¡Œäº†ä¼˜åŒ–ã€‚å°è¡¨æ”¾åœ¨å·¦è¾¹å’Œå³è¾¹å·²ç»æ²¡æœ‰æ˜æ˜¾åŒºåˆ«ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å…³é—­mapjoinåŠŸèƒ½(é»˜è®¤æ˜¯æ‰“å¼€çš„)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.auto.<span style="color:#000;font-weight:bold">convert</span>.<span style="color:#000;font-weight:bold">join</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¤§è¡¨joinå¤§è¡¨-ç©ºkeyè¿‡æ»¤">å¤§è¡¨joinå¤§è¡¨-ç©ºkeyè¿‡æ»¤</h4>
<p>å¦‚æœå¤§è¡¨çš„ç©ºkeyå¤ªå¤šï¼Œè€Œä¸”ç©ºkeyä¸å‚ä¸joinï¼Œåˆ™åº”è¯¥åœ¨joinä¹‹å‰è¿›è¡Œå­æŸ¥è¯¢è¿‡æ»¤æ‰ç©ºkey</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>bigNullKeyTable<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>bigtable_id<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">is</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>T<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">join</span><span style="color:#bbb"> </span>bigTable<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span>bigTable.id<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>T.bigtable_id;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¤§è¡¨joinå¤§è¡¨-ç©ºkeyè½¬æ¢">å¤§è¡¨joinå¤§è¡¨-ç©ºkeyè½¬æ¢</h4>
<p>å¦‚æœå¤§è¡¨çš„ç©ºkeyå¤ªå¤šï¼Œä½†æ˜¯ç©ºkeyå‚ä¸joinï¼Œåˆ™å¯ä»¥éšæœºç”Ÿæˆjoinç”¨çš„keyé¿å…æ•°æ®å€¾æ–œ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>bigNullKeyTable<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">join</span><span style="color:#bbb"> </span>bigTable<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span>(bigNullKeyTable.bigtable_id<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">is</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span>concat(<span style="color:#d14">&#39;temp_join_key&#39;</span>,<span style="color:#bbb"> </span>rand())<span style="color:#bbb"> </span>,bigNullKeyTable.bigtable_id<span style="color:#bbb"> </span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb">  </span>bigTable.id;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mapjoin">MapJoin</h4>
<p>å¦‚æœä¸æŒ‡å®šMapJoinæˆ–è€…ä¸ç¬¦åˆMapJoinçš„æ¡ä»¶ï¼Œé‚£ä¹ˆHiveè§£æå™¨ä¼šå°†åœ¨Reduceé˜¶æ®µå®Œæˆjoinï¼Œå®¹æ˜“å‘ç”Ÿæ•°æ®å€¾æ–œã€‚å¯ä»¥ç”¨MapJoinæŠŠå°
è¡¨å…¨éƒ¨åŠ è½½åˆ°å†…å­˜åœ¨mapç«¯è¿›è¡Œjoinï¼Œé¿å…reduceå¤„ç†ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- è®¾ç½®è‡ªåŠ¨é€‰æ‹©MapJoinï¼Œé»˜è®¤ä¸ºtrue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.auto.<span style="color:#000;font-weight:bold">convert</span>.<span style="color:#000;font-weight:bold">join</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- å¤§è¡¨å°è¡¨çš„é˜ˆå€¼è®¾ç½®(é»˜è®¤25Mä¸‹è®¤ä¸ºæ˜¯å°è¡¨)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.mapjoin.smalltable.filesize<span style="color:#000;font-weight:bold">=</span><span style="color:#099">25000000</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="group-by">Group By</h4>
<p><code>Group By</code>åŒæ ·çš„Keyä¼šåˆ†å‘ç»™ä¸€ä¸ªreduceï¼Œå¦‚æœ<code>Group By</code>çš„å­—æ®µæ•°æ®å€¾æ–œè¾ƒå¤§ï¼ˆä¸€æ ·çš„é›†ä¸­åœ¨å‡ ä¸ªå€¼ä¸Šï¼‰å‹åŠ›ä¼šé›†ä¸­åœ¨ä¸ªåˆ«Reduceä¸Šã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„èšåˆæ“ä½œéƒ½éœ€è¦åœ¨Reduceç«¯å®Œæˆï¼Œå¾ˆå¤šèšåˆæ“ä½œéƒ½å¯ä»¥å…ˆåœ¨Mapç«¯è¿›è¡Œéƒ¨åˆ†èšåˆï¼Œæœ€ååœ¨Reduceç«¯å¾—å‡ºæœ€ç»ˆç»“æœã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ˜¯å¦åœ¨Mapç«¯è¿›è¡Œèšåˆï¼Œé»˜è®¤ä¸ºTrue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">map</span>.aggr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åœ¨Mapç«¯è¿›è¡Œèšåˆæ“ä½œçš„æ¡ç›®æ•°ç›®ï¼Œé»˜è®¤100000
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.groupby.mapaggr.checkinterval<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#099">100000</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æœ‰æ•°æ®å€¾æ–œçš„æ—¶å€™è¿›è¡Œè´Ÿè½½å‡è¡¡(é»˜è®¤æ˜¯false)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.groupby.skewindata<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“é€‰é¡¹è®¾å®šä¸ºtrueï¼Œ ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’ä¼šæœ‰ä¸¤ä¸ªMR Jobã€‚ç¬¬ä¸€ä¸ªMR Jobä¸­ï¼ŒMapçš„è¾“å‡ºç»“æœä¼šéšæœºåˆ†å¸ƒåˆ°Reduceä¸­ï¼Œæ¯ä¸ªReduceåšéƒ¨åˆ†èšåˆæ“ä½œï¼Œå¹¶è¾“å‡ºç»“æœï¼Œè¿™æ ·å¤„ç†çš„ç»“æœæ˜¯ç›¸åŒçš„Group By Keyæœ‰å¯èƒ½è¢«åˆ†å‘åˆ°ä¸åŒçš„Reduceä¸­ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ï¼›ç¬¬äºŒä¸ªMR Jobå†æ ¹æ®é¢„å¤„ç†çš„æ•°æ®ç»“æœæŒ‰ç…§Group By Keyåˆ†å¸ƒåˆ°Reduceä¸­(è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä¿è¯ç›¸åŒçš„Group By Keyè¢«åˆ†å¸ƒåˆ°åŒä¸€ä¸ªReduceä¸­)ï¼Œæœ€åå®Œæˆæœ€ç»ˆçš„èšåˆæ“ä½œã€‚</p>
<h4 id="å»é‡ç»Ÿè®¡">å»é‡ç»Ÿè®¡</h4>
<p>æ•°æ®é‡å°çš„æ—¶å€™æ— æ‰€è°“ï¼Œæ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œç”±äº<code>COUNT DISTINCT</code>æ“ä½œéœ€è¦ç”¨ä¸€ä¸ªReduce Taskæ¥å®Œæˆï¼Œè¿™ä¸€ä¸ªReduceéœ€è¦å¤„ç†çš„æ•°æ®é‡å¤ªå¤§ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªJobå¾ˆéš¾å®Œæˆï¼Œä¸€èˆ¬<code>COUNT DISTINCT</code>ä½¿ç”¨å…ˆ<code>GROUP BY</code>å†<code>COUNT</code>çš„æ–¹å¼æ›¿æ¢:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">count</span>(<span style="color:#000;font-weight:bold">distinct</span><span style="color:#bbb"> </span>mgr)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.job.reduces<span style="color:#000;font-weight:bold">=</span><span style="color:#099">10</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">count</span>(mgr)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>mgr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span>mgr)<span style="color:#bbb"> </span>T;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¬›å¡å°”ç§¯">ç¬›å¡å°”ç§¯</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ç¬›å¡å°”ç§¯æ ¡éªŒæ—¶å…³é—­çš„ï¼Œå¯ä»¥é…ç½®<code>hive-site.xml</code>å¼€å¯</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hive.strict.checks.cartesian.product<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“éœ€è¦ä½¿ç”¨æ—¶å¯åœ¨å½“å‰ä¼šè¯å¼€å¯ä½¿ç”¨å¼€å¯ç¬›å¡å°”ç§¯</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å¼€å¯å¯ä½¿ç”¨ç¬›å¡å°”ç§¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">strict</span>.checks.cartesian.product<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è¡Œåˆ—è¿‡æ»¤">è¡Œåˆ—è¿‡æ»¤</h4>
<p>åˆ—å¤„ç†ï¼šåœ¨<code>SELECT</code>ä¸­ï¼Œåªæ‹¿éœ€è¦çš„åˆ—ï¼Œå°‘ä½¿ç”¨<code>SELECT *</code></p>
<p>è¡Œå¤„ç†ï¼šå¦‚æœèƒ½è¿‡æ»¤å‡ºå¾ˆå¤šåˆ—å¯å…ˆå°†è¡¨æ‰§è¡Œå­æŸ¥è¯¢å†JOIN</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>ename,deptno<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>mgr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">is</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>emp<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">join</span><span style="color:#bbb"> </span>department<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">on</span><span style="color:#bbb"> </span>emp.deptno<span style="color:#000;font-weight:bold">=</span>department.id;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mrä¼˜åŒ–">MRä¼˜åŒ–</h3>
<p><strong>åˆç†è®¾ç½®Mapæ•°</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å†³å®šæ¯ä¸ªmapå¤„ç†çš„æœ€å¤§çš„æ–‡ä»¶å¤§å°ï¼Œå•ä½ä¸ºB,é»˜è®¤256M
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>mapreduce.<span style="color:#000;font-weight:bold">input</span>.fileinputformat.split.maxsize<span style="color:#000;font-weight:bold">=</span><span style="color:#099">256000000</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åˆç†è®¾ç½®reduceæ•°é‡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ¯ä¸ªReduceå¤„ç†çš„æ•°æ®é‡é»˜è®¤æ˜¯256MB
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.reducers.bytes.per.reducer<span style="color:#000;font-weight:bold">=</span><span style="color:#099">256000000</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- æ¯ä¸ªä»»åŠ¡æœ€å¤§çš„reduceæ•°ï¼Œé»˜è®¤ä¸º1009
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.reducers.<span style="color:#000;font-weight:bold">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">1009</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- reduceä¸ªæ•°è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>mapreduce.job.reduces<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å°æ–‡ä»¶è¿›è¡Œåˆå¹¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- é»˜è®¤å·²åˆå¹¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">input</span>.format<span style="color:#000;font-weight:bold">=</span>org.apache.hadoop.hive.q1.io.CombineHive.InputFormat;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¹¶è¡Œæ‰§è¡Œ">å¹¶è¡Œæ‰§è¡Œ</h3>
<p>Hiveä¼šå°†ä¸€ä¸ªæŸ¥è¯¢è½¬åŒ–æˆ-ä¸€ä¸ªæˆ–è€…å¤šä¸ªé˜¶æ®µã€‚è¿™æ ·çš„é˜¶æ®µå¯ä»¥æ˜¯MapReduceé˜¶æ®µã€æŠ½æ ·é˜¶æ®µã€åˆå¹¶é˜¶æ®µã€limit é˜¶æ®µã€‚æˆ–è€…Hiveæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦çš„å…¶ä»–é˜¶æ®µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHiveä¸€æ¬¡åªä¼šæ‰§è¡Œä¸€ä¸ªé˜¶æ®µã€‚ä¸è¿‡ï¼ŒæŸä¸ªç‰¹å®šçš„jobå¯èƒ½åŒ…å«ä¼—å¤šçš„é˜¶æ®µï¼Œè€Œè¿™äº›é˜¶æ®µå¯èƒ½å¹¶éå®Œå…¨äº’ç›¸ä¾èµ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰äº›é˜¶æ®µæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ï¼Œè¿™æ ·å¯èƒ½ä½¿å¾—æ•´ä¸ªjobçš„æ‰§è¡Œæ—¶é—´ç¼©çŸ­ã€‚å¦‚æœæœ‰æ›´å¤šçš„é˜¶æ®µå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆjobå¯èƒ½å°±è¶Šå¿«å®Œæˆã€‚<span style="color:red">ç³»ç»Ÿèµ„æºæ¯”è¾ƒç©ºé—²çš„æ—¶å€™æ‰æœ‰ä¼˜åŠ¿</span></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æ‰“å¼€ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œé»˜è®¤false
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.parallel<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- åŒä¸€ä¸ªsq1å…è®¸æœ€å¤§å¹¶è¡Œåº¦ï¼Œé»˜è®¤8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">set</span><span style="color:#bbb"> </span>hive.<span style="color:#000;font-weight:bold">exec</span>.plarallel.thread.<span style="color:#0086b3">number</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">16</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸¥æ ¼æ¨¡å¼">ä¸¥æ ¼æ¨¡å¼</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">	hive.mapred.modeè¢«åºŸå¼ƒï¼Œå·²è¢« hive.strict.checks.* è®¾ç½®æ›¿ä»£
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- ordey by å¿…é¡»å’Œlimitè¿ç”¨ï¼Œé»˜è®¤false --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hive.strict.checks.orderby.no.limit<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>false<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- åˆ†åŒºè¡¨æŸ¥è¯¢å¿…é¡»å«æœ‰åˆ†åŒºå­—æ®µè¿‡æ»¤ï¼Œé»˜è®¤false --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hive.strict.checks.no.partition.filter<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>false<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- ç¬›å¡å°”ç§¯æ£€æµ‹ï¼Œé»˜è®¤false --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hive.strict.checks.cartesian.product<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>false<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hadoopå¼€å¯jvmé‡ç”¨æ¨æµ‹æ‰§è¡Œhttpsmynamelancelotgithubiohadoophadoophtml"><a href="https://mynamelancelot.github.io/hadoop/hadoop.html">Hadoopå¼€å¯JVMé‡ç”¨&amp;æ¨æµ‹æ‰§è¡Œ</a></h3>
<blockquote>
<p>Hiveè‡ªèº«ä¹Ÿå¼€å¯äº†æ¨æµ‹æ‰§è¡Œ<code>hive.mapred.reduce.tasks.speculative.execution</code>ï¼Œé»˜è®¤true</p>
</blockquote>
<h3 id="æ‰§è¡Œè®¡åˆ’">æ‰§è¡Œè®¡åˆ’</h3>
<p>ä½¿ç”¨extendåˆ†ææ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹MRå¦‚ä½•è¿è¡Œ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explain</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>deptno<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">explain</span><span style="color:#bbb"> </span>extended<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>employee_partition<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>deptno<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20</span>;<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
