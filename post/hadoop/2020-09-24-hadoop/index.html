<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="HadoopåŸºç¡€ - https://hobocat.github.io/post/hadoop/2020-09-24-hadoop/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>HadoopåŸºç¡€</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">HadoopåŸºç¡€</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2020-09-24&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            21463 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            43 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€hadoopå’Œå¤§æ•°æ®ç®€ä»‹">ä¸€ã€Hadoopå’Œå¤§æ•°æ®ç®€ä»‹</a>
      <ul>
        <li><a href="#å¤§æ•°æ®">å¤§æ•°æ®</a></li>
        <li><a href="#hadoop">Hadoop</a></li>
      </ul>
    </li>
    <li><a href="#äºŒhadoopå®‰è£…">äºŒã€Hadoopå®‰è£…</a>
      <ul>
        <li><a href="#ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…</a></li>
        <li><a href="#å•èŠ‚ç‚¹å®‰è£…">å•èŠ‚ç‚¹å®‰è£…</a></li>
        <li><a href="#ä¼ªè£…åˆ†å¸ƒå¼å®‰è£…">ä¼ªè£…åˆ†å¸ƒå¼å®‰è£…</a></li>
        <li><a href="#åˆ†å¸ƒå¼å®‰è£…">åˆ†å¸ƒå¼å®‰è£…</a></li>
        <li><a href="#é›†ç¾¤æ—¶é—´åŒæ­¥">é›†ç¾¤æ—¶é—´åŒæ­¥</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰hdfçš„æ¦‚è¿°">ä¸‰ã€HDFçš„æ¦‚è¿°</a></li>
    <li><a href="#å››hdfsçš„æ“ä½œ">å››ã€HDFSçš„æ“ä½œ</a>
      <ul>
        <li><a href="#shellæ“ä½œ">Shellæ“ä½œ</a></li>
        <li><a href="#hdfsçš„apiæ“ä½œ">HDFSçš„APIæ“ä½œ</a></li>
      </ul>
    </li>
    <li><a href="#äº”hdfsçš„å·¥ä½œæœºåˆ¶">äº”ã€HDFSçš„å·¥ä½œæœºåˆ¶</a>
      <ul>
        <li><a href="#hdfså†™æ•°æ®æµç¨‹">HDFSå†™æ•°æ®æµç¨‹</a></li>
        <li><a href="#hdfsçš„è¯»æ•°æ®æµç¨‹">HDFSçš„è¯»æ•°æ®æµç¨‹</a></li>
        <li><a href="#namenodeå’Œsecondarynamenodeå·¥ä½œæœºåˆ¶">NameNodeå’ŒSecondaryNameNodeå·¥ä½œæœºåˆ¶</a></li>
        <li><a href="#datanodeå·¥ä½œæœºåˆ¶">DataNodeå·¥ä½œæœºåˆ¶</a></li>
      </ul>
    </li>
    <li><a href="#å…­hdfså…¶å®ƒ">å…­ã€HDFSå…¶å®ƒ</a>
      <ul>
        <li><a href="#å°æ–‡ä»¶å­˜æ¡£">å°æ–‡ä»¶å­˜æ¡£</a></li>
        <li><a href="#å¿«ç…§ç®¡ç†">å¿«ç…§ç®¡ç†</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒmapreduceæ¦‚è¿°">ä¸ƒã€MapReduceæ¦‚è¿°</a></li>
    <li><a href="#å…«mapreduceç¼–ç¨‹">å…«ã€MapReduceç¼–ç¨‹</a>
      <ul>
        <li><a href="#wordcountå…¥é—¨æ¡ˆä¾‹">WordCountå…¥é—¨æ¡ˆä¾‹</a></li>
        <li><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–">è‡ªå®šä¹‰åºåˆ—åŒ–</a></li>
        <li><a href="#inputformatæ•°æ®è¾“å…¥">InputFormatæ•°æ®è¾“å…¥</a></li>
        <li><a href="#åˆ†åŒº">åˆ†åŒº</a></li>
        <li><a href="#æ’åº">æ’åº</a></li>
        <li><a href="#åˆ†ç»„æ’åº">åˆ†ç»„æ’åº</a></li>
        <li><a href="#combineråˆå¹¶">Combineråˆå¹¶</a></li>
        <li><a href="#outputformatæ•°æ®è¾“å‡º">OutputFormatæ•°æ®è¾“å‡º</a></li>
        <li><a href="#joinçš„åº”ç”¨">Joinçš„åº”ç”¨</a></li>
        <li><a href="#è®¡æ•°å™¨åº”ç”¨">è®¡æ•°å™¨åº”ç”¨</a></li>
      </ul>
    </li>
    <li><a href="#ä¹æ•°æ®å‹ç¼©">ä¹ã€æ•°æ®å‹ç¼©</a>
      <ul>
        <li><a href="#å‹ç¼©ç®—æ³•">å‹ç¼©ç®—æ³•</a></li>
        <li><a href="#å‹ç¼©ä½ç½®é€‰æ‹©">å‹ç¼©ä½ç½®é€‰æ‹©</a></li>
        <li><a href="#å‹ç¼©å‚æ•°é…ç½®">å‹ç¼©å‚æ•°é…ç½®</a></li>
        <li><a href="#ä»£ç è®¾ç½®">ä»£ç è®¾ç½®</a></li>
        <li><a href="#lzoå®‰è£…">LZOå®‰è£…</a></li>
        <li><a href="#snappyå®‰è£…">Snappyå®‰è£…</a></li>
      </ul>
    </li>
    <li><a href="#åyarnèµ„æºè°ƒåº¦å™¨">åã€Yarnèµ„æºè°ƒåº¦å™¨</a>
      <ul>
        <li><a href="#yarnåŸºæœ¬æ¶æ„">YarnåŸºæœ¬æ¶æ„</a></li>
        <li><a href="#yarnå·¥ä½œæœºåˆ¶">Yarnå·¥ä½œæœºåˆ¶</a></li>
        <li><a href="#èµ„æºè°ƒåº¦å™¨">èµ„æºè°ƒåº¦å™¨</a></li>
        <li><a href="#ä»»åŠ¡çš„æ¨æµ‹æ‰§è¡Œ">ä»»åŠ¡çš„æ¨æµ‹æ‰§è¡Œ</a></li>
      </ul>
    </li>
    <li><a href="#åä¸€hadoopä¼˜åŒ–">åä¸€ã€Hadoopä¼˜åŒ–</a>
      <ul>
        <li><a href="#æ•°æ®è¾“å…¥">æ•°æ®è¾“å…¥</a></li>
        <li><a href="#mapé˜¶æ®µ">Mapé˜¶æ®µ</a></li>
        <li><a href="#reduceé˜¶æ®µ">Reduceé˜¶æ®µ</a></li>
        <li><a href="#ioä¼ è¾“">I/Oä¼ è¾“</a></li>
        <li><a href="#æ•°æ®å€¾æ–œ">æ•°æ®å€¾æ–œ</a></li>
        <li><a href="#å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°">å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°</a></li>
        <li><a href="#hdfså°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•">HDFSå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•</a></li>
      </ul>
    </li>
    <li><a href="#åäºŒhadoopé«˜å¯ç”¨">åäºŒã€Hadoopé«˜å¯ç”¨</a>
      <ul>
        <li><a href="#ç¬¬ä¸€æ­¥é…ç½®core-sitexml">ç¬¬ä¸€æ­¥ï¼šé…ç½®<code>core-site.xml</code></a></li>
        <li><a href="#ç¬¬äºŒæ­¥é…ç½®hdfs-sitexml">ç¬¬äºŒæ­¥ï¼šé…ç½®<code>hdfs-site.xml</code></a></li>
        <li><a href="#ç¬¬ä¸‰æ­¥é…ç½®yarn-sitexml">ç¬¬ä¸‰æ­¥ï¼šé…ç½®<code>yarn-site.xml</code></a></li>
        <li><a href="#é›†ç¾¤ç¾¤èµ·">é›†ç¾¤ç¾¤èµ·</a></li>
      </ul>
    </li>
    <li><a href="#é™„å½•">é™„å½•</a></li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€hadoopå’Œå¤§æ•°æ®ç®€ä»‹">ä¸€ã€Hadoopå’Œå¤§æ•°æ®ç®€ä»‹</h2>
<h3 id="å¤§æ•°æ®">å¤§æ•°æ®</h3>
<p>â€‹	å¤§æ•°æ®(BigData) :æŒ‡æ— æ³•åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ç”¨å¸¸è§„è½¯ä»¶å·¥å…·è¿›è¡Œæ•æ‰ã€ç®¡ç†å’Œå¤„ç†çš„æ•°æ®é›†åˆï¼Œæ˜¯éœ€è¦æ–°å¤„ç†æ¨¡å¼æ‰èƒ½å…·æœ‰æ›´å¼ºçš„å†³ç­–åŠ›ã€æ´å¯Ÿå‘ç°åŠ›å’Œæµç¨‹ä¼˜åŒ–èƒ½åŠ›çš„æµ·é‡ã€é«˜å¢é•¿ç‡å’Œå¤šæ ·åŒ–çš„ä¿¡æ¯èµ„äº§ã€‚å¤§æ•°æ®å«æœ‰ç‰¹ç‚¹ï¼šVolumnï¼ˆå¤§é‡ï¼‰ã€Velocityï¼ˆé«˜é€Ÿï¼‰ã€Varietyï¼ˆå¤šæ ·ï¼‰ã€Valueï¼ˆä½ä»·å€¼å¯†åº¦ï¼‰</p>
<img src="/img/hadoop/bigdata-dept.png" alt="å¤§æ•°æ®éƒ¨é—¨" style="zoom:67%;" />
<h3 id="hadoop">Hadoop</h3>
<p>â€‹	Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šå¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€æ¶æ„ï¼Œä¸»è¦è§£å†³ï¼Œæµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚å¹¿ä¹‰ä¸Šæ¥è¯´ã€‚Hadoopé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µå³hadoopç”Ÿæ€åœˆã€‚</p>
<ul>
<li>Hadoopä¸»è¦ç‰ˆæœ¬ï¼šApacheç‰ˆæœ¬ã€æœ€åŸºç¡€ç‰ˆæœ¬ã€‘ã€Clouderaç‰ˆæœ¬-CDHã€å¤§å‹äº’è”ç½‘ä¸­åº”ç”¨è¾ƒå¤šã€‘ã€Hortonworksç‰ˆæœ¬ã€æ–‡æ¡£è¾ƒå¥½ã€‘</li>
<li>Hadoopä¸»è¦ä¼˜åŠ¿ï¼šé«˜å¯é ã€æ•°æ®æœ‰å‰¯æœ¬ã€‘ã€é«˜æ‰©å±•ã€æ–¹ä¾¿æ‰©å±•èŠ‚ç‚¹ã€‘ã€é«˜æ•ˆæ€§ã€é€Ÿåº¦å¿«ã€‘ã€é«˜å®¹é”™ã€èƒ½è‡ªåŠ¨é‡æ–°åˆ†é…å¤±è´¥ä»»åŠ¡ã€‘</li>
<li>Hadoopçš„ç»„æˆéƒ¨åˆ†ï¼šMapReduceï¼ˆè®¡ç®—ï¼‰ã€HDFSï¼ˆå­˜å‚¨ï¼‰ã€YARNï¼ˆèµ„æºè°ƒåº¦ï¼‰ã€COMMONï¼ˆè¾…åŠ©å·¥å…·ï¼‰</li>
</ul>
<p><strong>Hadoopçš„ç›®å½•å’Œä¸»è¦æ–‡ä»¶ç»“æ„</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>â”œâ”€â”€ binã€æœ€åŸºæœ¬çš„ç®¡ç†è„šæœ¬å’Œä½¿ç”¨è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œè¿™äº›è„šæœ¬æ˜¯sbinç›®å½•ä¸‹ç®¡ç†è„šæœ¬çš„åŸºç¡€å®ç°ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ container-executor
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ hadoop
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ hdfs
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ mapred
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ rcc
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ test-container-executor
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ yarn
</span></span><span style="display:flex;"><span>â”œâ”€â”€ etc ã€é…ç½®æ–‡ä»¶ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ hadoop
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ capacity-scheduler.xml
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ configuration.xsl
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ container-executor.cfg
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ core-site.xml                 ã€å…¨å±€é…ç½®æ–‡ä»¶å¦‚NameNodeçš„åœ°å€ã€å­˜å‚¨ç›®å½•ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ hadoop-env.sh                 ã€ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ hadoop-metrics2.properties
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ hadoop-metrics.properties
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ hadoop-policy.xml
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ hdfs-site.xml                 ã€HDFSçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶å¦‚å‰¯æœ¬æ•°ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ httpfs-env.sh
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ httpfs-log4j.properties
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ httpfs-signature.secret
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ httpfs-site.xml
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ kms-acls.xml
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ kms-env.sh
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ kms-log4j.properties
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ kms-site.xml
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ log4j.properties
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ mapred-env.sh
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ mapred-queues.xml.template
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ mapred-site.xml.template      ã€MapReduceçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ slaves                        ã€ç”¨äºè®¾ç½®æ‰€æœ‰çš„slaveçš„åç§°æˆ–IPï¼Œæ¯è¡Œå­˜æ”¾ä¸€ä¸ªã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ ssl-client.xml.example
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ ssl-server.xml.example
</span></span><span style="display:flex;"><span>â”‚Â Â      â”œâ”€â”€ yarn-env.sh
</span></span><span style="display:flex;"><span>â”‚Â Â      â””â”€â”€ yarn-site.xml                 ã€yarnçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‘
</span></span><span style="display:flex;"><span>â”œâ”€â”€ sbinã€ç®¡ç†è„šæœ¬æ‰€åœ¨ç›®å½•ï¼Œä¸»è¦åŒ…å«HDFSå’ŒYARNä¸­å„ç±»æœåŠ¡å¯åŠ¨/å…³é—­çš„è„šæœ¬ã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ hadoop-daemon.sh     ã€å¯åŠ¨æœ¬æœºNameNodeã€DataNodeä»¥åŠSecondaryNameNodeã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ hadoop-daemons.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ hdfs-config.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ refresh-namenodes.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ slaves.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ start-balancer.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ start-dfs.sh         ã€å¯åŠ¨NameNodeã€DataNodeä»¥åŠSecondaryNameNodeã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ start-secure-dns.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ start-yarn.sh        ã€å¯åŠ¨ResourceManagerä»¥åŠNodeManagerã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ stop-balancer.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ stop-dfs.sh          ã€åœæ­¢NameNodeã€DataNodeä»¥åŠSecondaryNameNodeã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ stop-secure-dns.sh
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ stop-yarn.sh         ã€åœæ­¢ResourceManagerä»¥åŠNodeManagerã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ yarn-daemon.sh       ã€å¯åŠ¨æœ¬æœºã€‘
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ yarn-daemons.sh
</span></span><span style="display:flex;"><span>â”œâ”€â”€ libã€åŒ…å«äº†Hadoopå¯¹å¤–æä¾›çš„ç¼–ç¨‹åŠ¨æ€åº“å’Œé™æ€åº“ï¼Œä¸includeç›®å½•ä¸­çš„å¤´æ–‡ä»¶ç»“åˆä½¿ç”¨ã€‘
</span></span><span style="display:flex;"><span>â”œâ”€â”€ libexecã€å„ä¸ªæœåŠ¡å¯¹åº”çš„shellé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œå¯ç”¨äºé…ç½®æ—¥å¿—è¾“å‡ºç›®å½•ã€å¯åŠ¨å‚æ•°ï¼ˆæ¯”å¦‚JVMå‚æ•°ï¼‰ç­‰åŸºæœ¬ä¿¡æ¯ã€‚ã€‘
</span></span><span style="display:flex;"><span>â””â”€â”€ shareã€å„ä¸ªæ¨¡å—ç¼–è¯‘åçš„JaråŒ…æ‰€åœ¨ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸­ä¹ŸåŒ…å«äº†Hadoopæ–‡æ¡£ã€‘
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äºŒhadoopå®‰è£…">äºŒã€Hadoopå®‰è£…</h2>
<p>å‰ç½®æ¡ä»¶ï¼šJDKå·²å®‰è£…</p>
<h3 id="ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…</h3>
<p>å‰ç½®å‡†å¤‡ï¼šå·²å®‰è£…<code>JDK</code>ã€<code>maven</code>ã€<code>ant</code></p>
<p>å®‰è£…ä¾èµ–ï¼š<code>yum install -y glibc-headers gcc-c++ make cmake openssl-devel ncurses-devel</code></p>
<p>ç¬¬ä¸€æ­¥ï¼šå®‰è£…<a href="https://github.com/protocolbuffers/protobuf/releases">protobuf</a></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./configure
</span></span><span style="display:flex;"><span>make <span style="color:#000;font-weight:bold">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>protoc --version
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šæºç ç¼–è¯‘</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -zxvf hadoop-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>-src.tar.gz
</span></span><span style="display:flex;"><span>mvn package -Pdist,native -DskipTests -Dmaven.javadoc.skip<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">true</span> -Dtar
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å•èŠ‚ç‚¹å®‰è£…">å•èŠ‚ç‚¹å®‰è£…</h3>
<p><strong>ç¬¬ä¸€æ­¥ å®‰è£…é…ç½®</strong></p>
<p>å·²å®‰è£…<code>openssl</code> ï¼Œ<code>openssl-devel</code>ï¼Œ<code>gcc</code>ï¼Œ<code>gcc-c++</code></p>
<p>Hadoopå·²è§£å‹å¹¶åˆ›å»º<code>HADOOP_HOME</code>å’ŒåŠ å…¥<code>PATH</code>å˜é‡ï¼Œå¹¶å°†è§£å‹çš„ç›®å½•æƒé™ç§»äº¤ç»™æŒ‡å®šç”¨æˆ·</p>
<p><strong>ç¬¬äºŒæ­¥ æµ‹è¯•</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cp etc/hadoop/*.xml input
</span></span><span style="display:flex;"><span>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.jar grep input output <span style="color:#d14">&#39;dfs[a-z.]+&#39;</span>
</span></span><span style="display:flex;"><span>cat output/*
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¼ªè£…åˆ†å¸ƒå¼å®‰è£…">ä¼ªè£…åˆ†å¸ƒå¼å®‰è£…</h3>
<h4 id="é…ç½®hdfs">é…ç½®HDFS</h4>
<p><strong>ç¬¬ä¸€æ­¥ å®‰è£…é…ç½®</strong></p>
<p>Hadoopå·²è§£å‹å¹¶åˆ›å»º<code>HADOOP_HOME</code>å’ŒåŠ å…¥<code>PATH</code>å˜é‡</p>
<p><strong>ç¬¬äºŒæ­¥ é…ç½®é›†ç¾¤</strong></p>
<p>â‘ é…ç½®<code>core-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHDFSä¸­NameNodeçš„åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;name&gt;</span>fs.defaultFS<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;value&gt;</span>hdfs://centos160:9000<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000080">&lt;name&gt;</span>hadoop.tmp.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000080">&lt;value&gt;</span>/opt/module/hadoop/data/tmp<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡é…ç½®<code>hdfs-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHDFSå‰¯æœ¬çš„æ•°é‡ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000080">&lt;name&gt;</span>dfs.replication<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000080">&lt;value&gt;</span>1<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰æ­¥ å¯åŠ¨é›†ç¾¤ï¼š</strong></p>
<p>â‘ æ ¼å¼åŒ–NameNodeã€ä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤idå¦‚æœå’ŒdataNodeçš„é›†ç¾¤idä¸åŒåˆ™æ‰¾ä¸åˆ°ä»¥å¾€æ•°æ®ã€‘</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hdfs namenode -format
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡å¯åŠ¨NameNodeå’ŒDataNode</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/hadoop-daemon.sh start namenode
</span></span><span style="display:flex;"><span>sbin/hadoop-daemon.sh start datanode
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>jps
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘£è®¿é—®<code>http://ip:50070</code>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>
<p>â‘¤æµ‹è¯•ä¸Šä¼ æ–‡ä»¶å’Œåˆ é™¤æ–‡ä»¶</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åˆ›å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span>hadoop fs -mkdir -p /user/kun/input
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ä¸Šä¼ æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>hadoop fs -put input/* /user/kun/input
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥çœ‹æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>hadoop fs -ls -R /user
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style="display:flex;"><span>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.jar wordcount /user/kun/input /user/kun/output
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥çœ‹ç»“æœ</span>
</span></span><span style="display:flex;"><span>hadoop fs -tail -f /user/kun/output/part-r-00000
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åˆ é™¤ç›®å½•</span>
</span></span><span style="display:flex;"><span>hadoop fs -rm -r /user
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®yarn">é…ç½®YARN</h4>
<p><strong>ç¬¬ä¸€æ­¥ é…ç½®é›†ç¾¤</strong></p>
<p>â‘ é…ç½®<code>yarn-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- Reducerè·å–æ•°æ®çš„æ–¹å¼ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>mapreduce_shuffle<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šYARNçš„ResourceManagerçš„åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.hostname<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos160<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡é…ç½®<code>mapred-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šMRè¿è¡Œåœ¨YARNä¸Š --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.framework.name<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>yarn<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ å¯åŠ¨é›†ç¾¤</strong></p>
<p>â‘ å¯åŠ¨ResourceManagerå’ŒNodeManager</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/yarn-daemon.sh start resourcemanager
</span></span><span style="display:flex;"><span>sbin/yarn-daemon.sh start nodemanager
</span></span><span style="display:flex;"><span>jps
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡è®¿é—®<code>http://ip:8088</code>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>
<p>â‘¢æ‰§è¡Œæµ‹è¯•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style="display:flex;"><span>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.jar wordcount /user/kun/input /user/kun/output
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®å†å²æœåŠ¡å™¨">é…ç½®å†å²æœåŠ¡å™¨</h4>
<p>â‘ é…ç½®<code>mapred-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.jobhistory.address<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos160:10020<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å†å²æœåŠ¡å™¨webç«¯åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.jobhistory.webapp.address<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos160:19888<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡å¯åŠ¨å†å²æœåŠ¡å™¨</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/mr-jobhistory-daemon.sh start historyserver
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢è®¿é—®<code>http://ip:19888/jobhistory</code>å†å²æœåŠ¡å™¨</p>
<h4 id="é…ç½®æ—¥å¿—èšé›†">é…ç½®æ—¥å¿—èšé›†</h4>
<p>â‘ å…³é—­NodeManager ã€ResourceManagerå’ŒHistoryManager</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/yarn-daemon.sh stop resourcemanager
</span></span><span style="display:flex;"><span>sbin/yarn-daemon.sh stop nodemanager
</span></span><span style="display:flex;"><span>sbin/mr-jobhistory-daemon.sh stop historyserver
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡é…ç½®<code>yarn-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.log-aggregation-enable<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æ—¥å¿—ä¿ç•™æ—¶é—´è®¾ç½®7å¤© --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.log-aggregation.retain-seconds<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>604800<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>mapreduce_shuffle<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢å¯åŠ¨NodeManager ã€ResourceManagerå’ŒHistoryManager</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/yarn-daemon.sh start resourcemanager
</span></span><span style="display:flex;"><span>sbin/yarn-daemon.sh start nodemanager
</span></span><span style="display:flex;"><span>sbin/mr-jobhistory-daemon.sh start historyserver
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šä»¥åæ‰§è¡Œçš„ä»»åŠ¡æ‰èƒ½æŸ¥çœ‹èšé›†æ—¥å¿—</p>
</blockquote>
<h3 id="åˆ†å¸ƒå¼å®‰è£…">åˆ†å¸ƒå¼å®‰è£…</h3>
<p>éƒ¨ç½²è§„åˆ’</p>
<table>
<thead>
<tr>
<th></th>
<th>Hadoop161</th>
<th>Hadoop162</th>
<th>Hadoop163</th>
</tr>
</thead>
<tbody>
<tr>
<td>HDFS</td>
<td>NameNode/DataNode</td>
<td>DataNode</td>
<td>DataNode/SecondaryNameNode</td>
</tr>
<tr>
<td>YARN</td>
<td>NodeManager</td>
<td>ResourceManager/NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody>
</table>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç³»ç»Ÿé…ç½®</strong></p>
<p>â‘ é…ç½®<code>/etc/hosts</code></p>
<pre tabindex="0"><code>::1         localhost
127.0.0.1   localhost
192.168.1.161   centos161
192.168.1.162   centos162
192.168.1.163   centos163
</code></pre><p>åˆ†å‘<code>rsync -rvl /etc/hosts root@192.168.1.162:/etc/hosts</code></p>
<p>åˆ†å‘<code>rsync -rvl /etc/hosts root@192.168.1.163:/etc/hosts</code></p>
<p>â‘¡é…ç½®NameNodeèŠ‚ç‚¹sshç™»é™†ã€æ³¨æ„åˆ‡æ¢ç”¨æˆ·ä¸ºhadoopçš„ä½¿ç”¨ç”¨æˆ·ã€‘</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ç”Ÿæˆå¯†é’¥</span>
</span></span><span style="display:flex;"><span>ssh-keygen -t rsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># å…¨éƒ¨éƒ½éœ€è¦ï¼ŒåŒ…æ‹¬æœ¬æœº</span>
</span></span><span style="display:flex;"><span>ssh-copy-id centos161
</span></span><span style="display:flex;"><span>ssh-copy-id centos162
</span></span><span style="display:flex;"><span>ssh-copy-id centos163
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢é…ç½®ResourceManagerèŠ‚ç‚¹sshç™»é™†ã€æ³¨æ„åˆ‡æ¢ç”¨æˆ·ä¸ºhadoopçš„ä½¿ç”¨ç”¨æˆ·ã€‘</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šhadoopé…ç½®</strong></p>
<p>â‘ é…ç½®<code>core-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHDFSä¸­NameNodeçš„åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>fs.defaultFS<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>hdfs://centos161:9000<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hadoop.tmp.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/opt/module/hadoop/data/tmp<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æœ‰è®¿é—®æƒé™çš„ä»£ç†ç”¨æˆ· --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hadoop.proxyuser.kun.hosts<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>*<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hadoop.proxyuser.kun.groups<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>*<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é»˜è®¤ç”¨æˆ· --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hadoop.http.staticuser.user<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>kun<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡é…ç½®<code>hdfs-site.xml </code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.replication<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>3<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHadoopè¾…åŠ©åç§°èŠ‚ç‚¹ä¸»æœºé…ç½® --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.secondary.http-address<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos163:50090<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å—å­˜å‚¨å¤§å°é»˜è®¤128Mï¼ŒHDFSå—çš„å¤§å°è®¾ç½®ä¸»è¦å–å†³äºç£ç›˜ä¼ è¾“é€Ÿç‡ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.blocksize<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>134217728<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢é…ç½®<code>yarn-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- Reducerè·å–æ•°æ®çš„æ–¹å¼ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>mapreduce_shuffle<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šYARNçš„ResourceManagerçš„åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.hostname<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos162<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘£é…ç½®<code>slaves</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>centos161
</span></span><span style="display:flex;"><span>centos162
</span></span><span style="display:flex;"><span>centos163
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¤åˆ†å‘é…ç½®æ–‡ä»¶</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> rsync -rvl /opt/module/hadoop/etc/hadoop/* root@192.168.1.162:/opt/module/hadoop/etc/hadoop/
</span></span><span style="display:flex;"><span> rsync -rvl /opt/module/hadoop/etc/hadoop/* root@192.168.1.163:/opt/module/hadoop/etc/hadoop/
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰æ­¥ å¯åŠ¨é›†ç¾¤ï¼š</strong></p>
<p>â‘ NameNodeèŠ‚ç‚¹æ ¼å¼åŒ–</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hdfs namenode -format
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡å¯åŠ¨HDFS</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/start-dfs.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢ç”¨<code>jps</code>æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€</p>
<p>â‘£è®¿é—®<code>http://snnIp:50090/status.html</code>æŸ¥çœ‹secondaryNameNode</p>
<p>â‘¤åœ¨ResourceMangerèŠ‚ç‚¹å¯åŠ¨YARN</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/start-yarn.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬å››æ­¥ é›†ç¾¤æµ‹è¯•</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hadoop fs -mkdir -p /user/kun/input
</span></span><span style="display:flex;"><span>hadoop fs -put etc/hadoop/*.xml /user/kun/input
</span></span><span style="display:flex;"><span>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.10.0.jar wordcount /user/kun/input /user/kun/output
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é›†ç¾¤æ—¶é—´åŒæ­¥">é›†ç¾¤æ—¶é—´åŒæ­¥</h3>
<p><strong>ç¬¬ä¸€æ­¥ é…ç½®ä¸€å°æœºå™¨ä¸ºæ—¶é—´æœåŠ¡å™¨</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum install ntp
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ é…ç½®<code>/etc/ntp.conf</code></strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf"># æˆæƒ192.168.1.0-192.168.1.255ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´
restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap

# é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ï¼Œä½¿ç”¨è‡ªå·±çš„æ—¶é’Ÿ
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst

# å½“è¯¥èŠ‚ç‚¹ä¸¢å¤±ç½‘ç»œè¿æ¥ï¼Œä¾ç„¶å¯ä»¥é‡‡ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ä¸ºé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥
server 127.127.1.0
# æ—¶é—´ç²¾å‡†ç­‰çº§
fudge 127.127.1.0 stratum 10
</code></pre><p><strong>ç¬¬ä¸‰æ­¥ é…ç½®<code>/etc/sysconfig/ntpd</code></strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">SYNC_HWCLOCK=yes
</code></pre><p><strong>ç¬¬å››æ­¥ é‡æ–°å¯åŠ¨ntpdæœåŠ¡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl restart ntpd
</span></span><span style="display:flex;"><span>chkconfig ntpd on
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äº”æ­¥ é…ç½®å…¶å®ƒæœºå™¨åŒæ­¥æ—¶é—´æœåŠ¡å™¨</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>crontab -e
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># */10 * * * * /usr/sbin/ntpdate centos161</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬å…­æ­¥ ä¿®æ”¹ä»»æ„æœºå™¨æ—¶é—´æŸ¥çœ‹æœºå™¨æ˜¯å¦ä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>date -s <span style="color:#d14">&#34;2017-9-11 11:11:11&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ç­‰å¾…åŒæ­¥</span>
</span></span><span style="display:flex;"><span>date
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸‰hdfçš„æ¦‚è¿°">ä¸‰ã€HDFçš„æ¦‚è¿°</h2>
<p>HDFS (Hadoop Distributed File System)æ˜¯ä¸ªåˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ï¼Œé€šè¿‡ç›®å½•æ ‘æ¥å®šä½æ–‡ä»¶ã€‚</p>
<p>HDFSçš„ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ï¼Œä¸”ä¸æ”¯æŒæ–‡ä»¶çš„ä¿®æ”¹ã€‚é€‚åˆåšæ•°æ®åˆ†æï¼Œä¸é€‚åˆç”¨æ¥åšç½‘ç›˜åº”ç”¨ï¼Œå®æ—¶æ€§å·®ã€‚</p>
<p><strong>HDFSçš„ä¼˜ç‚¹</strong></p>
<ul>
<li>é«˜å®¹é”™æ€§</li>
<li>é€‚åˆå¤§æ•°æ®å¤„ç†</li>
<li>å¯æ„å»ºåœ¨å»‰ä»·æœºå™¨ä¸Š</li>
</ul>
<p><strong>HDFSçš„ç¼ºç‚¹</strong></p>
<ul>
<li>ä¸é€‚åˆä½å»¶æ—¶æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¯«ç§’çº§çš„å­˜å‚¨æ•°æ®</li>
<li>æ— æ³•é«˜æ•ˆçš„å¯¹å¤§é‡å°æ–‡ä»¶è¿›è¡Œå­˜å‚¨
<ul>
<li>å­˜å‚¨å¤§é‡å°æ–‡ä»¶çš„è¯ï¼Œå®ƒä¼šå ç”¨NarmeNodeå¤§é‡çš„å†…å­˜æ¥å­˜å‚¨æ–‡ä»¶</li>
<li>å°æ–‡ä»¶å­˜å‚¨çš„å¯»å€æ—¶é—´ä¼šè¶…è¿‡è¯»å–æ—¶é—´ï¼Œå®ƒè¿åäº†HDFSçš„è®¾è®¡ç›®æ ‡</li>
</ul>
</li>
<li>ä¸æ”¯æŒå¹¶å‘å†™å…¥ã€æ–‡ä»¶éšæœºä¿®æ”¹
<ul>
<li>ä¸å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™</li>
<li>ä»…æ”¯æŒæ•°æ®è¿½åŠ ï¼Œä¸æ”¯æŒæ–‡ä»¶çš„éšæœºä¿®æ”¹</li>
</ul>
</li>
</ul>
<p><strong>HDFSæ¶æ„</strong></p>
<img src="/img/hadoop/hdfsarchitecture.png" alt="HDFS Architecture" style="zoom:80%;" />
<p>NameNodeï¼šâ‘ ç®¡ç†HDFSåç§°ç©ºé—´ï¼›â‘¡é…ç½®å‰¯æœ¬ç­–ç•¥ï¼›â‘¢ç®¡ç†æ•°æ®å—æ˜ å°„ä¿¡æ¯ï¼›â‘£å¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ï¼›</p>
<p>DataNodeï¼šâ‘ å­˜å‚¨å®é™…çš„æ•°æ®å—ï¼›â‘¡æ‰§è¡Œæ•°æ®å—çš„è¯»/å†™è¯·æ±‚ï¼›</p>
<p>Clientï¼šâ‘ æ–‡ä»¶åˆ‡åˆ†ï¼Œæ–‡ä»¶ä¸Šä¼ æ—¶åˆ‡åˆ†ä¸ºä¸€å—å—Blockï¼›â‘¡NameNodeäº¤äº’è·å–æ–‡ä»¶ä½ç½®ä¿¡æ¯ï¼›â‘¢DataNodeäº¤äº’è¯»å†™æ–‡ä»¶ï¼›</p>
<p>SecondaryNameNodeï¼šâ‘ è¾…åŠ©NameNodeï¼Œåˆ†æ‹…å®šæœŸå·¥ä½œå¦‚FsImageã€Editsï¼›â‘¡ç´§æ€¥æƒ…å†µä¸‹è¾…åŠ©æ¢å¤NameNodeï¼›</p>
<h2 id="å››hdfsçš„æ“ä½œ">å››ã€HDFSçš„æ“ä½œ</h2>
<h3 id="shellæ“ä½œ">Shellæ“ä½œ</h3>
<p>â‘ æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨<code>hadoop fs -ls /path</code>ï¼Œå¯é€‰å‚æ•°-Rã€é€’å½’å±•ç¤ºç›¸å½“äºtreeã€‘</p>
<p>â‘¡åˆ›å»ºç›®å½•<code>hadoop fs -mkdir /path/dir</code>ï¼Œå¯é€‰å‚æ•°-pã€åˆ›å»ºå¤šçº§ç›®å½•ã€‘</p>
<p>â‘¢å‰ªåˆ‡æœ¬åœ°æ–‡ä»¶åˆ°æœåŠ¡å™¨<code>hadoop fs -moveFromLocal file /path</code></p>
<p>â‘£è¿½åŠ æœ¬åœ°æ–‡ä»¶åˆ°æœåŠ¡å™¨<code>hadoop fs -appendToFile file /path</code></p>
<p>â‘¤æŸ¥çœ‹æ–‡ä»¶<code> hadoop fs -cat /path/file</code></p>
<p>â‘¥å¤åˆ¶æœ¬åœ°æ–‡ä»¶åˆ°æœåŠ¡å™¨<code>hadoop fs -copyFromLocal file /path</code>æˆ–<code>hadoop fs -put file /path</code></p>
<p>â‘¦ä»æœåŠ¡å™¨æ‹·è´åˆ°æœ¬åœ°<code>hadoop fs -copyToLocal /path file</code>æˆ–<code>hadoop fs -get /path file</code></p>
<p>â‘§æœåŠ¡å™¨æ–‡ä»¶æ‹·è´<code>hadoop fs -cp /path /path</code></p>
<p>â‘¨æœåŠ¡å™¨æ–‡ä»¶å‰ªåˆ‡<code>hadoop fs -mv /path /path</code></p>
<p>â‘©åˆå¹¶å¤šä¸ªæ–‡ä»¶è¿›è¡Œä¸‹è½½<code>hadoop fs -getmerge /path/* file</code></p>
<p>â‘ªæŸ¥çœ‹æ–‡ä»¶åå‡ è¡Œ<code>hadoop fs -tail /path</code></p>
<p>â‘«åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹<code>hadoop fs -rm -f /path</code></p>
<p>â‘¬ç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯<code>hadoop fs -du -h /</code></p>
<p>â‘­æ–‡ä»¶å‰¯æœ¬æ•°é‡<code>hadoop fs -setrep 10 /path</code></p>
<p>â‘®ä¿®æ”¹æ–‡ä»¶æƒé™<code>chown chgrp chmod</code></p>
<h3 id="hdfsçš„apiæ“ä½œ">HDFSçš„APIæ“ä½œ</h3>
<h4 id="åˆ›å»ºç›®å½•">åˆ›å»ºç›®å½•</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">mkdirTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>configuration.<span style="color:#008080">set</span>(<span style="color:#d14">&#34;dfs.replication&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;2&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>success<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">mkdirs</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/java/api/input&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ‰§è¡Œç»“æœ{}&#34;</span>,<span style="color:#bbb"> </span>success);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¸Šä¼ æ“ä½œ">ä¸Šä¼ æ“ä½œ</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">copyTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">copyToLocalFile</span>(<span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/sanguo&#34;</span>),<span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;F:\\input&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">ioInputTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>InputStream<span style="color:#bbb"> </span>inputStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FileInputStream(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>File(<span style="color:#d14">&#34;F:\\input\\sanguo\\wuguo.txt&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>OutputStream<span style="color:#bbb"> </span>outputStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">create</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/wuguo.txt&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>IOUtils.<span style="color:#008080">copyBytes</span>(inputStream,<span style="color:#bbb"> </span>outputStream,<span style="color:#bbb"> </span>configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¸‹è½½æ“ä½œ">ä¸‹è½½æ“ä½œ</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">copyTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">copyToLocalFile</span>(<span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/sanguo&#34;</span>),<span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;F:\\input&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">ioDownTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>OutputStream<span style="color:#bbb"> </span>outputStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FileOutputStream(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>File(<span style="color:#d14">&#34;F:\\input\\sanguo\\wuguo.txt&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>InputStream<span style="color:#bbb"> </span>inputStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">open</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/wuguo.txt&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>IOUtils.<span style="color:#008080">copyBytes</span>(inputStream,<span style="color:#bbb"> </span>outputStream,<span style="color:#bbb"> </span>configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ é™¤æ“ä½œ">åˆ é™¤æ“ä½œ</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">rmTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>success<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">delete</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/sanguo&#34;</span>),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ‰§è¡Œç»“æœ{}&#34;</span>,<span style="color:#bbb"> </span>success);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é‡å‘½åæ“ä½œ">é‡å‘½åæ“ä½œ</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">renameTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>success<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">rename</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/sanguo&#34;</span>),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/ThreeKing&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ‰§è¡Œç»“æœ{}&#34;</span>,<span style="color:#bbb"> </span>success);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ–‡ä»¶è¯¦æƒ…è·å–">æ–‡ä»¶è¯¦æƒ…è·å–</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">fileDetailTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>),<span style="color:#bbb"> </span>configuration,<span style="color:#bbb"> </span><span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * listFilesï¼šåªèƒ½åˆ—å‡ºæ–‡ä»¶ï¼Œå¯æ§åˆ¶æ˜¯å¦é€’å½’
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * listLocatedStatus: åªèƒ½è·å–å½“å‰ç›®å½•ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * listStatusIterator: å’ŒlistLocatedStatusç›¸ä¼¼ï¼Œä½†è¿”å›çš„æ˜¯æ–‡ä»¶å—çŠ¶æ€ä¿¡æ¯å°‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>RemoteIterator<span style="color:#000;font-weight:bold">&lt;</span>LocatedFileStatus<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>listFiles<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">listLocatedStatus</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/ThreeKing&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(listFiles.<span style="color:#008080">hasNext</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>LocatedFileStatus<span style="color:#bbb"> </span>fileStatus<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>listFiles.<span style="color:#008080">next</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ–‡ä»¶å:{}&#34;</span>,<span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">getPath</span>().<span style="color:#008080">getName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;é•¿åº¦:{}&#34;</span>,<span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">getLen</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æƒé™:{}&#34;</span>,<span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">getPermission</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ˜¯æ–‡ä»¶:{}&#34;</span>,<span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">isFile</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;æ˜¯ç›®å½•:{}&#34;</span>,<span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">isDirectory</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å—ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>BlockLocation<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>blockLocations<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileStatus.<span style="color:#008080">getBlockLocations</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(BlockLocation<span style="color:#bbb"> </span>blockLocation<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>blockLocations)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>hosts<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>blockLocation.<span style="color:#008080">getHosts</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(String<span style="color:#bbb"> </span>host<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>hosts)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;å­˜å‚¨èŠ‚ç‚¹:{}&#34;</span>,<span style="color:#bbb"> </span>host);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>fileSystem.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”hdfsçš„å·¥ä½œæœºåˆ¶">äº”ã€HDFSçš„å·¥ä½œæœºåˆ¶</h2>
<h3 id="hdfså†™æ•°æ®æµç¨‹">HDFSå†™æ•°æ®æµç¨‹</h3>
<img src="/img/hadoop/hdfs-write.png" alt="hdfs-write" style="zoom: 80%;" />
<ol>
<li>è·ŸNameNodeé€šä¿¡è¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼ŒNameNodeæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œçˆ¶ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨</li>
<li>NameNodeè¿”å›æ˜¯å¦å¯ä»¥ä¸Šä¼ </li>
<li>Clientå…ˆå¯¹æ–‡ä»¶è¿›è¡Œåˆ‡åˆ†ï¼Œè¯·æ±‚ç¬¬ä¸€ä¸ªblockè¯¥ä¼ è¾“åˆ°å“ªäº›DataNodeæœåŠ¡å™¨ä¸Š</li>
<li>NameNodeè¿”å›3ä¸ªDataNodeæœåŠ¡å™¨DataNode 1ï¼ŒDataNode 2ï¼ŒDataNode 3</li>
<li>Clientè¯·æ±‚3å°ä¸­çš„ä¸€å°DataNode 1ï¼ˆç½‘ç»œæ‹“æ‰‘ä¸Šçš„å°±è¿‘åŸåˆ™ï¼‰ä¸Šä¼ æ•°æ®ï¼ŒDataNode 1æ”¶åˆ°è¯·æ±‚ä¼šç»§ç»­è°ƒç”¨DataNode 2ï¼Œç„¶åDataNode 2è°ƒç”¨DataNode 3ï¼Œå°†æ•´ä¸ªpipelineå»ºç«‹å®Œæˆï¼Œç„¶åé€çº§è¿”å›å®¢æˆ·ç«¯</li>
<li>Clientå¼€å§‹å¾€DataNode 1ä¸Šä¼ ç¬¬ä¸€ä¸ªblockï¼ˆå…ˆä»ç£ç›˜è¯»å–æ•°æ®æ”¾åˆ°ä¸€ä¸ªæœ¬åœ°å†…å­˜ç¼“å­˜ï¼‰ï¼Œä»¥pocketä¸ºå•ä½ã€‚å†™å…¥çš„æ—¶å€™DataNodeä¼šè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå®ƒå¹¶ä¸æ˜¯é€šè¿‡ä¸€ä¸ªpacketè¿›è¡Œä¸€æ¬¡æ ¡éªŒè€Œæ˜¯ä»¥chunkä¸ºå•ä½è¿›è¡Œæ ¡éªŒï¼ˆ512byteï¼‰ã€‚DataNode 1æ”¶åˆ°ä¸€ä¸ªpacketå°±ä¼šä¼ ç»™DataNode 2ï¼ŒDataNode 2ä¼ ç»™DataNode 3ï¼ŒDataNode 1æ¯ä¼ ä¸€ä¸ªpocketä¼šæ”¾å…¥ä¸€ä¸ªåº”ç­”é˜Ÿåˆ—ç­‰å¾…åº”ç­”</li>
<li>ä¸€ä¸ªblockä¼ è¾“å®Œæˆä¹‹åï¼ŒClientå†æ¬¡è¯·æ±‚NameNodeä¸Šä¼ ç¬¬äºŒä¸ªblockçš„æœåŠ¡å™¨.</li>
<li>ä¼ è¾“å®ŒæˆClienté€šçŸ¥NameNode</li>
</ol>
<h3 id="hdfsçš„è¯»æ•°æ®æµç¨‹">HDFSçš„è¯»æ•°æ®æµç¨‹</h3>
<img src="/img/hadoop/hdfs-read.png" alt="hdfs-read" style="zoom:80%;" />
<ol>
<li>ä¸NameNodeé€šä¿¡æŸ¥è¯¢å…ƒæ•°æ®ï¼Œæ‰¾åˆ°æ–‡ä»¶å—æ‰€åœ¨çš„DataNodeæœåŠ¡å™¨</li>
<li>æŒ‘é€‰ä¸€å°DataNodeï¼ˆç½‘ç»œæ‹“æ‰‘ä¸Šçš„å°±è¿‘åŸåˆ™ï¼‰æœåŠ¡å™¨ï¼Œè¯·æ±‚å»ºç«‹socketæµ</li>
<li>DataNodeå¼€å§‹å‘é€æ•°æ®ï¼Œä»¥packetï¼ˆ64kbï¼‰ä¸ºå•ä½æ¥åšæ ¡éªŒ</li>
<li>å®¢æˆ·ç«¯ä»¥packetä¸ºå•ä½æ¥æ”¶ï¼Œå…ˆåœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†™å…¥ç›®æ ‡æ–‡ä»¶</li>
<li>è¯»å®Œä¸€ä¸ªblockç»§ç»­ä¸²è¡Œè¯»å–ä¸‹ä¸ªblock</li>
</ol>
<h3 id="namenodeå’Œsecondarynamenodeå·¥ä½œæœºåˆ¶">NameNodeå’ŒSecondaryNameNodeå·¥ä½œæœºåˆ¶</h3>
<img src="/img/hadoop/NN-2NN.png" alt="NN-2NN" style="zoom:67%;" />
<blockquote>
<p>Fsimageï¼šNameNodeå†…å­˜ä¸­å…ƒæ•°æ®åºåˆ—åŒ–åå½¢æˆçš„æ–‡ä»¶ï¼›Editsï¼šè®°å½•å®¢æˆ·ç«¯æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯çš„æ¯ä¸€æ­¥æ“ä½œ</p>
</blockquote>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šNameNodeå¯åŠ¨</strong></p>
<ol>
<li>ç¬¬ä¸€æ¬¡å¯åŠ¨æ ¼å¼åŒ–åçš„NameNodeæ—¶ï¼Œåˆ›å»ºFsimageå’ŒEditsæ–‡ä»¶ã€‚å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œç›´æ¥åŠ è½½ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶åˆ°å†…å­˜</li>
<li>å®¢æˆ·ç«¯å¯¹å…ƒæ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„è¯·æ±‚</li>
<li>NameNodeè®°å½•æ“ä½œæ—¥å¿—ï¼Œæ›´æ–°æ»šåŠ¨æ—¥å¿—</li>
<li>NameNodeåœ¨å†…å­˜ä¸­å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹</li>
</ol>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šSecondary NameNodeå·¥ä½œ</strong></p>
<ol>
<li>Secondary NameNodeè¯¢é—®NameNodeæ˜¯å¦éœ€è¦CheckPoint</li>
<li>Secondary NameNodeè¯·æ±‚æ‰§è¡ŒCheckPoint</li>
<li>NameNodeæ»šåŠ¨æ­£åœ¨å†™çš„Editsæ—¥å¿—</li>
<li>å°†æ»šåŠ¨å‰çš„ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶æ‹·è´åˆ°Secondary NameNode</li>
<li>Secondary NameNodeåŠ è½½ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶åˆ°å†…å­˜ï¼Œå¹¶åˆå¹¶</li>
<li>ç”Ÿæˆæ–°çš„é•œåƒæ–‡ä»¶fsimage.chkpoint</li>
<li>æ‹·è´fsimage.chkpointåˆ°NameNode</li>
<li>NameNodeå°†fsimage.chkpointé‡æ–°å‘½åæˆfsimage</li>
</ol>
<h4 id="checkpointçš„åˆ¤æ–­">CheckPointçš„åˆ¤æ–­</h4>
<p>â‘ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSecondaryNameNodeæ¯éš”ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.checkpoint.period<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>3600<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°ï¼Œ3å½“æ“ä½œæ¬¡æ•°è¾¾åˆ°1ç™¾ä¸‡æ—¶ï¼ŒSecondaryNameNodeæ‰§è¡Œä¸€æ¬¡</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æ“ä½œæ¬¡æ•°çš„é˜ˆå€¼ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.checkpoint.txns<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>1000000<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æ“ä½œé˜ˆå€¼çš„æ—¶é—´ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.checkpoint.check.period<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>60<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property &gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="namenodeæ•…éšœå¤„ç†">NameNodeæ•…éšœå¤„ç†</h4>
<p><strong>æ–¹å¼ä¸€ï¼šå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•</strong></p>
<p><strong>æ–¹å¼äºŒï¼šå°†æ£€æŸ¥ç‚¹æ—¶é—´æ”¹å°ã€ä¹‹åéœ€è¦æ”¹å›å»ã€‘ï¼Œä¹‹åç»™SecondaryNameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„å¹³çº§ç›®å½•ï¼Œå¹¶åˆ é™¤in_use.lockæ–‡ä»¶ã€‚å¯¼å…¥æ£€æŸ¥ç‚¹æ•°æ®<code>bin/hdfs namenode -importCheckpoint</code>ï¼Œç­‰å¾…ä¸€ä¼šä¹‹åé€€å‡º</strong></p>
<h4 id="é›†ç¾¤å®‰å…¨æ¨¡å¼">é›†ç¾¤å®‰å…¨æ¨¡å¼</h4>
<p><strong>NameNodeå¯åŠ¨</strong></p>
<p>â€‹	NameNodeå¯åŠ¨æ—¶ï¼Œé¦–å…ˆå°†é•œåƒæ–‡ä»¶ï¼ˆFsimageï¼‰è½½å…¥å†…å­˜ï¼Œå¹¶æ‰§è¡Œç¼–è¾‘æ—¥å¿—(Edits) ä¸­çš„å„é¡¹æ“ä½œã€‚ä¸€æ—¦åœ¨å†…å­˜ä¸­æˆåŠŸå»ºç«‹æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„æ˜ åƒï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„Fsimageæ–‡ä»¶å’Œä¸€ä¸ªç©ºçš„ç¼–è¾‘æ—¥å¿—ã€‚æ­¤æ—¶ï¼ŒNameNodeå¼€å§‹ç›‘å¬DataNodeè¯·æ±‚ã€‚<span style="color:red">è¿™ä¸ªè¿‡ç¨‹æœŸé—´NameNodeä¸€ç›´è¿è¡Œåœ¨å®‰å…¨æ¨¡å¼ï¼Œå³NameNodeçš„æ–‡ä»¶ç³»ç»Ÿå¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ˜¯åªè¯»çš„ã€‚</span></p>
<p><strong>DataNodeå¯åŠ¨</strong></p>
<p>â€‹	<span style="color:red">ç³»ç»Ÿä¸­çš„æ•°æ®å—çš„ä½ç½®å¹¶ä¸æ˜¯ç”±NameNodeç»´æŠ¤çš„ï¼Œè€Œæ˜¯ä»¥å—åˆ—è¡¨çš„å½¢å¼å­˜å‚¨åœ¨DataNodeä¸­ã€‚</span>åœ¨ç³»ç»Ÿçš„æ­£å¸¸æ“ä½œæœŸé—´ï¼ŒNameNode ä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰å—ä½ç½®çš„æ˜ å°„ä¿¡æ¯ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸‹ï¼Œå„ä¸ªDataNodeä¼šå‘NameNodeå‘é€æœ€æ–°çš„å—åˆ—è¡¨ä¿¡æ¯ï¼ŒNameNodeäº†è§£åˆ°è¶³å¤Ÿå¤šçš„å—ä½ç½®ä¿¡æ¯ä¹‹åï¼Œå³å¯é«˜æ•ˆè¿è¡Œæ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p><strong>å®‰å…¨æ¨¡å¼é€€å‡ºåˆ¤æ–­</strong></p>
<p>â€‹		<span style="color:red">å¦‚æœæ»¡è¶³&quot;æœ€å°å‰¯æœ¬æ¡ä»¶&quot;ï¼ŒNameNodeä¼šåœ¨30ç§’é’Ÿä¹‹åå°±é€€å‡ºå®‰å…¨æ¨¡å¼ã€‚</span>æ‰€è°“çš„æœ€å°å‰¯æœ¬æ¡ä»¶æŒ‡çš„æ˜¯åœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­99.9%çš„å—æ»¡è¶³æœ€å°å‰¯æœ¬çº§åˆ«(é»˜è®¤å€¼: dfs.replication.min=1)ã€‚åœ¨å¯åŠ¨ä¸€ä¸ªåˆšåˆšæ ¼å¼åŒ–çš„HDFSé›†ç¾¤æ—¶ï¼Œå› ä¸ºç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ä»»ä½•å—ï¼Œæ‰€ä»¥NameNodeä¸ä¼šè¿›å…¥å®‰å…¨æ¨¡å¼ã€‚</p>
<p><strong>å®‰å…¨æ¨¡å¼æ“ä½œå‘½ä»¤</strong></p>
<ul>
<li><code>hdfs dfsadmin -safemode get</code>ã€æŸ¥çœ‹å®‰å…¨æ¨¡å¼çŠ¶æ€ã€‘</li>
<li><code>hdfs dfsadmin -safemode enter</code>ã€è¿›å…¥å®‰å…¨æ¨¡å¼çŠ¶æ€ã€‘</li>
<li><code>hdfs dfsadmin -safemode leave</code>ã€ç¦»å¼€å®‰å…¨æ¨¡å¼çŠ¶æ€ã€‘</li>
<li><code>hdfs dfsadmin -safemode wait</code>ã€ç­‰å¾…å®‰å…¨æ¨¡å¼ç»“æŸã€‘</li>
</ul>
<h4 id="namenodeå¤šç›®å½•é…ç½®">NameNodeå¤šç›®å½•é…ç½®</h4>
<p>NameNodeçš„æœ¬åœ°ç›®å½•å¯ä»¥é…ç½®æˆå¤šä¸ªï¼Œ<span style="color:red">æ¯ä¸ªç›®å½•å­˜æ”¾å†…å®¹ç›¸åŒï¼Œå¢åŠ äº†å¯é æ€§</span></p>
<p>ç¬¬ä¸€æ­¥ï¼šé…ç½®<code>hdfs-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.name.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>file:///${hadoop.tmp.dir}/dfs/name1,file:///${hadoop.tmp.dir}/dfs/name2<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šé‡æ–°æ ¼å¼åŒ–NameNode</p>
<h3 id="datanodeå·¥ä½œæœºåˆ¶">DataNodeå·¥ä½œæœºåˆ¶</h3>
<img src="/img/hadoop/datanode.png" alt="datanode" style="zoom:77%;" />
<ol>
<li>ä¸€ä¸ªæ•°æ®å—åœ¨DataNodeä¸Šä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒåŒ…æ‹¬ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯æ•°æ®æœ¬èº«ï¼Œä¸€ä¸ªæ˜¯å…ƒæ•°æ®åŒ…æ‹¬æ•°æ®å—çš„é•¿åº¦ï¼Œå—æ•°æ®çš„æ ¡éªŒå’Œï¼Œä»¥åŠæ—¶é—´æˆ³</li>
<li>DataNodeå¯åŠ¨åå‘NameNodeæ³¨å†Œï¼Œé€šè¿‡åï¼Œå‘¨æœŸæ€§ï¼ˆ1å°æ—¶ï¼‰çš„å‘NameNodeä¸ŠæŠ¥æ‰€æœ‰çš„å—ä¿¡æ¯</li>
<li>æ¯3ç§’è¿›è¡Œä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œå¿ƒè·³è¿”å›ç»“æœå¸¦æœ‰NameNodeç»™è¯¥DataNodeçš„å‘½ä»¤ã€å¦‚å¤åˆ¶å—æ•°æ®åˆ°å¦ä¸€å°æœºå™¨æˆ–åˆ é™¤æŸä¸ªæ•°æ®å—ã€‘å¦‚æœè¶…è¿‡10åˆ†é’Ÿæ²¡æœ‰æ”¶åˆ°æŸä¸ªDataNodeçš„å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚</li>
</ol>
<h4 id="æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®">æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®</h4>
<p>å½“DataNodeè¿›ç¨‹æ­»äº¡æˆ–è€…ç½‘ç»œæ•…éšœå¯¼è‡´æ— æ³•ä¸NameNodeè¿›è¡Œé€šè®¯æ—¶ï¼ŒNameNodeä¸ä¼šç«‹å³å°†æ­¤DataNodeç§»é™¤ï¼Œè€Œæ˜¯è¦ç»è¿‡ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤æ—¶é•¿ä¸º10m30sï¼‰</p>
<p>è®¡ç®—å…¬å¼ä¸ºï¼š2 * dfs.namenode.heartbeat.recheck-interval + 10 * dfs.heartbeat.interval</p>
<p>å¯åœ¨<code>hdfs-site.xml</code>é…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å•ä½æ¯«ç§’ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.heartbeat.recheck-interval<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>300000<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å•ä½ç§’ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.heartbeat.interval<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>3<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ·»åŠ èŠ‚ç‚¹">æ·»åŠ èŠ‚ç‚¹</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç¡®ä¿æ–°åŠ å…¥çš„èŠ‚ç‚¹çš„logså’Œdataæ–‡ä»¶ä¸ºç©º</strong></p>
<p><strong>ç¬¬äºŒæ­¥ï¼šé…ç½®/etc/hostsï¼Œæ‹·è´hadoopçš„etcç›®å½•ä¸‹çš„æ–‡ä»¶</strong></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨<code>sbin/hadoop-daemon.sh start datanode</code>å’Œ<code>sbin/yarn-daemon.sh start nodemanager</code></strong></p>
<blockquote>
<p>å¦‚æœå‡ºç°æ•°æ®ä¸å‡è¡¡çš„æƒ…å†µï¼Œåº”ä½¿ç”¨<code>sbin/start-balancer.sh</code>å‡è¡¡æ•°æ®</p>
</blockquote>
<h4 id="ç™½åå•åº”åœ¨é›†ç¾¤åˆ›å»ºæ—¶è§„åˆ’">ç™½åå•ã€åº”åœ¨é›†ç¾¤åˆ›å»ºæ—¶è§„åˆ’ã€‘</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º<code>etc/hadoop/dfs.hosts</code>æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>centos161
</span></span><span style="display:flex;"><span>centos162
</span></span><span style="display:flex;"><span>centos163
</span></span><span style="display:flex;"><span>centos164
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ï¼šé…ç½®<code>hdfs-site.xml</code></strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.hosts<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/opt/module/hadoop/etc/hadoop/dfs.hosts<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ†å‘<code>hdfs-site.xml</code></strong></p>
<p><strong>ç¬¬å››æ­¥ï¼šåˆ·æ–°èŠ‚ç‚¹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hdfs dfsadmin -refreshNodes
</span></span><span style="display:flex;"><span>yarn rmadmin -refreshNodes
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼šå­˜åœ¨ä¸ç™½åå•å¤–çš„å·²æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæ•°æ®ä¸ä¼šå˜åŒ–</p>
</blockquote>
<h4 id="é»‘åå•åº”åœ¨é€€å½¹èŠ‚ç‚¹æ—¶ä½¿ç”¨">é»‘åå•ã€åº”åœ¨é€€å½¹èŠ‚ç‚¹æ—¶ä½¿ç”¨ã€‘</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º<code>etc/hadoop/dfs.hosts.exclude</code>æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>centos164
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ï¼šé…ç½®<code>hdfs-site.xml</code></strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.hosts.exclude<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/opt/module/hadoop/etc/hadoop/dfs.hosts.exclude<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ†å‘<code>hdfs-site.xml</code></strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hdfs dfsadmin -refreshNodes
</span></span><span style="display:flex;"><span>yarn rmadmin -refreshNodes
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬å››æ­¥ï¼šåˆ·æ–°èŠ‚ç‚¹</strong></p>
<blockquote>
<p>æ³¨æ„ï¼šåŒä¸€ä¸ªä¸»æœºä¸èƒ½åŒæ—¶å­˜åœ¨å†é»‘ç™½åå•ä¸­ã€‚å­˜åœ¨ä¸é»‘åå•å†…çš„å·²æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæ•°æ®ä¼šåˆ†é…ç»™å…¶å®ƒèŠ‚ç‚¹</p>
</blockquote>
<h4 id="å¤šç›®å½•é…ç½®">å¤šç›®å½•é…ç½®</h4>
<p>DataNodeä¹Ÿå¯ä»¥é…ç½®æˆå¤šä¸ªç›®å½•ï¼Œ<span style="color:red">æ¯ä¸ªç›®å½•å­˜å‚¨çš„æ•°æ®ä¸ä¸€æ ·ã€æ•°æ®ä¸æ˜¯å‰¯æœ¬ã€‘</span></p>
<p>é…ç½®<code>hdfs-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.datanode.data.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>file:///${hadoop.tmp.dir}/dfs/data1,file:///${hadoop.tmp.dir}/dfs/data2<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­hdfså…¶å®ƒ">å…­ã€HDFSå…¶å®ƒ</h2>
<h3 id="å°æ–‡ä»¶å­˜æ¡£">å°æ–‡ä»¶å­˜æ¡£</h3>
<p><strong>å½’æ¡£æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hadoop archive -archiveName input.har  -p /src *.xml  /dest
</span></span></code></pre></td></tr></table>
</div>
</div><p>-pï¼šæŒ‡å®šçˆ¶ç›®å½•ï¼Œåé¢çš„æºæ–‡ä»¶å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„</p>
<p><strong>æŸ¥çœ‹å½’æ¡£æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hadoop fs -ls -r har:///dest/input.har
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è§£å½’æ¡£æ–‡ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hadoop fs -cp har:///dest/input.har/* /noArchive
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¿«ç…§ç®¡ç†">å¿«ç…§ç®¡ç†</h3>
<p>å¿«ç…§ç›¸å½“äºæ˜¯å¯¹ç›®å½•åšä¸€ä¸ªå¤‡ä»½ï¼Œå¹¶æœªå¯¹æ•°æ®åšå¤‡ä»½ï¼Œåªæ˜¯è®°å½•äº†æ–‡ä»¶çš„å˜åŒ–ã€‚</p>
<p>å¯ç”¨ç›®å½•å¿«ç…§åŠŸèƒ½ï¼š<code>hdfs dfsadmin -allowSnapshot /dir</code></p>
<p>ç¦ç”¨ç›®å½•å¿«ç…§åŠŸèƒ½ï¼š<code>hdfs dfsadmin -disallowSnapshot /dir</code></p>
<p>å¯¹ç›®å½•åˆ›å»ºå¿«ç…§ï¼š<code>hdfs dfs -createSnapshot /dir SnapshotName</code></p>
<p>é‡å‘½åå¿«ç…§ï¼š<code>hdfs dfs -renameSnapshot SnapshotName NewSnapshotName</code></p>
<p>åˆ—å‡ºå½“å‰ç”¨æˆ·æ‰€æœ‰å¯å¿«ç…§ç›®å½•ï¼š<code>hdfs lsSnapshottableDir</code></p>
<p>æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ç›®å½•çš„ä¸åŒä¹‹å¤„ï¼š<code>hdfs snapshotDiff</code></p>
<h2 id="ä¸ƒmapreduceæ¦‚è¿°">ä¸ƒã€MapReduceæ¦‚è¿°</h2>
<p>â€‹	MapReduceæ˜¯ä¸€ä¸ªåŸºäºHadoopçš„æ•°æ®åˆ†æåº”ç”¨çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ã€‚MapReduceæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚</p>
<p><strong>MapReduceçš„ä¼˜ç‚¹ï¼š</strong></p>
<p>â‘ æ˜“äºç¼–ç¨‹ï¼Œåªéœ€ç®€å•çš„å®ç°ä¸€äº›æ¥å£</p>
<p>â‘¡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå½“è®¡ç®—èµ„æºä¸èƒ½æ»¡è¶³æ—¶å¯ä»¥é€šè¿‡ç®€å•å¢åŠ æœºå™¨æ¥æå‡</p>
<p>â‘¢é«˜å®¹é”™æ€§ï¼Œå¦‚æœæœºå™¨å®•æœºæ•…éšœä¼šè‡ªåŠ¨å°†ä¸Šé¢çš„è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°å¦ä¸€èŠ‚ç‚¹è¿è¡Œ</p>
<p>â‘£PBçº§æ–‡ä»¶ä»¥ä¸Šæµ·é‡æ•°æ®çš„ç¦»çº¿å¤„ç†</p>
<p><strong>MapReduceçš„ç¼ºç‚¹ï¼š</strong></p>
<p>â‘ ä¸èƒ½å®æ—¶è®¡ç®—</p>
<p>â‘¡ä¸æ“…é•¿æµå¼è®¡ç®—ï¼Œå³è¾“å…¥æ•°æ®ä¸æ˜¯åŠ¨æ€çš„</p>
<p>â‘¢ä¸æ“…é•¿æœ‰å‘å›¾è®¡ç®—ï¼Œå¤šä¸ªç¨‹åºä¹‹é—´å­˜åœ¨ä¾èµ–ï¼Œåä¸€ä¸ªç¨‹åºçš„è¾“å…¥æ˜¯å‰ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šé€ æˆå¤§é‡IO</p>
<p><img src="/img/hadoop/map.png" alt="map"></p>
<p><img src="/img/hadoop/reducer.png" alt="reudcer"></p>
<p><span style="color:red"><strong>Mapä¹‹åReduceä¹‹å‰ç§°ä¹‹ä¸ºShuffle</strong></span></p>
<h2 id="å…«mapreduceç¼–ç¨‹">å…«ã€MapReduceç¼–ç¨‹</h2>
<h3 id="wordcountå…¥é—¨æ¡ˆä¾‹">WordCountå…¥é—¨æ¡ˆä¾‹</h3>
<p>æ¡ˆä¾‹è¯´æ˜ï¼šè®¡ç®—å•è¯å‡ºç°çš„æ¬¡æ•°</p>
<h4 id="è‡ªå®šä¹‰mapper">è‡ªå®šä¹‰Mapper</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Slf4j</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">WordCountMapper</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Mapper<span style="color:#000;font-weight:bold">&lt;</span>LongWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>IntWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>outKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>IntWritable<span style="color:#bbb"> </span>outValue<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>IntWritable();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ä»»åŠ¡å¼€å§‹æ—¶ä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">setup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;=================WordCountMapper setup=================&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">map</span>(LongWritable<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>value,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>text<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">toString</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>words<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>text.<span style="color:#008080">split</span>(<span style="color:#d14">&#34; &#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(String<span style="color:#bbb"> </span>word<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>words)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>outKey.<span style="color:#008080">set</span>(word);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>outValue.<span style="color:#008080">set</span>(1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>context.<span style="color:#008080">write</span>(outKey,<span style="color:#bbb"> </span>outValue);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ä»»åŠ¡ç»“æŸä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">cleanup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;=================WordCountMapper cleanup=================&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è‡ªå®šä¹‰reducer">è‡ªå®šä¹‰Reducer</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Slf4j</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">WordCountReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>IntWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>IntWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>IntWritable<span style="color:#bbb"> </span>outValue<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>IntWritable();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">setup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;=================WordCountReduce setup=================&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>IntWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(IntWritable<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>values)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">get</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>outValue.<span style="color:#008080">set</span>(count);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(key,<span style="color:#bbb"> </span>outValue);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">cleanup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;=================WordCountReduce cleanup=================&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è‡ªå®šä¹‰driver">è‡ªå®šä¹‰Driver</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">WordCountDriver</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è·å–JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>configuration.<span style="color:#008080">set</span>(<span style="color:#d14">&#34;fs.defaultFS&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®jarä½ç½®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setJarByClass</span>(WordCountDriver.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å…³è”Mapperå’ŒReducer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapperClass</span>(WordCountMapper.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setReducerClass</span>(WordCountReducer.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®Mapperé˜¶æ®µè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputValueClass</span>(IntWritable.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®æœ€åè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputValueClass</span>(IntWritable.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®ç¨‹åºè¾“å‡ºçš„è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileInputFormat.<span style="color:#008080">setInputPaths</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/input&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileOutputFormat.<span style="color:#008080">setOutputPath</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/output&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æäº¤JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">submit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">waitForCompletion</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–">è‡ªå®šä¹‰åºåˆ—åŒ–</h3>
<p>æ¡ˆä¾‹è¯´æ˜ï¼šç»Ÿè®¡æ‰‹æœºçš„ä¸Šä¸‹è¡Œæµé‡</p>
<h4 id="è‡ªå®šä¹‰åºåˆ—åŒ–bean">è‡ªå®šä¹‰åºåˆ—åŒ–Bean</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å¿…é¡»æä¾›æ— å‚æ„é€ å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å®ç°Writableæ¥å£ï¼Œwriteå’ŒreadFieldså­—æ®µé¡ºåºå¿…é¡»å®Œå…¨ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * é‡æ–°toStringæä¾›è¾“å‡ºåˆ°æ–‡ä»¶çš„æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰çš„beanæ”¾åœ¨keyä¸­ä¼ è¾“è¿˜è¦å®ç°Comparableæ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å¿…é¡»æœ‰å€¼ï¼Œå¦åˆ™åºåˆ—åŒ–æŠ¥é”™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Data</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@NoArgsConstructor</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerBean</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">implements</span><span style="color:#bbb"> </span>Writable<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>name;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>upFlow;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>downFlow;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>sumFlow;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">write</span>(DataOutput<span style="color:#bbb"> </span>out)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(name);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeLong</span>(upFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeLong</span>(downFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeLong</span>(sumFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">readFields</span>(DataInput<span style="color:#bbb"> </span>in)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">name</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">upFlow</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readLong</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">downFlow</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readLong</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">sumFlow</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readLong</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">toString</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>upFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>downFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>sumFlow;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®šä¹‰mapper">å®šä¹‰Mapper</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerMapper</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Mapper<span style="color:#000;font-weight:bold">&lt;</span>LongWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>FlowerBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">map</span>(LongWritable<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>value,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>lineText<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">toString</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>values<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>lineText.<span style="color:#008080">split</span>(<span style="color:#d14">&#34;\t&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FlowerBean<span style="color:#bbb"> </span>flowerBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FlowerBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setName</span>(values<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setUpFlow</span>(Long.<span style="color:#008080">parseLong</span>(values<span style="color:#000;font-weight:bold">[</span>values.<span style="color:#008080">length</span><span style="color:#000;font-weight:bold">-</span>3<span style="color:#000;font-weight:bold">]</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setDownFlow</span>(Long.<span style="color:#008080">parseLong</span>(values<span style="color:#000;font-weight:bold">[</span>values.<span style="color:#008080">length</span><span style="color:#000;font-weight:bold">-</span>2<span style="color:#000;font-weight:bold">]</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text(values<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>),<span style="color:#bbb"> </span>flowerBean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®šä¹‰reducer">å®šä¹‰Reducer</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>FlowerBean,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>FlowerBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>FlowerBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FlowerBean<span style="color:#bbb"> </span>flowerBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FlowerBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>downFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>upFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(FlowerBean<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>values)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>downFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">getDownFlow</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>upFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">getUpFlow</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>sumFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>upFlow<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>downFlow;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setUpFlow</span>(upFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setDownFlow</span>(downFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setSumFlow</span>(sumFlow);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flowerBean.<span style="color:#008080">setName</span>(key.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(key,<span style="color:#bbb"> </span>flowerBean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®šä¹‰driver">å®šä¹‰Driver</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerDriver</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è·å–JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>configuration.<span style="color:#008080">set</span>(<span style="color:#d14">&#34;fs.defaultFS&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å…³è”Mapperå’ŒReducer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapperClass</span>(FlowerMapper.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setReducerClass</span>(FlowerReducer.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®Mapperé˜¶æ®µè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputValueClass</span>(FlowerBean.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®æœ€åè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputValueClass</span>(FlowerBean.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®ç¨‹åºè¾“å‡ºçš„è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileInputFormat.<span style="color:#008080">setInputPaths</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/input/flower&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileOutputFormat.<span style="color:#008080">setOutputPath</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;/output&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æäº¤JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">submit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">waitForCompletion</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="inputformatæ•°æ®è¾“å…¥">InputFormatæ•°æ®è¾“å…¥</h3>
<p><img src="/img/hadoop/split.png" alt="split"></p>
<h4 id="textfileinputformaté»˜è®¤">TextFileInputFormat(é»˜è®¤)</h4>
<p>â‘ ç®€å•çš„æŒ‰ç…§æ–‡ä»¶çš„å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡ç‰‡</p>
<p>â‘¡åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºBlockå¤§å°</p>
<p>â‘¢åˆ‡ç‰‡æ˜¯ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡</p>
<p>â‘£keyä¸ºæ¯è¡Œé¦–å•è¯å†å…¨æ–‡æœ¬çš„åç§»é‡ï¼Œvalueä¸ºè¡Œå†…å®¹</p>
<p>åˆ‡ç‰‡æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>file_1.txt 350M  -&gt;  file_1.txt.split1 128Mï¼›file_1.txt.split2 128Mï¼›file_3.txt.split1 94M
</span></span><span style="display:flex;"><span>file_2.txt 10M   -&gt;  file_2.txt.split1 10M
</span></span><span style="display:flex;"><span>file_3.txt 129M  -&gt;  file_3.txt.split1 129M
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šç‰©ç†å­˜å‚¨æ˜¯128Mä¸€å—ï¼Œåˆ‡ç‰‡æ˜¯æœ€åä¸€ç‰‡å¤§å°å¯ä»¥æ˜¯å­˜å‚¨çš„1.1å€</p>
</blockquote>
<h4 id="combinetextinputformat">CombineTextInputFormat</h4>
<p>â€‹	æ¡†æ¶é»˜è®¤çš„TextInputFormatåˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡ï¼Œéƒ½ä¼šäº¤ç»™ä¸€ä¸ªMapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„MapTaskï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹ã€‚CombineTextInputFormatå°†å¤šä¸ªå°æ–‡ä»¶è§„åˆ’æˆä¸€ä¸ªå¤§åˆ‡ç‰‡ã€‚</p>
<p>â‘ æé«˜å°æ–‡ä»¶å¤„ç†æ•ˆç‡</p>
<p>â‘¡keyä¸ºæ¯è¡Œé¦–å•è¯å†å…¨æ–‡æœ¬çš„åç§»é‡ï¼Œvalueä¸ºè¡Œå†…å®¹</p>
<p>åˆ‡ç‰‡æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">â‘ </span>å¦‚æœæœ€å¤§åˆ‡ç‰‡å¤§å°è®¾ç½®ä¸º4M<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>æ–‡ä»¶å‰©ä½™å¤§å°å¤§äº4Mä½†å°äº8Måˆ™å°†æœ€åä¸¤ç«¯è¿›è¡Œå¹³å‡åˆ‡åˆ†<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>file_1.<span style="color:#008080">txt</span><span style="color:#bbb"> </span>10M<span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb">  </span>file_1.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>4M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span>file_1.<span style="color:#008080">txt</span>.<span style="color:#008080">split2</span><span style="color:#bbb"> </span>3M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span>file_1.<span style="color:#008080">txt</span>.<span style="color:#008080">split3</span><span style="color:#bbb"> </span>3M<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>file_2.<span style="color:#008080">txt</span><span style="color:#bbb"> </span>2M<span style="color:#bbb">   </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb">  </span>file_2.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>2M<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>file_3.<span style="color:#008080">txt</span><span style="color:#bbb"> </span>6M<span style="color:#bbb">   </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb">  </span>file_3.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>3M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span>file_3.<span style="color:#008080">txt</span>.<span style="color:#008080">split2</span><span style="color:#bbb"> </span>3M<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a61717;background-color:#e3d2d2">â‘¡</span>è¿›è¡Œç»„åˆ<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>ä¸¤ä¸ªåˆ‡ç‰‡ç›¸åŠ å°äº4Mç»§ç»­åŠ <span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>å¦‚æœå¤§äºç­‰äº4Måˆ™åœæ­¢ä¸”ä¸ºä¸€ä¸ªåˆ‡ç‰‡<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>åˆ‡ç‰‡1<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>file_1.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>4M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>åˆ‡ç‰‡2<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>file_1.<span style="color:#008080">txt</span>.<span style="color:#008080">split2</span><span style="color:#bbb"> </span>3M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span>file_3.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>3M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>åˆ‡ç‰‡3<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>file_2.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>2M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span>file_3.<span style="color:#008080">txt</span>.<span style="color:#008080">split1</span><span style="color:#bbb"> </span>3M<span style="color:#a61717;background-color:#e3d2d2">ï¼›</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>åˆ‡ç‰‡4<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>file_3.<span style="color:#008080">txt</span>.<span style="color:#008080">split2</span><span style="color:#bbb"> </span>3M<span style="color:#bbb"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£ç è®¾ç½®ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>job.<span style="color:#008080">setInputFormatClass</span>(CombineTextInputFormat.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>CombineTextInputFormat.<span style="color:#008080">setMaxInputSplitSize</span>(job,<span style="color:#bbb"> </span>128<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1024<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1024);<span style="color:#998;font-style:italic">// 128m</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="keyvaluetextinputformat">KeyValueTextInputFormat</h4>
<p>â‘ ä»¥æ¯è¡Œé¦–å•è¯ï¼ˆè‡ªå®šä¹‰åˆ‡åˆ†è§„åˆ™ï¼‰ä½œä¸ºkeyï¼Œè¡Œé™¤å»keyçš„å†…å®¹ä½œä¸ºvalue</p>
<p>â‘¡åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºBlockå¤§å°</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// è®¾ç½®åˆ‡å‰²ç¬¦ï¼Œå¿…é¡»å†å¾—åˆ°jobå®ä¾‹ä¹‹å‰</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>configuration.<span style="color:#008080">set</span>(KeyValueLineRecordReader.<span style="color:#008080">KEY_VALUE_SEPERATOR</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34; &#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>job.<span style="color:#008080">setInputFormatClass</span>(KeyValueTextInputFormat.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="nlineinputformat">NLineInputFormat</h4>
<p>â‘ æŒ‰ç…§è¡Œåˆ‡åˆ†ï¼Œåˆ‡ç‰‡æ•°ä¸ºè¡Œæ•°/Næœ‰ä½™æ•°åŠ ä¸€</p>
<p>â‘¡keyä¸ºè¡Œå·ï¼Œvalueä¸ºè¡Œå†…å®¹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>NLineInputFormat.<span style="color:#008080">setNumLinesPerSplit</span>(job,<span style="color:#bbb"> </span>3);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>job.<span style="color:#008080">setInputFormatClass</span>(NLineInputFormat.<span style="color:#008080">class</span>);<span style="color:#bbb">  
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è‡ªå®šä¹‰inputformat">è‡ªå®šä¹‰InputFormat</h4>
<p><strong>å®šä¹‰Format</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomArchiveInputFormat</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>FileInputFormat<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>RecordReader<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">createRecordReader</span>(InputSplit<span style="color:#bbb"> </span>split,<span style="color:#bbb"> </span>TaskAttemptContext<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CustomArchiveRecordReader<span style="color:#bbb"> </span>customArchiveRecordReader<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>CustomArchiveRecordReader();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>customArchiveRecordReader.<span style="color:#008080">initialize</span>(split,<span style="color:#bbb"> </span>context);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>customArchiveRecordReader;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/* æ–‡ä»¶æ˜¯å¦å¯ä»¥åœ¨é€»è¾‘ä¸Šè¿›è¡Œåˆ‡åˆ† */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">isSplitable</span>(JobContext<span style="color:#bbb"> </span>context,<span style="color:#bbb"> </span>Path<span style="color:#bbb"> </span>filename)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/* è°ƒç”¨çˆ¶æ–¹æ³•ï¼Œè¿”å›çš„åˆ—è¡¨åŒ…å«æ–‡ä»¶å¤¹ï¼Œå†å°†çˆ¶æ–¹æ³•è¿”å›çš„æ•°æ®å†æ¬¡è¿‡æ»¤ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span>List<span style="color:#000;font-weight:bold">&lt;</span>FileStatus<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">listStatus</span>(JobContext<span style="color:#bbb"> </span>job)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>FileStatus<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>statusList<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">listStatus</span>(job);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>statusList.<span style="color:#008080">stream</span>().<span style="color:#008080">filter</span>(FileStatus::isFile).<span style="color:#008080">collect</span>(Collectors.<span style="color:#008080">toList</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å®šä¹‰RecordReader</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Slf4j</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomArchiveRecordReader</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>RecordReader<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>FileSplit<span style="color:#bbb"> </span>split;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>TaskAttemptContext<span style="color:#bbb"> </span>context;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>BytesWritable<span style="color:#bbb"> </span>currentValue<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>BytesWritable();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>currentKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// æ¯æ¬¡mapperéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæ‰€ä»¥åˆå§‹åŒ–éƒ½ä¸ºtrue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>isBegin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initialize</span>(InputSplit<span style="color:#bbb"> </span>split,<span style="color:#bbb"> </span>TaskAttemptContext<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">split</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(FileSplit)<span style="color:#bbb"> </span>split;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">context</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>context;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">nextKeyValue</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;Fileã€{}ã€‘å¼€å§‹å¤„ç†&#34;</span>,<span style="color:#bbb"> </span>split.<span style="color:#008080">getPath</span>().<span style="color:#008080">getName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(isBegin)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>contents<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[</span>(<span style="color:#458;font-weight:bold">int</span>)split.<span style="color:#008080">getLength</span>()<span style="color:#000;font-weight:bold">]</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>split.<span style="color:#008080">getPath</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>path.<span style="color:#008080">getFileSystem</span>(context.<span style="color:#008080">getConfiguration</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>FSDataInputStream<span style="color:#bbb"> </span>inputStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">open</span>(path);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">set</span>(path.<span style="color:#008080">getName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>IOUtils.<span style="color:#008080">readFully</span>(inputStream,<span style="color:#bbb"> </span>contents,<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>contents.<span style="color:#008080">length</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentValue.<span style="color:#008080">set</span>(contents,<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>contents.<span style="color:#008080">length</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>isBegin<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getCurrentKey</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>currentKey;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>BytesWritable<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getCurrentValue</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>currentValue;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">float</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getProgress</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">close</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;Fileã€{}ã€‘å·²å®Œæˆ&#34;</span>,<span style="color:#bbb"> </span>split.<span style="color:#008080">getPath</span>().<span style="color:#008080">getName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å®šä¹‰Mapperå’ŒReducer</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Slf4j</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomArchiveMapper</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Mapper<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>BytesWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">map</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>BytesWritable<span style="color:#bbb"> </span>value,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(key,<span style="color:#bbb"> </span>value);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Slf4j</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomArchiveReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>BytesWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>BytesWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(key,<span style="color:#bbb"> </span>values.<span style="color:#008080">iterator</span>().<span style="color:#008080">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å®šä¹‰Driver</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomArchiveDriver</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è·å–JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>configuration.<span style="color:#008080">set</span>(<span style="color:#d14">&#34;fs.defaultFS&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®jarä½ç½®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setJarByClass</span>(CustomArchiveDriver.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å…³è”Mapperå’ŒReducer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapperClass</span>(CustomArchiveMapper.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setReducerClass</span>(CustomArchiveReducer.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setInputFormatClass</span>(CustomArchiveInputFormat.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®Mapperé˜¶æ®µè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputValueClass</span>(BytesWritable.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®æœ€åè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputValueClass</span>(BytesWritable.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®ç¨‹åºè¾“å‡ºçš„è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileInputFormat.<span style="color:#008080">setInputPaths</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/input&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileOutputFormat.<span style="color:#008080">setOutputPath</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/output&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æäº¤JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">submit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">waitForCompletion</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ†åŒº">åˆ†åŒº</h3>
<p>Maperé€šè¿‡Collectorè¾“å‡ºåˆ°ç¯å½¢ç¼“å†²åŒºçš„ä½¿ç”¨é»˜è®¤åˆ†åŒºæ˜¯HashPartitionåˆ†åŒºï¼Œæ˜¯æ ¹æ®keyçš„hashCodeå¯¹ReducerTaskä¸ªæ•°å–æ¨¡å¾—åˆ°çš„ï¼Œç”¨æˆ·æ— æ³•æ§åˆ¶è¾“å‡ºåˆ°å“ªä¸ªåˆ†åŒºã€‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰Partitionè¿›è¡Œæ§åˆ¶ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ä¸€ä¸‹ä»£ç æ²¡ç”¨å–æ¨¡çš„æ–¹å¼ï¼Œæ‰€ä»¥å¦‚æœtaskNumè®¾ç½®å°äº5ï¼Œè¿”å›å€¼ä¼šå¤§äºnumPartitions
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * åˆ†åŒºå·å¿…é¡»ä»0å¼€å§‹ï¼Œé€ä¸€ç´¯åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CustomPartition</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Partitioner<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>FlowerBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getPartition</span>(Text<span style="color:#bbb"> </span>text,<span style="color:#bbb"> </span>FlowerBean<span style="color:#bbb"> </span>flowerBean,<span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>numPartitions)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>phone<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>text.<span style="color:#008080">toString</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(phone.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;139&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(phone.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;183&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>1;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(phone.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;135&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>2;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(phone.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;137&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>3;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>4;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerDriver</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ã€‚ã€‚ã€‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setPartitionerClass</span>(CustomPartition.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setNumReduceTasks</span>(5);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ã€‚ã€‚ã€‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¦‚æœ[ ReduceTaskçš„æ•°é‡ &gt; Partitionçš„æ•°é‡ ]ï¼Œåˆ™ä¼šäº§ç”Ÿå‡ ä¸ªç©ºçš„è¾“å‡ºæ–‡ä»¶</p>
<p>å¦‚æœ[ 1 &lt; ReduceTaskçš„æ•°é‡ &lt; Partitionçš„æ•°é‡ ]ï¼Œåˆ™éƒ¨åˆ†æ•°æ®å› ä¸ºæ‰¾ä¸åˆ°è¾“å‡ºæ–‡ä»¶æŠ¥é”™</p>
<p>å¦‚æœ[ ReduceTaskçš„æ•°é‡ = 1 ]ï¼Œåˆ™ä¸ç®¡MapTaskç«¯è¾“å‡ºï¼Œæœ€ç»ˆéƒ½è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶</p>
</blockquote>
<h3 id="æ’åº">æ’åº</h3>
<p>MapTaskå’ŒReduceTaskå‡ä¼šå¯¹æ•°æ®<span style="color:red">æŒ‰ç…§Keyè¿›è¡Œæ’åº</span>ã€‚è¯¥æ“ä½œå±äºHadoopçš„é»˜è®¤è¡Œä¸ºã€‚ä»»ä½•ç¨‹åºæ•°æ®å‡ä¼šè¢«æ’åºï¼Œè€Œä¸ç®¡é€»è¾‘ä¸Šæ˜¯å¦éœ€è¦ã€‚é»˜è®¤æ˜¯ä½¿ç”¨å¿«é€Ÿæ’åºæŒ‰ç…§å­—å…¸é¡ºåºæ’åºã€‚</p>
<ul>
<li>MapTaskè¿‡ç¨‹ä¸­æ¯æ¬¡æº¢å†™ç£ç›˜éœ€è¦è¿›è¡Œå¿«é€Ÿæ’åºï¼Œåˆå¹¶æº¢å†™æ–‡ä»¶è¦è¿›è¡Œå½’å¹¶æ’åºã€‚</li>
<li>ReduceTaskè¿›è¡Œåˆ†åŒºæ±‡æ€»æ—¶ï¼Œå¦‚æœå‘ç”Ÿæº¢å†™æ“ä½œä¹Ÿä¼šè¿›è¡Œå¿«é€Ÿæ’åºï¼Œæœ€ååˆå¹¶æº¢å†™æ–‡ä»¶</li>
</ul>
<p><strong>è‡ªå®šä¹‰æ’åº</strong></p>
<p>Beanå¯¹è±¡è¦å®ç°WritableComparableæ¥å£é‡å†™compareToæ–¹æ³•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç°è±¡ï¼šreducerå¹¶æœªå°†ä»·æ ¼åŠ å’Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * åŸç†ï¼šè¿›å…¥é¡ºåº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000001,33.8&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000001,222.8&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000002,122.4&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      ......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *    å®é™…æ•°æ®                      reducerç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000001  222.8       ==&gt;      0000001  33.8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002  722.4                0000001  222.8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000001  33.8                 0000002  122.4
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000003  232.8                0000002  522.8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000003  33.8                 0000002  722.4 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002  522.8                0000003  33.8 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002  122.4                0000003  232.8 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Data</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">OrderBean</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">implements</span><span style="color:#bbb"> </span>WritableComparable<span style="color:#000;font-weight:bold">&lt;</span>OrderBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>orderId;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// è®¢å•idå·</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">double</span><span style="color:#bbb"> </span>price;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ä»·æ ¼</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">compareTo</span>(OrderBean<span style="color:#bbb"> </span>o)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>orderIdCompare<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Integer.<span style="color:#008080">compare</span>(<span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">getOrderId</span>(),<span style="color:#bbb"> </span>o.<span style="color:#008080">getOrderId</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>orderIdCompare<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>0<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span>Double.<span style="color:#008080">compare</span>(<span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">getPrice</span>(),<span style="color:#bbb"> </span>o.<span style="color:#008080">getPrice</span>())<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>orderIdCompare;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">write</span>(DataOutput<span style="color:#bbb"> </span>out)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeInt</span>(orderId);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeDouble</span>(price);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">readFields</span>(DataInput<span style="color:#bbb"> </span>in)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>orderId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readInt</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>price<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readDouble</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">OrderReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>OrderBean,<span style="color:#bbb"> </span>NullWritable,<span style="color:#bbb"> </span>OrderBean,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(OrderBean<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>OrderBean<span style="color:#bbb"> </span>currentKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>OrderBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(NullWritable<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>values)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">setOrderId</span>(key.<span style="color:#008080">getOrderId</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">setPrice</span>(currentKey.<span style="color:#008080">getPrice</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>key.<span style="color:#008080">getPrice</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">setDate</span>(key.<span style="color:#008080">getDate</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(currentKey,<span style="color:#bbb"> </span>NullWritable.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ†ç»„æ’åº">åˆ†ç»„æ’åº</h3>
<p>æŒ‡å¯¹Reduceé˜¶æ®µçš„æ•°æ®æ ¹æ®æŸä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œ ReducerTaskä¼šæŒ‰ç…§Keyè¿›è¡Œåˆ†ç»„ï¼Œåˆ¤æ–­ä¸‹ä¸€ä¸ªkeyæ˜¯å¦ç›¸åŒï¼Œå°†åŒç»„çš„Keyä¼ ç»™reduce()æ‰§è¡Œ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç°è±¡ï¼šreducerå¹¶å°†ä»·æ ¼åŠ å’Œäº†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * åŸç†ï¼šè¿›å…¥é¡ºåº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000001,33.8,2020-09-14&gt; &lt;0000001,222,2020-09-14&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000002,122.4,2020-09-10&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000002,522.8,2020-09-14&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000002,722.4,2020-09-12&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      &lt;0000003,33.8,2020-09-11&gt; &lt;0000003,232.8,2020-09-11&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *      ......
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *    å®é™…æ•°æ®                                      reducerç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000001 222    2020-09-14       ==&gt;      0000001 255.8 2020-09-14
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002 722.4  2020-09-12                0000002 122.4 2020-09-10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000001 33.8   2020-09-14                0000002 522.8 2020-09-14
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000003 232.8  2020-09-11                0000002 722.4 2020-09-12
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000003 33.8   2020-09-11                0000003 266.6 2020-09-11
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002 522.8  2020-09-14
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 0000002 122.4  2020-09-10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Data</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">OrderBean</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">implements</span><span style="color:#bbb"> </span>WritableComparable<span style="color:#000;font-weight:bold">&lt;</span>OrderBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>orderId;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">double</span><span style="color:#bbb"> </span>price;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>date;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">compareTo</span>(OrderBean<span style="color:#bbb"> </span>o)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>orderIdCompare<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Integer.<span style="color:#008080">compare</span>(<span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">getOrderId</span>(),<span style="color:#bbb"> </span>o.<span style="color:#008080">getOrderId</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>orderIdCompare<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>0<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span>Double.<span style="color:#008080">compare</span>(<span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">getPrice</span>(),<span style="color:#bbb"> </span>o.<span style="color:#008080">getPrice</span>())<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>orderIdCompare;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">write</span>(DataOutput<span style="color:#bbb"> </span>out)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeInt</span>(orderId);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeDouble</span>(price);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(date);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">readFields</span>(DataInput<span style="color:#bbb"> </span>in)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>orderId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readInt</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>price<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readDouble</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>date<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">OrderGroupingComparator</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>WritableComparator<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">OrderGroupingComparator</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">super</span>(OrderBean.<span style="color:#008080">class</span>,<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">compare</span>(WritableComparable<span style="color:#bbb"> </span>a,<span style="color:#bbb"> </span>WritableComparable<span style="color:#bbb"> </span>b)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>OrderBean<span style="color:#bbb"> </span>aBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(OrderBean)<span style="color:#bbb"> </span>a;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>OrderBean<span style="color:#bbb"> </span>bBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(OrderBean)<span style="color:#bbb"> </span>b;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>aBean.<span style="color:#008080">getDate</span>().<span style="color:#008080">compareTo</span>(bBean.<span style="color:#008080">getDate</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// è·å¾—æ•°æ®æŒ‰ç…§orderIdåˆ†ç»„priceæ’åº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">OrderReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>OrderBean,<span style="color:#bbb"> </span>NullWritable,<span style="color:#bbb"> </span>OrderBean,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(OrderBean<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>OrderBean<span style="color:#bbb"> </span>currentKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>OrderBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(NullWritable<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>values)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">setOrderId</span>(key.<span style="color:#008080">getOrderId</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>currentKey.<span style="color:#008080">setPrice</span>(currentKey.<span style="color:#008080">getPrice</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>key.<span style="color:#008080">getPrice</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(currentKey,<span style="color:#bbb"> </span>NullWritable.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="combineråˆå¹¶">Combineråˆå¹¶</h3>
<p>Combineråœ¨æ¯ä¸ªMapTaskèŠ‚ç‚¹è¿è¡Œæº¢å†™æ’åºå’Œåˆå¹¶åˆ†åŒºçš„è¿‡ç¨‹ä¸­å·¥ä½œã€‚Combinerçš„å­˜åœ¨æ„ä¹‰æ˜¯å¯¹æ¯ä¸ªMapTaskçš„ç»“æœè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚Combinerèƒ½å¤Ÿä½¿ç”¨çš„å‰ææ˜¯ä¸å½±å“æœ€ç»ˆç»“æœã€å¹³å‡å€¼ä¹‹ç±»çš„æ“ä½œä¸€å®šä¸èƒ½ç”¨Combinerã€‘</p>
<p>Combinerçš„ä½¿ç”¨æ–¹ä¸ºä¸¤ç§ï¼šâ‘ è‡ªå®šä¹‰Combinerç±»å®ç°Reduceræ–¹æ³•ï¼›â‘¡ç›´æ¥è®¾ç½®Combinerä¸ºReducerçš„å®ç°ç±»æ–¹æ³•</p>
<h3 id="outputformatæ•°æ®è¾“å‡º">OutputFormatæ•°æ®è¾“å‡º</h3>
<p>é»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯TextOutputFormatï¼Œå®ƒæŠŠæ¯æ¡è®°å½•å†™ä¸ºæ–‡æœ¬è¡Œã€‚å®ƒçš„é”®å’Œå€¼å¯ä»¥æ˜¯ä»»æ ¼å¼ï¼Œå› ä¸ºå®ƒçš„æ ¼å¼ç´§å‡‘ï¼Œå¾ˆå®¹æ˜“è¢«å‹ç¼©ã€‚</p>
<p>å¯æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰OutputFormat</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">LogOutputFormat</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>FileOutputFormat<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>RecordWriter<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getRecordWriter</span>(TaskAttemptContext<span style="color:#bbb"> </span>job)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>LogRecordWriter(job);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å°†æ•°æ®æ ¹æ®è¡Œé¦–å­—æ¯åˆ†ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">LogRecordWriter</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>RecordWriter<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>FSDataOutputStream<span style="color:#bbb"> </span>outA_Q;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>FSDataOutputStream<span style="color:#bbb"> </span>outR_Z;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">LogRecordWriter</span>(TaskAttemptContext<span style="color:#bbb"> </span>job)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>job.<span style="color:#008080">getConfiguration</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>String<span style="color:#bbb"> </span>dir<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>configuration.<span style="color:#008080">get</span>(FileOutputFormat.<span style="color:#008080">OUTDIR</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>outA_Q<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">create</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(dir<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;a-q.text&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>outR_Z<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">create</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(dir<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;r-z.text&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">write</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>NullWritable<span style="color:#bbb"> </span>value)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>keyStr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>key.<span style="color:#008080">toString</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(StringUtils.<span style="color:#008080">isNotBlank</span>(keyStr))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">char</span><span style="color:#bbb"> </span>firstChar<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>keyStr.<span style="color:#008080">toLowerCase</span>().<span style="color:#008080">charAt</span>(0);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(<span style="color:#d14">&#39;a&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;=</span><span style="color:#bbb"> </span>firstChar<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&amp;&amp;</span><span style="color:#bbb"> </span>firstChar<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;=</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;q&#39;</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>outA_Q.<span style="color:#008080">writeUTF</span>(keyStr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;\n&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>outR_Z.<span style="color:#008080">writeBytes</span>(keyStr<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;\n&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">close</span>(TaskAttemptContext<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>outA_Q.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>outR_Z.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="joinçš„åº”ç”¨">Joinçš„åº”ç”¨</h3>
<p><strong>Joinæ—¶Mapç«¯çš„ä¸»è¦å·¥ä½œ</strong>ï¼šä¸ºæ¥è‡ªä¸åŒè¡¨æˆ–æ–‡ä»¶çš„key/valueå¯¹ï¼Œæ‰“æ ‡ç­¾ä»¥åŒºåˆ«ä¸åŒæ¥æºçš„è®°å½•ã€‚ç„¶åç”¨è¿æ¥å­—æ®µä½œä¸ºkeyï¼Œå…¶ä½™éƒ¨åˆ†å’Œæ–°åŠ çš„æ ‡å¿—ä½œä¸ºvalueï¼Œæœ€åè¿›è¡Œè¾“å‡ºã€‚</p>
<p><strong>Joinæ—¶Reduceç«¯çš„ä¸»è¦å·¥ä½œ</strong>ï¼šåœ¨Reduceç«¯ä»¥è¿æ¥å­—æ®µä½œä¸ºkeyçš„åˆ†ç»„å·²ç»å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ¯ä¸€ä¸ªåˆ†ç»„å½“ä¸­å°†é‚£äº›æ¥æºäºä¸åŒæ–‡ä»¶çš„è®°å½•(åœ¨Mapé˜¶æ®µå·²ç»æ‰“æ ‡å¿—)åˆ†å¼€ï¼Œæœ€åè¿›è¡Œåˆå¹¶ã€‚</p>
<h4 id="reduce-join">Reduce Join</h4>
<p>åœ¨Reduceè¿‡ç¨‹ä¸­è¿›è¡ŒJoinæ“ä½œ</p>
<p>ç¼ºç‚¹ï¼šè¿™ç§æ–¹å¼ä¸­ï¼Œåˆå¹¶çš„æ“ä½œæ˜¯åœ¨Reduceé˜¶æ®µå®Œæˆï¼ŒReduceç«¯çš„å¤„ç†å‹åŠ›å¤ªå¤§ï¼ŒMapèŠ‚ç‚¹çš„è¿ç®—è´Ÿè½½åˆ™å¾ˆä½ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸é«˜ï¼Œ ä¸”åœ¨Reduceé˜¶æ®µææ˜“äº§ç”Ÿæ•°æ®å€¾æ–œã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Data</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TableBean</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">implements</span><span style="color:#bbb"> </span>Writable<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>orderId;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>productId;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>name;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>flag;<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// è¡¨çš„æ ‡è®°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">write</span>(DataOutput<span style="color:#bbb"> </span>out)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(orderId);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(productId);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(name);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeInt</span>(count);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>out.<span style="color:#008080">writeUTF</span>(flag);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">readFields</span>(DataInput<span style="color:#bbb"> </span>in)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>orderId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>productId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readInt</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>flag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>in.<span style="color:#008080">readUTF</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">toString</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>orderId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb">  </span>name<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\t&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// åˆ†ç±»</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TableMapper</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Mapper<span style="color:#000;font-weight:bold">&lt;</span>LongWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>TableBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>fileName;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>TableBean<span style="color:#bbb"> </span>tableBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>TableBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>pId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">setup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileSplit<span style="color:#bbb"> </span>inputSplit<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(FileSplit)context.<span style="color:#008080">getInputSplit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>fileName<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>inputSplit.<span style="color:#008080">getPath</span>().<span style="color:#008080">getName</span>();<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">map</span>(LongWritable<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>value,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>data<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">toString</span>().<span style="color:#008080">split</span>(<span style="color:#d14">&#34;\t&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(fileName.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;order&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setOrderId</span>(data<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setProductId</span>(data<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>pId.<span style="color:#008080">set</span>(data<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setCount</span>(Integer.<span style="color:#008080">parseInt</span>(data<span style="color:#000;font-weight:bold">[</span>2<span style="color:#000;font-weight:bold">]</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setName</span>(<span style="color:#d14">&#34;&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setFlag</span>(<span style="color:#d14">&#34;order&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>context.<span style="color:#008080">write</span>(pId,<span style="color:#bbb"> </span>tableBean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(fileName.<span style="color:#008080">startsWith</span>(<span style="color:#d14">&#34;product&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setOrderId</span>(<span style="color:#d14">&#34;&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setCount</span>(0);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setProductId</span>(data<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setName</span>(data<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>pId.<span style="color:#008080">set</span>(data<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>tableBean.<span style="color:#008080">setFlag</span>(<span style="color:#d14">&#34;product&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>context.<span style="color:#008080">write</span>(pId,<span style="color:#bbb"> </span>tableBean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TableReducer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Reducer<span style="color:#000;font-weight:bold">&lt;</span>Text,<span style="color:#bbb"> </span>TableBean,<span style="color:#bbb"> </span>TableBean,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">reduce</span>(Text<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Iterable<span style="color:#000;font-weight:bold">&lt;</span>TableBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>values,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>TableBean<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>orderBeans<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>TableBean<span style="color:#bbb"> </span>productBean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>TableBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å¿…é¡»é‡æ–°copyå¯¹è±¡ï¼Œä¸ç„¶iteratoræ—¶ä½¿ç”¨è‡ªå·±å¡«å……ï¼Œä¼šå°†è®°å½•åç§»</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(TableBean<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>values)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">if</span>(value.<span style="color:#008080">getFlag</span>().<span style="color:#008080">equals</span>(<span style="color:#d14">&#34;order&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>TableBean<span style="color:#bbb"> </span>bean<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>TableBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>BeanUtil.<span style="color:#008080">copyProperties</span>(value,<span style="color:#bbb"> </span>bean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>orderBeans.<span style="color:#008080">add</span>(bean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>BeanUtil.<span style="color:#008080">copyProperties</span>(value,<span style="color:#bbb"> </span>productBean);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(TableBean<span style="color:#bbb"> </span>orderBean<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>orderBeans)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>TableBean<span style="color:#bbb"> </span>record<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>TableBean();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>BeanUtil.<span style="color:#008080">copyProperties</span>(orderBean,<span style="color:#bbb"> </span>record);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">record</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#458;font-weight:bold">setName</span>(productBean.<span style="color:#008080">getName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>context.<span style="color:#008080">write</span>(record,<span style="color:#bbb"> </span>NullWritable.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="map-join">Map Join</h4>
<p>Map Joiné€‚ç”¨äºä¸€å¼ è¡¨ååˆ†å°ã€ä¸€å¼ è¡¨å¾ˆå¤§çš„åœºæ™¯ã€‚åœ¨Mapç«¯ç¼“å­˜å¤šå¼ è¡¨ï¼Œæå‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ ·å¢åŠ Mapç«¯ä¸šåŠ¡ï¼Œå‡å°‘Reduceç«¯æ•°æ®çš„å‹åŠ›ï¼Œå°½å¯èƒ½çš„å‡å°‘æ•°æ®å€¾æ–œã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TableMapper</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>Mapper<span style="color:#000;font-weight:bold">&lt;</span>LongWritable,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>Text,<span style="color:#bbb"> </span>NullWritable<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,<span style="color:#bbb"> </span>String<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>productMap<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>k<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Text();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">setup</span>(Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 1 è·å–ç¼“å­˜çš„æ–‡ä»¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>URI<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>cacheFiles<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>context.<span style="color:#008080">getCacheFiles</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>cacheFiles<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>.<span style="color:#008080">getPath</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>context.<span style="color:#008080">getConfiguration</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileSystem<span style="color:#bbb"> </span>fileSystem<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>FileSystem.<span style="color:#008080">get</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FSDataInputStream<span style="color:#bbb"> </span>fileStream<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fileSystem.<span style="color:#008080">open</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(path));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>BufferedReader<span style="color:#bbb"> </span>reader<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>BufferedReader(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InputStreamReader(fileStream));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>line;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">while</span>(StringUtils.<span style="color:#008080">isNotEmpty</span>(line<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>reader.<span style="color:#008080">readLine</span>())){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// 2 åˆ‡å‰²</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>line.<span style="color:#008080">split</span>(<span style="color:#d14">&#34;\t&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// 3 ç¼“å­˜æ•°æ®åˆ°é›†åˆ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>productMap.<span style="color:#008080">put</span>(fields<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>,<span style="color:#bbb"> </span>fields<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 4 å…³æµ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>reader.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">map</span>(LongWritable<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>Text<span style="color:#bbb"> </span>value,<span style="color:#bbb"> </span>Context<span style="color:#bbb"> </span>context)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 1 è·å–ä¸€è¡Œ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>line<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>value.<span style="color:#008080">toString</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 2 æˆªå–</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>fields<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>line.<span style="color:#008080">split</span>(<span style="color:#d14">&#34;\t&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 3 è·å–äº§å“id</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>pId<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>fields<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 4 è·å–å•†å“åç§°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>pdName<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>productMap.<span style="color:#008080">get</span>(pId);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 5 æ‹¼æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>k.<span style="color:#008080">set</span>(line<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;\t&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>pdName);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 6 å†™å‡º</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>context.<span style="color:#008080">write</span>(k,<span style="color:#bbb"> </span>NullWritable.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DistributedCacheDriver</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Configuration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Configuration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>configuration.<span style="color:#008080">set</span>(<span style="color:#d14">&#34;fs.defaultFS&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;hdfs://192.168.1.161:9000&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// è®¾ç½®ç¼“å­˜æ–‡ä»¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">addCacheFile</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>URI(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/join/product.txt&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">setMapOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">setMapOutputValueClass</span>(NullWritable.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">setMapperClass</span>(TableMapper.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">setJarByClass</span>(DistributedCacheDriver.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>FileInputFormat.<span style="color:#008080">setInputPaths</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/join&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>FileOutputFormat.<span style="color:#008080">setOutputPath</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(<span style="color:#d14">&#34;hdfs://192.168.1.161:9000/output&#34;</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">submit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>job.<span style="color:#008080">waitForCompletion</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è®¡æ•°å™¨åº”ç”¨">è®¡æ•°å™¨åº”ç”¨</h3>
<p>Hadoopä¸ºæ¯ä¸ªä½œä¸šç»´æŠ¤è‹¥å¹²å†…ç½®è®¡æ•°å™¨ï¼Œä»¥æè¿°å¤šé¡¹æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼ŒæŸäº›è®¡æ•°å™¨è®°å½•å·²å¤„ç†çš„å­—èŠ‚æ•°å’Œè®°å½•æ•°ï¼Œä½¿ç”¨æˆ·å¯ç›‘æ§å·²å¤„ç†çš„è¾“å…¥æ•°æ®é‡å’Œå·²äº§ç”Ÿçš„è¾“å‡ºæ•°æ®é‡ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/* å¯ä½¿ç”¨å­—ç¬¦ä¸²åŒºåˆ† */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>context.<span style="color:#008080">getCounter</span>(<span style="color:#d14">&#34;status&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;success&#34;</span>).<span style="color:#008080">increment</span>(1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>context.<span style="color:#008080">getCounter</span>(<span style="color:#d14">&#34;status&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;fail&#34;</span>).<span style="color:#008080">increment</span>(1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/* å¯ä½¿ç”¨æšä¸¾ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>context.<span style="color:#008080">getCounter</span>(HttpStatus.<span style="color:#008080">SUCCESS</span>).<span style="color:#008080">increment</span>(1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>context.<span style="color:#008080">getCounter</span>(HttpStatus.<span style="color:#008080">FAIL</span>).<span style="color:#008080">increment</span>(1);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¹æ•°æ®å‹ç¼©">ä¹ã€æ•°æ®å‹ç¼©</h2>
<h3 id="å‹ç¼©ç®—æ³•">å‹ç¼©ç®—æ³•</h3>
<p>é‰´äºç£ç›˜I/Oå’Œç½‘ç»œå¸¦å®½æ˜¯Hadoopçš„å®è´µèµ„æºï¼Œæ•°æ®å‹ç¼©å¯¹äºèŠ‚çœèµ„æºã€æœ€å°åŒ–ç£ç›˜I/Oå’Œç½‘ç»œä¼ è¾“éå¸¸æœ‰å¸®åŠ©ã€‚<span style="color:red">å¯ä»¥åœ¨ä»»æ„MapReduceé˜¶æ®µå¯ç”¨å‹ç¼©</span>ã€‚ ä¸è¿‡ï¼Œå°½ç®¡å‹ç¼©ä¸è§£å‹æ“ä½œçš„CPUå¼€é”€ä¸é«˜,å…¶æ€§èƒ½çš„æå‡å’Œèµ„æºçš„èŠ‚çœå¹¶éæ²¡æœ‰ä»£ä»·ã€‚</p>
<p>Hadoopæ”¯æŒçš„å‹ç¼©ç¼–ç </p>
<table>
<thead>
<tr>
<th>å‹ç¼©æ ¼å¼</th>
<th>hadoopè‡ªå¸¦</th>
<th>ç®—æ³•</th>
<th>æ–‡ä»¶æ‰©å±•å</th>
<th>æ˜¯å¦å¯åˆ‡åˆ†</th>
<th>æ¢å‹ç¼©æ ¼å¼ååŸç¨‹åºæ˜¯å¦éœ€è¦ä¿®æ”¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEFLATE</td>
<td>æ˜¯</td>
<td>DEFLATE</td>
<td>.deflate</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>Gzip</td>
<td>æ˜¯</td>
<td>DEFLATE</td>
<td>.gz</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>bzip2</td>
<td>æ˜¯</td>
<td>bzip2</td>
<td>.bz2</td>
<td>æ˜¯</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>LZO</td>
<td>å¦</td>
<td>LZO</td>
<td>.lzo</td>
<td>æ˜¯</td>
<td>éœ€è¦å»ºç´¢å¼•ï¼Œè¿˜éœ€è¦æŒ‡å®šè¾“å…¥æ ¼å¼</td>
</tr>
<tr>
<td>Snappy</td>
<td>å¦</td>
<td>Snappy</td>
<td>.snappy</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
</tbody>
</table>
<ul>
<li>Gzipå‹ç¼©
<ul>
<li>ä¼˜ç‚¹ï¼šå‹ç¼©ç‡æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å‹ç¼©è§£å‹é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ï¼›Hadoopæœ¬èº«æ”¯æŒï¼Œåœ¨åº”ç”¨ä¸­å¤„ç†Gzipæ ¼å¼çš„æ–‡ä»¶å°±å’Œç›´æ¥å¤„ç†æ–‡æœ¬ä¸€æ ·ï¼›å¤§éƒ¨åˆ†Linuxç³»ç»Ÿéƒ½è‡ªå¸¦Gzipå‘½ä»¤ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚</li>
<li>ç¼ºç‚¹ï¼šä¸æ”¯æŒSplitã€‚</li>
<li>åº”ç”¨åœºæ™¯ï¼šå½“æ¯ä¸ªæ–‡ä»¶å‹ç¼©ä¹‹ååœ¨130Mä»¥å†…çš„(1ä¸ªå—å¤§å°å†…)ï¼Œéƒ½å¯ä»¥è€ƒè™‘ç”¨Gzipå‹ç¼©æ ¼å¼ã€‚</li>
</ul>
</li>
<li>Bzip2å‹ç¼©
<ul>
<li>ä¼˜ç‚¹ï¼šæ”¯æŒSplitï¼›å…·æœ‰å¾ˆé«˜çš„å‹ç¼©ç‡ï¼Œæ¯”Gzipå‹ç¼©ç‡é«˜ï¼› Hadoopæœ¬èº«è‡ªå¸¦ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚</li>
<li>ç¼ºç‚¹ï¼šå‹ç¼©è§£å‹é€Ÿåº¦æ…¢ã€‚</li>
<li>åº”ç”¨åœºæ™¯ï¼šé€‚åˆå¯¹é€Ÿåº¦è¦æ±‚ä¸é«˜ï¼Œä½†éœ€è¦è¾ƒé«˜çš„å‹ç¼©ç‡çš„æ—¶å€™ï¼Œæˆ–è€…è¾“å‡ºä¹‹åçš„æ•°æ®æ¯”è¾ƒå¤§ï¼Œå¤„ç†ä¹‹åçš„æ•°æ®éœ€è¦å‹ç¼©å­˜æ¡£å‡å°‘ç£ç›˜ç©ºé—´å¹¶ä¸”ä»¥åæ•°æ®ç”¨å¾—æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œæˆ–è€…å¯¹å•ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶æƒ³å‹ç¼©å‡å°‘å­˜å‚¨ç©ºé—´ï¼ŒåŒæ—¶åˆéœ€è¦æ”¯æŒSplitï¼Œè€Œä¸”å…¼å®¹ä¹‹å‰çš„åº”ç”¨ç¨‹åºçš„æƒ…å†µã€‚</li>
</ul>
</li>
<li>Lzoå‹ç¼©
<ul>
<li>ä¼˜ç‚¹ï¼šå‹ç¼©è§£å‹é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ï¼Œåˆç†çš„å‹ç¼©ç‡ï¼›æ”¯æŒSplitï¼Œå¯ä»¥åœ¨Linuxç³»ç»Ÿä¸‹å®‰è£…lzopå‘½ä»¤,ä½¿ç”¨æ–¹ä¾¿ã€‚</li>
<li>ç¼ºç‚¹ï¼šå‹ç¼©ç‡æ¯”Gzipè¦ä½ä¸€äº›ï¼ŒHadoopæœ¬èº«ä¸æ”¯æŒï¼Œéœ€è¦å®‰è£…ï¼›åœ¨åº”ç”¨ä¸­å¯¹Lzoæ ¼å¼çš„æ–‡ä»¶éœ€è¦åšä¸€-äº›ç‰¹æ®Šå¤„ç†(ä¸ºäº†æ”¯æŒSplitéœ€è¦å»ºç´¢å¼•ï¼Œè¿˜éœ€è¦æŒ‡å®šInputFormatä¸ºLzoæ ¼å¼)ã€‚</li>
<li>åº”ç”¨åœºæ™¯ï¼šä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå‹ç¼©ä¹‹åè¿˜å¤§äº200Mä»¥ä¸Šçš„å¯ä»¥è€ƒè™‘,è€Œä¸”å•ä¸ªæ–‡ä»¶è¶Šå¤§ï¼ŒLzoä¼˜ç‚¹è¶Šè¶Šæ˜æ˜¾ã€‚</li>
</ul>
</li>
<li>Snappyå‹ç¼©
<ul>
<li>ä¼˜ç‚¹ï¼šé«˜é€Ÿå‹ç¼©é€Ÿåº¦å’Œåˆç†çš„å‹ç¼©ç‡ã€‚</li>
<li>ç¼ºç‚¹ï¼šä¸æ”¯æŒSplitï¼Œå‹ç¼©ç‡æ¯”Gzipè¦ä½ï¼ŒHadoopæœ¬èº«ä¸æ”¯æŒ, éœ€è¦å®‰è£…ã€‚</li>
<li>åº”ç”¨åœºæ™¯ï¼šå½“MapReduceä½œä¸šçš„Mapè¾“å‡ºçš„æ•°æ®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä½œä¸ºMapåˆ°Reduceçš„ä¸­é—´æ•°æ®çš„å‹ç¼©æ ¼å¼ï¼Œæˆ–è€…ä½œä¸ºä¸€ä¸ªMapReduceä½œä¸šçš„è¾“å‡ºå’Œå¦å¤–ä¸€ä¸ªMapReduceä½œä¸šçš„è¾“å…¥ã€‚</li>
</ul>
</li>
</ul>
<h3 id="å‹ç¼©ä½ç½®é€‰æ‹©">å‹ç¼©ä½ç½®é€‰æ‹©</h3>
<img src="/img/hadoop/zip.png" style="zoom:67%;" />
<h3 id="å‹ç¼©å‚æ•°é…ç½®">å‹ç¼©å‚æ•°é…ç½®</h3>
<h4 id="ç¼–ç å™¨">ç¼–ç å™¨</h4>
<table>
<thead>
<tr>
<th>å‹ç¼©æ ¼å¼</th>
<th>ç¼–ç å™¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEFLATE</td>
<td>org.apache.hadoop.io.compress.DefaultCodec</td>
</tr>
<tr>
<td>gzip</td>
<td>org.apache.hadoop.io.compress.GzipCodec</td>
</tr>
<tr>
<td>bzip2</td>
<td>org.apache.hadoop.io.compress.BZip2Codec</td>
</tr>
<tr>
<td>LZO</td>
<td>com.hadoop.compression.lzo.LzopCodec</td>
</tr>
<tr>
<td>Snappy</td>
<td>org.apache.hadoop.io.compress.SnappyCodec</td>
</tr>
</tbody>
</table>
<h4 id="é…ç½®æ–‡ä»¶å‚æ•°">é…ç½®æ–‡ä»¶å‚æ•°</h4>
<p><code>core-site.xml</code>é…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- è¾“å…¥å‹ç¼©,Hadoopä½¿ç”¨æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ç¼–è§£ç å™¨ï¼Œé»˜è®¤ä»¥ä¸‹å€¼ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>io.compression.codecs<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.io.compress.DefaultCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>mapred-site.xml</code>é…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- è¿™ä¸ªå‚æ•°è®¾ä¸ºtrueå¯ç”¨Mapperè¾“å‡ºå‹ç¼© --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.map.output.compress<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>false<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- Mapperè¾“å‡ºå‹ç¼©æ ¼å¼ï¼Œä¼ä¸šå¤šä½¿ç”¨LZOæˆ–Snappyç¼–è§£ç å™¨åœ¨æ­¤é˜¶æ®µå‹ç¼©æ•°æ® --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.map.output.compress.codec<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.io.compress.DefaultCodec<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- Reducerè¾“å‡ºæ˜¯å¦å‹ç¼© --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.output.fileoutputformat.compress<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>false<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- Reducerè¾“å‡ºå‹ç¼©æ ¼å¼ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.output.fileoutputformat.compress.codec<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.io.compress.DefaultCodec<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å‹ç¼©ç±»å‹è¡Œå‹ç¼©ï¼ˆRECORDï¼‰ã€å—å‹ç¼©ï¼ˆBLOCKï¼‰ã€æ— å‹ç¼©ï¼ˆNONEï¼‰ï¼Œå»ºè®®å—å‹ç¼© --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.output.fileoutputformat.compress.type<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>RECORD<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä»£ç è®¾ç½®">ä»£ç è®¾ç½®</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// å¼€å¯mapç«¯è¾“å‡ºå‹ç¼©</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>configuration.<span style="color:#008080">setBoolean</span>(<span style="color:#d14">&#34;mapreduce.map.output.compress&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// è®¾ç½®mapç«¯è¾“å‡ºå‹ç¼©æ–¹å¼</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>configuration.<span style="color:#008080">setClass</span>(<span style="color:#d14">&#34;mapreduce.map.output.compress.codec&#34;</span>,<span style="color:#bbb"> </span>BZip2Codec.<span style="color:#008080">class</span>,<span style="color:#bbb"> </span>CompressionCodec.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// è®¾ç½®reduceç«¯è¾“å‡ºå‹ç¼©å¼€å¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>FileOutputFormat.<span style="color:#008080">setCompressOutput</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// è®¾ç½®å‹ç¼©çš„æ–¹å¼</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>FileOutputFormat.<span style="color:#008080">setOutputCompressorClass</span>(job,<span style="color:#bbb"> </span>BZip2Codec.<span style="color:#008080">class</span>);<span style="color:#bbb"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="lzoå®‰è£…">LZOå®‰è£…</h3>
<p><a href="http://www.oberhumer.com/opensource/lzo/download/">ä¸‹è½½LZO</a> | <a href="http://www.lzop.org/download">ä¸‹è½½lzop</a> | <a href="https://github.com/twitter/hadoop-lzo/archive/master.zip">ä¸‹è½½hadoop-lzo-master</a></p>
<h4 id="ç¬¬ä¸€æ­¥ç¼–è¯‘å®‰è£…lzoä¸lzopæ¯å°æœºå™¨éƒ½éœ€è¦">ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å®‰è£…lzoä¸lzopã€æ¯å°æœºå™¨éƒ½éœ€è¦ã€‘</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># lzo</span>
</span></span><span style="display:flex;"><span>tar -xvzf   lzo-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.tar.gz
</span></span><span style="display:flex;"><span>./configure --enable-shared
</span></span><span style="display:flex;"><span>make -j <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>make install
</span></span><span style="display:flex;"><span>cp /usr/local/lib/*lzo* /usr/lib  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># lzop</span>
</span></span><span style="display:flex;"><span>tar -xvzf lzop-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.tar.gz 
</span></span><span style="display:flex;"><span>./configure 
</span></span><span style="display:flex;"><span>make -j <span style="color:#099">10</span> 
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¬¬äºŒæ­¥å®‰è£…ç¼–è¯‘hadoop-lzo-master">ç¬¬äºŒæ­¥ï¼šå®‰è£…ã€ç¼–è¯‘hadoop-lzo-master</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>unzip master.zip 
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ç¼–è¾‘pom.xmlä¿®æ”¹hadoopçš„ç‰ˆæœ¬å·ä¸é›†ç¾¤ä¸­hadoopç‰ˆæœ¬ä¸€è‡´  </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># &lt;hadoop.current.version&gt;2.10.0&lt;/hadoop.current.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># å®‰è£…é…ç½®å¥½maven</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># å¯¼å…¥å®‰è£…éœ€è¦çš„å˜é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">CFLAGS</span><span style="color:#000;font-weight:bold">=</span>-m64
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">CXXFLAGS</span><span style="color:#000;font-weight:bold">=</span>-m64
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">C_INCLUDE_PATH</span><span style="color:#000;font-weight:bold">=</span>/opt/module/hadoop/lzo/include
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">LIBRARY_PATH</span><span style="color:#000;font-weight:bold">=</span>/opt/module/hadoop/lzo/lib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># mavebç¼–è¯‘</span>
</span></span><span style="display:flex;"><span>mvn clean package -Dmaven.test.skip<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># copyç¼–è¯‘åçš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> target/native/Linux-amd64-64/
</span></span><span style="display:flex;"><span>mkdir ~/hadoop-lzo-files
</span></span><span style="display:flex;"><span>tar -cBf - -C lib . | tar -xBvf - -C ~/hadoop-lzo-files
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¬¬ä¸‰æ­¥æ‹·è´ç¼–è¯‘åçš„æ–‡ä»¶æ¯å°æœºå™¨éƒ½éœ€è¦">ç¬¬ä¸‰æ­¥ï¼šæ‹·è´ç¼–è¯‘åçš„æ–‡ä»¶ã€æ¯å°æœºå™¨éƒ½éœ€è¦ã€‘</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cp ~/hadoop-lzo-files/libgplcompression*  <span style="color:#008080">$HADOOP_HOME</span>/lib/native/
</span></span><span style="display:flex;"><span>cp target/hadoop-lzo-0.4.21-SNAPSHOT.jar <span style="color:#008080">$HADOOP_HOME</span>/share/hadoop/common/
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¬¬å››æ­¥é…ç½®hadoopé…ç½®æ–‡ä»¶æ¯å°æœºå™¨éƒ½éœ€è¦">ç¬¬å››æ­¥ï¼šé…ç½®hadoopé…ç½®æ–‡ä»¶ã€æ¯å°æœºå™¨éƒ½éœ€è¦ã€‘</h4>
<p>é…ç½®<code>core-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>io.compression.codecs<span style="color:#000080">&lt;/name&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.io.compress.GzipCodec,  
</span></span><span style="display:flex;"><span>    org.apache.hadoop.io.compress.DefaultCodec,  
</span></span><span style="display:flex;"><span>    com.hadoop.compression.lzo.LzoCodec,  
</span></span><span style="display:flex;"><span>    com.hadoop.compression.lzo.LzopCodec,  
</span></span><span style="display:flex;"><span>    org.apache.hadoop.io.compress.BZip2Codec  
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/value&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>io.compression.codec.lzo.class<span style="color:#000080">&lt;/name&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>com.hadoop.compression.lzo.LzoCodec<span style="color:#000080">&lt;/value&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®<code>mapred-site.xml</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>    
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapred.compress.map.output<span style="color:#000080">&lt;/name&gt;</span>    
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>    
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>    
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapred.map.output.compression.codec<span style="color:#000080">&lt;/name&gt;</span>    
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>com.hadoop.compression.lzo.LzoCodec<span style="color:#000080">&lt;/value&gt;</span>    
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="snappyå®‰è£…">Snappyå®‰è£…</h3>
<p><a href="https://github.com/google/snappy/releases">snappyä¸‹è½½åœ°å€</a></p>
<h4 id="ç¬¬ä¸€æ­¥å®‰è£…snappy">ç¬¬ä¸€æ­¥ï¼šå®‰è£…snappy</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./configure
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¬¬äºŒæ­¥å’Œhadoopä¸€èµ·ç¼–è¯‘">ç¬¬äºŒæ­¥ï¼šå’ŒHadoopä¸€èµ·ç¼–è¯‘</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mvn package -Pdist,native -DskipTests -Dmaven.javadoc.skip<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">true</span> -Dtar -Dsnappy.lib<span style="color:#000;font-weight:bold">=</span>/usr/local/lib -Dbundle.snappy
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘çš„hadoopä¸‹çš„lib/nativeå·²ç»å­˜åœ¨</p>
<ul>
<li>libsnappy.la</li>
<li>libsnappy.so.1</li>
<li>libsnappy.so</li>
<li>libsnappy.so.1.3.1</li>
<li>libsnappy.a</li>
</ul>
<h4 id="ç¬¬ä¸‰æ­¥æ‹·è´æ‰€æœ‰snappyçš„libåˆ°é›†ç¾¤æ‰€æœ‰hadoopæœºå™¨çš„libnativeä¸‹">ç¬¬ä¸‰æ­¥ï¼šæ‹·è´æ‰€æœ‰snappyçš„libåˆ°é›†ç¾¤æ‰€æœ‰hadoopæœºå™¨çš„lib/nativeä¸‹</h4>
<h4 id="ç¬¬å››æ­¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸ">ç¬¬å››æ­¥ï¼šæŸ¥çœ‹æ˜¯å¦æˆåŠŸ</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hadoop checknative
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åyarnèµ„æºè°ƒåº¦å™¨">åã€Yarnèµ„æºè°ƒåº¦å™¨</h2>
<h3 id="yarnåŸºæœ¬æ¶æ„">YarnåŸºæœ¬æ¶æ„</h3>
<p>YARNä¸»è¦ç”±ResourceManagerã€NodeManagerã€ApplicationMasterå’ŒContainerç­‰ç»„ä»¶æ„æˆ</p>
<img src="/img/hadoop/yarn-struct.png" style="zoom: 50%;" />
<p><strong>Resource Manager</strong></p>
<p>â‘ å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼›â‘¡ç›‘æ§NodeManagerï¼›â‘¢å¯åŠ¨æˆ–ç›‘æ§App Masterï¼›â‘£èµ„æºåˆ†é…å’Œè°ƒåº¦</p>
<p><strong>Node Manager</strong></p>
<p>â‘ ç®¡ç†å•ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºï¼›â‘¡å¤„ç†æ¥è‡ªReourceManagerçš„å‘½ä»¤ï¼›â‘¢å¤„ç†æ¥è‡ªApp Masterçš„å‘½ä»¤</p>
<p><strong>App Master</strong></p>
<p>â‘ è´Ÿè´£æ•°æ®çš„åˆ‡åˆ†ï¼›â‘¡ä¸ºåº”ç”¨ç¨‹åºç”³è¯·èµ„æºå¹¶åˆ†é…å†…éƒ¨ä»»åŠ¡ï¼›â‘¢ä»»åŠ¡çš„ç›‘æ§ä¸å®¹é”™</p>
<p><strong>Container</strong></p>
<p>å°è£…èŠ‚ç‚¹ä¸Šå¤šç»´åº¦èµ„æºï¼Œä¾‹å¦‚ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰</p>
<h3 id="yarnå·¥ä½œæœºåˆ¶">Yarnå·¥ä½œæœºåˆ¶</h3>
<p><img src="/img/hadoop/yarn-work.png" alt="yarn-work"></p>
<p><strong>ã€1ã€‘ä½œä¸šæäº¤</strong></p>
<p>å‰ç½®æ­¥éª¤ï¼šClientè°ƒç”¨job.waitForCompletionæ–¹æ³•ï¼Œå‘æ•´ä¸ªé›†ç¾¤æäº¤MapReduceä½œä¸š</p>
<p>ç¬¬1æ­¥ï¼šClientå‘RMç”³è¯·ä¸€ä¸ªä½œä¸šid</p>
<p>ç¬¬2æ­¥ï¼šResourceManagerç»™Clientè¿”å›è¯¥jobèµ„æºçš„æäº¤è·¯å¾„å’Œä½œä¸šid</p>
<p>ç¬¬3æ­¥ï¼šClientæäº¤jaråŒ…ã€åˆ‡ç‰‡ä¿¡æ¯å’Œé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šçš„èµ„æºæäº¤è·¯å¾„</p>
<p>ç¬¬4æ­¥ï¼šClientæäº¤å®Œèµ„æºåï¼Œå‘RMç”³è¯·è¿è¡ŒAppMaster</p>
<p><strong>ã€2ã€‘ä½œä¸šåˆå§‹åŒ–</strong></p>
<p>ç¬¬5æ­¥ï¼šå½“RMæ”¶åˆ°Clientçš„è¯·æ±‚åï¼Œå°†è¯¥jobæ·»åŠ åˆ°å®¹é‡è°ƒåº¦å™¨ä¸­</p>
<p>ç¬¬6æ­¥ï¼šæŸä¸€ä¸ªç©ºé—²çš„NMé¢†å–åˆ°è¯¥Job</p>
<p>ç¬¬7æ­¥ï¼šè¯¥NodeManangeråˆ›å»ºContainerï¼Œå¹¶äº§ç”ŸAppMaster</p>
<p>ç¬¬8æ­¥ï¼šä¸‹è½½Clientæäº¤çš„èµ„æºåˆ°æœ¬åœ°</p>
<p>ã€3ã€‘ä»»åŠ¡åˆ†é…</p>
<p>ç¬¬9æ­¥ï¼šAppMasterå‘ResourceManagerç”³è¯·è¿è¡Œå¤šä¸ªMapTaskä»»åŠ¡èµ„æº</p>
<p>ç¬¬10æ­¥ï¼šResourceManagerå°†è¿è¡ŒMapTaskä»»åŠ¡åˆ†é…ç»™NodeManagerï¼ŒNodeManageråˆ†åˆ«é¢†å–ä»»åŠ¡å¹¶åˆ›å»ºå®¹å™¨</p>
<p>ã€4ã€‘ä»»åŠ¡è¿è¡Œ</p>
<p>ç¬¬11æ­¥ï¼šResourceManagerå‘æ¥æ”¶åˆ°ä»»åŠ¡çš„NodeManagerå‘é€ç¨‹åºå¯åŠ¨è„šæœ¬ï¼Œè¿™äº›NodeManageråˆ†åˆ«å¯åŠ¨MapTaskï¼ŒMapTaskå¯¹æ•°æ®åˆ†åŒºæ’åº</p>
<p>ç¬¬12æ­¥ï¼šAppMasterç­‰å¾…æ‰€æœ‰MapTaskè¿è¡Œå®Œæ¯•åï¼Œå‘ResourceManagerç”³è¯·å®¹å™¨ï¼Œè¿è¡ŒReduceTask</p>
<p>ç¬¬13æ­¥ï¼šReduceTaskå‘MapTaskè·å–ç›¸åº”åˆ†åŒºçš„æ•°æ®è¿›è¡Œè¿ç®—</p>
<p>ç¬¬14æ­¥ï¼šç¨‹åºè¿è¡Œå®Œæ¯•åï¼ŒMRä¼šå‘RMç”³è¯·æ³¨é”€è‡ªå·±</p>
<h4 id="è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°">è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°</h4>
<p>YARNä¸­çš„ä»»åŠ¡å°†å…¶è¿›åº¦å’ŒçŠ¶æ€åŒ…æ‹¬counterè¿”å›ç»™åº”ç”¨ç®¡ç†å™¨, å®¢æˆ·ç«¯æ¯ç§’ã€é€šè¿‡mapreduce.client.progressmonitor.pollintervalè®¾ç½®ã€‘å‘åº”ç”¨ç®¡ç†å™¨è¯·æ±‚è¿›åº¦æ›´æ–°, å±•ç¤ºç»™ç”¨æˆ·</p>
<h4 id="ä½œä¸šå®Œæˆ">ä½œä¸šå®Œæˆ</h4>
<p>é™¤äº†å‘åº”ç”¨ç®¡ç†å™¨è¯·æ±‚ä½œä¸šè¿›åº¦å¤–ï¼Œå®¢æˆ·ç«¯æ¯5ç§’éƒ½ä¼šé€šè¿‡è°ƒç”¨waitForCompletion()æ¥æ£€æŸ¥ä½œä¸šæ˜¯å¦å®Œæˆã€æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡mapreduce.client.completion.pollintervalè®¾ç½®ã€‘ã€‚ä½œä¸šå®Œæˆä¹‹åï¼Œåº”ç”¨ç®¡ç†å™¨å’ŒContainerä¼šæ¸…ç†å·¥ä½œçŠ¶æ€ã€‚ä½œä¸šçš„ä¿¡æ¯ä¼šè¢«ä½œä¸šå†å²æœåŠ¡å™¨å­˜å‚¨ä»¥å¤‡ä¹‹åç”¨æˆ·æ ¸æŸ¥</p>
<h3 id="èµ„æºè°ƒåº¦å™¨">èµ„æºè°ƒåº¦å™¨</h3>
<p>Hadoopä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰ä¸‰ç§ï¼š<code>FIFO</code>ã€<code>Capacity Scheduler</code>ã€é»˜è®¤ã€‘<code>å’ŒFair Scheduler</code>ï¼Œåœ¨``</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.scheduler.class<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>FIFO Scheduler</strong></p>
<p>FIFO ScheduleræŠŠåº”ç”¨æŒ‰æäº¤çš„é¡ºåºæ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåœ¨è¿›è¡Œèµ„æºåˆ†é…çš„æ—¶å€™ï¼Œå…ˆç»™é˜Ÿåˆ—ä¸­æœ€å¤´ä¸Šçš„åº”ç”¨è¿›è¡Œåˆ†é…èµ„æºï¼Œå¾…æœ€å¤´ä¸Šçš„åº”ç”¨éœ€æ±‚æ»¡è¶³åå†ç»™ä¸‹ä¸€ä¸ªåˆ†é…ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>FIFO Scheduleræ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å®¹æ˜“ç†è§£çš„è°ƒåº¦å™¨ï¼Œä¹Ÿä¸éœ€è¦ä»»ä½•é…ç½®ï¼Œä½†å®ƒå¹¶ä¸é€‚ç”¨äºå…±äº«é›†ç¾¤ã€‚å¤§çš„åº”ç”¨å¯èƒ½ä¼šå ç”¨æ‰€æœ‰é›†ç¾¤èµ„æºï¼Œè¿™å°±å¯¼è‡´å…¶å®ƒåº”ç”¨è¢«é˜»å¡ï¼Œæ¯”å¦‚æœ‰ä¸ªå¤§ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå ç”¨äº†å…¨éƒ¨çš„èµ„æºï¼Œå†æäº¤ä¸€ä¸ªå°ä»»åŠ¡ï¼Œåˆ™æ­¤å°ä»»åŠ¡ä¼šä¸€ç›´è¢«é˜»å¡ã€‚</p>
<p><strong>Capacity Scheduler</strong></p>
<p>å¯¹äºCapacityè°ƒåº¦å™¨ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„é˜Ÿåˆ—ç”¨æ¥è¿è¡Œå°ä»»åŠ¡ï¼Œä½†æ˜¯ä¸ºå°ä»»åŠ¡ä¸“é—¨è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¼šé¢„å…ˆå ç”¨ä¸€å®šçš„é›†ç¾¤èµ„æºï¼Œè¿™å°±å¯¼è‡´å¤§ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¼šè½åäºä½¿ç”¨FIFOè°ƒåº¦å™¨æ—¶çš„æ—¶é—´ã€‚</p>
<p><strong>Fair Scheduler</strong></p>
<p>åœ¨Fairè°ƒåº¦å™¨ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢„å…ˆå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼ŒFairè°ƒåº¦å™¨ä¼šä¸ºæ‰€æœ‰è¿è¡Œçš„jobåŠ¨æ€çš„è°ƒæ•´ç³»ç»Ÿèµ„æºã€‚</p>
<p>æ¯”å¦‚ï¼šå½“ç¬¬ä¸€ä¸ªå¤§jobæäº¤æ—¶ï¼Œåªæœ‰è¿™ä¸€ä¸ªjobåœ¨è¿è¡Œï¼Œæ­¤æ—¶å®ƒè·å¾—äº†æ‰€æœ‰é›†ç¾¤èµ„æºï¼›å½“ç¬¬äºŒä¸ªå°ä»»åŠ¡æäº¤åï¼ŒFairè°ƒåº¦å™¨ä¼šåˆ†é…ä¸€åŠèµ„æºç»™è¿™ä¸ªå°ä»»åŠ¡ï¼Œè®©è¿™ä¸¤ä¸ªä»»åŠ¡å…¬å¹³çš„å…±äº«é›†ç¾¤èµ„æºã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Fairè°ƒåº¦å™¨ä¸­ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡æäº¤åˆ°è·å¾—èµ„æºä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå› ä¸ºå®ƒéœ€è¦ç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡é‡Šæ”¾å ç”¨çš„Containerã€‚å°ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åä¹Ÿä¼šé‡Šæ”¾è‡ªå·±å ç”¨çš„èµ„æºï¼Œå¤§ä»»åŠ¡åˆè·å¾—äº†å…¨éƒ¨çš„ç³»ç»Ÿèµ„æºã€‚æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯Fairè°ƒåº¦å™¨å³å¾—åˆ°äº†é«˜çš„èµ„æºåˆ©ç”¨ç‡åˆèƒ½ä¿è¯å°ä»»åŠ¡åŠæ—¶å®Œæˆã€‚</p>
<h3 id="ä»»åŠ¡çš„æ¨æµ‹æ‰§è¡Œ">ä»»åŠ¡çš„æ¨æµ‹æ‰§è¡Œ</h3>
<p>å› ä¸ºä½œä¸šå®Œæˆæ—¶é—´å–å†³äºæœ€æ…¢çš„ä»»åŠ¡å®Œæˆæ—¶é—´ï¼Œæ‰€ä»¥å½“æœ‰æŸäº›èŠ‚ç‚¹å› ä¸ºè‡ªèº«é—®é¢˜æ‹–æ…¢ä»»åŠ¡ç»“æŸæ—¶é—´ï¼Œå¯ä½¿ç”¨æ¨æµ‹æ‰§è¡Œè¿›è¡Œä¼˜åŒ–ã€‚</p>
<p><strong>æ¨æµ‹æ‰§è¡Œæœºåˆ¶</strong></p>
<p>å‘ç°æ‹–åè…¿çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æŸä¸ªä»»åŠ¡è¿è¡Œé€Ÿåº¦è¿œæ…¢äºä»»åŠ¡å¹³å‡é€Ÿåº¦ã€‚ä¸ºæ‹–åè…¿ä»»åŠ¡å¯åŠ¨ä¸€ä¸ªå¤‡ä»½ä»»åŠ¡ï¼ŒåŒæ—¶è¿è¡Œã€‚è°å…ˆè¿è¡Œå®Œï¼Œåˆ™é‡‡ç”¨è°çš„ç»“æœã€‚</p>
<p><strong>æ‰§è¡Œæ¨æµ‹ä»»åŠ¡çš„å‰ææ¡ä»¶</strong></p>
<ol>
<li>æ‰§è¡Œæ¨æµ‹ä»»åŠ¡çš„å‰ææ¡ä»¶</li>
<li>å½“å‰Jobå·²å®Œæˆçš„Taskå¿…é¡»ä¸å°äº0.05ï¼ˆ5%ï¼‰</li>
<li>å¼€å¯æ¨æµ‹æ‰§è¡Œå‚æ•°è®¾ç½®ã€‚mapred-site.xmlæ–‡ä»¶ä¸­é»˜è®¤æ˜¯æ‰“å¼€çš„</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>mapreduce.map.speculative<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¸èƒ½å¯ç”¨æ¨æµ‹æ‰§è¡Œæœºåˆ¶æƒ…å†µ</strong></p>
<ol>
<li>ä»»åŠ¡é—´å­˜åœ¨ä¸¥é‡çš„è´Ÿè½½å€¾æ–œ</li>
<li>ç‰¹æ®Šä»»åŠ¡ï¼Œæ¯”å¦‚ä»»åŠ¡å‘æ•°æ®åº“ä¸­å†™æ•°æ®</li>
</ol>
<p><strong>ç®—æ³•åŸç†</strong></p>
<p>æ¨æµ‹è¿è¡Œæ—¶é—´ = (å½“å‰æ—¶åˆ» - ä»»åŠ¡å¯åŠ¨æ—¶åˆ») / ä»»åŠ¡æ¯”ä¾‹</p>
<p>æ¨æµ‹å®Œæˆæ—¶é—´ = æ¨æµ‹è¿è¡Œæ—¶é—´ + ä»»åŠ¡å¯åŠ¨æ—¶åˆ»</p>
<p>å¤‡ä»½ä»»åŠ¡æ¨æµ‹å®Œæˆæ—¶é—´ = å½“å‰æ—¶åˆ» + è¿è¡Œå®Œæˆä»»åŠ¡çš„å¹³å‡æ—¶é—´</p>
<ul>
<li>MesourceManageræ€»æ˜¯é€‰æ‹©<code>æ¨æµ‹å®Œæˆæ—¶é—´ - å¤‡ä»½ä»»åŠ¡æ¨æµ‹å®Œæˆæ—¶é—´ </code>å·®å€¼æœ€å¤§çš„ä»»åŠ¡ï¼Œä¸ºæ­¢å¯åŠ¨å¤‡ä»½ä»»åŠ¡</li>
<li>ä¸ºäº†é˜²æ­¢å¤§é‡ä»»åŠ¡åŒæ—¶å¯åŠ¨å¤‡ä»½ä»»åŠ¡é€ æˆçš„èµ„æºæµªè´¹ï¼ŒMesourceManagerä¸ºæ¯ä¸ªä½œä¸šè®¾ç½®äº†åŒæ—¶å¯åŠ¨çš„å¤‡ä»½ä»»åŠ¡æ•°ç›®ä¸Šé™</li>
</ul>
<h2 id="åä¸€hadoopä¼˜åŒ–">åä¸€ã€Hadoopä¼˜åŒ–</h2>
<h3 id="æ•°æ®è¾“å…¥">æ•°æ®è¾“å…¥</h3>
<ul>
<li>
<p>åˆå¹¶å°æ–‡ä»¶åœ¨æ‰§è¡ŒMRä»»åŠ¡å‰å°†å°æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¤§é‡çš„å°æ–‡ä»¶ä¼šäº§ç”Ÿå¤§é‡çš„Mapä»»åŠ¡ï¼Œå¢å¤§Mapä»»åŠ¡è£…è½½æ¬¡æ•°ï¼Œè€Œä»»åŠ¡çš„è£…è½½æ¯”è¾ƒè€—æ—¶ï¼Œä»è€Œå¯¼è‡´MRè¿è¡Œè¾ƒæ…¢</p>
</li>
<li>
<p>é‡‡ç”¨CombineTextInpntFormatæ¥ä½œä¸ºè¾“å…¥ï¼Œ è§£å†³è¾“å…¥ç«¯å¤§é‡å°æ–‡ä»¶åœºæ™¯</p>
</li>
</ul>
<h3 id="mapé˜¶æ®µ">Mapé˜¶æ®µ</h3>
<ul>
<li>å‡å°‘æº¢å†™(Spill) æ¬¡æ•°ï¼šè¿‡è°ƒæ•´<code>io.sort.mb</code>åŠ<code>sort.spill.percent</code>å‚æ•°å€¼ï¼Œå¢å¤§è§¦å‘Spillçš„å†…å­˜ä¸Šé™ï¼Œå‡å°‘Spillæ¬¡æ•°ï¼Œä»è€Œå‡å°‘ç£ç›˜lO</li>
<li>å‡å°‘åˆå¹¶(Merge) æ¬¡æ•°ï¼šé€šè¿‡è°ƒæ•´<code>io.sort.factor</code>å‚æ•°,å¢å¤§Mergeçš„æ–‡ä»¶æ•°ç›®ï¼Œå‡å°‘Mergeçš„æ¬¡æ•°,ä»è€Œç¼©çŸ­MRå¤„ç†æ—¶é—´</li>
<li>åœ¨Mapä¹‹åï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘å‰æä¸‹ï¼Œå…ˆè¿›è¡ŒCombineå¤„ç†ï¼Œå‡å°‘I/O</li>
</ul>
<h3 id="reduceé˜¶æ®µ">Reduceé˜¶æ®µ</h3>
<ul>
<li>
<p>åˆç†è®¾ç½®Mapå’ŒReduceæ•°ï¼šä¸¤ä¸ªéƒ½ä¸èƒ½è®¾ç½®å¤ªå°‘ï¼Œä¹Ÿä¸èƒ½è®¾ç½®å¤ªå¤šã€‚å¤ªå°‘ä¼šå¯¼è‡´Taskç­‰å¾…ï¼Œå»¶é•¿å¤„ç†æ—¶é—´ï¼›å¤ªå¤šä¼šå¯¼è‡´Mapã€Reduceä»»åŠ¡é—´ç«äº‰èµ„æºï¼Œé€ æˆå¤„ç†è¶…æ—¶ç­‰é”™è¯¯</p>
</li>
<li>
<p>è®¾ç½®Mapã€Reduceå…±å­˜ï¼šè°ƒæ•´<code>slowstart.completedmaps</code>å‚æ•°,ä½¿Mapè¿è¡Œåˆ°ä¸€å®šç¨‹åº¦åï¼ŒReduceä¹Ÿå¼€å§‹è¿è¡Œï¼Œå‡å°‘Reduceçš„ç­‰å¾…æ—¶é—´ã€‚</p>
</li>
<li>
<p>è§„é¿ä½¿ç”¨Reduceï¼šå› ä¸ºReduceåœ¨ç”¨äºè¿æ¥æ•°æ®é›†çš„æ—¶å€™å°†ä¼šäº§ç”Ÿå¤§é‡çš„ç½‘ç»œæ¶ˆè€—ã€‚</p>
</li>
<li>
<p>åˆç†è®¾ç½®Reduceç«¯çš„Bufferï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼ŒBufferä¸­çš„æ•°æ®å°±ä¼šå†™å…¥ç£ç›˜ï¼Œç„¶åReduceä¼šä»ç£ç›˜ä¸­è·å¾—æ‰€æœ‰çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒBufferå’ŒReduceæ˜¯æ²¡æœ‰ç›´æ¥å…³è”çš„ï¼Œä¸­é—´å¤šæ¬¡å†™ç£ç›˜~&gt;è¯»ç£ç›˜çš„è¿‡ç¨‹ï¼Œæ—¢ç„¶
æœ‰è¿™ä¸ªå¼Šç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å‚æ•°æ¥é…ç½®ï¼Œä½¿å¾—Bufferä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®å¯ä»¥ç›´æ¥è¾“é€åˆ°Reduceï¼Œä»è€Œå‡å°‘IOå¼€é”€ï¼š<code>mapreduce reduce .input. buffer percent</code>é»˜è®¤ä¸º0.0ã€‚å½“å€¼å¤§äº0çš„æ—¶å€™ï¼Œä¼šä¿ç•™æŒ‡å®šæ¯”ä¾‹çš„å†…å­˜è¯»Bufferä¸­çš„æ•°æ®ç›´æ¥æ‹¿ç»™Reduceä½¿ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œ è®¾ç½®Buffer éœ€è¦å†…å­˜ï¼Œè¯»å–æ•°æ®éœ€è¦å†…å­˜ï¼ŒReduceè®¡ç®—ä¹Ÿè¦å†…å­˜ï¼Œæ‰€ä»¥è¦æ ¹æ®ä½œä¸šçš„è¿è¡Œæƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚</p>
</li>
</ul>
<h3 id="ioä¼ è¾“">I/Oä¼ è¾“</h3>
<p>é‡‡ç”¨æ•°æ®å‹ç¼–çš„æ–¹å¼ï¼Œå‡å°‘ç½‘è·¯I/Oçš„æ—¶é—´ã€‚å®‰è£…Snappyå’ŒLZOç¼–ç å™¨</p>
<h3 id="æ•°æ®å€¾æ–œ">æ•°æ®å€¾æ–œ</h3>
<p><strong>æŠ½æ ·å’ŒèŒƒå›´åˆ†åŒº</strong>ï¼šå¯ä»¥é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡ŒæŠ½æ ·å¾—åˆ°çš„ç»“æœé›†æ¥é¢„è®¾åˆ†åŒºè¾¹ç•Œå€¼ã€‚
<strong>è‡ªå®šä¹‰åˆ†åŒº</strong>ï¼šåŸºäºè¾“å‡ºé”®çš„èƒŒæ™¯çŸ¥è¯†è¿›è¡Œè‡ªå®šä¹‰åˆ†åŒºã€‚
<strong>é‡‡ç”¨Combine</strong>ï¼šä½¿ç”¨Combineå¯ä»¥å¤§é‡åœ°å‡å°æ•°æ®å€¾æ–œã€‚åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼ŒCombineçš„ç›®çš„å°±æ˜¯èšåˆå¹¶ç²¾ç®€æ•°æ®ã€‚
<strong>é‡‡ç”¨Map Joinï¼Œå°½é‡é¿å…Reduce Join</strong>ã€‚</p>
<h3 id="å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°">å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°</h3>
<p>é…ç½®<code>mapred-site.xml</code>æ–‡ä»¶</p>
<table>
<thead>
<tr>
<th>é…ç½®å‚æ•°</th>
<th>å‚æ•°è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>mapreduce.map.memory.mb</td>
<td>ä¸€ä¸ªMapTaskå¯ä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ˆå•ä½:MBï¼‰ï¼Œé»˜è®¤ä¸º1024ã€‚å¦‚æœMapTaskå®é™…ä½¿ç”¨çš„èµ„æºé‡è¶…è¿‡è¯¥å€¼ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ€æ­»ã€‚</td>
</tr>
<tr>
<td>mapreduce.reduce.memory.mb</td>
<td>ä¸€ä¸ªReduceTaskå¯ä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ˆå•ä½:MBï¼‰ï¼Œé»˜è®¤ä¸º1024ã€‚å¦‚æœReduceTaskå®é™…ä½¿ç”¨çš„èµ„æºé‡è¶…è¿‡è¯¥å€¼ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ€æ­»ã€‚</td>
</tr>
<tr>
<td>mapreduce.map.cpu.vcores</td>
<td>æ¯ä¸ªMapTaskå¯ä½¿ç”¨çš„æœ€å¤šcpu coreæ•°ç›®ï¼Œé»˜è®¤å€¼: 1</td>
</tr>
<tr>
<td>mapreduce.reduce.cpu.vcores</td>
<td>æ¯ä¸ªReduceTaskå¯ä½¿ç”¨çš„æœ€å¤šcpu coreæ•°ç›®ï¼Œé»˜è®¤å€¼: 1</td>
</tr>
<tr>
<td>mapreduce.reduce.shuffle.parallelcopies</td>
<td>æ¯ä¸ªReduceå»Mapä¸­å–æ•°æ®çš„å¹¶è¡Œæ•°ã€‚é»˜è®¤å€¼æ˜¯5</td>
</tr>
<tr>
<td>mapreduce.reduce.shuffle.merge.percent</td>
<td>Bufferä¸­çš„æ•°æ®è¾¾åˆ°å¤šå°‘æ¯”ä¾‹å¼€å§‹å†™å…¥ç£ç›˜ã€‚é»˜è®¤å€¼0.66</td>
</tr>
<tr>
<td>mapreduce.reduce.shuffle.input.buffer.percent</td>
<td>Bufferå¤§å°å Reduceå¯ç”¨å†…å­˜çš„æ¯”ä¾‹ã€‚é»˜è®¤å€¼0.7</td>
</tr>
<tr>
<td>mapreduce.reduce.input.buffer.percent</td>
<td>æŒ‡å®šå¤šå°‘æ¯”ä¾‹çš„å†…å­˜ç”¨æ¥å­˜æ”¾Bufferä¸­çš„æ•°æ®ï¼Œé»˜è®¤å€¼æ˜¯0.0</td>
</tr>
<tr>
<td>mapreduce.task.io.sort.mb</td>
<td>Shuffleçš„ç¯å½¢ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤100m</td>
</tr>
<tr>
<td>mapreduce.map.sort.spill.percent</td>
<td>ç¯å½¢ç¼“å†²åŒºæº¢å‡ºçš„é˜ˆå€¼ï¼Œé»˜è®¤80%</td>
</tr>
<tr>
<td>mapreduce.map.maxattempts</td>
<td>æ¯ä¸ªMap Taskæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸€æ—¦é‡è¯•å‚æ•°è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è®¤ä¸ºMap Taskè¿è¡Œå¤±è´¥ï¼Œé»˜è®¤å€¼ï¼š4</td>
</tr>
<tr>
<td>mapreduce.reduce.maxattempts</td>
<td>æ¯ä¸ªReduce Taskæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸€æ—¦é‡è¯•å‚æ•°è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è®¤ä¸ºMap Taskè¿è¡Œå¤±è´¥ï¼Œé»˜è®¤å€¼ï¼š4</td>
</tr>
<tr>
<td>mapreduce.task.timeout</td>
<td>Taskè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤600000æ¯«ç§’</td>
</tr>
</tbody>
</table>
<p>é…ç½®<code>yarn-site.xml</code>æ–‡ä»¶</p>
<table>
<thead>
<tr>
<th>é…ç½®å‚æ•°</th>
<th>å‚æ•°è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>yarn.scheduler.minimum-allocation-mb</td>
<td>ç»™åº”ç”¨ç¨‹åºContaineråˆ†é…çš„æœ€å°å†…å­˜ï¼Œé»˜è®¤å€¼ï¼š1024</td>
</tr>
<tr>
<td>yarn.scheduler.maximum-allocation-mb</td>
<td>ç»™åº”ç”¨ç¨‹åºContaineråˆ†é…çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ï¼š8192</td>
</tr>
<tr>
<td>yarn.scheduler.minimum-allocation-vcores</td>
<td>æ¯ä¸ªContainerç”³è¯·çš„æœ€å°CPUæ ¸æ•°ï¼Œé»˜è®¤å€¼ï¼š1</td>
</tr>
<tr>
<td>yarn.scheduler.maximum-allocation-vcores</td>
<td>æ¯ä¸ªContainerç”³è¯·çš„æœ€å¤§CPUæ ¸æ•°ï¼Œé»˜è®¤å€¼ï¼š32</td>
</tr>
<tr>
<td>yarn.nodemanager.resource.memory-mb</td>
<td>ç»™Containersåˆ†é…çš„æœ€å¤§ç‰©ç†å†…å­˜ï¼Œé»˜è®¤å€¼ï¼š8192</td>
</tr>
</tbody>
</table>
<h3 id="hdfså°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•">HDFSå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•</h3>
<ul>
<li>Hadoop Archiveï¼šæ˜¯ä¸€ä¸ªé«˜æ•ˆåœ°å°†å°æ–‡ä»¶æ”¾å…¥HDFSå—ä¸­çš„æ–‡ä»¶å­˜æ¡£å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå°†å¤šä¸ªå°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªHARæ–‡ä»¶, è¿™æ ·å°±å‡å°‘äº†NameNameçš„å†…å­˜ä½¿ç”¨ã€‚</li>
<li>CombineFileInputFormatï¼šç”¨äºå°†å¤šä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„Split</li>
<li>å¼€å¯JVMé‡ç”¨<code>mapred-site.xml</code>é…ç½®<code>mapreduce.job.jvm.num.tasks</code>ï¼Œé»˜è®¤ä¸º1</li>
</ul>
<h2 id="åäºŒhadoopé«˜å¯ç”¨">åäºŒã€Hadoopé«˜å¯ç”¨</h2>
<p>å‰ææ¡ä»¶ï¼š<code>å·²ç»æ­å»ºzookeeperé›†ç¾¤</code>ï¼Œ<code>yum install psmisc</code></p>
<h3 id="ç¬¬ä¸€æ­¥é…ç½®core-sitexml">ç¬¬ä¸€æ­¥ï¼šé…ç½®<code>core-site.xml</code></h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- zké›†ç¾¤ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>ha.zookeeper.quorum<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos161:2181,centos162:2181,centos163:2181<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHDFSä¸­NameNodeçš„åœ°å€ï¼Œé…ç½®ä¸ºé›†ç¾¤çš„ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>fs.defaultFS<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>hdfs://haCluster<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šHadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>hadoop.tmp.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/opt/module/HA/hadoop/data/tmp<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬äºŒæ­¥é…ç½®hdfs-sitexml">ç¬¬äºŒæ­¥ï¼šé…ç½®<code>hdfs-site.xml</code></h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é›†ç¾¤åç§° --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.nameservices<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>haCluster<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- è‡ªåŠ¨æ•…éšœè½¬ç§» --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.ha.automatic-failover.enabled<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®nameNode --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.ha.namenodes.haCluster<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>nn1,nn2<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.rpc-address.haCluster.nn1<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos161:8020<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.rpc-address.haCluster.nn2<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos162:8020<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.http-address.haCluster.nn1<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos161:50070<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.http-address.haCluster.nn2<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos162:50070<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®journalNode --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.shared.edits.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>qjournal://centos161:8485;centos162:8485;centos163:8485/haCluster<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.client.failover.proxy.provider.mycluster<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.journalnode.edits.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/opt/module/HA/hadoop/data/tmp/dfs/jn<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- sshç™»é™†é…ç½® --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.ha.fencing.methods<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>sshfence<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.ha.fencing.ssh.private-key-files<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>/home/kun/.ssh/id_rsa<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.replication<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>3<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.namenode.name.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>file:///${hadoop.tmp.dir}/dfs/name<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>dfs.datanode.data.dir<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>file:///${hadoop.tmp.dir}/dfs/data<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬ä¸‰æ­¥é…ç½®yarn-sitexml">ç¬¬ä¸‰æ­¥ï¼šé…ç½®<code>yarn-site.xml</code></h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>mapreduce_shuffle<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å¯ç”¨resourcemanager ha --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.ha.enabled<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å£°æ˜ä¸¤å°resourcemanagerçš„åœ°å€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.cluster-id<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>ha-yarn-cluster<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.ha.rm-ids<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>rm1,rm2<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.hostname.rm1<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos162<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.hostname.rm2<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos163<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šzookeeperé›†ç¾¤çš„åœ°å€ --&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.zk-address<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>centos161:2181,centos162:2181,centos163:2181<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å¯ç”¨è‡ªåŠ¨æ¢å¤ --&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.recovery.enabled<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- æŒ‡å®šresourcemanagerçš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨zookeeperé›†ç¾¤ --&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;name&gt;</span>yarn.resourcemanager.store.class<span style="color:#000080">&lt;/name&gt;</span>     		
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;value&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é›†ç¾¤ç¾¤èµ·">é›†ç¾¤ç¾¤èµ·</h3>
<p>â‘ å¯åŠ¨æ‰€æœ‰JNèŠ‚ç‚¹å¯åŠ¨journalNodeæœåŠ¡[å¥‡æ•°ä¸ª]</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/hadoop-daemon.sh start journalnode
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡æ ¼å¼åŒ–</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># NameNode 1 ä¸Šæ ¼å¼åŒ–</span>
</span></span><span style="display:flex;"><span>bin/hdfs namenode -format
</span></span><span style="display:flex;"><span>sbin/hadoop-daemon.sh start namenode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># NameNode 2 åŒæ­¥å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>bin/hdfs namenode -bootstrapStandby
</span></span><span style="display:flex;"><span>sbin/hadoop-daemon.sh start namenode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœæ­¢æœåŠ¡</span>
</span></span><span style="display:flex;"><span>sbin/stop-dfs.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢åˆå§‹åŒ–HAåœ¨Zookeeperä¸­çŠ¶æ€</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bin/hdfs zkfc -formatZK
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘£ç¾¤èµ·HDFS</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sbin/start-dfs.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥çœ‹nameNodeèŠ‚ç‚¹zkfcæœåŠ¡å¯åŠ¨çŠ¶æ€ï¼Œä½ç‰ˆæœ¬æ²¡å¯åŠ¨ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>sbin/hadoop-daemin.sh start zkfc
</span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¤å¯åŠ¨yarn</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœ¨ResourceManagerèŠ‚ç‚¹å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>sbin/start-yarn.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥çœ‹ResourceManagerèŠ‚ç‚¹å¯åŠ¨çŠ¶æ€ï¼Œä½ç‰ˆæœ¬æ²¡å¯åŠ¨ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>sbin/yarn-daemon.sh start resourcemanager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥çœ‹çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>bin/yarn rmadmin -getServiceState rm1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é™„å½•">é™„å½•</h2>
<p><strong>zkèŠ‚ç‚¹è„šæœ¬</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#008080">host_name_arr</span><span style="color:#000;font-weight:bold">=(</span><span style="color:#d14">&#39;centos161&#39;</span> <span style="color:#d14">&#39;centos162&#39;</span> <span style="color:#d14">&#39;centos163&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> host_name in <span style="color:#d14">${</span><span style="color:#008080">host_name_arr</span>[*]<span style="color:#d14">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span> <span style="color:#0086b3">echo</span> <span style="color:#d14">&#39;========================&#39;</span><span style="color:#008080">$host_name</span><span style="color:#d14">&#39;========================&#39;</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$1</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;start&#34;</span> <span style="color:#000;font-weight:bold">]</span> ; <span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  ssh <span style="color:#008080">$host_name</span> <span style="color:#d14">&#34;/opt/module/zookeeper/bin/zkServer.sh start&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$1</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;status&#34;</span> <span style="color:#000;font-weight:bold">]</span> ; <span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  ssh <span style="color:#008080">$host_name</span> <span style="color:#d14">&#34;/opt/module/zookeeper/bin/zkServer.sh status&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span> <span style="color:#0086b3">echo</span> -e <span style="color:#d14">&#39;\n&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è‡ªå®šä¹‰Driverå®˜æ–¹æ ¼å¼</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">FlowerDriver</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">implements</span><span style="color:#bbb"> </span>Tool<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>Configuration<span style="color:#bbb"> </span>configuration;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>res<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ToolRunner.<span style="color:#008080">run</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FlowerDriver(),<span style="color:#bbb"> </span>args);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">exit</span>(res);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">run</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è·å–JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Job<span style="color:#bbb"> </span>job<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Job.<span style="color:#008080">getInstance</span>(<span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">configuration</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å…³è”Mapperå’ŒReducer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapperClass</span>(FlowerMapper.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setReducerClass</span>(FlowerReducer.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®Mapperé˜¶æ®µè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setMapOutputValueClass</span>(FlowerBean.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®æœ€åè¾“å‡ºçš„KVç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputKeyClass</span>(Text.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">setOutputValueClass</span>(FlowerBean.<span style="color:#008080">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®¾ç½®ç¨‹åºè¾“å‡ºçš„è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileInputFormat.<span style="color:#008080">setInputPaths</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(args<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileOutputFormat.<span style="color:#008080">setOutputPath</span>(job,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Path(args<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æäº¤JOB</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>job.<span style="color:#008080">submit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>job.<span style="color:#008080">waitForCompletion</span>(<span style="color:#000;font-weight:bold">true</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span>0<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>1;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">setConf</span>(Configuration<span style="color:#bbb"> </span>conf)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">this</span>.<span style="color:#008080">configuration</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>conf;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>Configuration<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">getConf</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>configuration;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œæ–¹æ³•ï¼š<code>hadoop jar xxx.jar qualifiedClassName -Dmapred.map.tasks=nums -Dmapred.reduce.tasks=nums INPUT OUTPUT</code></p>

    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
