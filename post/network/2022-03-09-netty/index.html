<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="NettyÁöÑÂü∫Êú¨‰ΩøÁî® - https://hobocat.github.io/post/network/2022-03-09-netty/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>NettyÁöÑÂü∫Êú¨‰ΩøÁî®</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">NettyÁöÑÂü∫Êú¨‰ΩøÁî®</h1>
    
        
        
            <div id="toc">üìú</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2022-03-09&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            15351 Â≠ó</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            31 ÂàÜÈíü</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/network">network</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#‰∏ÄnioÂü∫Á°Ä">‰∏Ä„ÄÅNIOÂü∫Á°Ä</a>
      <ul>
        <li><a href="#bio">BIO</a></li>
        <li><a href="#nio">NIO</a></li>
        <li><a href="#nio---‰∏âÂ§ßÁªÑ‰ª∂">NIO - ‰∏âÂ§ßÁªÑ‰ª∂</a></li>
        <li><a href="#nio---bytebuffer">NIO - ByteBuffer</a></li>
        <li><a href="#nio---bytebuffer-Â∏∏ËßÅÊñπÊ≥ï">NIO - ByteBuffer Â∏∏ËßÅÊñπÊ≥ï</a></li>
        <li><a href="#nio---Êñá‰ª∂ÁºñÁ®ã">NIO - Êñá‰ª∂ÁºñÁ®ã</a></li>
        <li><a href="#nio---ÁΩëÁªúÁºñÁ®ã">NIO - ÁΩëÁªúÁºñÁ®ã</a></li>
        <li><a href="#nio-vs-bio">NIO vs BIO</a></li>
      </ul>
    </li>
    <li><a href="#‰∫ånettyÁöÑÂü∫Êú¨‰ΩøÁî®">‰∫å„ÄÅNettyÁöÑÂü∫Êú¨‰ΩøÁî®</a>
      <ul>
        <li><a href="#ÁÆÄ‰ªã">ÁÆÄ‰ªã</a></li>
        <li><a href="#ÊúÄÂü∫Á°ÄÁöÑnettyÁ§∫‰æã">ÊúÄÂü∫Á°ÄÁöÑNettyÁ§∫‰æã</a></li>
        <li><a href="#Áõ∏ÂÖ≥Ê¶ÇÂøµ">Áõ∏ÂÖ≥Ê¶ÇÂøµ</a></li>
        <li><a href="#eventloopÁªÑ‰ª∂">EventLoopÁªÑ‰ª∂</a></li>
        <li><a href="#channelÁªÑ‰ª∂">ChannelÁªÑ‰ª∂</a></li>
        <li><a href="#future--promise">Future &amp; Promise</a></li>
        <li><a href="#handler--pipeline">Handler &amp; Pipeline</a></li>
        <li><a href="#bytebuf">ByteBuf</a></li>
      </ul>
    </li>
    <li><a href="#‰∏ânettyÈ´òÁ∫ßÁî®Ê≥ï">‰∏â„ÄÅNettyÈ´òÁ∫ßÁî®Ê≥ï</a>
      <ul>
        <li><a href="#Á≤òÂåÖ‰∏éÂçäÂåÖ">Á≤òÂåÖ‰∏éÂçäÂåÖ</a></li>
        <li><a href="#ÂøÉË∑≥Êú∫Âà∂">ÂøÉË∑≥Êú∫Âà∂</a></li>
        <li><a href="#ÁºñÁ†Å">ÁºñÁ†Å</a></li>
        <li><a href="#nettyÊèê‰æõÁöÑ‰∏ªË¶ÅtcpÂèÇÊï∞">NettyÊèê‰æõÁöÑ‰∏ªË¶ÅTCPÂèÇÊï∞</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="‰∏ÄnioÂü∫Á°Ä">‰∏Ä„ÄÅNIOÂü∫Á°Ä</h2>
<h3 id="bio">BIO</h3>
<p>Blocking IOÔºö ÂêåÊ≠•ÈòªÂ°ûÁöÑÁºñÁ®ãÊñπÂºè„ÄÇ</p>
<p>JDK1.4ÁâàÊú¨Êèê‰æõ‰∫ÜBIOÁºñÁ®ãÊñπÂºè„ÄÇÁºñÁ®ãÂÆûÁé∞ËøáÁ®ã‰∏∫ÔºöÈ¶ñÂÖàÂú®ÊúçÂä°Á´ØÂêØÂä®‰∏Ä‰∏™ServerSocketÊù•ÁõëÂê¨ÁΩëÁªúËØ∑Ê±ÇÔºåÂÆ¢Êà∑Á´ØÂêØÂä®SocketÂèëËµ∑ÁΩëÁªúËØ∑Ê±ÇÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãServerSocketÂõûÂª∫Á´ã‰∏Ä‰∏™Á∫øÁ®ãÊù•Â§ÑÁêÜÊ≠§ËØ∑Ê±ÇÔºåÂ¶ÇÊûúÊúçÂä°Á´ØÊ≤°ÊúâÁ∫øÁ®ãÂèØÁî®ÔºåÂÆ¢Êà∑Á´ØÂàô‰ºöÈòªÂ°ûÁ≠âÂæÖÊàñÈÅ≠Âà∞ÊãíÁªù„ÄÇÈÄöËÆØËøáÁ®ã‰∏≠ÔºåÊòØÂêåÊ≠•ÁöÑ„ÄÇÂú®Âπ∂ÂèëÂ§ÑÁêÜÊïàÁéá‰∏äÊØîËæÉ‰Ωé„ÄÇ</p>
<img src="/img/netty/BIO-01.png" alt="BIO-01" style="zoom:77%;" />
<p>ÂêåÊ≠•Âπ∂ÈòªÂ°ûÔºåÊúçÂä°Âô®ÂÆûÁé∞Ê®°Âºè‰∏∫‰∏Ä‰∏™ËøûÊé•‰∏Ä‰∏™Á∫øÁ®ãÔºåÂç≥ÂÆ¢Êà∑Á´ØÊúâËøûÊé•ËØ∑Ê±ÇÊó∂ÊúçÂä°Âô®Á´ØÂ∞±ÈúÄË¶ÅÂêØÂä®‰∏Ä‰∏™Á∫øÁ®ãËøõË°åÂ§ÑÁêÜÔºåÂ¶ÇÊûúËøô‰∏™ËøûÊé•‰∏çÂÅö‰ªª‰Ωï‰∫ãÊÉÖ‰ºöÈÄ†Êàê‰∏çÂøÖË¶ÅÁöÑÁ∫øÁ®ãÂºÄÈîÄÔºåÂΩìÁÑ∂ÂèØ‰ª•ÈÄöËøáÁ∫øÁ®ãÊ±†Êú∫Âà∂ÊîπÂñÑ„ÄÇBIOÊñπÂºèÈÄÇÁî®‰∫éËøûÊé•Êï∞ÁõÆÊØîËæÉÂ∞è‰∏îÂõ∫ÂÆöÁöÑÊû∂ÊûÑÔºåËøôÁßçÊñπÂºèÂØπÊúçÂä°Âô®ËµÑÊ∫êË¶ÅÊ±ÇÊØîËæÉÈ´òÔºåÂπ∂ÂèëÂ±ÄÈôê‰∫éÂ∫îÁî®‰∏≠ÔºåJDK1.4‰ª•ÂâçÁöÑÂîØ‰∏ÄÈÄâÊã©Ôºå‰ΩÜÁ®ãÂ∫èÁõ¥ËßÇÁÆÄÂçïÊòìÁêÜËß£„ÄÇ</p>
<img src="/img/netty/BIO-02.png" alt="BIO-02" style="zoom:77%;" />
<h3 id="nio">NIO</h3>
<p>Unblocking IOÔºàNew IOÔºâÔºö ÂêåÊ≠•ÈùûÈòªÂ°ûÁöÑÁºñÁ®ãÊñπÂºè„ÄÇ</p>
<p>NIOÊú¨Ë∫´ÊòØÂü∫‰∫é‰∫ã‰ª∂È©±Âä®ÊÄùÊÉ≥Êù•ÂÆåÊàêÁöÑÔºåÂÖ∂‰∏ªË¶ÅÊÉ≥Ëß£ÂÜ≥ÁöÑÊòØBIOÁöÑÂ§ßÂπ∂ÂèëÈóÆÈ¢òÔºåNIOÂü∫‰∫éReactorÔºåÂΩìsocketÊúâÊµÅÂèØËØªÊàñÂèØÂÜôÂÖ•socketÊó∂ÔºåÊìç‰ΩúÁ≥ªÁªü‰ºöÁõ∏Â∫îÁöÑÈÄöÁü•ÂºïÁî®Á®ãÂ∫èËøõË°åÂ§ÑÁêÜÔºåÂ∫îÁî®ÂÜçÂ∞ÜÊµÅËØªÂèñÂà∞ÁºìÂÜ≤Âå∫ÊàñÂÜôÂÖ•Êìç‰ΩúÁ≥ªÁªü„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåËøô‰∏™Êó∂ÂÄôÔºåÂ∑≤Áªè‰∏çÊòØ‰∏Ä‰∏™ËøûÊé•Â∞±Ë¶ÅÂØπÂ∫î‰∏Ä‰∏™Â§ÑÁêÜÁ∫øÁ®ã‰∫ÜÔºåËÄåÊòØÊúâÊïàÁöÑËØ∑Ê±ÇÔºåÂØπÂ∫î‰∏Ä‰∏™Á∫øÁ®ãÔºåÂΩìËøûÊé•Ê≤°ÊúâÊï∞ÊçÆÊó∂ÔºåÊòØÊ≤°ÊúâÂ∑•‰ΩúÁ∫øÁ®ãÊù•Â§ÑÁêÜÁöÑ„ÄÇ</p>
<img src="/img/netty/NIO.png" alt="NIO" style="zoom:87%;" />
<h3 id="nio---‰∏âÂ§ßÁªÑ‰ª∂">NIO - ‰∏âÂ§ßÁªÑ‰ª∂</h3>
<p><strong>Channel &amp; Buffer</strong></p>
<p>channelÊúâ‰∏ÄÁÇπÁ±ª‰ºº‰∫éstreamÔºåÂÆÉÂ∞±ÊòØËØªÂÜôÊï∞ÊçÆÁöÑ<span style="color:red">ÂèåÂêëÈÄöÈÅì</span>ÔºåÂèØ‰ª•‰ªéchannelÂ∞ÜÊï∞ÊçÆËØªÂÖ•bufferÔºå‰πüÂèØ‰ª•Â∞ÜbufferÁöÑÊï∞ÊçÆÂÜôÂÖ•channelÔºåËÄå‰πãÂâçÁöÑstreamË¶Å‰πàÊòØËæìÂÖ•ÔºåË¶Å‰πàÊòØËæìÂá∫ÔºåchannelÊØîstreamÊõ¥‰∏∫Â∫ïÂ±Ç</p>
<img src="/img/netty/Channel_Buffer.png" alt="Channel_Buffer" />
<p>Â∏∏ËßÅÁöÑChannelÔºöFileChannel„ÄêFile„Äë„ÄÅDatagramChannel„ÄêUDP„Äë„ÄÅSocketChannel„ÄêTCP„Äë„ÄÅServerSocketChannel„ÄêTCP„Äë</p>
<p>bufferÁî®Êù•ÁºìÂÜ≤ËØªÂÜôÊï∞ÊçÆÔºåÂ∏∏ËßÅÁöÑbufferÔºöMappedByteBuffer„ÄêÂÜÖÂ≠òÊò†Â∞ÑÊñá‰ª∂„Äë„ÄÅDirectByteBuffer„ÄêÁõ¥Êé•ÂÜÖÂ≠òÂàÜÈÖç„Äë„ÄÅHeapByteBuffer„ÄêÂ†ÜÂÜÖÂ≠ò„Äë</p>
<p><strong>Selector</strong></p>
<p>selectorÁöÑ‰ΩúÁî®Â∞±ÊòØÈÖçÂêà‰∏Ä‰∏™Á∫øÁ®ãÊù•ÁÆ°ÁêÜÂ§ö‰∏™channelÔºåËé∑ÂèñËøô‰∫õchannel‰∏äÂèëÁîüÁöÑ‰∫ã‰ª∂„ÄÇËøô‰∫õchannelÂ∑•‰ΩúÂú®ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÈÄÇÂêàËøûÊé•Êï∞ÁâπÂà´Â§öÔºå‰ΩÜÊµÅÈáè‰ΩéÁöÑÂú∫ÊôØ„ÄÇË∞ÉÁî®selectorÁöÑselect()‰ºöÈòªÂ°ûÁõ¥Âà∞channelÂèëÁîü‰∫ÜËØªÂÜôÂ∞±Áª™‰∫ã‰ª∂ÔºåÂΩì‰∫ã‰ª∂ÂèëÁîüselectÊñπÊ≥ïÂ∞±‰ºöËøîÂõûËøô‰∫õ‰∫ã‰ª∂‰∫§ÁªôthreadÊù•Â§ÑÁêÜ</p>
<img src="/img/netty/Selector.png" alt="Selector" />
<h3 id="nio---bytebuffer">NIO - ByteBuffer</h3>
<p><strong>ByteBuffer Ê≠£Á°Æ‰ΩøÁî®ÂßøÂäø</strong></p>
<ol>
<li>ÂêëbufferÂÜôÂÖ•Êï∞ÊçÆÔºå‰æãÂ¶ÇË∞ÉÁî®channel.read(buffer)</li>
<li>Ë∞ÉÁî®flip()ÂàáÊç¢Ëá≥<span style="color:blue">ËØªÊ®°Âºè</span></li>
<li>‰ªé buffer ËØªÂèñÊï∞ÊçÆÔºå‰æãÂ¶ÇË∞ÉÁî® buffer.get()</li>
<li>Ë∞ÉÁî® clear() Êàñ compact() ÂàáÊç¢Ëá≥<span style="color:blue">ÂÜôÊ®°Âºè</span></li>
<li>ÈáçÂ§ç 1~4 Ê≠•È™§</li>
</ol>
<p>Áî®buyteBufferËØªÂèñÊñá‰ª∂Êï∞ÊçÆÁ§∫‰æã</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">testByteBuffer</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>RandomAccessFile<span style="color:#bbb"> </span>file<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>RandomAccessFile(<span style="color:#d14">&#34;data.txt&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;rw&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>FileChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>file.<span style="color:#008080">getChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>readLen<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">do</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// Âêë buffer ÂÜôÂÖ•</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>readLen<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">read</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;ËØªÂèñÂà∞Â≠óËäÇ {}&#34;</span>,readLen);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÂàáÊç¢ buffer ËØªÊ®°Âºè</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(buffer.<span style="color:#008080">hasRemaining</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;{}&#34;</span>,<span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">char</span>)<span style="color:#bbb"> </span>buffer.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÂàáÊç¢ buffer ÂÜôÊ®°Âºè</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>buffer.<span style="color:#008080">clear</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(readLen<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ByteBufferÁªìÊûÑ</strong></p>
<p>ByteBufferÁöÑÈáçË¶ÅÂ±ûÊÄßÔºöcapacity„ÄêÂÆπÈáè„Äë„ÄÅposition„ÄêËØªÂÜô‰ΩçÁΩÆ„Äë„ÄÅlimit„ÄêËØªÂÜôÈôêÂà∂‰ΩçÁΩÆ„Äë</p>
<p>ÂàùÂßãÊó∂</p>
<p><img src="/img/netty/byteBuffer-start.png" alt="byteBuffer"></p>
<p>ÂÜôÊ®°Âºè‰∏ãÔºåpositionÊòØÂÜôÂÖ•‰ΩçÁΩÆÔºålimitÁ≠â‰∫éÂÆπÈáèÔºàÂê´‰πâÊòØÂèØÂÜôÂÖ•ÁöÑÊúÄÂ§ßÈôêÂà∂Ôºâ</p>
<p><img src="/img/netty/byteBuffer-write.png" alt="byteBuffer-write"></p>
<p>flipÂä®‰ΩúÂèëÁîüÂêéÔºåpositionÂàáÊç¢‰∏∫ËØªÂèñ‰ΩçÁΩÆÔºålimitÂàáÊç¢‰∏∫ËØªÂèñÈôêÂà∂</p>
<p><img src="/img/netty/bytebuffer-flip.png" alt="bytebuffer-flip"></p>
<p>clearÂä®‰ΩúÂèëÁîüÂêéÔºå‰ºöÂ∞ÜpositionÁΩÆ‰∏∫0ÔºålimitÁΩÆ‰∏∫capacity‰ΩçÁΩÆÔºå‰ΩÜÊòØÊï∞ÊçÆÂùó‰∏ç‰ºöÈáçÁΩÆ</p>
<p><img src="/img/netty/bytebuffer-clear.png" alt="bytebuffer-clear"></p>
<p>compactÊñπÊ≥ïÔºåÊòØÊääÊú™ËØªÂÆåÁöÑÈÉ®ÂàÜÂêëÂâçÂéãÁº©ÔºåÁÑ∂ÂêéÂàáÊç¢Ëá≥ÂÜôÊ®°Âºè</p>
<p><img src="/img/netty/byteBuffe-compact.png" alt="byteBuffe-compact"></p>
<p><a href="/java/netty/ByteBufferUtil.java">Ë∞ÉËØïÂ∑•ÂÖ∑Á±ª</a></p>
<h3 id="nio---bytebuffer-Â∏∏ËßÅÊñπÊ≥ï">NIO - ByteBuffer Â∏∏ËßÅÊñπÊ≥ï</h3>
<ul>
<li>ÂàÜÈÖçÁ©∫Èó¥</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// heap ÂÜÖÂ≠ò</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>ByteBuffer<span style="color:#bbb"> </span>buf<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(16);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// Áõ¥Êé•ÂÜÖÂ≠ò</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>ByteBuffer<span style="color:#bbb"> </span>directBuf<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocateDirect</span>(16);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂêëbufferÂÜôÂÖ•Êï∞ÊçÆ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>readBytes<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">read</span>(buf);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//ËøîÂõû‰ªéchannelËØªÂèñÁöÑÈïøÂ∫¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>buf.<span style="color:#008080">put</span>((<span style="color:#458;font-weight:bold">byte</span>)127);<span style="color:#bbb">                </span><span style="color:#998;font-style:italic">//ÊâãÂä®ÊîæÂÖ•Êï∞ÊçÆ</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ªébufferËØªÂèñÊï∞ÊçÆ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>writeBytes<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">write</span>(buf);<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ËøîÂõûÂÜôÂÖ•Âà∞channleÁöÑËá™Â∑±Êï∞Èáè</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>b<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buf.<span style="color:#008080">get</span>();<span style="color:#bbb">                   </span><span style="color:#998;font-style:italic">// ÊâãÂä®ËØªÂèñÊï∞ÊçÆÔºå‰ºöÁßªÂä®positionÊåáÈíà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>b<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buf.<span style="color:#008080">get</span>(i);<span style="color:#bbb">                  </span><span style="color:#998;font-style:italic">// ÊâãÂä®ËØªÂèñÊï∞ÊçÆÔºå‰∏çÁßªÂä®positionÊåáÈíà</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈáçÁΩÆËØªÂèñ‰ΩçÁΩÆ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>buf.<span style="color:#008080">rewind</span>();<span style="color:#bbb">                         </span><span style="color:#998;font-style:italic">// ÈáçÁΩÆposition‰∏∫0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * mark &amp; reset
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * markÂú®ËØªÂèñÊó∂ÔºåÂÅö‰∏Ä‰∏™Ê†áËÆ∞„ÄÇÂç≥‰ΩøpositionÊîπÂèòÔºåÂè™Ë¶ÅË∞ÉÁî®resetÂ∞±ËÉΩÂõûÂà∞markÁöÑ‰ΩçÁΩÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">markAndRestTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;123456&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>b1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">get</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// &#39;1&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">mark</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>b2<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">get</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// &#39;2&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>b3<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">get</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// &#39;3&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">reset</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#bbb"> </span>hasB2<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">get</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//&#39;2&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">assert</span><span style="color:#bbb"> </span>hasB2<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>b2;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â≠óÁ¨¶‰∏≤‰∏éByteBuffer‰∫íËΩ¨</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Â≠óÁ¨¶‰∏≤ËΩ¨ByteBuffer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>ByteBuffer<span style="color:#bbb"> </span>buffer1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>StandardCharsets.<span style="color:#008080">UTF_8</span>.<span style="color:#008080">encode</span>(<span style="color:#d14">&#34;‰Ω†Â•Ω&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>debug(buffer1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ByteBufferËΩ¨Â≠óÁ¨¶‰∏≤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>CharBuffer<span style="color:#bbb"> </span>buffer2<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>StandardCharsets.<span style="color:#008080">UTF_8</span>.<span style="color:#008080">decode</span>(buffer1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(buffer2.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Scattering Reads</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ÂàÜÊï£ËØªÂèñÔºåÊúâ‰∏Ä‰∏™ÊñáÊú¨Êñá‰ª∂ 3parts.txt ÂÜÖÂÆπ onetwothree</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">partsReadTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>(RandomAccessFile<span style="color:#bbb"> </span>file<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>RandomAccessFile(<span style="color:#d14">&#34;3parts.txt&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;rw&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>file.<span style="color:#008080">getChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>a<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(3);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>b<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(3);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>c<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(5);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">read</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ByteBuffer<span style="color:#000;font-weight:bold">[]</span>{a,<span style="color:#bbb"> </span>b,<span style="color:#bbb"> </span>c});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>a.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>b.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>c.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBufferUtil.<span style="color:#008080">debugAll</span>(a);<span style="color:#bbb">	</span><span style="color:#998;font-style:italic">//one</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBufferUtil.<span style="color:#008080">debugAll</span>(b);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//two</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBufferUtil.<span style="color:#008080">debugAll</span>(c);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//three</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Gathering Writes</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Â∞ÜÂ§ö‰∏™bufferÁöÑÊï∞ÊçÆÂêàÂπ∂ÂÜôÂÖ•Âà∞‰∏Ä‰∏™channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">gatheringWritesTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>(RandomAccessFile<span style="color:#bbb"> </span>file<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>RandomAccessFile(<span style="color:#d14">&#34;2parts.txt&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;rw&#34;</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>file.<span style="color:#008080">getChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>d<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(4);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>e<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(4);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>d.<span style="color:#008080">put</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span>{<span style="color:#d14">&#39;f&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;o&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;u&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;r&#39;</span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">put</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span>{<span style="color:#d14">&#39;f&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;i&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;v&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;e&#39;</span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>d.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">write</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ByteBuffer<span style="color:#000;font-weight:bold">[]</span>{d,<span style="color:#bbb"> </span>e});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><span style="color:red">Ê≥®ÊÑèÔºöBufferÊòØÈùûÁ∫øÁ®ãÂÆâÂÖ®</span></p>
<h3 id="nio---Êñá‰ª∂ÁºñÁ®ã">NIO - Êñá‰ª∂ÁºñÁ®ã</h3>
<p>NIO‰∏≠‰ΩøÁî®FileChannelÂª∫Á´ã‰∏éÊñá‰ª∂ÁöÑÈìæÊé•ÈÄöÈÅìÔºå<span style="color:red">FileChannelÂè™ËÉΩÂ∑•‰ΩúÂú®ÈòªÂ°ûÊ®°Âºè‰∏ã</span>„ÄÇ</p>
<p><strong>Ëé∑Âèñ</strong></p>
<p>ÂèØ‰ª•ÈÄöËøá<code>FileChannel.open</code>Ëé∑ÂèñFileChannelÔºå‰πüÂèØÈÄöËøáFileInputStream„ÄÅFileOutputStreamÊàñËÄÖRandomAccessFileÊù•Ëé∑ÂèñÔºåÂÆÉ‰ª¨ÈÉΩÊúâgetChannelÊñπÊ≥ï</p>
<ul>
<li>ÈÄöËøáFileInputStreamËé∑ÂèñÁöÑchannelÂè™ËÉΩËØª</li>
<li>ÈÄöËøáFileOutputStreamËé∑ÂèñÁöÑchannelÂè™ËÉΩÂÜô</li>
<li>ÈÄöËøáRandomAccessFileÊòØÂê¶ËÉΩËØªÂÜôÊ†πÊçÆÊûÑÈÄ†RandomAccessFileÊó∂ÁöÑËØªÂÜôÊ®°ÂºèÂÜ≥ÂÆö</li>
</ul>
<p><strong>ËØªÂèñ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ‰ºö‰ªéchannelËØªÂèñÊï∞ÊçÆÂ°´ÂÖÖByteBufferÔºåËøîÂõûÂÄºË°®Á§∫ËØªÂà∞‰∫ÜÂ§öÂ∞ëÂ≠óËäÇÔºå-1Ë°®Á§∫Âà∞Ëææ‰∫ÜÊñá‰ª∂ÁöÑÊú´Â∞æ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>readBytes<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">read</span>(buffer);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÜôÂÖ•</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Ê≠£Á°ÆÁöÑÂÜôÂÖ•ÂßøÂäøÔºåÂ¶ÇÊûúbufferËæÉÂ§ßÔºå‰∏ÄÊ¨°‰ºöÂÜô‰∏çÂÆå</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">while</span>(buffer.<span style="color:#008080">hasRemaining</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">write</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÖ≥Èó≠</strong></p>
<p>channelÂøÖÈ°ªÂÖ≥Èó≠Ôºå‰∏çËøáË∞ÉÁî®‰∫ÜFileInputStream„ÄÅFileOutputStreamÊàñËÄÖRandomAccessFileÁöÑcloseÊñπÊ≥ï‰ºöÈó¥Êé•Âú∞Ë∞ÉÁî®channelÁöÑcloseÊñπÊ≥ï</p>
<p><strong>‰ΩçÁΩÆ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Ëé∑ÂèñÂΩìÂâç‰ΩçÁΩÆ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>pos<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">position</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ËÆæÁΩÆÂΩìÂâç‰ΩçÁΩÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ËÆæÁΩÆÂΩìÂâç‰ΩçÁΩÆÊó∂ÔºåÂ¶ÇÊûúËÆæÁΩÆ‰∏∫Êñá‰ª∂ÁöÑÊú´Â∞æ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - ËøôÊó∂ËØªÂèñ‰ºöËøîÂõû -1 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - ËøôÊó∂ÂÜôÂÖ•Ôºå‰ºöËøΩÂä†ÂÜÖÂÆπÔºå‰ΩÜË¶ÅÊ≥®ÊÑèÂ¶ÇÊûúpositionË∂ÖËøá‰∫ÜÊñá‰ª∂Êú´Â∞æÔºåÂÜçÂÜôÂÖ•Êó∂Âú®Êñ∞ÂÜÖÂÆπÂíåÂéüÊú´Â∞æ‰πãÈó¥‰ºöÊúâÁ©∫Ê¥ûÔºà00Ôºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>channel.<span style="color:#008080">position</span>(newPos);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Â§ßÂ∞è</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>channel.<span style="color:#008080">size</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Âº∫Âà∂ÂÜôÂÖ•</strong></p>
<p>Êìç‰ΩúÁ≥ªÁªüÂá∫‰∫éÊÄßËÉΩÁöÑËÄÉËôëÔºå‰ºöÂ∞ÜÊï∞ÊçÆÁºìÂ≠òÔºå‰∏çÊòØÁ´ãÂàªÂÜôÂÖ•Á£ÅÁõò„ÄÇÂèØ‰ª•Ë∞ÉÁî®<code>force(true) </code>ÊñπÊ≥ïÂ∞ÜÊñá‰ª∂ÂÜÖÂÆπÂíåÂÖÉÊï∞ÊçÆÔºàÊñá‰ª∂ÁöÑÊùÉÈôêÁ≠â‰ø°ÊÅØÔºâÁ´ãÂàªÂÜôÂÖ•Á£ÅÁõò</p>
<p><strong>‰∏§‰∏™ Channel ‰º†ËæìÊï∞ÊçÆ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">fileChannelTransferToTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileChannel<span style="color:#bbb"> </span>from<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FileInputStream(<span style="color:#d14">&#34;data.txt&#34;</span>).<span style="color:#008080">getChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>FileChannel<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FileOutputStream(<span style="color:#d14">&#34;to.txt&#34;</span>).<span style="color:#008080">getChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÊïàÁéáÈ´òÔºåÂ∫ïÂ±Ç‰ºöÂà©Áî®Êìç‰ΩúÁ≥ªÁªüÁöÑÈõ∂Êã∑Ë¥ùËøõË°å‰ºòÂåñ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>size<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>from.<span style="color:#008080">size</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// left ÂèòÈáè‰ª£Ë°®ËøòÂâ©‰ΩôÂ§öÂ∞ëÂ≠óËäÇ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>left<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>size;<span style="color:#bbb"> </span>left<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>0;<span style="color:#bbb"> </span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;position:&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>(size<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#bbb"> </span>left)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34; left:&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>left);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>left<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-=</span><span style="color:#bbb"> </span>from.<span style="color:#008080">transferTo</span>((size<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#bbb"> </span>left),<span style="color:#bbb"> </span>left,<span style="color:#bbb"> </span>to);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Path</strong></p>
<p>jdk7 ÂºïÂÖ•‰∫ÜPathÂíåPathsÁ±ª</p>
<ul>
<li>PathÁî®Êù•Ë°®Á§∫Êñá‰ª∂Ë∑ØÂæÑ</li>
<li>PathsÊòØÂ∑•ÂÖ∑Á±ªÔºåÁî®Êù•Ëé∑ÂèñPathÂÆû‰æã</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>source<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;1.txt&#34;</span>);<span style="color:#bbb">                     </span><span style="color:#998;font-style:italic">// Áõ∏ÂØπË∑ØÂæÑ‰ΩøÁî®user.dirÁéØÂ¢ÉÂèòÈáèÊù•ÂÆö‰Ωç1.txt</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Path<span style="color:#bbb"> </span>source<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d:\\1.txt&#34;</span>);<span style="color:#bbb">                 </span><span style="color:#998;font-style:italic">// ÁªùÂØπË∑ØÂæÑ‰ª£Ë°®‰∫Üd:\1.txt</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Path<span style="color:#bbb"> </span>projects<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d:\\data&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;projects&#34;</span>);<span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ‰ª£Ë°®‰∫Üd:\data\projects</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d:\\data\\projects\\a\\..\\b&#34;</span>);<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>path.<span style="color:#008080">normalize</span>()<span style="color:#bbb">                                      </span><span style="color:#998;font-style:italic">// ËÆ°ÁÆó‰∏∫d:\data\projects\b</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Files</strong></p>
<ul>
<li>Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;data.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(Files.<span style="color:#008080">exists</span>(path));<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂàõÂª∫‰∏ÄÁ∫ßÁõÆÂΩï</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d1&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">createDirectory</span>(path);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂàõÂª∫Â§öÁ∫ßÁõÆÂΩïÁî®</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d1/d2/d3&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">createDirectories</span>(path);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êã∑Ë¥ùÊñá‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>source<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;data.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Path<span style="color:#bbb"> </span>target<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;target.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// Â¶ÇÊûúÊñá‰ª∂Â∑≤Â≠òÂú®Ôºå‰ºöÊäõÂºÇÂ∏∏FileAlreadyExistsException</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ÂèØ‰ª•‰ΩøÁî®Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING);</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">copy</span>(source,<span style="color:#bbb"> </span>target);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁßªÂä®Êñá‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>source<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;data.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Path<span style="color:#bbb"> </span>target<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;data.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// StandardCopyOption.ATOMIC_MOVE ‰øùËØÅÊñá‰ª∂ÁßªÂä®ÁöÑÂéüÂ≠êÊÄß</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">move</span>(source,<span style="color:#bbb"> </span>target,<span style="color:#bbb"> </span>StandardCopyOption.<span style="color:#008080">ATOMIC_MOVE</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§Êñá‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>target<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;target.txt&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">delete</span>(target);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// Â¶ÇÊûúÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ºöÊäõÂºÇÂ∏∏ NoSuchFileException</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§ÁõÆÂΩï</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path<span style="color:#bbb"> </span>target<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;d1&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Files.<span style="color:#008080">delete</span>(target);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// Â¶ÇÊûúÁõÆÂΩïËøòÊúâÂÜÖÂÆπÔºå‰ºöÊäõÂºÇÂ∏∏ DirectoryNotEmptyException</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈÅçÂéÜÁõÆÂΩïÊñá‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">loopDirTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Path<span style="color:#bbb"> </span>path<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Paths.<span style="color:#008080">get</span>(<span style="color:#d14">&#34;C:\\Program Files\\Java\\jdk1.8.0_181&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Files.<span style="color:#008080">walkFileTree</span>(path,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>SimpleFileVisitor<span style="color:#000;font-weight:bold">&lt;</span>Path<span style="color:#000;font-weight:bold">&gt;</span>(){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>FileVisitResult<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">preVisitDirectory</span>(Path<span style="color:#bbb"> </span>dir,<span style="color:#bbb"> </span>BasicFileAttributes<span style="color:#bbb"> </span>attrs)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;preVisitDirectory dir={}&#34;</span>,<span style="color:#bbb"> </span>dir.<span style="color:#008080">getFileName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">preVisitDirectory</span>(dir,<span style="color:#bbb"> </span>attrs);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>FileVisitResult<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">visitFile</span>(Path<span style="color:#bbb"> </span>file,<span style="color:#bbb"> </span>BasicFileAttributes<span style="color:#bbb"> </span>attrs)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;visitFile file={}&#34;</span>,<span style="color:#bbb"> </span>file.<span style="color:#008080">getFileName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">visitFile</span>(file,<span style="color:#bbb"> </span>attrs);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>FileVisitResult<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">visitFileFailed</span>(Path<span style="color:#bbb"> </span>file,<span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>exc)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;visitFileFailed file={} exc={}&#34;</span>,<span style="color:#bbb"> </span>file.<span style="color:#008080">getFileName</span>(),<span style="color:#bbb"> </span>exc.<span style="color:#008080">getMessage</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">visitFileFailed</span>(file,<span style="color:#bbb"> </span>exc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>FileVisitResult<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">postVisitDirectory</span>(Path<span style="color:#bbb"> </span>dir,<span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>exc)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;postVisitDirectory dir={}&#34;</span>,<span style="color:#bbb"> </span>dir.<span style="color:#008080">getFileName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">postVisitDirectory</span>(dir,<span style="color:#bbb"> </span>exc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nio---ÁΩëÁªúÁºñÁ®ã">NIO - ÁΩëÁªúÁºñÁ®ã</h3>
<h4 id="ÈùûÈòªÂ°ûvsÈòªÂ°û">ÈùûÈòªÂ°ûvsÈòªÂ°û</h4>
<p><strong>ÈòªÂ°û</strong></p>
<p>ÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÁõ∏ÂÖ≥ÊñπÊ≥ïÈÉΩ‰ºöÂØºËá¥Á∫øÁ®ãÊöÇÂÅú</p>
<ul>
<li>ServerSocketChannel.accept‰ºöÂú®Ê≤°ÊúâËøûÊé•Âª∫Á´ãÊó∂ËÆ©Á∫øÁ®ãÊöÇÂÅú</li>
<li>SocketChannel.read‰ºöÂú®Ê≤°ÊúâÊï∞ÊçÆÂèØËØªÊó∂ËÆ©Á∫øÁ®ãÊöÇÂÅú</li>
<li>ÈòªÂ°ûÁöÑË°®Áé∞ÂÖ∂ÂÆûÂ∞±ÊòØÁ∫øÁ®ãÊöÇÂÅú‰∫ÜÔºåÊöÇÂÅúÊúüÈó¥‰∏ç‰ºöÂç†Áî®cpuÔºå‰ΩÜÁ∫øÁ®ãÁõ∏ÂΩì‰∫éÈó≤ÁΩÆ</li>
</ul>
<p>ÂçïÁ∫øÁ®ã‰∏ãÔºåÈòªÂ°ûÊñπÊ≥ï‰πãÈó¥Áõ∏‰∫íÂΩ±ÂìçÔºåÂá†‰πé‰∏çËÉΩÊ≠£Â∏∏Â∑•‰ΩúÔºåÈúÄË¶ÅÂ§öÁ∫øÁ®ãÊîØÊåÅ</p>
<p>Â§öÁ∫øÁ®ã‰∏ãÔºåÊúâÊñ∞ÁöÑÈóÆÈ¢òÔºå‰ΩìÁé∞Âú®‰ª•‰∏ãÊñπÈù¢</p>
<ul>
<li>32 ‰Ωçjvm‰∏Ä‰∏™Á∫øÁ®ã320kÔºå64‰Ωçjvm‰∏Ä‰∏™Á∫øÁ®ã1024kÔºåÂ¶ÇÊûúËøûÊé•Êï∞ËøáÂ§öÔºåÂøÖÁÑ∂ÂØºËá¥OOMÔºåÂπ∂‰∏îÁ∫øÁ®ãÂ§™Â§öÔºåÂèçËÄå‰ºöÂõ†‰∏∫È¢ëÁπÅ‰∏ä‰∏ãÊñáÂàáÊç¢ÂØºËá¥ÊÄßËÉΩÈôç‰Ωé</li>
<li>ÂèØ‰ª•ÈááÁî®Á∫øÁ®ãÊ±†ÊäÄÊúØÊù•ÂáèÂ∞ëÁ∫øÁ®ãÊï∞ÂíåÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢Ôºå‰ΩÜÊ≤ªÊ†á‰∏çÊ≤ªÊú¨ÔºåÂ¶ÇÊûúÊúâÂæàÂ§öËøûÊé•Âª∫Á´ãÔºå‰ΩÜÈïøÊó∂Èó¥inactiveÔºå‰ºöÈòªÂ°ûÁ∫øÁ®ãÊ±†‰∏≠ÊâÄÊúâÁ∫øÁ®ãÔºåÂõ†Ê≠§‰∏çÈÄÇÂêàÈïøËøûÊé•ÔºåÂè™ÈÄÇÂêàÁü≠ËøûÊé•</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">blockIOTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ‰ΩøÁî® nio Êù•ÁêÜËß£ÈòªÂ°ûÊ®°Âºè, ÂçïÁ∫øÁ®ã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 0. ByteBuffer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(16);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 1. ÂàõÂª∫‰∫ÜÊúçÂä°Âô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ServerSocketChannel<span style="color:#bbb"> </span>ssc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ServerSocketChannel.<span style="color:#008080">open</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 2. ÁªëÂÆöÁõëÂê¨Á´ØÂè£</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ssc.<span style="color:#008080">bind</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 3. ËøûÊé•ÈõÜÂêà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>List<span style="color:#000;font-weight:bold">&lt;</span>SocketChannel<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>channels<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">true</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 4. accept Âª∫Á´ã‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Ôºå SocketChannel Áî®Êù•‰∏éÂÆ¢Êà∑Á´Ø‰πãÈó¥ÈÄö‰ø°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;connecting...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ssc.<span style="color:#008080">accept</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÈòªÂ°ûÊñπÊ≥ïÔºåÁ∫øÁ®ãÂÅúÊ≠¢ËøêË°å</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;connected... {}&#34;</span>,<span style="color:#bbb"> </span>sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channels.<span style="color:#008080">add</span>(sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(SocketChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>channels)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// 5. Êé•Êî∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑÊï∞ÊçÆ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;before read... {}&#34;</span>,<span style="color:#bbb"> </span>channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>channel.<span style="color:#008080">read</span>(buffer);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÈòªÂ°ûÊñπÊ≥ïÔºåÁ∫øÁ®ãÂÅúÊ≠¢ËøêË°å</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>ByteBufferUtil.<span style="color:#008080">debugRead</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>buffer.<span style="color:#008080">clear</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;after read...{}&#34;</span>,<span style="color:#bbb"> </span>channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÈùûÈòªÂ°û</strong></p>
<ul>
<li>ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÁõ∏ÂÖ≥ÊñπÊ≥ïÈÉΩ‰ºö‰∏ç‰ºöËÆ©Á∫øÁ®ãÊöÇÂÅú
<ul>
<li>Âú®ServerSocketChannel.accept Âú®Ê≤°ÊúâËøûÊé•Âª∫Á´ãÊó∂Ôºå‰ºöËøîÂõû nullÔºåÁªßÁª≠ËøêË°å</li>
<li>SocketChannel.readÂú®Ê≤°ÊúâÊï∞ÊçÆÂèØËØªÊó∂Ôºå‰ºöËøîÂõû0Ôºå‰ΩÜÁ∫øÁ®ã‰∏çÂøÖÈòªÂ°ûÔºåÂèØ‰ª•ÂéªÊâßË°åÂÖ∂ÂÆÉSocketChannelÁöÑreadÊàñÊòØÂéªÊâßË°åServerSocketChannel.accept</li>
<li>ÂÜôÊï∞ÊçÆÊó∂ÔºåÁ∫øÁ®ãÂè™ÊòØÁ≠âÂæÖÊï∞ÊçÆÂÜôÂÖ•ChannelÂç≥ÂèØÔºåÊó†ÈúÄÁ≠âChannelÈÄöËøáÁΩëÁªúÊääÊï∞ÊçÆÂèëÈÄÅÂá∫Âéª</li>
</ul>
</li>
<li>‰ΩÜÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÂç≥‰ΩøÊ≤°ÊúâËøûÊé•Âª∫Á´ãÔºåÂíåÂèØËØªÊï∞ÊçÆÔºåÁ∫øÁ®ã‰ªçÁÑ∂Âú®‰∏çÊñ≠ËøêË°åÔºåÁôΩÁôΩÊµ™Ë¥π‰∫Ücpu</li>
<li>Êï∞ÊçÆÂ§çÂà∂ËøáÁ®ã‰∏≠ÔºåÁ∫øÁ®ãÂÆûÈôÖËøòÊòØÈòªÂ°ûÁöÑÔºàAIO ÊîπËøõÁöÑÂú∞ÊñπÔºâ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">nonBlockIOTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ‰ΩøÁî® nio Êù•ÁêÜËß£ÈùûÈòªÂ°ûÊ®°Âºè, ÂçïÁ∫øÁ®ã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 0. ByteBuffer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(16);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 1. ÂàõÂª∫‰∫ÜÊúçÂä°Âô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ServerSocketChannel<span style="color:#bbb"> </span>ssc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ServerSocketChannel.<span style="color:#008080">open</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ÈùûÈòªÂ°ûÊ®°Âºè</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ssc.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 2. ÁªëÂÆöÁõëÂê¨Á´ØÂè£</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ssc.<span style="color:#008080">bind</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 3. ËøûÊé•ÈõÜÂêà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>List<span style="color:#000;font-weight:bold">&lt;</span>SocketChannel<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>channels<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">true</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// 4. accept Âª∫Á´ã‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Ôºå SocketChannel Áî®Êù•‰∏éÂÆ¢Êà∑Á´Ø‰πãÈó¥ÈÄö‰ø°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ssc.<span style="color:#008080">accept</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÈùûÈòªÂ°ûÔºåÁ∫øÁ®ãËøò‰ºöÁªßÁª≠ËøêË°åÔºåÂ¶ÇÊûúÊ≤°ÊúâËøûÊé•Âª∫Á´ãÔºå‰ΩÜscÊòØnull</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;connected... {}&#34;</span>,<span style="color:#bbb"> </span>sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>sc.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÈùûÈòªÂ°ûÊ®°Âºè</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>channels.<span style="color:#008080">add</span>(sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(SocketChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>channels)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// 5. Êé•Êî∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑÊï∞ÊçÆ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">read</span>(buffer);<span style="color:#998;font-style:italic">// ÈùûÈòªÂ°ûÔºåÁ∫øÁ®ã‰ªçÁÑ∂‰ºöÁªßÁª≠ËøêË°åÔºåÂ¶ÇÊûúÊ≤°ÊúâËØªÂà∞Êï∞ÊçÆÔºåread ËøîÂõû 0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>0)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ByteBufferUtil.<span style="color:#008080">debugRead</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>buffer.<span style="color:#008080">clear</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;after read...{}&#34;</span>,<span style="color:#bbb"> </span>channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="selector">Selector</h4>
<p>ÂçïÁ∫øÁ®ãÂèØ‰ª•ÈÖçÂêàSelectorÂÆåÊàêÂØπÂ§ö‰∏™ChannelÂèØËØªÂÜô‰∫ã‰ª∂ÁöÑÁõëÊéßÔºå<span style="color:blue">ËøôÁß∞‰πã‰∏∫Â§öË∑ØÂ§çÁî®</span></p>
<ul>
<li>Â§öË∑ØÂ§çÁî®‰ªÖÈíàÂØπÁΩëÁªúIO„ÄÅÊôÆÈÄöÊñá‰ª∂IOÊ≤°Ê≥ïÂà©Áî®Â§öË∑ØÂ§çÁî®</li>
<li>Â¶ÇÊûú‰∏çÁî®SelectorÁöÑÈùûÈòªÂ°ûÊ®°ÂºèÔºåÁ∫øÁ®ãÂ§ßÈÉ®ÂàÜÊó∂Èó¥ÈÉΩÂú®ÂÅöÊó†Áî®ÂäüÔºåËÄåSelectorËÉΩÂ§ü‰øùËØÅ
<ul>
<li>ÊúâÂèØËøûÊé•‰∫ã‰ª∂Êó∂ÊâçÂéªËøûÊé•</li>
<li>ÊúâÂèØËØª‰∫ã‰ª∂ÊâçÂéªËØªÂèñ</li>
<li>ÊúâÂèØÂÜô‰∫ã‰ª∂ÊâçÂéªÂÜôÂÖ•„ÄêÈôê‰∫éÁΩëÁªú‰º†ËæìËÉΩÂäõÔºåChannelÊú™ÂøÖÊó∂Êó∂ÂèØÂÜôÔºå‰∏ÄÊó¶ChannelÂèØÂÜôÔºå‰ºöËß¶ÂèëSelectorÁöÑÂèØÂÜô‰∫ã‰ª∂„Äë</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
subgraph selector Áâà
thread --&gt; selector
selector --&gt; c1(channel)
selector --&gt; c2(channel)
selector --&gt; c3(channel)
end
</code></pre><ul>
<li>ÂàõÂª∫</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Selector<span style="color:#bbb"> </span>selector<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Selector.<span style="color:#008080">open</span>();<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁªëÂÆö Channel ‰∫ã‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * channel ÂøÖÈ°ªÂ∑•‰ΩúÂú®ÈùûÈòªÂ°ûÊ®°Âºè
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ÁªëÂÆöÁöÑ‰∫ã‰ª∂Á±ªÂûãÂèØ‰ª•Êúâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - connect - ÂÆ¢Êà∑Á´ØËøûÊé•ÊàêÂäüÊó∂Ëß¶Âèë
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - accept  - ÊúçÂä°Âô®Á´ØÊàêÂäüÊé•ÂèóËøûÊé•Êó∂Ëß¶Âèë
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - read    - Êï∞ÊçÆÂèØËØªÂÖ•Êó∂Ëß¶ÂèëÔºåÊúâÂõ†‰∏∫Êé•Êî∂ËÉΩÂäõÂº±ÔºåÊï∞ÊçÆÊöÇ‰∏çËÉΩËØªÂÖ•ÁöÑÊÉÖÂÜµ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *  - write   - Êï∞ÊçÆÂèØÂÜôÂá∫Êó∂Ëß¶ÂèëÔºåÊúâÂõ†‰∏∫ÂèëÈÄÅËÉΩÂäõÂº±ÔºåÊï∞ÊçÆÊöÇ‰∏çËÉΩÂÜôÂá∫ÁöÑÊÉÖÂÜµ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>channel.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>SelectionKey<span style="color:#bbb"> </span>key<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">register</span>(selector,<span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_ACCEPT</span>);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁõëÂê¨ Channel ‰∫ã‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ÈòªÂ°ûÁõ¥Âà∞ÁªëÂÆö‰∫ã‰ª∂ÂèëÁîü</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">select</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ÈòªÂ°ûÁõ¥Âà∞ÁªëÂÆö‰∫ã‰ª∂ÂèëÁîüÔºåÊàñÊòØË∂ÖÊó∂ÔºàÊó∂Èó¥Âçï‰Ωç‰∏∫ msÔºâ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">select</span>(1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ‰∏ç‰ºöÈòªÂ°ûÔºå‰πüÂ∞±ÊòØ‰∏çÁÆ°ÊúâÊ≤°Êúâ‰∫ã‰ª∂ÔºåÁ´ãÂàªËøîÂõûÔºåËá™Â∑±Ê†πÊçÆËøîÂõûÂÄºÊ£ÄÊü•ÊòØÂê¶Êúâ‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">selectNow</span>();<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>select‰∏çÈòªÂ°ûÁöÑÊÉÖÂÜµÔºö‚ë†‰∫ã‰ª∂ÂèëÁîüÊó∂Ôºõ‚ë°Ë∞ÉÁî®selector.wakeup()Ôºõ‚ë¢Ë∞ÉÁî®selector.close()Ôºõ‚ë£selectorÊâÄÂú®Á∫øÁ®ãinterrupt</p>
</blockquote>
<ul>
<li>Â§ÑÁêÜ accept ‰∫ã‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">acceptorTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>(ServerSocketChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ServerSocketChannel.<span style="color:#008080">open</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">bind</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Selector<span style="color:#bbb"> </span>selector<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Selector.<span style="color:#008080">open</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">register</span>(selector,<span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_ACCEPT</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">true</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">select</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;select count: {}&#34;</span>,<span style="color:#bbb"> </span>count);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// Ëé∑ÂèñÊâÄÊúâ‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Set<span style="color:#000;font-weight:bold">&lt;</span>SelectionKey<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>keys<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">selectedKeys</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ÈÅçÂéÜÊâÄÊúâ‰∫ã‰ª∂ÔºåÈÄê‰∏ÄÂ§ÑÁêÜ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Iterator<span style="color:#000;font-weight:bold">&lt;</span>SelectionKey<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>iter<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>keys.<span style="color:#008080">iterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(iter.<span style="color:#008080">hasNext</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>SelectionKey<span style="color:#bbb"> </span>key<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>iter.<span style="color:#008080">next</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// Âà§Êñ≠‰∫ã‰ª∂Á±ªÂûã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isAcceptable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>ServerSocketChannel<span style="color:#bbb"> </span>c<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(ServerSocketChannel)<span style="color:#bbb"> </span>key.<span style="color:#008080">channel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic">// ÂøÖÈ°ªÂ§ÑÁêÜ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>c.<span style="color:#008080">accept</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;{}&#34;</span>,<span style="color:#bbb"> </span>sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// Â§ÑÁêÜÂÆåÊØïÔºåÂøÖÈ°ªÂ∞Ü‰∫ã‰ª∂ÁßªÈô§</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>iter.<span style="color:#008080">remove</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§ÑÁêÜ read ‰∫ã‰ª∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">readEventTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>(ServerSocketChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ServerSocketChannel.<span style="color:#008080">open</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">bind</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Selector<span style="color:#bbb"> </span>selector<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Selector.<span style="color:#008080">open</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">register</span>(selector,<span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_ACCEPT</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">true</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>count<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">select</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;select count: {}&#34;</span>,<span style="color:#bbb"> </span>count);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// Ëé∑ÂèñÊâÄÊúâ‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Set<span style="color:#000;font-weight:bold">&lt;</span>SelectionKey<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>keys<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>selector.<span style="color:#008080">selectedKeys</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ÈÅçÂéÜÊâÄÊúâ‰∫ã‰ª∂ÔºåÈÄê‰∏ÄÂ§ÑÁêÜ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Iterator<span style="color:#000;font-weight:bold">&lt;</span>SelectionKey<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>iter<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>keys.<span style="color:#008080">iterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">while</span><span style="color:#bbb"> </span>(iter.<span style="color:#008080">hasNext</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>SelectionKey<span style="color:#bbb"> </span>key<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>iter.<span style="color:#008080">next</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// Âà§Êñ≠‰∫ã‰ª∂Á±ªÂûã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isAcceptable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>ServerSocketChannel<span style="color:#bbb"> </span>c<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(ServerSocketChannel)<span style="color:#bbb"> </span>key.<span style="color:#008080">channel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic">// ÂøÖÈ°ªÂ§ÑÁêÜ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>c.<span style="color:#008080">accept</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>sc.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>sc.<span style="color:#008080">register</span>(selector,<span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_READ</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>log.<span style="color:#008080">debug</span>(<span style="color:#d14">&#34;ËøûÊé•Â∑≤Âª∫Á´ã: {}&#34;</span>,<span style="color:#bbb"> </span>sc);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isReadable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(SocketChannel)<span style="color:#bbb"> </span>key.<span style="color:#008080">channel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(128);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>sc.<span style="color:#008080">read</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>1)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#998;font-style:italic">// cancel‰ºöÂèñÊ∂àÊ≥®ÂÜåÂú®selector‰∏äÁöÑchannelÔºåÂπ∂‰ªékeysÈõÜÂêà‰∏≠Âà†Èô§keyÂêéÁª≠‰∏ç‰ºöÂÜçÁõëÂê¨‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>key.<span style="color:#008080">cancel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>sc.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>ByteBufferUtil.<span style="color:#008080">debugRead</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// Â§ÑÁêÜÂÆåÊØïÔºåÂøÖÈ°ªÂ∞Ü‰∫ã‰ª∂ÁßªÈô§</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>iter.<span style="color:#008080">remove</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><span id="bound">Â§ÑÁêÜÊ∂àÊÅØÁöÑËæπÁïå</span></p>
<p><img src="/img/netty/message-bound.png" alt="message-bound"></p>
</li>
</ul>
<p>‚ë†‰∏ÄÁßçÊÄùË∑ØÊòØÂõ∫ÂÆöÊ∂àÊÅØÈïøÂ∫¶ÔºåÊï∞ÊçÆÂåÖÂ§ßÂ∞è‰∏ÄÊ†∑ÔºåÊúçÂä°Âô®ÊåâÈ¢ÑÂÆöÈïøÂ∫¶ËØªÂèñÔºåÁº∫ÁÇπÊòØÊµ™Ë¥πÂ∏¶ÂÆΩ</p>
<p>‚ë°Âè¶‰∏ÄÁßçÊÄùË∑ØÊòØÊåâÂàÜÈöîÁ¨¶ÊãÜÂàÜÔºåÁº∫ÁÇπÊòØÊïàÁéá‰Ωé</p>
<p>‚ë¢TLVÊ†ºÂºèÔºåÂç≥TypeÁ±ªÂûã„ÄÅLengthÈïøÂ∫¶„ÄÅValueÊï∞ÊçÆÔºåÁ±ªÂûãÂíåÈïøÂ∫¶Â∑≤Áü•ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞±ÂèØ‰ª•Êñπ‰æøËé∑ÂèñÊ∂àÊÅØÂ§ßÂ∞èÔºåÂàÜÈÖçÂêàÈÄÇÁöÑbufferÔºåÁº∫ÁÇπÊòØbufferÈúÄË¶ÅÊèêÂâçÂàÜÈÖçÔºåÂ¶ÇÊûúÂÜÖÂÆπËøáÂ§ßÔºåÂàôÂΩ±ÂìçserverÂêûÂêêÈáèÔºåHttp1.1ÊòØTLVÊ†ºÂºè„ÄÅHttp2.0ÊòØLTVÊ†ºÂºè</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">split</span>(ByteBuffer<span style="color:#bbb"> </span>source)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>source.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#bbb"> </span>source.<span style="color:#008080">limit</span>();<span style="color:#bbb"> </span>i<span style="color:#000;font-weight:bold">++</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÊâæÂà∞‰∏ÄÊù°ÂÆåÊï¥Ê∂àÊÅØ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(source.<span style="color:#008080">get</span>(i)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;\n&#39;</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>length<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#bbb"> </span>source.<span style="color:#008080">position</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ÊääËøôÊù°ÂÆåÊï¥Ê∂àÊÅØÂ≠òÂÖ•Êñ∞ÁöÑ ByteBuffer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>ByteBuffer<span style="color:#bbb"> </span>target<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(length);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ‰ªé source ËØªÔºåÂêë target ÂÜô</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>j<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb"> </span>j<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#bbb"> </span>length;<span style="color:#bbb"> </span>j<span style="color:#000;font-weight:bold">++</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>target.<span style="color:#008080">put</span>(source.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>ByteBufferUtil.<span style="color:#008080">debugAll</span>(target);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>source.<span style="color:#008080">compact</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ‰ΩøÁî® \n Âå∫ÂàÜÊ∂àÊÅØÊÆµ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isReadable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>SocketChannel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(SocketChannel)<span style="color:#bbb"> </span>key.<span style="color:#008080">channel</span>();<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÊãøÂà∞Ëß¶Âèë‰∫ã‰ª∂ÁöÑchannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// Ëé∑ÂèñselectionKey‰∏äÂÖ≥ËÅîÁöÑÈôÑ‰ª∂ÔºåÂú®acceptÊó∂ËÆæÁΩÆ‰∏äÁöÑ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(ByteBuffer)<span style="color:#bbb"> </span>key.<span style="color:#008080">attachment</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">read</span>(buffer);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// Â¶ÇÊûúÊòØÊ≠£Â∏∏Êñ≠ÂºÄÔºåreadÁöÑÊñπÊ≥ïÁöÑËøîÂõûÂÄºÊòØ-1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span>(read<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span>1)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>key.<span style="color:#008080">cancel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>split(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ÈúÄË¶ÅÊâ©ÂÆπ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(buffer.<span style="color:#008080">position</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">limit</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ByteBuffer<span style="color:#bbb"> </span>newBuffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBuffer.<span style="color:#008080">allocate</span>(buffer.<span style="color:#008080">capacity</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>2);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>buffer.<span style="color:#008080">flip</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>newBuffer.<span style="color:#008080">put</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>key.<span style="color:#008080">attach</span>(newBuffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>key.<span style="color:#008080">cancel</span>();<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// Âõ†‰∏∫ÂÆ¢Êà∑Á´ØÊñ≠ÂºÄ‰∫Ü,Âõ†Ê≠§ÈúÄË¶ÅÂ∞Ü key ÂèñÊ∂à</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ByteBuffer Â§ßÂ∞èÂàÜÈÖç</li>
</ul>
<p>ÊØè‰∏™channelÈÉΩÈúÄË¶ÅËÆ∞ÂΩïÂèØËÉΩË¢´ÂàáÂàÜÁöÑÊ∂àÊÅØÔºåÂõ†‰∏∫ByteBuffer‰∏çËÉΩË¢´Â§ö‰∏™channelÂÖ±Âêå‰ΩøÁî®ÔºåÂõ†Ê≠§ÈúÄË¶Å‰∏∫ÊØè‰∏™channelÁª¥Êä§‰∏Ä‰∏™Áã¨Á´ãÁöÑByteBufferÔºåByteBuffer‰∏çËÉΩÂ§™Â§ßÔºåÊØîÂ¶Ç‰∏Ä‰∏™ByteBuffer1MbÁöÑËØùÔºåË¶ÅÊîØÊåÅÁôæ‰∏áËøûÊé•Â∞±Ë¶Å1TbÂÜÖÂ≠òÔºåÂõ†Ê≠§ÈúÄË¶ÅËÆæËÆ°Â§ßÂ∞èÂèØÂèòÁöÑByteBuffer</p>
<p>‚ë†‰∏ÄÁßçÊÄùË∑ØÊòØÈ¶ñÂÖàÂàÜÈÖç‰∏Ä‰∏™ËæÉÂ∞èÁöÑbufferÔºå‰æãÂ¶Ç4kÂ¶ÇÊûúÂèëÁé∞Êï∞ÊçÆ‰∏çÂ§üÔºåÂÜçÂàÜÈÖç8kÁöÑ„ÄÇÂ∞Ü4k bufferÂÜÖÂÆπÊã∑Ë¥ùËá≥8kÁöÑÔºå‰ºòÁÇπÊòØÊ∂àÊÅØËøûÁª≠ÂÆπÊòìÂ§ÑÁêÜÔºåÁº∫ÁÇπÊòØÊï∞ÊçÆÊã∑Ë¥ùËÄóË¥πÊÄßËÉΩ</p>
<p>‚ë°Âè¶‰∏ÄÁßçÊÄùË∑ØÊòØÁî®Â§ö‰∏™Êï∞ÁªÑÁªÑÊàêbufferÔºå‰∏Ä‰∏™Êï∞ÁªÑ‰∏çÂ§üÔºåÊääÂ§öÂá∫Êù•ÁöÑÂÜÖÂÆπÂÜôÂÖ•Êñ∞ÁöÑÊï∞ÁªÑÔºå‰∏éÂâçÈù¢ÁöÑÂå∫Âà´ÊòØÊ∂àÊÅØÂ≠òÂÇ®‰∏çËøûÁª≠Ëß£ÊûêÂ§çÊùÇÔºå‰ºòÁÇπÊòØÈÅøÂÖç‰∫ÜÊã∑Ë¥ùÂºïËµ∑ÁöÑÊÄßËÉΩÊçüËÄó</p>
<ul>
<li>Â§ÑÁêÜ write ‰∫ã‰ª∂</li>
</ul>
<p>ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÊó†Ê≥ï‰øùËØÅÊääbuffer‰∏≠ÊâÄÊúâÊï∞ÊçÆÈÉΩÂÜôÂÖ•channel„ÄêÁΩëÂç°ËÉΩÂäõ‰πüÊòØÊúâÈôêÁöÑ„ÄëÔºåÂõ†Ê≠§ÈúÄË¶ÅËøΩË∏™writeÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºà‰ª£Ë°®ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇÊï∞Ôºâ</p>
<p>Áî®selectorÁõëÂê¨ÊâÄÊúâchannelÁöÑÂèØÂÜô‰∫ã‰ª∂ÔºåÊØè‰∏™channe ÈÉΩÈúÄË¶Å‰∏Ä‰∏™keyÊù•Ë∑üË∏™bufferÔºå‰ΩÜËøôÊ†∑Âèà‰ºöÂØºËá¥Âç†Áî®ÂÜÖÂ≠òËøáÂ§öÔºåÂ∞±Êúâ‰∏§Èò∂ÊÆµÁ≠ñÁï•</p>
<p>‚ë†ÂΩìÊ∂àÊÅØÂ§ÑÁêÜÂô®Á¨¨‰∏ÄÊ¨°ÂÜôÂÖ•Ê∂àÊÅØÊó∂ÔºåÊâçÂ∞ÜchannelÊ≥®ÂÜåÂà∞selector‰∏ä</p>
<p>‚ë°selector Ê£ÄÊü•channel‰∏äÁöÑÂèØÂÜô‰∫ã‰ª∂ÔºåÂ¶ÇÊûúÊâÄÊúâÁöÑÊï∞ÊçÆÂÜôÂÆå‰∫ÜÔºåÂ∞±ÂèñÊ∂àchannelÁöÑÊ≥®ÂÜå</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isAcceptable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ssc.<span style="color:#008080">accept</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>sc.<span style="color:#008080">configureBlocking</span>(<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>SelectionKey<span style="color:#bbb"> </span>sckey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>sc.<span style="color:#008080">register</span>(selector,<span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_READ</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 1. ÂêëÂÆ¢Êà∑Á´ØÂèëÈÄÅÂÜÖÂÆπ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>StringBuilder<span style="color:#bbb"> </span>sb<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringBuilder();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#bbb"> </span>3000000;<span style="color:#bbb"> </span>i<span style="color:#000;font-weight:bold">++</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sb.<span style="color:#008080">append</span>(<span style="color:#d14">&#34;a&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Charset.<span style="color:#008080">defaultCharset</span>().<span style="color:#008080">encode</span>(sb.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>write<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>sc.<span style="color:#008080">write</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 3. write Ë°®Á§∫ÂÆûÈôÖÂÜô‰∫ÜÂ§öÂ∞ëÂ≠óËäÇ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇ:&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>write);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// 4. Â¶ÇÊûúÊúâÂâ©‰ΩôÊú™ËØªÂ≠óËäÇÔºåÊâçÈúÄË¶ÅÂÖ≥Ê≥®ÂÜô‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(buffer.<span style="color:#008080">hasRemaining</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// read 1  write 4</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// Âú®ÂéüÊúâÂÖ≥Ê≥®‰∫ã‰ª∂ÁöÑÂü∫Á°Ä‰∏äÔºåÂ§öÂÖ≥Ê≥® ÂÜô‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sckey.<span style="color:#008080">interestOps</span>(sckey.<span style="color:#008080">interestOps</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_WRITE</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// Êää buffer ‰Ωú‰∏∫ÈôÑ‰ª∂Âä†ÂÖ• sckey</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sckey.<span style="color:#008080">attach</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(key.<span style="color:#008080">isWritable</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuffer<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(ByteBuffer)<span style="color:#bbb"> </span>key.<span style="color:#008080">attachment</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>SocketChannel<span style="color:#bbb"> </span>sc<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>(SocketChannel)<span style="color:#bbb"> </span>key.<span style="color:#008080">channel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>write<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>sc.<span style="color:#008080">write</span>(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇ:&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>write);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">!</span>buffer.<span style="color:#008080">hasRemaining</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ÂÜôÂÆå‰∫Ü</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>key.<span style="color:#008080">interestOps</span>(key.<span style="color:#008080">interestOps</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-</span><span style="color:#bbb"> </span>SelectionKey.<span style="color:#008080">OP_WRITE</span>);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// Â¶ÇÊûú‰∏çÂèñÊ∂àÔºå‰ºöÊØèÊ¨°ÂèØÂÜôÂùá‰ºöËß¶Âèëwrite‰∫ã‰ª∂</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>key.<span style="color:#008080">attach</span>(<span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‰∫ã‰ª∂ÂèëÁîüÂêéÔºåË¶Å‰πàÂ§ÑÁêÜÔºåË¶Å‰πàÂèñÊ∂àÔºàcancelÔºâÔºå‰∏çËÉΩ‰ªÄ‰πàÈÉΩ‰∏çÂÅöÔºåÂê¶Âàô‰∏ãÊ¨°ËØ•‰∫ã‰ª∂‰ªç‰ºöËß¶ÂèëÔºåËøôÊòØÂõ†‰∏∫nioÂ∫ïÂ±Ç‰ΩøÁî®ÁöÑÊòØÊ∞¥Âπ≥Ëß¶Âèë</p>
<p>selectÂú®‰∫ã‰ª∂ÂèëÁîüÂêéÔºåÂ∞±‰ºöÂ∞ÜÁõ∏ÂÖ≥ÁöÑkeyÊîæÂÖ•selectedKeysÈõÜÂêàÔºå‰ΩÜ‰∏ç‰ºöÂú®Â§ÑÁêÜÂÆåÂêé‰ªéselectedKeysÈõÜÂêà‰∏≠ÁßªÈô§ÔºåÈúÄË¶ÅÊàë‰ª¨Ëá™Â∑±ÁºñÁ†ÅÂà†Èô§„ÄÇ‰æãÂ¶Ç</p>
<ul>
<li>Á¨¨‰∏ÄÊ¨°Ëß¶Âèë‰∫Üssckey‰∏äÁöÑaccept‰∫ã‰ª∂ÔºåÊ≤°ÊúâÁßªÈô§ssckey</li>
<li>Á¨¨‰∫åÊ¨°Ëß¶Âèë‰∫Üsckey‰∏äÁöÑread‰∫ã‰ª∂Ôºå‰ΩÜËøôÊó∂selectedKeys‰∏≠ËøòÊúâ‰∏äÊ¨°ÁöÑssckeyÔºåÂú®Â§ÑÁêÜÊó∂Âõ†‰∏∫Ê≤°ÊúâÁúüÊ≠£ÁöÑserverSocketËøû‰∏ä‰∫ÜÔºåÂ∞±‰ºöÂØºËá¥Á©∫ÊåáÈíàÂºÇÂ∏∏</li>
</ul>
</blockquote>
<h4 id="Èõ∂Êã∑Ë¥ù">Èõ∂Êã∑Ë¥ù</h4>
<p><strong>‰º†ÁªüIO ‰º†ËæìÊï∞ÊçÆÈóÆÈ¢ò</strong></p>
<p><img src="/img/netty/BIO-trans-copy.png" alt="BIO-trans-copy"></p>
<ol>
<li>
<p>javaÊú¨Ë∫´Âπ∂‰∏çÂÖ∑Â§áIOËØªÂÜôËÉΩÂäõÔºåÂõ†Ê≠§readÊñπÊ≥ïË∞ÉÁî®ÂêéÔºåË¶Å‰ªéjavaÁ®ãÂ∫èÁöÑ<code>Áî®Êà∑ÊÄÅ</code>ÂàáÊç¢Ëá≥<code>ÂÜÖÊ†∏ÊÄÅ</code>ÔºåÂéªË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüÔºàKernelÔºâÁöÑËØªËÉΩÂäõÔºåÂ∞ÜÊï∞ÊçÆËØªÂÖ•<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>„ÄÇËøôÊúüÈó¥Áî®Êà∑Á∫øÁ®ãÈòªÂ°ûÔºåÊìç‰ΩúÁ≥ªÁªü‰ΩøÁî®DMAÔºàDirect Memory AccessÔºâÊù•ÂÆûÁé∞Êñá‰ª∂ËØªÔºåÂÖ∂Èó¥‰πü‰∏ç‰ºö‰ΩøÁî®cpu</p>
<blockquote>
<p>DMAÂèØ‰ª•ÁêÜËß£‰∏∫Á°¨‰ª∂ÂçïÂÖÉÔºåÁî®Êù•Ëß£ÊîæcpuÂÆåÊàêÊñá‰ª∂IO</p>
</blockquote>
</li>
<li>
<p>‰ªé<code>ÂÜÖÊ†∏ÊÄÅ</code>ÂàáÊç¢Âõû<code>Áî®Êà∑ÊÄÅ</code>ÔºåÂ∞ÜÊï∞ÊçÆ‰ªé<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>ËØªÂÖ•<code>Áî®Êà∑ÁºìÂÜ≤Âå∫</code>ÔºàÂç≥ byte[] bufÔºâÔºåËøôÊúüÈó¥cpu‰ºöÂèÇ‰∏éÊã∑Ë¥ùÔºåÊó†Ê≥ïÂà©Áî®DMA</p>
</li>
<li>
<p>Ë∞ÉÁî®writeÊñπÊ≥ïÔºåËøôÊó∂Â∞ÜÊï∞ÊçÆ‰ªé<code>Áî®Êà∑ÁºìÂÜ≤Âå∫</code>Ôºàbyte[] bufÔºâÂÜôÂÖ•<code>socket ÁºìÂÜ≤Âå∫</code>Ôºåcpu‰ºöÂèÇ‰∏éÊã∑Ë¥ù</p>
</li>
<li>
<p>Êé•‰∏ãÊù•Ë¶ÅÂêëÁΩëÂç°ÂÜôÊï∞ÊçÆÔºåËøôÈ°πËÉΩÂäõjavaÂèà‰∏çÂÖ∑Â§áÔºåÂõ†Ê≠§ÂèàÂæó‰ªé<code>Áî®Êà∑ÊÄÅ</code>ÂàáÊç¢Ëá≥<code>ÂÜÖÊ†∏ÊÄÅ</code>ÔºåË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüÁöÑÂÜôËÉΩÂäõÔºå‰ΩøÁî®DMAÂ∞Ü<code>socket ÁºìÂÜ≤Âå∫</code>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî®cpu</p>
</li>
</ol>
<blockquote>
<p>ÂèØ‰ª•ÁúãÂà∞‰∏≠Èó¥ÁéØËäÇËæÉÂ§öÔºåjava ÁöÑ IO ÂÆûÈôÖ‰∏çÊòØÁâ©ÁêÜËÆæÂ§áÁ∫ßÂà´ÁöÑËØªÂÜôÔºåËÄåÊòØÁºìÂ≠òÁöÑÂ§çÂà∂ÔºåÂ∫ïÂ±ÇÁöÑÁúüÊ≠£ËØªÂÜôÊòØÊìç‰ΩúÁ≥ªÁªüÊù•ÂÆåÊàêÁöÑ</p>
<ul>
<li>Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢ÂèëÁîü‰∫Ü 3 Ê¨°ÔºåËøô‰∏™Êìç‰ΩúÊØîËæÉÈáçÈáèÁ∫ß</li>
<li>Êï∞ÊçÆÊã∑Ë¥ù‰∫ÜÂÖ± 4 Ê¨°</li>
</ul>
</blockquote>
<p><strong>NIO ‰ºòÂåñ</strong></p>
<p>ÈÄöËøá<code>ByteBuffer.allocateDirect(capacity)</code> ÂàõÂª∫DirectByteBuffer‰ΩøÁî®ÁöÑÊòØÊìç‰ΩúÁ≥ªÁªüÂÜÖÂ≠ò„ÄÇDirectByteBufÂ∞ÜÂ†ÜÂ§ñÂÜÖÂ≠òÊò†Â∞ÑÂà∞jvmÂÜÖÂ≠ò‰∏≠Êù•Áõ¥Êé•ËÆøÈóÆ‰ΩøÁî®Ôºå</p>
<p><img src="/img/netty/DirectByteBuffer.png" alt="DirectByteBuffer"></p>
<ul>
<li>ËøôÂùóÂÜÖÂ≠ò‰∏çÂèó jvm ÂûÉÂúæÂõûÊî∂ÁöÑÂΩ±ÂìçÔºåÂõ†Ê≠§ÂÜÖÂ≠òÂú∞ÂùÄÂõ∫ÂÆöÔºåÊúâÂä©‰∫é IO ËØªÂÜô</li>
<li>java ‰∏≠ÁöÑ DirectByteBuf ÂØπË±°‰ªÖÁª¥Êä§‰∫ÜÊ≠§ÂÜÖÂ≠òÁöÑËôöÂºïÁî®ÔºåÂÜÖÂ≠òÂõûÊî∂ÂàÜÊàê‰∏§Ê≠•
<ul>
<li>DirectByteBuf ÂØπË±°Ë¢´ÂûÉÂúæÂõûÊî∂ÔºåÂ∞ÜËôöÂºïÁî®Âä†ÂÖ•ÂºïÁî®ÈòüÂàó</li>
<li>ÈÄöËøá‰∏ìÈó®Á∫øÁ®ãËÆøÈóÆÂºïÁî®ÈòüÂàóÔºåÊ†πÊçÆËôöÂºïÁî®ÈáäÊîæÂ†ÜÂ§ñÂÜÖÂ≠ò</li>
</ul>
</li>
<li>ÂáèÂ∞ë‰∫Ü‰∏ÄÊ¨°Êï∞ÊçÆÊã∑Ë¥ùÔºåÁî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢Ê¨°Êï∞Ê≤°ÊúâÂáèÂ∞ë</li>
</ul>
<hr>
<p>Ëøõ‰∏ÄÊ≠•‰ºòÂåñÔºàÂ∫ïÂ±ÇÈááÁî®‰∫Ülinux 2.1ÂêéÊèê‰æõÁöÑsendFileÊñπÊ≥ïÔºâÔºåjava ‰∏≠ÂØπÂ∫îÁùÄ‰∏§channelË∞ÉÁî®transferTo/transferFromÊñπÊ≥ïÊã∑Ë¥ùÊï∞ÊçÆ</p>
<p><img src="/img/netty/zero-copy-1.png" alt="zero-copy-1"></p>
<ol>
<li>javaË∞ÉÁî®transferToÊñπÊ≥ïÂêéÔºåË¶Å‰ªéjavaÁ®ãÂ∫èÁöÑ<code>Áî®Êà∑ÊÄÅ</code>ÂàáÊç¢Ëá≥<code>ÂÜÖÊ†∏ÊÄÅ</code>Ôºå‰ΩøÁî® DMAÂ∞ÜÊï∞ÊçÆËØªÂÖ•<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
<li>Êï∞ÊçÆ‰ªé<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>‰º†ËæìÂà∞<code>socket ÁºìÂÜ≤Âå∫</code>Ôºåcpu‰ºöÂèÇ‰∏éÊã∑Ë¥ù</li>
<li>ÊúÄÂêé‰ΩøÁî®DMAÂ∞Ü<code>socket ÁºìÂÜ≤Âå∫</code>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
</ol>
<blockquote>
<p>Âè™ÂèëÁîü‰∫Ü‰∏ÄÊ¨°Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢ÔºåÊï∞ÊçÆÊã∑Ë¥ù‰∫Ü 3 Ê¨°</p>
</blockquote>
<hr>
<p>Ëøõ‰∏ÄÊ≠•‰ºòÂåñÔºàlinux 2.4Ôºâ</p>
<p><img src="/img/netty/zero-copy-2.png" alt="zero-copy-2"></p>
<ol>
<li>javaË∞ÉÁî®transferToÊñπÊ≥ïÂêéÔºåË¶Å‰ªéjavaÁ®ãÂ∫èÁöÑ<code>Áî®Êà∑ÊÄÅ</code>ÂàáÊç¢Ëá≥<code>ÂÜÖÊ†∏ÊÄÅ</code>Ôºå‰ΩøÁî®DMAÂ∞ÜÊï∞ÊçÆËØªÂÖ•<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
<li>Âè™‰ºöÂ∞Ü‰∏Ä‰∫õoffsetÂíålength‰ø°ÊÅØÊã∑ÂÖ•<code>socket ÁºìÂÜ≤Âå∫</code>ÔºåÂá†‰πéÊó†Ê∂àËÄó</li>
<li>‰ΩøÁî®DMAÂ∞Ü<code>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</code>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
</ol>
<blockquote>
<p>Êï¥‰∏™ËøáÁ®ã‰ªÖÂè™ÂèëÁîü‰∫Ü‰∏ÄÊ¨°Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢ÔºåÊï∞ÊçÆÊã∑Ë¥ù‰∫Ü 2 Ê¨°„ÄÇ</p>
<p>ÊâÄË∞ìÁöÑ„ÄêÈõ∂Êã∑Ë¥ù„ÄëÔºåÂπ∂‰∏çÊòØÁúüÊ≠£Êó†Êã∑Ë¥ùÔºåËÄåÊòØÂú®‰∏ç‰ºöÊã∑Ë¥ùÈáçÂ§çÊï∞ÊçÆÂà∞ jvm ÂÜÖÂ≠ò‰∏≠</p>
</blockquote>
<h3 id="nio-vs-bio">NIO vs BIO</h3>
<p><strong>stream vs channel</strong></p>
<ul>
<li>stream‰∏ç‰ºöËá™Âä®ÁºìÂÜ≤Êï∞ÊçÆÔºåchannel‰ºöÂà©Áî®Á≥ªÁªüÊèê‰æõÁöÑÂèëÈÄÅÁºìÂÜ≤Âå∫„ÄÅÊé•Êî∂ÁºìÂÜ≤Âå∫ÔºàÊõ¥‰∏∫Â∫ïÂ±ÇÔºâ</li>
<li>stream‰ªÖÊîØÊåÅÈòªÂ°ûAPIÔºåchannelÂêåÊó∂ÊîØÊåÅÈòªÂ°û„ÄÅÈùûÈòªÂ°ûAPIÔºåÁΩëÁªúchannelÂèØÈÖçÂêàselectorÂÆûÁé∞Â§öË∑ØÂ§çÁî®</li>
<li>‰∫åËÄÖÂùá‰∏∫ÂÖ®ÂèåÂ∑•ÔºåÂç≥ËØªÂÜôÂèØ‰ª•ÂêåÊó∂ËøõË°å</li>
</ul>
<p><strong>IO Ê®°Âûã</strong></p>
<p>ÂêåÊ≠•ÈòªÂ°û„ÄÅÂêåÊ≠•ÈùûÈòªÂ°û„ÄÅÂêåÊ≠•Â§öË∑ØÂ§çÁî®„ÄÅÂºÇÊ≠•ÈòªÂ°ûÔºàÊ≤°ÊúâÊ≠§ÊÉÖÂÜµÔºâ„ÄÅÂºÇÊ≠•ÈùûÈòªÂ°û</p>
<ul>
<li>ÂêåÊ≠•ÔºöÁ∫øÁ®ãËá™Â∑±ÂéªËé∑ÂèñÁªìÊûúÔºà‰∏Ä‰∏™Á∫øÁ®ãÔºâ</li>
<li>ÂºÇÊ≠•ÔºöÁ∫øÁ®ãËá™Â∑±‰∏çÂéªËé∑ÂèñÁªìÊûúÔºåËÄåÊòØÁî±ÂÖ∂ÂÆÉÁ∫øÁ®ãÈÄÅÁªìÊûúÔºàËá≥Â∞ë‰∏§‰∏™Á∫øÁ®ãÔºâ</li>
</ul>
<h2 id="‰∫ånettyÁöÑÂü∫Êú¨‰ΩøÁî®">‰∫å„ÄÅNettyÁöÑÂü∫Êú¨‰ΩøÁî®</h2>
<h3 id="ÁÆÄ‰ªã">ÁÆÄ‰ªã</h3>
<p>NettyÊòØ‰∏Ä‰∏™ÂºÇÊ≠•ÁöÑ„ÄÅÂü∫‰∫é‰∫ã‰ª∂È©±Âä®ÁöÑÁΩëÁªúÂ∫îÁî®Ê°ÜÊû∂ÔºåÁî®‰∫éÂø´ÈÄüÂºÄÂèëÂèØÁª¥Êä§„ÄÅÈ´òÊÄßËÉΩÁöÑÁΩëÁªúÊúçÂä°Âô®ÂíåÂÆ¢Êà∑Á´Ø„ÄÇ</p>
<p>Netty vs NIOÁöÑ‰ºòÂäø</p>
<ol>
<li>NIOÔºåÂ∑•‰ΩúÈáèÂ§ßÔºåbug Â§ö</li>
<li>NIOÈúÄË¶ÅËá™Â∑±ÊûÑÂª∫ÂçèËÆÆ</li>
<li>NettyËß£ÂÜ≥TCP‰º†ËæìÈóÆÈ¢òÔºåÂ¶ÇÁ≤òÂåÖ„ÄÅÂçäÂåÖ</li>
<li>NIOÁöÑepollÁ©∫ËΩÆËØ¢ÂØºËá¥CPU100%</li>
<li>ÂØπAPIËøõË°åÂ¢ûÂº∫Ôºå‰Ωø‰πãÊõ¥ÊòìÁî®</li>
</ol>
<h3 id="ÊúÄÂü∫Á°ÄÁöÑnettyÁ§∫‰æã">ÊúÄÂü∫Á°ÄÁöÑNettyÁ§∫‰æã</h3>
<ul>
<li>ÊúçÂä°Âô®Á´Ø</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">simpleServerTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ServerBootstrap()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÂàõÂª∫ NioEventLoopGroupÔºåÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫ Á∫øÁ®ãÊ±† + Selector</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">group</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>NioEventLoopGroup())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÈÄâÊã©ÊúçÂä°SocketÂÆûÁé∞Á±ªÔºåÂÖ∂‰∏≠NioServerSocketChannelË°®Á§∫Âü∫‰∫éNIOÁöÑÊúçÂä°Âô®Á´ØÂÆûÁé∞</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">channel</span>(NioServerSocketChannel.<span style="color:#008080">class</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//  childHandlerÊ∑ªÂä†ÁöÑÂ§ÑÁêÜÂô®ÈÉΩÊòØÁªôSocketChannelÁî®ÁöÑÔºåËÄå‰∏çÊòØÁªôServerSocketChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//  ChannelInitializerÂ§ÑÁêÜÂô®Ôºà‰ªÖÊâßË°å‰∏ÄÊ¨°ÔºâÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂæÖÂÆ¢Êà∑Á´ØSocketChannelÂª∫Á´ãËøûÊé•ÂêéÔºåÊâßË°åinitChannel‰ª•‰æøÊ∑ªÂä†Êõ¥Â§öÁöÑÂ§ÑÁêÜÂô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">childHandler</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ChannelInitializer<span style="color:#000;font-weight:bold">&lt;</span>NioSocketChannel<span style="color:#000;font-weight:bold">&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initChannel</span>(NioSocketChannel<span style="color:#bbb"> </span>ch)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// SocketChannel ÁöÑÂ§ÑÁêÜÂô®ÔºåËß£Á†Å ByteBuf =&gt; String</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringDecoder());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// SocketChannel ÁöÑ‰∏öÂä°Â§ÑÁêÜÂô®Ôºå‰ΩøÁî®‰∏ä‰∏Ä‰∏™Â§ÑÁêÜÂô®ÁöÑÂ§ÑÁêÜÁªìÊûú</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>SimpleChannelInboundHandler<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">channelRead0</span>(ChannelHandlerContext<span style="color:#bbb"> </span>ctx,<span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>msg)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(msg);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>})<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÁªëÂÆöÁöÑÁõëÂê¨Á´ØÂè£</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">bind</span>(8080);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">in</span>.<span style="color:#008080">read</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÆ¢Êà∑Á´Ø</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">simpleClientTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ChannelFuture<span style="color:#bbb"> </span>client<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Bootstrap()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÂàõÂª∫ NioEventLoopGroupÔºåÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫ Á∫øÁ®ãÊ±† + Selector</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">group</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>NioEventLoopGroup())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// ÈÄâÊã©ÊúçÂä°SocketÂÆûÁé∞Á±ªÔºåÂÖ∂‰∏≠NioSocketChannelË°®Á§∫Âü∫‰∫éNIOÁöÑÂÆ¢Êà∑Âô®Á´ØÂÆûÁé∞</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">channel</span>(NioSocketChannel.<span style="color:#008080">class</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//  ChannelInitializerÂ§ÑÁêÜÂô®Ôºà‰ªÖÊâßË°å‰∏ÄÊ¨°ÔºâÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂæÖÂÆ¢Êà∑Á´ØSocketChannelÂª∫Á´ãËøûÊé•ÂêéÔºåÊâßË°åinitChannel‰ª•‰æøÊ∑ªÂä†Êõ¥Â§öÁöÑÂ§ÑÁêÜÂô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">handler</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ChannelInitializer<span style="color:#000;font-weight:bold">&lt;</span>NioSocketChannel<span style="color:#000;font-weight:bold">&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initChannel</span>(NioSocketChannel<span style="color:#bbb"> </span>ch)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// SocketChannel ÁöÑÂ§ÑÁêÜÂô®ÔºåÁºñÁ†Å ByteBuf =&gt; String</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringEncoder());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">// ËøûÊé•ÊúçÂä°Âô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}).<span style="color:#008080">connect</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// FutureÊòØÂºÇÊ≠•ÁöÑÔºåË¶ÅÁ≠âÂæÖËøûÊé•‰∏äÊúçÂä°Âô®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">sync</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ÂèëÈÄÅÊï∞ÊçÆ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">channel</span>().<span style="color:#008080">writeAndFlush</span>(<span style="color:#d14">&#34;Hello world&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">in</span>.<span style="color:#008080">read</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Áõ∏ÂÖ≥Ê¶ÇÂøµ">Áõ∏ÂÖ≥Ê¶ÇÂøµ</h3>
<p>ÈúÄË¶ÅÊ†ëÁ´ãÊ≠£Á°ÆÁöÑÁêÜËß£ËßÇÂøµ</p>
<ol>
<li>Êää channel ÁêÜËß£‰∏∫Êï∞ÊçÆÁöÑÈÄöÈÅì</li>
<li>Êää msg ÁêÜËß£‰∏∫ÊµÅÂä®ÁöÑÊï∞ÊçÆÔºåÊúÄÂºÄÂßãËæìÂÖ•ÊòØ ByteBufÔºå‰ΩÜÁªèËøá pipeline ÁöÑÂä†Â∑•Ôºå‰ºöÂèòÊàêÂÖ∂ÂÆÉÁ±ªÂûãÂØπË±°ÔºåÊúÄÂêéËæìÂá∫ÂèàÂèòÊàê ByteBuf</li>
<li>Êää handler ÁêÜËß£‰∏∫Êï∞ÊçÆÁöÑÂ§ÑÁêÜÂ∑•Â∫è
<ul>
<li>Â∑•Â∫èÊúâÂ§öÈÅìÔºåÂêàÂú®‰∏ÄËµ∑Â∞±ÊòØpipelineÔºåpipelineË¥üË¥£ÂèëÂ∏É‰∫ã‰ª∂ÔºàËØª„ÄÅËØªÂèñÂÆåÊàê&hellip;Ôºâ‰º†Êí≠ÁªôÊØè‰∏™handlerÔºå handlerÂØπËá™Â∑±ÊÑüÂÖ¥Ë∂£ÁöÑ‰∫ã‰ª∂ËøõË°åÂ§ÑÁêÜÔºàÈáçÂÜô‰∫ÜÁõ∏Â∫î‰∫ã‰ª∂Â§ÑÁêÜÊñπÊ≥ïÔºâ</li>
<li>handlerÂàÜInboundÂíåOutbound‰∏§Á±ª</li>
</ul>
</li>
<li>Êää eventLoop ÁêÜËß£‰∏∫Â§ÑÁêÜÊï∞ÊçÆÁöÑÂ∑•‰∫∫
<ul>
<li>Â∑•‰∫∫ÂèØ‰ª•ÁÆ°ÁêÜÂ§ö‰∏™channelÁöÑioÊìç‰ΩúÔºåÂπ∂‰∏î‰∏ÄÊó¶Â∑•‰∫∫Ë¥üË¥£‰∫ÜÊüê‰∏™ channelÔºåÂ∞±Ë¶ÅË¥üË¥£Âà∞Â∫ïÔºàÁªëÂÆöÔºâ</li>
<li>Â∑•‰∫∫Êó¢ÂèØ‰ª•ÊâßË°åioÊìç‰ΩúÔºå‰πüÂèØ‰ª•ËøõË°å‰ªªÂä°Â§ÑÁêÜÔºåÊØè‰ΩçÂ∑•‰∫∫Êúâ‰ªªÂä°ÈòüÂàóÔºåÈòüÂàóÈáåÂèØ‰ª•Â†ÜÊîæÂ§ö‰∏™channelÁöÑÂæÖÂ§ÑÁêÜ‰ªªÂä°Ôºå‰ªªÂä°ÂàÜ‰∏∫ÊôÆÈÄö‰ªªÂä°„ÄÅÂÆöÊó∂‰ªªÂä°</li>
<li>Â∑•‰∫∫ÊåâÁÖßpipelineÈ°∫Â∫èÔºå‰æùÊ¨°ÊåâÁÖßhandlerÁöÑËßÑÂàíÔºà‰ª£Á†ÅÔºâÂ§ÑÁêÜÊï∞ÊçÆÔºåÂèØ‰ª•‰∏∫ÊØèÈÅìÂ∑•Â∫èÊåáÂÆö‰∏çÂêåÁöÑÂ∑•‰∫∫</li>
</ul>
</li>
</ol>
<h3 id="eventloopÁªÑ‰ª∂">EventLoopÁªÑ‰ª∂</h3>
<p><strong>EventLoop„ÄêÊó∂Èó¥Âæ™ÁéØÂØπË±°„Äë</strong></p>
<p>Êú¨Ë¥®ÊòØ‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÊâßË°åÂô®ÔºàÂêåÊó∂Áª¥Êä§‰∫Ü‰∏Ä‰∏™SelectorÔºâÔºåÈáåÈù¢ÊúârunÊñπÊ≥ïÂ§ÑÁêÜChannel‰∏äÊ∫êÊ∫ê‰∏çÊñ≠ÁöÑio‰∫ã‰ª∂</p>
<p><img src="/img/netty/eventLoop-inheritance.png" alt="EventLoop-inheritance"></p>
<p><strong>EventLoopGroup„Äê‰∫ã‰ª∂Âæ™ÁéØÁªÑ„Äë</strong></p>
<p>EventLoopGroupÊòØ‰∏ÄÁªÑEventLoopÔºåChannel‰∏ÄËà¨‰ºöË∞ÉÁî®EventLoopGroupÁöÑregisterÊñπÊ≥ïÊù•ÁªëÂÆöÂÖ∂‰∏≠‰∏Ä‰∏™EventLoopÔºåÂêéÁª≠Ëøô‰∏™Channel‰∏äÁöÑio‰∫ã‰ª∂ÈÉΩÁî±Ê≠§ EventLoopÊù•Â§ÑÁêÜÔºà‰øùËØÅ‰∫Üio‰∫ã‰ª∂Â§ÑÁêÜÊó∂ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÔºâÔºåÊúânextÊñπÊ≥ïËé∑ÂèñÈõÜÂêà‰∏≠‰∏ã‰∏Ä‰∏™EventLoop</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ÁÆÄÂçïÁöÑÁ§∫‰æã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>DefaultEventLoopGroup<span style="color:#bbb"> </span>group<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultEventLoopGroup(2);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(group.<span style="color:#008080">next</span>());<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//io.netty.channel.DefaultEventLoop@60f82f98</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(group.<span style="color:#008080">next</span>());<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//io.netty.channel.DefaultEventLoop@35f983a6</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(group.<span style="color:#008080">next</span>());<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//io.netty.channel.DefaultEventLoop@60f82f98</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ‰πüÂèØ‰ª•ÊòØÊúâforÂæ™ÁéØ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>DefaultEventLoopGroup<span style="color:#bbb"> </span>group<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultEventLoopGroup(2);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(EventExecutor<span style="color:#bbb"> </span>eventLoop<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>group)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(eventLoop);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰ºòÈõÖÂÖ≥Èó≠</strong></p>
<p>‰ºòÈõÖÂÖ≥Èó≠ <code>shutdownGracefully</code> ÊñπÊ≥ï„ÄÇËØ•ÊñπÊ≥ï‰ºöÈ¶ñÂÖàÂàáÊç¢ <code>EventLoopGroup</code> Âà∞ÂÖ≥Èó≠Áä∂ÊÄÅ‰ªéËÄåÊãíÁªùÊñ∞ÁöÑ‰ªªÂä°ÁöÑÂä†ÂÖ•ÔºåÁÑ∂ÂêéÂú®‰ªªÂä°ÈòüÂàóÁöÑ‰ªªÂä°ÈÉΩÂ§ÑÁêÜÂÆåÊàêÂêéÔºåÂÅúÊ≠¢Á∫øÁ®ãÁöÑËøêË°å„ÄÇ‰ªéËÄåÁ°Æ‰øùÊï¥‰ΩìÂ∫îÁî®ÊòØÂú®Ê≠£Â∏∏ÊúâÂ∫èÁöÑÁä∂ÊÄÅ‰∏ãÈÄÄÂá∫„ÄÇ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">simpleClientTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>NioEventLoopGroup<span style="color:#bbb"> </span>eventLoopGroup<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>NioEventLoopGroup();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ChannelFuture<span style="color:#bbb"> </span>client<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Bootstrap()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">group</span>(eventLoopGroup)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">channel</span>(NioSocketChannel.<span style="color:#008080">class</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">handler</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ChannelInitializer<span style="color:#000;font-weight:bold">&lt;</span>NioSocketChannel<span style="color:#000;font-weight:bold">&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initChannel</span>(NioSocketChannel<span style="color:#bbb"> </span>ch)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringEncoder());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}).<span style="color:#008080">connect</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">sync</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">channel</span>().<span style="color:#008080">writeAndFlush</span>(<span style="color:#d14">&#34;Hello world&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ‰ºòÈõÖÂÖ≥Èó≠</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>eventLoopGroup.<span style="color:#008080">shutdownGracefully</span>().<span style="color:#008080">sync</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>eventLoopÂíåchannelÂº∫ÁªëÂÆö</strong></p>
<p>ÂÖ≥ÈîÆ‰ª£Á†Å <code>io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">invokeChannelRead</span>(<span style="color:#000;font-weight:bold">final</span><span style="color:#bbb"> </span>AbstractChannelHandlerContext<span style="color:#bbb"> </span>next,<span style="color:#bbb"> </span>Object<span style="color:#bbb"> </span>msg)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">final</span><span style="color:#bbb"> </span>Object<span style="color:#bbb"> </span>m<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>next.<span style="color:#008080">pipeline</span>.<span style="color:#008080">touch</span>(ObjectUtil.<span style="color:#008080">checkNotNull</span>(msg,<span style="color:#bbb"> </span><span style="color:#d14">&#34;msg&#34;</span>),<span style="color:#bbb"> </span>next);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ‰∏ã‰∏Ä‰∏™ handler ÁöÑ‰∫ã‰ª∂Âæ™ÁéØÊòØÂê¶‰∏éÂΩìÂâçÁöÑ‰∫ã‰ª∂Âæ™ÁéØÊòØÂêå‰∏Ä‰∏™Á∫øÁ®ã</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>EventExecutor<span style="color:#bbb"> </span>executor<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>next.<span style="color:#008080">executor</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ÊòØÔºåÁõ¥Êé•Ë∞ÉÁî®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(executor.<span style="color:#008080">inEventLoop</span>())<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>next.<span style="color:#008080">invokeChannelRead</span>(m);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ‰∏çÊòØÔºåÂ∞ÜË¶ÅÊâßË°åÁöÑ‰ª£Á†Å‰Ωú‰∏∫‰ªªÂä°Êèê‰∫§Áªô‰∏ã‰∏Ä‰∏™‰∫ã‰ª∂Âæ™ÁéØÂ§ÑÁêÜÔºàÊç¢‰∫∫Ôºâ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>executor.<span style="color:#008080">execute</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Runnable()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">run</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>next.<span style="color:#008080">invokeChannelRead</span>(m);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="channelÁªÑ‰ª∂">ChannelÁªÑ‰ª∂</h3>
<p><strong>channelÁöÑ‰∏ªË¶Å‰ΩúÁî®</strong></p>
<ol>
<li>close() ÂèØ‰ª•Áî®Êù•ÂÖ≥Èó≠channel</li>
<li>closeFuture() Áî®Êù•Â§ÑÁêÜchannelÁöÑÂÖ≥Èó≠
<ul>
<li>syncÊñπÊ≥ï‰ΩúÁî®ÊòØÂêåÊ≠•Á≠âÂæÖchannelÂÖ≥Èó≠</li>
<li>ËÄåaddListenerÊñπÊ≥ïÊòØÂºÇÊ≠•Á≠âÂæÖchannelÂÖ≥Èó≠</li>
</ul>
</li>
<li>pipeline() ÊñπÊ≥ïÊ∑ªÂä†Â§ÑÁêÜÂô®</li>
<li>write() ÊñπÊ≥ïÂ∞ÜÊï∞ÊçÆÂÜôÂÖ•</li>
<li>writeAndFlush() ÊñπÊ≥ïÂ∞ÜÊï∞ÊçÆÂÜôÂÖ•Âπ∂Âà∑Âá∫</li>
</ol>
<p><strong>ChannelFuture</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">simpleClientTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>NioEventLoopGroup<span style="color:#bbb"> </span>eventLoopGroup<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>NioEventLoopGroup();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ChannelFuture<span style="color:#bbb"> </span>client<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Bootstrap()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">group</span>(eventLoopGroup)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">channel</span>(NioSocketChannel.<span style="color:#008080">class</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">handler</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ChannelInitializer<span style="color:#000;font-weight:bold">&lt;</span>NioSocketChannel<span style="color:#000;font-weight:bold">&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initChannel</span>(NioSocketChannel<span style="color:#bbb"> </span>ch)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringEncoder());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}).<span style="color:#008080">connect</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>InetSocketAddress(8080));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// connectÊñπÊ≥ïÊòØÂºÇÊ≠•ÁöÑÔºåÊÑèÂë≥ÁùÄ‰∏çÁ≠âËøûÊé•Âª∫Á´ãÔºåÊñπÊ≥ïÊâßË°åÂ∞±ËøîÂõû‰∫Ü„ÄÇ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// Âõ†Ê≠§channelFutureÂØπË±°‰∏≠‰∏çËÉΩ„ÄêÁ´ãÂàª„ÄëËé∑ÂæóÂà∞Ê≠£Á°ÆÁöÑChannelÂØπË±°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">sync</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ËøîÂõûÁöÑÊòØChannelFutureÂØπË±°ÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂà©Áî®channel()ÊñπÊ≥ïÊù•Ëé∑ÂèñChannelÂØπË±°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>client.<span style="color:#008080">channel</span>().<span style="color:#008080">writeAndFlush</span>(<span style="color:#d14">&#34;Hello world&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ChannelFuture<span style="color:#bbb"> </span>channelFuture<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>client.<span style="color:#008080">channel</span>().<span style="color:#008080">closeFuture</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ÂèØÊâßË°åchannelÂÖ≥Èó≠ÂêéÁöÑÊâ´Â∞æÊìç‰Ωú</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channelFuture.<span style="color:#008080">addListener</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>GenericFutureListener<span style="color:#000;font-weight:bold">&lt;</span>Future<span style="color:#000;font-weight:bold">&lt;?</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span><span style="color:#bbb"> </span>Void<span style="color:#000;font-weight:bold">&gt;&gt;</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">operationComplete</span>(Future<span style="color:#000;font-weight:bold">&lt;?</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">super</span><span style="color:#bbb"> </span>Void<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>future)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;ÂÖ≥Èó≠ÂêéÊâ´Â∞æÊìç‰Ωú&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>eventLoopGroup.<span style="color:#008080">shutdownGracefully</span>().<span style="color:#008080">sync</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂºÇÊ≠•ÁöÑÂ•ΩÂ§Ñ</strong></p>
<p>‰∏æ‰∏™‰æãÂ≠êÔºåÂ¶ÇÊûú4‰∏™ÂåªÁîüÂêåÊ≠•Â§ÑÁêÜÁúãÁóÖÁöÑÂÖ®ÊµÅÁ®ãÔºåÂàô‰ºöÊòØÂ¶Ç‰∏ãÔºåÂÅáËÆæÊåÇÂè∑„ÄÅÂèñËçØ10minÔºåÁúãÁóÖ„ÄÅÁº¥Ë¥π20minÔºåÂàô60minËÉΩËµ∞ÂÆå4‰∏™ÁóÖ‰∫∫ÁúãÁóÖÊµÅÁ®ã</p>
<p><img src="/img/netty/netty-async.png" alt="netty-async"></p>
<p>Â¶ÇÊûúÊîπ‰∏∫ÂºÇÊ≠•ÔºåÂàô60minÔºåÂèØ‰ª•Â§ÑÁêÜ6‰∏™ÊåÇÂè∑Ôºå6‰∏™ÂèñËçØÔºå3‰∏™ÁúãÁóÖÔºå3‰∏™Áº¥Ë¥π„ÄÇËøôÊ†∑ÊåÇÂè∑Êï∞Èáè‰∏äÂçá‰ºö‰ΩøÂêûÂêêÈáè‰∏äÂçá„ÄÇÂçïÂÆûÈôÖÁúãÂÆåÁöÑÁóÖ‰∫∫Êï∞Èáè‰ºö‰∏ãÈôç„ÄÇ</p>
<p><img src="/img/netty/netty-sync.png" alt="netty-sync"></p>
<ul>
<li>ÂçïÁ∫øÁ®ãÊ≤°Ê≥ïÂºÇÊ≠•ÊèêÈ´òÊïàÁéáÔºåÂøÖÈ°ªÈÖçÂêàÂ§öÁ∫øÁ®ã„ÄÅÂ§öÊ†∏ cpu ÊâçËÉΩÂèëÊå•ÂºÇÊ≠•ÁöÑ‰ºòÂäø</li>
<li>ÂºÇÊ≠•Âπ∂Ê≤°ÊúâÁº©Áü≠ÂìçÂ∫îÊó∂Èó¥ÔºåÂèçËÄåÊúâÊâÄÂ¢ûÂä†ÔºåÊèêÈ´òÁöÑÊòØÂêûÂêêÈáè</li>
<li>ÂêàÁêÜËøõË°å‰ªªÂä°ÊãÜÂàÜÔºå‰πüÊòØÂà©Áî®ÂºÇÊ≠•ÁöÑÂÖ≥ÈîÆ</li>
</ul>
<h3 id="future--promise">Future &amp; Promise</h3>
<p>Âú®ÂºÇÊ≠•Â§ÑÁêÜÊó∂ÔºåÁªèÂ∏∏Áî®Âà∞Ëøô‰∏§‰∏™Êé•Âè£</p>
<p>È¶ñÂÖàË¶ÅËØ¥Êòénetty‰∏≠ÁöÑFuture‰∏éjdk‰∏≠ÁöÑFutureÂêåÂêçÔºå‰ΩÜÊòØÊòØ‰∏§‰∏™Êé•Âè£ÔºånettyÁöÑFutureÁªßÊâøËá™jdkÁöÑFutureÔºåËÄåPromiseÂèàÂØπnetty FutureËøõË°å‰∫ÜÊâ©Â±ï</p>
<ul>
<li>jdk FutureÂè™ËÉΩÂêåÊ≠•Á≠âÂæÖ‰ªªÂä°ÁªìÊùüÔºàÊàñÊàêÂäü„ÄÅÊàñÂ§±Ë¥•ÔºâÊâçËÉΩÂæóÂà∞ÁªìÊûú</li>
<li>netty FutureÂèØ‰ª•ÂêåÊ≠•Á≠âÂæÖ‰ªªÂä°ÁªìÊùüÂæóÂà∞ÁªìÊûúÔºå‰πüÂèØ‰ª•ÂºÇÊ≠•ÊñπÂºèÂæóÂà∞ÁªìÊûúÔºå‰ΩÜÈÉΩÊòØË¶ÅÁ≠â‰ªªÂä°ÁªìÊùü</li>
<li>netty Promise‰∏ç‰ªÖÊúânetty FutureÁöÑÂäüËÉΩÔºåËÄå‰∏îËÑ±Á¶ª‰∫Ü‰ªªÂä°Áã¨Á´ãÂ≠òÂú®ÔºåÂè™‰Ωú‰∏∫‰∏§‰∏™Á∫øÁ®ãÈó¥‰º†ÈÄíÁªìÊûúÁöÑÂÆπÂô®</li>
</ul>
<table>
<thead>
<tr>
<th>ÂäüËÉΩ/ÂêçÁß∞</th>
<th>jdk Future</th>
<th>netty Future</th>
<th>Promise</th>
</tr>
</thead>
<tbody>
<tr>
<td>cancel</td>
<td>ÂèñÊ∂à‰ªªÂä°</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>isCanceled</td>
<td>‰ªªÂä°ÊòØÂê¶ÂèñÊ∂à</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>isDone</td>
<td>‰ªªÂä°ÊòØÂê¶ÂÆåÊàêÔºå‰∏çËÉΩÂå∫ÂàÜÊàêÂäüÂ§±Ë¥•</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>get</td>
<td>Ëé∑Âèñ‰ªªÂä°ÁªìÊûúÔºåÈòªÂ°ûÁ≠âÂæÖ</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>getNow</td>
<td>-</td>
<td>Ëé∑Âèñ‰ªªÂä°ÁªìÊûúÔºåÈùûÈòªÂ°ûÔºåËøòÊú™‰∫ßÁîüÁªìÊûúÊó∂ËøîÂõû null</td>
<td>-</td>
</tr>
<tr>
<td>await</td>
<td>-</td>
<td>Á≠âÂæÖ‰ªªÂä°ÁªìÊùüÔºåÂ¶ÇÊûú‰ªªÂä°Â§±Ë¥•Ôºå‰∏ç‰ºöÊäõÂºÇÂ∏∏ÔºåËÄåÊòØÈÄöËøáisSuccessÂà§Êñ≠</td>
<td>-</td>
</tr>
<tr>
<td>sync</td>
<td>-</td>
<td>Á≠âÂæÖ‰ªªÂä°ÁªìÊùüÔºåÂ¶ÇÊûú‰ªªÂä°Â§±Ë¥•ÔºåÊäõÂá∫ÂºÇÂ∏∏</td>
<td>-</td>
</tr>
<tr>
<td>isSuccess</td>
<td>-</td>
<td>Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊàêÂäü</td>
<td>-</td>
</tr>
<tr>
<td>cause</td>
<td>-</td>
<td>Ëé∑ÂèñÂ§±Ë¥•‰ø°ÊÅØÔºåÈùûÈòªÂ°ûÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ§±Ë¥•ÔºåËøîÂõûnull</td>
<td>-</td>
</tr>
<tr>
<td>addLinstener</td>
<td>-</td>
<td>Ê∑ªÂä†ÂõûË∞ÉÔºåÂºÇÊ≠•Êé•Êî∂ÁªìÊûú</td>
<td>-</td>
</tr>
<tr>
<td>setSuccess</td>
<td>-</td>
<td>-</td>
<td>ËÆæÁΩÆÊàêÂäüÁªìÊûú</td>
</tr>
<tr>
<td>setFailure</td>
<td>-</td>
<td>-</td>
<td>ËÆæÁΩÆÂ§±Ë¥•ÁªìÊûú</td>
</tr>
</tbody>
</table>
<p>Á§∫‰æã</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ==================================== ÂêåÊ≠•Â§ÑÁêÜ‰ªªÂä°ÊàêÂäü ====================================</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">syncSuccessTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>ExecutionException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>DefaultEventLoop<span style="color:#bbb"> </span>eventExecutors<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultEventLoop();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>DefaultPromise<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>promise<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultPromise<span style="color:#000;font-weight:bold">&lt;&gt;</span>(eventExecutors);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>eventExecutors.<span style="color:#008080">execute</span>(()<span style="color:#000;font-weight:bold">-&gt;</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Thread.<span style="color:#008080">sleep</span>(1000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(InterruptedException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;set success, {}&#34;</span>,10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>promise.<span style="color:#008080">setSuccess</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;start...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;getNow = {}&#34;</span>,promise.<span style="color:#008080">getNow</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// ËøòÊ≤°ÊúâÁªìÊûú</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;get = {}&#34;</span>,promise.<span style="color:#008080">get</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ==================================== ÂºÇÊ≠•Â§ÑÁêÜ‰ªªÂä°ÊàêÂäü ====================================</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">asyncSuccessTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>ExecutionException,<span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>DefaultEventLoop<span style="color:#bbb"> </span>eventExecutors<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultEventLoop();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>DefaultPromise<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>promise<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultPromise<span style="color:#000;font-weight:bold">&lt;&gt;</span>(eventExecutors);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ËÆæÁΩÆÂõûË∞ÉÔºåÂºÇÊ≠•Êé•Êî∂ÁªìÊûú</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>promise.<span style="color:#008080">addListener</span>(future<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;getNow = {}&#34;</span>,<span style="color:#bbb"> </span>future.<span style="color:#008080">getNow</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// Á≠âÂæÖ 1000 ÂêéËÆæÁΩÆÊàêÂäüÁªìÊûú</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>eventExecutors.<span style="color:#008080">execute</span>(()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>Thread.<span style="color:#008080">sleep</span>(1000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(InterruptedException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;set success, {}&#34;</span>,<span style="color:#bbb"> </span>10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>promise.<span style="color:#008080">setSuccess</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log.<span style="color:#008080">info</span>(<span style="color:#d14">&#34;start...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>promise.<span style="color:#008080">await</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="handler--pipeline">Handler &amp; Pipeline</h3>
<p>ChannelHandlerÁî®Êù•Â§ÑÁêÜChannel‰∏äÁöÑÂêÑÁßç‰∫ã‰ª∂ÔºåÂàÜ‰∏∫ÂÖ•Á´ô„ÄÅÂá∫Á´ô‰∏§Áßç„ÄÇÊâÄÊúâChannelHandlerË¢´ËøûÊàê‰∏Ä‰∏≤ÔºåÂ∞±ÊòØPipeline</p>
<ul>
<li>ÂÖ•Á´ôÂ§ÑÁêÜÂô®ÈÄöÂ∏∏ÊòØChannelInboundHandlerAdapterÁöÑÂ≠êÁ±ªÔºå‰∏ªË¶ÅÁî®Êù•ËØªÂèñÂÆ¢Êà∑Á´ØÊï∞ÊçÆÔºåÂÜôÂõûÁªìÊûú</li>
<li>Âá∫Á´ôÂ§ÑÁêÜÂô®ÈÄöÂ∏∏ÊòØChannelOutboundHandlerAdapterÁöÑÂ≠êÁ±ªÔºå‰∏ªË¶ÅÂØπÂÜôÂõûÁªìÊûúËøõË°åÂä†Â∑•</li>
</ul>
<p>ChannelInboundHandlerAdapterÊòØÊåâÁÖßaddLastÁöÑÈ°∫Â∫èÊâßË°åÁöÑÔºåËÄåChannelOutboundHandlerAdapterÊòØÊåâÁÖßaddLastÁöÑÈÄÜÂ∫èÊâßË°åÁöÑ„ÄÇChannelPipelineÁöÑÂÆûÁé∞ÊòØ‰∏Ä‰∏™ChannelHandlerContextÔºàÂåÖË£Ö‰∫Ü ChannelHandlerÔºâÁªÑÊàêÁöÑÂèåÂêëÈìæË°®</p>
<p><img src="/img/netty/Pipeline.png" alt="Pipeline"></p>
<p>ËØªÂèñÊ∂àÊÅØÊâßË°åÈ°∫Â∫èÔºöHead -&gt; In_1 -&gt; In_2 -&gt; Out_1Ôºà‰∏çÂ§ÑÁêÜÔºâ-&gt; Out_2Ôºà‰∏çÂ§ÑÁêÜÔºâ-&gt; Tail</p>
<p>ÂèëÈÄÅÊ∂àÊÅØÊâßË°åÈ°∫Â∫èÔºöTail -&gt;  Out_2 -&gt; Out_1 -&gt; In_2 Ôºà‰∏çÂ§ÑÁêÜÔºâ-&gt; In_1 Ôºà‰∏çÂ§ÑÁêÜÔºâ-&gt; Head</p>
<blockquote>
<p>chx.writeAndFlushÊòØ‰ªéÂΩìÂâç‰ΩçÁΩÆÂêëHeadËøîÂõûÂèëÈÄÅÊï∞ÊçÆ</p>
<p>ch.writeAndFlushÊòØ‰ªéTailÂêëHeadËøîÂõûÂèëÈÄÅÊï∞ÊçÆÔºåÂ¶ÇÊûúÊòØÂú®ChannelOutboundHandlerAdapteËøõË°å‰ºöÊòØÊ≠ªÂæ™ÁéØ</p>
</blockquote>
<h3 id="bytebuf">ByteBuf</h3>
<p>ÊòØÂØπÂ≠óËäÇÊï∞ÊçÆÁöÑÂ∞ÅË£ÖÔºåÊèê‰æõ‰∫ÜÊØîNIO ByteBufferÊõ¥Â•ΩÁöÑ‰ΩøÁî®‰ΩìÈ™å</p>
<p>Ë∞ÉËØïÂáÜÂ§á</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">log</span>(ByteBuf<span style="color:#bbb"> </span>buffer)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>length<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>buffer.<span style="color:#008080">readableBytes</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>length<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">/</span><span style="color:#bbb"> </span>16<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>(length<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">%</span><span style="color:#bbb"> </span>15<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>0<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">?</span><span style="color:#bbb"> </span>0<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>1)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>4;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>StringBuilder<span style="color:#bbb"> </span>buf<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>StringBuilder(rows<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>80<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>2)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">append</span>(<span style="color:#d14">&#34;read index:&#34;</span>).<span style="color:#008080">append</span>(buffer.<span style="color:#008080">readerIndex</span>())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">append</span>(<span style="color:#d14">&#34; write index:&#34;</span>).<span style="color:#008080">append</span>(buffer.<span style="color:#008080">writerIndex</span>())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">append</span>(<span style="color:#d14">&#34; capacity:&#34;</span>).<span style="color:#008080">append</span>(buffer.<span style="color:#008080">capacity</span>())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">append</span>(<span style="color:#d14">&#34; class:&#34;</span>).<span style="color:#008080">append</span>(buffer.<span style="color:#008080">getClass</span>())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>.<span style="color:#008080">append</span>(NEWLINE);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBufUtil.<span style="color:#008080">appendPrettyHexDump</span>(buf,<span style="color:#bbb"> </span>buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(buf.<span style="color:#008080">toString</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>1ÔºâÂàõÂª∫</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">byteBufTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ÈªòËÆ§ÂàõÂª∫ÁöÑÊòØÊ±†ÂåñÁöÑÁõ¥Êé•ÂÜÖÂ≠ò</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// read index:0 write index:0 capacity:10 class:class io.netty.buffer.PooledUnsafeDirectByteBuf</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>log(buffer);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2ÔºâÁõ¥Êé•ÂÜÖÂ≠ò vs Â†ÜÂÜÖÂ≠ò</strong></p>
<p>ÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÊù•ÂàõÂª∫Ê±†ÂåñÂü∫‰∫éÂ†ÜÁöÑ ByteBuf</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ByteBuf<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">heapBuffer</span>(10);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰πüÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÊù•ÂàõÂª∫Ê±†ÂåñÂü∫‰∫éÁõ¥Êé•ÂÜÖÂ≠òÁöÑ ByteBuf</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ByteBuf<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">directBuffer</span>(10);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áõ¥Êé•ÂÜÖÂ≠òÂàõÂª∫ÂíåÈîÄÊØÅÁöÑ‰ª£‰ª∑ÊòÇË¥µÔºå‰ΩÜËØªÂÜôÊÄßËÉΩÈ´òÔºàÂ∞ë‰∏ÄÊ¨°ÂÜÖÂ≠òÂ§çÂà∂ÔºâÔºåÈÄÇÂêàÈÖçÂêàÊ±†ÂåñÂäüËÉΩ‰∏ÄËµ∑Áî®</li>
<li>Áõ¥Êé•ÂÜÖÂ≠òÂØπ GC ÂéãÂäõÂ∞èÔºåÂõ†‰∏∫ËøôÈÉ®ÂàÜÂÜÖÂ≠ò‰∏çÂèó JVM ÂûÉÂúæÂõûÊî∂ÁöÑÁÆ°ÁêÜÔºå‰ΩÜ‰πüË¶ÅÊ≥®ÊÑèÂèäÊó∂‰∏ªÂä®ÈáäÊîæ</li>
</ul>
<p><strong>3ÔºâÊ±†Âåñ vs ÈùûÊ±†Âåñ</strong></p>
<p>Ê±†ÂåñÁöÑÊúÄÂ§ßÊÑè‰πâÂú®‰∫éÂèØ‰ª•ÈáçÁî® ByteBufÔºå‰ºòÁÇπÊúâ</p>
<ul>
<li>Ê≤°ÊúâÊ±†ÂåñÔºåÂàôÊØèÊ¨°ÈÉΩÂæóÂàõÂª∫Êñ∞ÁöÑ ByteBuf ÂÆû‰æãÔºåËøô‰∏™Êìç‰ΩúÂØπÁõ¥Êé•ÂÜÖÂ≠ò‰ª£‰ª∑ÊòÇË¥µÔºåÂ∞±ÁÆóÊòØÂ†ÜÂÜÖÂ≠òÔºå‰πü‰ºöÂ¢ûÂä† GC ÂéãÂäõ</li>
<li>Êúâ‰∫ÜÊ±†ÂåñÔºåÂàôÂèØ‰ª•ÈáçÁî®Ê±†‰∏≠ ByteBuf ÂÆû‰æãÔºåÂπ∂‰∏îÈááÁî®‰∫Ü‰∏é jemalloc Á±ª‰ººÁöÑÂÜÖÂ≠òÂàÜÈÖçÁÆóÊ≥ïÊèêÂçáÂàÜÈÖçÊïàÁéá</li>
<li>È´òÂπ∂ÂèëÊó∂ÔºåÊ±†ÂåñÂäüËÉΩÊõ¥ËäÇÁ∫¶ÂÜÖÂ≠òÔºåÂáèÂ∞ëÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑÂèØËÉΩ</li>
</ul>
<p>Ê±†ÂåñÂäüËÉΩÊòØÂê¶ÂºÄÂêØÔºåÂèØ‰ª•ÈÄöËøáÁ≥ªÁªüÁéØÂ¢ÉÂèòÈáèÊù•ËÆæÁΩÆ<code>-Dio.netty.allocator.type={unpooled|pooled}</code></p>
<ul>
<li>4.1 ‰ª•ÂêéÔºåÈùû Android Âπ≥Âè∞ÈªòËÆ§ÂêØÁî®Ê±†ÂåñÂÆûÁé∞ÔºåAndroid Âπ≥Âè∞ÂêØÁî®ÈùûÊ±†ÂåñÂÆûÁé∞</li>
<li>4.1 ‰πãÂâçÔºåÊ±†ÂåñÂäüËÉΩËøò‰∏çÊàêÁÜüÔºåÈªòËÆ§ÊòØÈùûÊ±†ÂåñÂÆûÁé∞</li>
</ul>
<p><strong>4ÔºâÁªÑÊàê</strong></p>
<p><img src="/img/netty/ByteBuf.png" alt="ByteBuf"></p>
<p><strong>5ÔºâÂÜôÂÖ•</strong></p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÁ≠æÂêç</th>
<th>Âê´‰πâ</th>
<th>Â§áÊ≥®</th>
</tr>
</thead>
<tbody>
<tr>
<td>writeBoolean(boolean value)</td>
<td>ÂÜôÂÖ• boolean ÂÄº</td>
<td>Áî®‰∏ÄÂ≠óËäÇ 01|00 ‰ª£Ë°® true|false</td>
</tr>
<tr>
<td>writeByte(int value)</td>
<td>ÂÜôÂÖ• byte ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeShort(int value)</td>
<td>ÂÜôÂÖ• short ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeInt(int value)</td>
<td>ÂÜôÂÖ• int ÂÄº</td>
<td>Big EndianÔºåÂç≥ 0x250ÔºåÂÜôÂÖ•Âêé 00 00 02 50</td>
</tr>
<tr>
<td>writeIntLE(int value)</td>
<td>ÂÜôÂÖ• int ÂÄº</td>
<td>Little EndianÔºåÂç≥ 0x250ÔºåÂÜôÂÖ•Âêé 50 02 00 00</td>
</tr>
<tr>
<td>writeLong(long value)</td>
<td>ÂÜôÂÖ• long ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeChar(int value)</td>
<td>ÂÜôÂÖ• char ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeFloat(float value)</td>
<td>ÂÜôÂÖ• float ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeDouble(double value)</td>
<td>ÂÜôÂÖ• double ÂÄº</td>
<td></td>
</tr>
<tr>
<td>writeBytes(ByteBuf src)</td>
<td>ÂÜôÂÖ• netty ÁöÑ ByteBuf</td>
<td></td>
</tr>
<tr>
<td>writeBytes(byte[] src)</td>
<td>ÂÜôÂÖ• byte[]</td>
<td></td>
</tr>
<tr>
<td>writeBytes(ByteBuffer src)</td>
<td>ÂÜôÂÖ• nio ÁöÑ ByteBuffer</td>
<td></td>
</tr>
<tr>
<td>int writeCharSequence(CharSequence sequence, Charset charset)</td>
<td>ÂÜôÂÖ•Â≠óÁ¨¶‰∏≤</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>6ÔºâÊâ©ÂÆπ</strong></p>
<p>ByteBufÂÖ∑ÊúâËá™Âä®Êâ©ÂÆπËÉΩÂäõÔºåËßÑÂàôÊòØ</p>
<ul>
<li>Â¶Ç‰ΩïÂÜôÂÖ•ÂêéÊï∞ÊçÆÂ§ßÂ∞èÊú™Ë∂ÖËøá 512ÔºåÂàôÈÄâÊã©‰∏ã‰∏Ä‰∏™16ÁöÑÊï¥Êï∞ÂÄçÔºå‰æãÂ¶ÇÂÜôÂÖ•ÂêéÂ§ßÂ∞è‰∏∫12 ÔºåÂàôÊâ©ÂÆπÂêécapacityÊòØ16</li>
<li>Â¶ÇÊûúÂÜôÂÖ•ÂêéÊï∞ÊçÆÂ§ßÂ∞èË∂ÖËøá512ÔºåÂàôÈÄâÊã©‰∏ã‰∏Ä‰∏™ 2^nÔºå‰æãÂ¶ÇÂÜôÂÖ•ÂêéÂ§ßÂ∞è‰∏∫513ÔºåÂàôÊâ©ÂÆπÂêé capacityÊòØ2^10=1024Ôºà2^9=512 Â∑≤Áªè‰∏çÂ§ü‰∫ÜÔºâ</li>
<li>Êâ©ÂÆπ‰∏çËÉΩË∂ÖËøámax capacityÂê¶ÂàôÊä•Èîô</li>
</ul>
<p><strong>7ÔºâËØªÂèñ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">byteBufReadTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">writeBytes</span>(<span style="color:#d14">&#34;ABCDEFG&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ËØªÂèñÔºåÂΩ±ÂìçËØªÊåáÈíà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// A</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// B</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// C</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// D</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// markÊ†áËÆ∞ËØªÊåáÈíà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">markReaderIndex</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// E</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// F</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ËØªÊåáÈíàÂ§ç‰Ωç</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer.<span style="color:#008080">resetReaderIndex</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">readByte</span>());<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// E</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// getÊñπÊ≥ï‰∏çÂΩ±ÂìçÊåáÈíà</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>((<span style="color:#458;font-weight:bold">char</span>)buffer.<span style="color:#008080">getByte</span>(0));<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">// A</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>8Ôºâretain &amp; release</strong></p>
<p>Áî±‰∫éNetty‰∏≠ÊúâÂ†ÜÂ§ñÂÜÖÂ≠òÁöÑByteBufÂÆûÁé∞ÔºåÂ†ÜÂ§ñÂÜÖÂ≠òÊúÄÂ•ΩÊòØÊâãÂä®Êù•ÈáäÊîæÔºåËÄå‰∏çÊòØÁ≠âGCÂûÉÂúæÂõûÊî∂</p>
<ul>
<li>UnpooledHeapByteBuf ‰ΩøÁî®ÁöÑÊòØ JVM ÂÜÖÂ≠òÔºåÂè™ÈúÄÁ≠â GC ÂõûÊî∂ÂÜÖÂ≠òÂç≥ÂèØ</li>
<li>UnpooledDirectByteBuf ‰ΩøÁî®ÁöÑÂ∞±ÊòØÁõ¥Êé•ÂÜÖÂ≠ò‰∫ÜÔºåÈúÄË¶ÅÁâπÊÆäÁöÑÊñπÊ≥ïÊù•ÂõûÊî∂ÂÜÖÂ≠ò</li>
<li>PooledByteBuf ÂíåÂÆÉÁöÑÂ≠êÁ±ª‰ΩøÁî®‰∫ÜÊ±†ÂåñÊú∫Âà∂ÔºåÈúÄË¶ÅÊõ¥Â§çÊùÇÁöÑËßÑÂàôÊù•ÂõûÊî∂ÂÜÖÂ≠ò</li>
</ul>
<p>Netty ËøôÈáåÈááÁî®‰∫ÜÂºïÁî®ËÆ°Êï∞Ê≥ïÊù•ÊéßÂà∂ÂõûÊî∂ÂÜÖÂ≠òÔºåÊØè‰∏™ ByteBuf ÈÉΩÂÆûÁé∞‰∫Ü ReferenceCounted Êé•Âè£</p>
<ul>
<li>ÊØè‰∏™ByteBufÂØπË±°ÁöÑÂàùÂßãËÆ°Êï∞‰∏∫ 1</li>
<li>Ë∞ÉÁî®releaseÊñπÊ≥ïËÆ°Êï∞Âáè 1ÔºåÂ¶ÇÊûúËÆ°Êï∞‰∏∫0ÔºåByteBufÂÜÖÂ≠òË¢´ÂõûÊî∂</li>
<li>Ë∞ÉÁî®retainÊñπÊ≥ïËÆ°Êï∞Âä† 1ÔºåË°®Á§∫Ë∞ÉÁî®ËÄÖÊ≤°Áî®ÂÆå‰πãÂâçÔºåÂÖ∂ÂÆÉhandlerÂç≥‰ΩøË∞ÉÁî®‰∫Ürelease‰πü‰∏ç‰ºöÈÄ†ÊàêÂõûÊî∂</li>
<li>ÂΩìËÆ°Êï∞‰∏∫0Êó∂ÔºåÂ∫ïÂ±ÇÂÜÖÂ≠ò‰ºöË¢´ÂõûÊî∂ÔºåËøôÊó∂Âç≥‰ΩøByteBufÂØπË±°ËøòÂú®ÔºåÂÖ∂ÂêÑ‰∏™ÊñπÊ≥ïÂùáÊó†Ê≥ïÊ≠£Â∏∏‰ΩøÁî®</li>
</ul>
<p>Âõ†‰∏∫pipelineÁöÑÂ≠òÂú®Ôºå‰∏ÄËà¨ÈúÄË¶ÅÂ∞ÜByteBuf‰º†ÈÄíÁªô‰∏ã‰∏Ä‰∏™ChannelHandlerÔºåÊâÄ‰ª•Âü∫Êú¨ËßÑÂàôÊòØÔºå<strong>Ë∞ÅÊòØÊúÄÂêé‰ΩøÁî®ËÄÖÔºåË∞ÅË¥üË¥£ release</strong>ÔºåÂç≥TailContextË¥üË¥£ÈáäÊîæ</p>
<p><strong>9Ôºâslice</strong></p>
<p>„ÄêÈõ∂Êã∑Ë¥ù„ÄëÁöÑ‰ΩìÁé∞‰πã‰∏ÄÔºåÂØπÂéüÂßãByteBufËøõË°åÂàáÁâáÊàêÂ§ö‰∏™ByteBufÔºåËøòÊòØ‰ΩøÁî®ÂéüÂßãByteBufÁöÑÂÜÖÂ≠òÔºåÂàáÁâáÂêéÁöÑByteBufÁª¥Êä§Áã¨Á´ãÁöÑreadÔºåwriteÊåáÈíà</p>
<p><img src="/img/netty/slice.png" alt="slice"></p>
<p><strong>10Ôºâduplicate</strong></p>
<p>„ÄêÈõ∂Êã∑Ë¥ù„ÄëÁöÑ‰ΩìÁé∞‰πã‰∏ÄÔºåÊà™Âèñ‰∫ÜÂéüÂßãByteBufÊâÄÊúâÂÜÖÂÆπÔºåÂπ∂‰∏îÊ≤°Êúâmax capacityÁöÑÈôêÂà∂Ôºå‰πüÊòØ‰∏éÂéüÂßãByteBuf‰ΩøÁî®Âêå‰∏ÄÂùóÂ∫ïÂ±ÇÂÜÖÂ≠òÔºåÂè™ÊòØËØªÂÜôÊåáÈíàÊòØÁã¨Á´ãÁöÑ</p>
<p><img src="/img/netty/duplicate.png" alt="duplicate"></p>
<p><strong>11Ôºâcopy</strong></p>
<p>‰ºöÂ∞ÜÂ∫ïÂ±ÇÂÜÖÂ≠òÊï∞ÊçÆËøõË°åÊ∑±Êã∑Ë¥ùÔºåÂõ†Ê≠§Êó†ËÆ∫ËØªÂÜôÔºåÈÉΩ‰∏éÂéüÂßã ByteBuf Êó†ÂÖ≥</p>
<p><strong>12ÔºâCompositeByteBuf</strong></p>
<p>„ÄêÈõ∂Êã∑Ë¥ù„ÄëÁöÑ‰ΩìÁé∞‰πã‰∏ÄÔºåÂ∞ÜÂ§ö‰∏™ByteBufÂêàÂπ∂‰∏∫‰∏Ä‰∏™ÈÄªËæë‰∏äÁöÑByteBufÔºåÈÅøÂÖçÊã∑Ë¥ù„ÄÇCompositeByteBufÊòØ‰∏Ä‰∏™ÁªÑÂêàÁöÑByteBufÔºåÂÆÉÂÜÖÈÉ®Áª¥Êä§‰∫Ü‰∏Ä‰∏™ComponentÊï∞ÁªÑÔºåÊØè‰∏™ComponentÁÆ°ÁêÜ‰∏Ä‰∏™ByteBufÔºåËÆ∞ÂΩï‰∫ÜËøô‰∏™ByteBuf Áõ∏ÂØπ‰∫éÊï¥‰ΩìÂÅèÁßªÈáèÁ≠â‰ø°ÊÅØÔºå‰ª£Ë°®ÁùÄÊï¥‰Ωì‰∏≠Êüê‰∏ÄÊÆµÁöÑÊï∞ÊçÆ„ÄÇ</p>
<p><img src="/img/netty/CompositeByteBuf.png" alt="CompositeByteBuf"></p>
<p><strong>13ÔºâUnpooled</strong></p>
<p>Unpooled ÊòØ‰∏Ä‰∏™Â∑•ÂÖ∑Á±ªÔºåÁ±ªÂ¶ÇÂÖ∂ÂêçÔºåÊèê‰æõ‰∫ÜÈùûÊ±†ÂåñÁöÑ ByteBuf ÂàõÂª∫„ÄÅÁªÑÂêà„ÄÅÂ§çÂà∂Á≠âÊìç‰Ωú</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">byteBufUnpooledTest</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Unpooled.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer1.<span style="color:#008080">release</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer2<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Unpooled.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer2.<span style="color:#008080">release</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(buffer1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>buffer2);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer3<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer3.<span style="color:#008080">release</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ByteBuf<span style="color:#bbb"> </span>buffer4<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>ByteBufAllocator.<span style="color:#008080">DEFAULT</span>.<span style="color:#008080">buffer</span>(10);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>buffer4.<span style="color:#008080">release</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(buffer3<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>buffer4);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ByteBuf ‰ºòÂäø</strong></p>
<ul>
<li>Ê±†Âåñ - ÂèØ‰ª•ÈáçÁî®Ê±†‰∏≠ ByteBuf ÂÆû‰æãÔºåÊõ¥ËäÇÁ∫¶ÂÜÖÂ≠òÔºåÂáèÂ∞ëÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑÂèØËÉΩ</li>
<li>ËØªÂÜôÊåáÈíàÂàÜÁ¶ªÔºå‰∏çÈúÄË¶ÅÂÉè ByteBuffer ‰∏ÄÊ†∑ÂàáÊç¢ËØªÂÜôÊ®°Âºè</li>
<li>ÂèØ‰ª•Ëá™Âä®Êâ©ÂÆπ</li>
<li>ÊîØÊåÅÈìæÂºèË∞ÉÁî®Ôºå‰ΩøÁî®Êõ¥ÊµÅÁïÖ</li>
<li>ÂæàÂ§öÂú∞Êñπ‰ΩìÁé∞Èõ∂Êã∑Ë¥ùÔºå‰æãÂ¶Ç slice„ÄÅduplicate„ÄÅCompositeByteBuf</li>
</ul>
<h2 id="‰∏ânettyÈ´òÁ∫ßÁî®Ê≥ï">‰∏â„ÄÅNettyÈ´òÁ∫ßÁî®Ê≥ï</h2>
<h3 id="Á≤òÂåÖ‰∏éÂçäÂåÖ">Á≤òÂåÖ‰∏éÂçäÂåÖ</h3>
<p>Á≤òÂåÖÂíåÂçäÂåÖÁöÑÁé∞Ë±°ÊòØ<a href="#bound">Ê∂àÊÅØËæπÁïå</a>ÁöÑÂè¶‰∏ÄÁßçËØ¥Ê≥ï</p>
<p>Á≤òÂåÖ</p>
<ul>
<li>Áé∞Ë±°ÔºöÂèëÈÄÅ abc defÔºåÊé•Êî∂ abcdef</li>
<li>ÂéüÂõ†
<ul>
<li>Â∫îÁî®Â±ÇÔºöÊé•Êî∂ÊñπByteBufËÆæÁΩÆÂ§™Â§ßÔºàNettyÈªòËÆ§1024Ôºâ</li>
<li>ÊªëÂä®Á™óÂè£ÔºöÂÅáËÆæÂèëÈÄÅÊñπ256bytesË°®Á§∫‰∏Ä‰∏™ÂÆåÊï¥Êä•ÊñáÔºå‰ΩÜÁî±‰∫éÊé•Êî∂ÊñπÂ§ÑÁêÜ‰∏çÂèäÊó∂‰∏îÁ™óÂè£Â§ßÂ∞èË∂≥Â§üÂ§ßÔºåËøô256bytes Â≠óËäÇÂ∞±‰ºöÁºìÂÜ≤Âú®Êé•Êî∂ÊñπÁöÑÊªëÂä®Á™óÂè£‰∏≠ÔºåÂΩìÊªëÂä®Á™óÂè£‰∏≠ÁºìÂÜ≤‰∫ÜÂ§ö‰∏™Êä•ÊñáÂ∞±‰ºöÁ≤òÂåÖ</li>
<li>NagleÁÆóÊ≥ïÔºö‰ºöÈÄ†ÊàêÁ≤òÂåÖ</li>
</ul>
</li>
</ul>
<p>ÂçäÂåÖ</p>
<ul>
<li>Áé∞Ë±°ÔºöÂèëÈÄÅ abcdefÔºåÊé•Êî∂ abc def</li>
<li>ÂéüÂõ†
<ul>
<li>Â∫îÁî®Â±ÇÔºöÊé•Êî∂ÊñπByteBufÂ∞è‰∫éÂÆûÈôÖÂèëÈÄÅÊï∞ÊçÆÈáè</li>
<li>ÊªëÂä®Á™óÂè£ÔºöÂÅáËÆæÊé•Êî∂ÊñπÁöÑÁ™óÂè£Âè™Ââ©‰∫Ü128bytesÔºåÂèëÈÄÅÊñπÁöÑÊä•ÊñáÂ§ßÂ∞èÊòØ256bytesÔºåËøôÊó∂Êîæ‰∏ç‰∏ã‰∫ÜÔºåÂè™ËÉΩÂÖàÂèëÈÄÅÂâç128bytesÔºåÁ≠âÂæÖackÂêéÊâçËÉΩÂèëÈÄÅÂâ©‰ΩôÈÉ®ÂàÜÔºåËøôÂ∞±ÈÄ†Êàê‰∫ÜÂçäÂåÖ</li>
<li>MSSÈôêÂà∂ÔºöÂΩìÂèëÈÄÅÁöÑÊï∞ÊçÆË∂ÖËøáMSSÈôêÂà∂ÂêéÔºå‰ºöÂ∞ÜÊï∞ÊçÆÂàáÂàÜÂèëÈÄÅÔºåÂ∞±‰ºöÈÄ†ÊàêÂçäÂåÖ</li>
</ul>
</li>
</ul>
<blockquote>
<p>Nagle ÁÆóÊ≥ï</p>
<p>Âç≥‰ΩøÂèëÈÄÅ‰∏Ä‰∏™Â≠óËäÇÔºå‰πüÈúÄË¶ÅÂä†ÂÖ•tcpÂ§¥ÂíåipÂ§¥Ôºå‰πüÂ∞±ÊòØÊÄªÂ≠óËäÇÊï∞‰ºö‰ΩøÁî®41bytesÔºåÈùûÂ∏∏‰∏çÁªèÊµé„ÄÇÂõ†Ê≠§‰∏∫‰∫ÜÊèêÈ´òÁΩëÁªúÂà©Áî®ÁéáÔºåtcpÂ∏åÊúõÂ∞ΩÂèØËÉΩÂèëÈÄÅË∂≥Â§üÂ§ßÁöÑÊï∞ÊçÆÔºåËøôÂ∞±ÊòØ Nagle ÁÆóÊ≥ï‰∫ßÁîüÁöÑÁºòÁî±ÔºåËØ•ÁÆóÊ≥ïÊòØÊåáÂèëÈÄÅÁ´ØÂç≥‰ΩøËøòÊúâÂ∫îËØ•ÂèëÈÄÅÁöÑÊï∞ÊçÆÔºå‰ΩÜÂ¶ÇÊûúËøôÈÉ®ÂàÜÊï∞ÊçÆÂæàÂ∞ëÁöÑËØùÔºåÂàôËøõË°åÂª∂ËøüÂèëÈÄÅ</p>
</blockquote>
<blockquote>
<p>MSSÈôêÂà∂</p>
<p>MSSÁöÑÂÄºÂú®‰∏âÊ¨°Êè°ÊâãÊó∂ÈÄöÁü•ÂØπÊñπËá™Â∑±MSSÁöÑÂÄº„ÄêÁΩëÂç°ÁöÑ‰º†ËæìËÉΩÂäõ„ÄëÔºåÁÑ∂ÂêéÂú®‰∏§ËÄÖ‰πãÈó¥ÈÄâÊã©‰∏Ä‰∏™Â∞èÂÄº‰Ωú‰∏∫MSS</p>
</blockquote>
<p><strong>NettyËß£ÂÜ≥ÁöÑÈÄîÂæÑ</strong></p>
<p>Âõ∫ÂÆöÈïøÂ∫¶</p>
<p>ËÆ©ÊâÄÊúâÊï∞ÊçÆÂåÖÈïøÂ∫¶Âõ∫ÂÆö</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>FixedLengthFrameDecoder(8));<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Áº∫ÁÇπÔºö</p>
<ol>
<li>ÈïøÂ∫¶ÂÆöÁöÑÂ§™Â§ßÔºåÊµ™Ë¥π</li>
<li>ÈïøÂ∫¶ÂÆöÁöÑÂ§™Â∞èÔºåÂØπÊüê‰∫õÊï∞ÊçÆÂåÖÂèàÊòæÂæó‰∏çÂ§ü</li>
</ol>
<hr>
<p>Âõ∫ÂÆöÂàÜÈöîÁ¨¶</p>
<p>ÊúçÂä°Á´ØÂä†ÂÖ•ÔºåÈªòËÆ§‰ª•<code>\n</code>Êàñ<code>\r\n</code>‰Ωú‰∏∫ÂàÜÈöîÁ¨¶ÔºåÂ¶ÇÊûúË∂ÖÂá∫ÊåáÂÆöÈïøÂ∫¶‰ªçÊú™Âá∫Áé∞ÂàÜÈöîÁ¨¶ÔºåÂàôÊäõÂá∫ÂºÇÂ∏∏</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>LineBasedFrameDecoder(1024));<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Áº∫ÁÇπÔºöÂ§ÑÁêÜÂ≠óÁ¨¶Êï∞ÊçÆÊØîËæÉÂêàÈÄÇÔºå‰ΩÜÂ¶ÇÊûúÂÜÖÂÆπÊú¨Ë∫´ÂåÖÂê´‰∫ÜÂàÜÈöîÁ¨¶ÔºàÂ≠óËäÇÊï∞ÊçÆÂ∏∏Â∏∏‰ºöÊúâÊ≠§ÊÉÖÂÜµÔºâÔºåÈÇ£‰πàÂ∞±‰ºöËß£ÊûêÈîôËØØ</p>
<hr>
<p>È¢ÑËÆæÈïøÂ∫¶</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ÊúÄÂ§ßÈïøÂ∫¶ÔºåÈïøÂ∫¶ÂÅèÁßªÔºåÈïøÂ∫¶Âç†Áî®Â≠óËäÇÔºåÈïøÂ∫¶Ë∞ÉÊï¥ÔºåÂâ•Á¶ªÂ≠óËäÇÊï∞</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>LengthFieldBasedFrameDecoder(1024,<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>1,<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>1));<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂøÉË∑≥Êú∫Âà∂">ÂøÉË∑≥Êú∫Âà∂</h3>
<p>ÂèØ‰ª•‰ΩøÁî®<code>IdleStateHandler</code>ÂèëÈÄÅÂøÉË∑≥Ôºå‰πüÂèØ‰ª•Ëá™ÂÆö‰πâÂèëÈÄÅÂøÉË∑≥</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * readerIdleTime ËØªÁ©∫Èó≤Êó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * writerIdleTime ÂÜôÁ©∫Èó≤Êó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * allIdleTime ÊâÄÊúâÁ©∫Èó≤Êó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * unit Êó∂Èó¥Âçï‰Ωç
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>pipeline.<span style="color:#008080">addLast</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>IdleStateHandler(0,<span style="color:#bbb"> </span>5,<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>TimeUnit.<span style="color:#008080">SECONDS</span>));<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÁºñÁ†Å">ÁºñÁ†Å</h3>
<p>NettyÁºñËß£Á†ÅÊäÄÊúØÔºàÂ∞±ÊòØÊåáÂ∫èÂàóÂåñ‰º†ÈÄíÂØπË±°ÔºâÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®JavaËøõË°åÂØπË±°Â∫èÂàóÂåñÔºånettyÂéª‰º†ËæìÔºå‰ΩÜÊòØJavaÂ∫èÂàóÂåñÊ≤°Ê≥ïË∑®ËØ≠Ë®ÄÔºåÂ≠òÂú®Â∫èÂàóÂåñÂêéÁöÑÁ†ÅÊµÅÂ§™Â§ßÔºåÂ∫èÂàóÂåñÊÄßËÉΩÂ§™‰ΩéÁ≠â„ÄÇ</p>
<p>‰∏ªÊµÅÁöÑÁºñËß£Á†ÅÊ°ÜÊû∂</p>
<ul>
<li>JBossÁöÑMarshalling</li>
<li>googleÁöÑProtoBuf</li>
<li>Âü∫‰∫éProtobufÁöÑKyro</li>
<li>MessagePackÊ°ÜÊû∂</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//======================================= ÈõÜÊàêMarshalling =======================================</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MarshallingCodeFactory</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span>MarshallingDecoder<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">bulidMarshallingDecoder</span>(){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//È¶ñÂÖàÈÄöËøáMarshallingÂ∑•ÂÖ∑Á±ªËé∑ÂèñMarshallingÂÆû‰æãÂØπË±°ÔºåÂèÇÊï∞serialÊ†áËØÜÂàõÂª∫ÁöÑÊòØjavaÂ∫èÂàóÂåñÂ∑•ÂéÇÂØπË±°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallerFactory<span style="color:#bbb"> </span>marshallerFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Marshalling.<span style="color:#008080">getProvidedMarshallerFactory</span>(<span style="color:#d14">&#34;serial&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//ÂàõÂª∫‰∫ÜMarshallingConfigurationÂØπË±°ÔºåÈÖçÁΩÆÁâàÊú¨Âè∑‰∏∫5</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallingConfiguration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MarshallingConfiguration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>configuration.<span style="color:#008080">setVersion</span>(5);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//Ê†πÊçÆmarshallerFactoryÂ•ΩConfigurationÂàõÂª∫provider</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>UnmarshallerProvider<span style="color:#bbb"> </span>provider<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultUnmarshallerProvider(marshallerFactory,<span style="color:#bbb"> </span>configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//ÊûÑÂª∫NettyÁöÑMarshallingDecoderÂØπË±°Ôºå‰ø©‰∏™ÂèÇÊï∞ÂàÜÂà´‰∏∫providerÂíåÂçï‰∏™Ê∂àÊÅØÂ∫èÂàóÂåñÂêéÁöÑÊúÄÂ§ßÈïøÂ∫¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallingDecoder<span style="color:#bbb"> </span>decoder<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MarshallingDecoder(provider,<span style="color:#bbb"> </span>1024<span style="color:#000;font-weight:bold">*</span>1024);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>decoder;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span>MarshallingEncoder<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">bulidMarshallingEncoder</span>(){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallerFactory<span style="color:#bbb"> </span>marshallerFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Marshalling.<span style="color:#008080">getProvidedMarshallerFactory</span>(<span style="color:#d14">&#34;serial&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallingConfiguration<span style="color:#bbb"> </span>configuration<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MarshallingConfiguration();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>configuration.<span style="color:#008080">setVersion</span>(5);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallerProvider<span style="color:#bbb"> </span>provider<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>DefaultMarshallerProvider(marshallerFactory,<span style="color:#bbb"> </span>configuration);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MarshallingEncoder<span style="color:#bbb"> </span>encoder<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MarshallingEncoder(provider);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>encoder;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®ÈÉΩÂä†‰∏äMarshallingÁºñËß£Á†ÅÂô®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">initChannel</span>(SocketChannel<span style="color:#bbb"> </span>ch)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//Ê≥®ÊÑèÈ°∫Â∫è</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(MarshallingCodeFactory.<span style="color:#008080">bulidMarshallingDecoder</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ch.<span style="color:#008080">pipeline</span>().<span style="color:#008080">addLast</span>(MarshallingCodeFactory.<span style="color:#008080">bulidMarshallingEncoder</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nettyÊèê‰æõÁöÑ‰∏ªË¶ÅtcpÂèÇÊï∞">NettyÊèê‰æõÁöÑ‰∏ªË¶ÅTCPÂèÇÊï∞</h3>
<table>
<thead>
<tr>
<th>ÂèÇÊï∞</th>
<th>Ëß£Èáä</th>
</tr>
</thead>
<tbody>
<tr>
<td>SO_TIMEOUT</td>
<td>ÊéßÂà∂ËØªÂèñÊìç‰ΩúÂ∞ÜÈòªÂ°ûÂ§öÂ∞ëÊØ´Áßí„ÄÇÂ¶ÇÊûúËøîÂõûÂÄº‰∏∫0ÔºåËÆ°Êó∂Âô®Â∞±Ë¢´Á¶ÅÊ≠¢‰∫ÜÔºåËØ•Á∫øÁ®ãÂ∞ÜÊó†ÈôêÊúüÈòªÂ°û</td>
</tr>
<tr>
<td>SO_SNDBUF</td>
<td>Â•óÊé•Â≠ó‰ΩøÁî®ÁöÑÂèëÈÄÅÁºìÂÜ≤Âå∫Â§ßÂ∞è</td>
</tr>
<tr>
<td>SO_RCVBUF</td>
<td>Â•óÊé•Â≠ó‰ΩøÁî®ÁöÑÊé•Êî∂ÁºìÂÜ≤Âå∫Â§ßÂ∞è</td>
</tr>
<tr>
<td>CONNECTTIMEOUTMILLIS</td>
<td>ÂÆ¢Êà∑Á´ØËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºåÁî±‰∫éNIOÂéüÁîüÁöÑÂÆ¢Êà∑Á´ØÂπ∂‰∏çÊèê‰æõËÆæÁΩÆËøûÊé•Ë∂ÖÊó∂ÁöÑÊé•Âè£„ÄÇ<br />Âõ†Ê≠§ÔºåNettyÈááÁî®ÁöÑÊòØËá™ÂÆö‰πâËøûÊé•Ë∂ÖÊó∂ÂÆöÊó∂Âô®Ë¥üË¥£Ê£ÄÊµãÂíåË∂ÖÊó∂ÊéßÂà∂</td>
</tr>
<tr>
<td>TCPNODELAY</td>
<td>ÊøÄÊ¥ªÊàñÁ¶ÅÊ≠¢TCPNODELAYÂ•óÊé•Â≠óÈÄâÈ°πÔºåÂÆÉÂÜ≥ÂÆöÊòØÂê¶‰ΩøÁî®NagleÁÆóÊ≥ï„ÄÇÂ¶ÇÊûúÊòØÊó∂Âª∂ÊïèÊÑüÂûãÁöÑÂ∫îÁî®ÔºåÂª∫ËÆÆÂÖ≥Èó≠NagleÁÆóÊ≥ï</td>
</tr>
</tbody>
</table>

    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">üïäÔ∏è</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
