<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="RabbitMQçš„ä½¿ç”¨ - https://hobocat.github.io/post/mq/2019-11-28-rabbitmq/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>RabbitMQçš„ä½¿ç”¨</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">RabbitMQçš„ä½¿ç”¨</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2019-11-28&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            12898 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            26 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»">ä¸€ã€ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»</a>
      <ul>
        <li><a href="#activemq">ActiveMQ</a></li>
        <li><a href="#kafka">Kafka</a></li>
        <li><a href="#rocketmq">RocketMQ</a></li>
        <li><a href="#rabbitmq">RabbitMQ</a></li>
      </ul>
    </li>
    <li><a href="#äºŒamqpåè®®">äºŒã€AMQPåè®®</a>
      <ul>
        <li><a href="#amqp-ä¸­åŒ…å«çš„ä¸»è¦å…ƒç´ ">AMQP ä¸­åŒ…å«çš„ä¸»è¦å…ƒç´ </a></li>
        <li><a href="#amqpåè®®æ¨¡å‹">AMQPåè®®æ¨¡å‹</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰rabbitå®‰è£…åŸºæœ¬å‘½ä»¤">ä¸‰ã€Rabbitå®‰è£…&amp;åŸºæœ¬å‘½ä»¤</a>
      <ul>
        <li><a href="#å®‰è£…erlang">å®‰è£…Erlang</a></li>
        <li><a href="#å®‰è£…rabbitmq">å®‰è£…RabbitMQ</a></li>
        <li><a href="#å®‰è£…webç®¡ç†ç•Œé¢">å®‰è£…Webç®¡ç†ç•Œé¢</a></li>
        <li><a href="#åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</a></li>
      </ul>
    </li>
    <li><a href="#å››java-clientçš„ç®€å•ä½¿ç”¨">å››ã€Java Clientçš„ç®€å•ä½¿ç”¨</a></li>
    <li><a href="#äº”exchangeäº¤æ¢æœº">äº”ã€Exchangeäº¤æ¢æœº</a>
      <ul>
        <li><a href="#direct-exchange">Direct Exchange</a></li>
        <li><a href="#topic-exchange">Topic Exchange</a></li>
        <li><a href="#fanout-exchange">Fanout Exchange</a></li>
        <li><a href="#headers-exchange">Headers Exchange</a></li>
      </ul>
    </li>
    <li><a href="#å…­message">å…­ã€Message</a>
      <ul>
        <li><a href="#messageä¿¡æ¯">Messageä¿¡æ¯</a></li>
        <li><a href="#æ¶ˆæ¯ç¡®è®¤æœºåˆ¶">æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</a></li>
        <li><a href="#æ¶ˆæ¯è¿”å›æœºåˆ¶">æ¶ˆæ¯è¿”å›æœºåˆ¶</a></li>
        <li><a href="#ttlæ¶ˆæ¯">TTLæ¶ˆæ¯</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒæ¶ˆè´¹ç«¯">ä¸ƒã€æ¶ˆè´¹ç«¯</a>
      <ul>
        <li><a href="#æ¶ˆè´¹ç«¯çš„è‡ªå®šä¹‰ç›‘å¬">æ¶ˆè´¹ç«¯çš„è‡ªå®šä¹‰ç›‘å¬</a></li>
        <li><a href="#æ¶ˆè´¹ç«¯çš„é™æµç­–ç•¥">æ¶ˆè´¹ç«¯çš„é™æµç­–ç•¥</a></li>
        <li><a href="#æ¶ˆè´¹ç«¯ackä¸é‡å›é˜Ÿåˆ—æœºåˆ¶">æ¶ˆè´¹ç«¯ACKä¸é‡å›é˜Ÿåˆ—æœºåˆ¶</a></li>
        <li><a href="#span-iddead-letter-exchangeæ­»ä¿¡é˜Ÿåˆ—dlx---dead-letter-exchangespan"><span id="Dead-Letter-Exchange">æ­»ä¿¡é˜Ÿåˆ—ã€DLX - Dead-Letter-Exchangeã€‘</span></a></li>
        <li><a href="#å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</a></li>
      </ul>
    </li>
    <li><a href="#å…«æ¶ˆæ¯å¯é æ€§ä¿éšœ">å…«ã€æ¶ˆæ¯å¯é æ€§ä¿éšœ</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#ä¹é›†ç¾¤æ­å»º">ä¹ã€é›†ç¾¤æ­å»º</a>
      <ul>
        <li><a href="#ä¸»å¤‡æ¨¡å¼">ä¸»å¤‡æ¨¡å¼</a></li>
        <li><a href="#è¿œç¨‹æ¨¡å¼">è¿œç¨‹æ¨¡å¼</a></li>
        <li><a href="#é•œåƒæ¨¡å¼">é•œåƒæ¨¡å¼</a></li>
        <li><a href="#é›†ç¾¤å…³é”®é…ç½®">é›†ç¾¤å…³é”®é…ç½®</a></li>
        <li><a href="#é›†ç¾¤æ¢å¤ä¸æ•…éšœè½¬ç§»">é›†ç¾¤æ¢å¤ä¸æ•…éšœè½¬ç§»</a></li>
        <li><a href="#å¤šæ´»æ¨¡å¼">å¤šæ´»æ¨¡å¼</a></li>
      </ul>
    </li>
    <li><a href="#åspan-iddelay-queueå»¶è¿Ÿæ’ä»¶çš„ä½¿ç”¨span">åã€<span id="delay queue">å»¶è¿Ÿæ’ä»¶çš„ä½¿ç”¨</span></a></li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»">ä¸€ã€ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»</h2>
<h3 id="activemq">ActiveMQ</h3>
<p>â€‹	ActiveMQæ˜¯Apacheå‡ºå“çš„èƒ½åŠ›å¼ºåŠ²çš„å¼€æºæ¶ˆæ¯æ€»çº¿ï¼Œå¹¶ä¸”å®ƒå®Œå…¨æ”¯æŒJMSè§„èŒƒçš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å…·æœ‰ä¸°å¯Œçš„APIã€å¤šç§é›†ç¾¤æ„å»ºæ¨¡å¼ã€‚ä¸­å°å‹å…¬å¸åº”ç”¨å¹¿æ³›ï¼Œä½†æœåŠ¡æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚</p>
<h3 id="kafka">Kafka</h3>
<p>â€‹	Kafaæ˜¯Linkedlnå¼€æºçš„åˆ†å¸ƒå¼å‘å¸ƒç³»ç»Ÿ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œç›®å‰å½’å±äºApacheé¡¶çº§é¡¹ç›®ã€‚Kafkaä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºæ‹‰å–ï¼ˆPullï¼‰æ¨¡å¼å¤„ç†ä¿¡æ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œå¯¹æ¶ˆæ¯çš„é‡å¤ã€ä¸¢å¤±ã€é”™è¯¯æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œé€‚åˆç”Ÿäº§å¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚</p>
<h3 id="rocketmq">RocketMQ</h3>
<p>â€‹	RocketMQæ˜¯é˜¿é‡Œå¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç›®å‰å½’å±äºApacheé¡¶çº§é¡¹ç›®ã€‚çº¯Javaå¼€å‘ï¼Œå…·æœ‰é«˜ååé‡ã€é«˜å¯ç”¨æ€§ã€é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨çš„ç‰¹ç‚¹ã€‚å¯ç”¨äºäº¤æ˜“ã€å……å€¼ã€æµè®¡ç®—ã€æ¶ˆæ¯æ¨é€ã€æ—¥å¿—æµå¼å¤„ç†ç­‰åœºæ™¯ã€‚</p>
<h3 id="rabbitmq">RabbitMQ</h3>
<p>â€‹	RabbitMQæ˜¯ç”¨Erlangè¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ŒåŸºäºAMQPåè®®å®ç°ã€‚AMQPåè®®æ›´å¤šæ˜¯ç”¨åœ¨ä¼ä¸šç³»ç»Ÿå†…ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§ã€ç¨³å®šæ€§å’Œå¯é æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¯¹æ€§èƒ½å’Œååé‡çš„è¦æ±‚åœ¨æ¬¡ä½ã€‚</p>
<h2 id="äºŒamqpåè®®">äºŒã€AMQPåè®®</h2>
<p>â€‹	AMQPã€Advanced Message Queuing Protocolã€‘ä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯ä¸­é—´ä»¶ä¸åŒäº§å“ï¼Œä¸åŒçš„å¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶ã€‚</p>
<h3 id="amqp-ä¸­åŒ…å«çš„ä¸»è¦å…ƒç´ ">AMQP ä¸­åŒ…å«çš„ä¸»è¦å…ƒç´ </h3>
<ul>
<li>ç”Ÿäº§è€…ã€Producerã€‘ï¼šå‘Exchangeå‘å¸ƒæ¶ˆæ¯çš„åº”ç”¨ã€‚</li>
<li>æ¶ˆè´¹è€…ã€Consumerã€‘ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯çš„åº”ç”¨ã€‚</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ã€Message Queueã€‘ï¼šæœåŠ¡å™¨ç»„ä»¶ï¼Œç”¨äºä¿å­˜æ¶ˆæ¯ï¼Œç›´åˆ°å‘é€ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>æ¶ˆæ¯ã€Messageã€‘ï¼šä¼ è¾“çš„å†…å®¹ã€‚ ç”±Propertieså’ŒBodyç»„æˆã€‚</li>
<li>äº¤æ¢å™¨ã€Exchangeã€‘ï¼šè·¯ç”±ç»„ä»¶ï¼Œæ¥æ”¶Producerå‘é€çš„æ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯è·¯ç”±è½¬å‘ç»™æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li>
<li>è™šæ‹Ÿä¸»æœºã€Virtual Hostã€‘: ä¸€æ‰¹äº¤æ¢å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å’Œç›¸å…³å¯¹è±¡ã€‚è™šæ‹Ÿä¸»æœºæ˜¯å…±äº«ç›¸åŒèº«ä»½è®¤è¯å’ŒåŠ å¯†ç¯å¢ƒçš„ç‹¬ç«‹æœåŠ¡å™¨åŸŸï¼Œå®ç°é€»è¾‘ä¸Šçš„éš”ç¦»ã€‚</li>
<li>Broker ï¼šAMQPçš„æœåŠ¡ç«¯ç§°ä¸ºBrokerã€‚</li>
<li>è¿æ¥ã€Connectionã€‘ï¼šä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œæ¯”å¦‚TCP/IPå¥—æ¥å­—è¿æ¥ã€‚</li>
<li>ä¿¡é“ã€Channelã€‘ï¼šå¤šè·¯å¤ç”¨è¿æ¥ä¸­çš„ä¸€æ¡ç‹¬ç«‹çš„åŒå‘æ•°æ®æµé€šé“ï¼Œä¸ºä¼šè¯æä¾›ç‰©ç†ä¼ è¾“ä»‹è´¨ã€‚</li>
<li>ç»‘å®šå™¨ã€Bindingã€‘ï¼šæ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢å™¨ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼ŒBindingä¸­åŒ…å«Routing keyã€‚</li>
<li>è·¯ç”±é”®ã€Routing keyã€‘ï¼šä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œè™šæ‹Ÿæœºç”¨å®ƒç¡®å®šå¦‚ä½•è¿›è¡Œæ¶ˆæ¯è·¯ç”±ã€‚</li>
</ul>
<h3 id="amqpåè®®æ¨¡å‹">AMQPåè®®æ¨¡å‹</h3>
<p><img src="/img/rabbit/AMQP-Model.png" alt="1560413384276"></p>
<h2 id="ä¸‰rabbitå®‰è£…åŸºæœ¬å‘½ä»¤">ä¸‰ã€Rabbitå®‰è£…&amp;åŸºæœ¬å‘½ä»¤</h2>
<h3 id="å®‰è£…erlang">å®‰è£…Erlang</h3>
<p>ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¸€äº›æ ‡å‡†å­˜å‚¨åº“ä¸­ä¸å­˜åœ¨çš„åŒ…</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šä¸‹è½½RabbitMQå¯¹åº”çš„ErlangåŒ…</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum localinstall erlang-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.x86_64.rpm 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…rabbitmq">å®‰è£…RabbitMQ</h3>
<p>ç¬¬ä¸€æ­¥ï¼šä»å®˜ç½‘æ‰¾åˆ°ä¸‹è½½RabbitMQçš„RPMå®‰è£…åŒ…</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>wget https://github.com/rabbitmq/rabbitmq-server/releases/download/<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>/rabbitmq-server-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.el7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šå®‰è£…RabbitMQ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> yum localinstall rabbitmq-server-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>-1.el7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹<code>/usr/lib/rabbitmq/lib/rabbitmq_server-ç‰ˆæœ¬å·/ebin/rabbit.app</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span> {<span style="color:#a61717;background-color:#e3d2d2">loopback_users,</span> <span style="color:#a61717;background-color:#e3d2d2">[</span><span style="color:#000080">&#34;guest&#34;</span><span style="color:#a61717;background-color:#e3d2d2">]</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å››æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼Œé»˜è®¤ç«¯å£5672</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl start rabbitmq-server
</span></span><span style="display:flex;"><span>rabbitmqctl start_app
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…webç®¡ç†ç•Œé¢">å®‰è£…Webç®¡ç†ç•Œé¢</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># é»˜è®¤ç«¯å£15672</span>
</span></span><span style="display:flex;"><span>rabbitmq-plugins <span style="color:#0086b3">enable</span> rabbitmq_management
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h3>
<ul>
<li>å¼€å¯åº”ç”¨ï¼š<code>rabbitmqctl start_app</code></li>
<li>å…³é—­åº”ç”¨ï¼š<code>rabbitmqctl stop_app</code></li>
<li>èŠ‚ç‚¹çŠ¶æ€ï¼š<code>rabbitmqctl status</code></li>
<li>ç§»é™¤æ‰€æœ‰æ•°æ®ï¼š<code>rabbitmqctl reset</code></li>
</ul>
<h2 id="å››java-clientçš„ç®€å•ä½¿ç”¨">å››ã€Java Clientçš„ç®€å•ä½¿ç”¨</h2>
<ul>
<li><strong>æ¶ˆè´¹è€…</strong></li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.å£°æ˜Queueã€åˆ›å»ºQueueã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable      - æ˜¯å¦æŒä¹…åŒ–ï¼Œdurableæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœä¸æŒä¹…åŒ–ï¼Œé‡å¯ä¹‹åä¸ä¼šè‡ªåŠ¨å»ºç«‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exclusive    - æ˜¯å¦æ˜¯æ¨¡å¼ç‹¬å ï¼Œåªæœ‰åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€…ç«¯æ‰å…è®¸è¿æ¥åˆ°è¯¥é˜Ÿåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æ²¡æœ‰å…³è”exchangeæ—¶åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;RoutingKey-001&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.åˆ›å»ºæ¶ˆè´¹è€… pull æ¨¡å‹ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯,ä¸é˜»å¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;RoutingKey-001&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(1000000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>ç”Ÿäº§è€…</strong></li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.é€šè¿‡channelå‘ç”Ÿæ•°æ®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>0;<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#bbb"> </span>5;<span style="color:#bbb"> </span>i<span style="color:#000;font-weight:bold">++</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>msg<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;message &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>i;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      * 5.å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;RoutingKey-001&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span>msg.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”exchangeäº¤æ¢æœº">äº”ã€Exchangeäº¤æ¢æœº</h2>
<p>Exchangeï¼šæ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®è·¯ç”±é”®è½¬å‘æ¶ˆæ¯æ‰€ç»‘å®šçš„é˜Ÿåˆ—ã€‚é€šä¿—æ˜¯<code>å°†æ¶ˆæ¯åˆ†é…ç»™æ¶ˆæ¯é˜Ÿåˆ—</code></p>
<p><img src="/img/rabbit/hello-world-example-routing.png" alt="hello-world-example-routing"></p>
<p>AMQPã€0-9-1ã€‘çš„Exchange æœ‰å¦‚ä¸‹å››ç§</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>é»˜è®¤é¢„å…ˆå£°æ˜çš„åå­—</th>
</tr>
</thead>
<tbody>
<tr>
<td>Direct exchange</td>
<td>(Empty string) and amq.direct</td>
</tr>
<tr>
<td>Topic exchange</td>
<td>amq.topic</td>
</tr>
<tr>
<td>Fanout exchange</td>
<td>amq.fanout</td>
</tr>
<tr>
<td>Headers exchange</td>
<td>amq.match (and amq.headers in RabbitMQ)</td>
</tr>
</tbody>
</table>
<p>äº¤æ¢æœºçš„å±æ€§</p>
<ul>
<li>Durability ï¼šæ˜¯å¦æŒä¹…åŒ–</li>
<li>Auto-deleteï¼šå½“æœ€åä¸€ä¸ªExchangeç»‘å®šçš„é˜Ÿåˆ—åˆ é™¤æ—¶ä¹Ÿåˆ é™¤äº¤æ¢æœº</li>
<li>Internalï¼šå½“å‰Exchangeæ˜¯å¦ç”¨äºRabbitMQå†…éƒ¨ä½¿ç”¨ï¼Œé»˜è®¤ä¸ºfalse</li>
</ul>
<h3 id="direct-exchange">Direct Exchange</h3>
<p><img src="/img/rabbit/exchange-direct.png" alt="exchange-direct"></p>
<p>æ‰€æœ‰å‘é€åˆ°Direct Exchangeä¸­çš„æ¶ˆæ¯è¢«è½¬å‘åˆ°ç»‘å®šå¯¹åº”RoutingKeyçš„Queueä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¤šæ’­è·¯ç”±ã€ä¸€ä¸ªRoutingKeyèƒ½ç»‘å®šå¤šä¸ªQueueã€‘</p>
<p><strong>æ¶ˆè´¹è€…ã€éœ€è¦å£°æ˜Exchangeå¹¶å°†Exchangeå’ŒQueueç»‘å®šã€‘</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException,<span style="color:#bbb"> </span>TimeoutException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">               </span><span style="color:#998;font-style:italic">//è®¾ç½®è™šæ‹Ÿä¸»æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setAutomaticRecoveryEnabled</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//è®¾ç½®è‡ªåŠ¨é‡è¿</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setConnectionTimeout</span>(5000);<span style="color:#bbb">        </span><span style="color:#998;font-style:italic">//è®¾ç½®è¶…æ—¶æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºConnect</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.åˆ›å»ºChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.å£°æ˜Exchange
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange        -äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * type            -äº¤æ¢æœºç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable         -æ˜¯å¦æŒä¹…åŒ–ï¼Œä¸æŒä¹…åŒ–é‡å¯ä¼šæ¶ˆå¤±
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete      -å½“äº¤æ¢æœºç»‘å®šçš„æœ€åä¸€ä¸ªQueueåˆ é™¤æ—¶æ˜¯å¦åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * internal        -æ­¤äº¤æ¢æœºæ˜¯å¦å†…éƒ¨ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments       -é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;app_exchange_direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å£°æ˜Queue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable      - æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exclusive    - æ˜¯å¦ç‹¬å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;app_queue_direct&#34;</span>,<span style="color:#000;font-weight:bold">true</span>,<span style="color:#000;font-weight:bold">false</span>,<span style="color:#000;font-weight:bold">false</span>,<span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å»ºç«‹ç»‘å®šå…³ç³»</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;app_queue_direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;app_exchange_direct&#34;</span>,<span style="color:#d14">&#34;direct_routingKey&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.è¯»å–æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;app_queue_direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç”Ÿäº§è€…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.é€šè¿‡channelå‘ç”Ÿæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>String<span style="color:#bbb"> </span>msg<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;message direct&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;app_exchange_direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct_routingKey&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span>msg.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="topic-exchange">Topic Exchange</h3>
<p><img src="/img/rabbit/topic-exchange.png" alt="topic-exchange"></p>
<ul>
<li>
<p>æ‰€æœ‰å‘é€åˆ°Topic Exchangeçš„æ¶ˆæ¯è¢«è½¬å‘åˆ°æ‰€æœ‰å…³å¿ƒçš„RouteKeyçš„Queueä¸Š</p>
</li>
<li>
<p>Exchangeå°†RouteKeyå’ŒTopicè¿›è¡Œ<code>æ¨¡ç³ŠåŒ¹é…</code></p>
<ul>
<li><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ª<code>è¯</code></li>
<li><code>*</code>ï¼šåŒ¹é…ä¸€ä¸ª<code>è¯</code></li>
</ul>
</li>
<li>
<p>Topic Exchangeé€šå¸¸ç”¨äºæ¶ˆæ¯çš„å¤šæ’­è·¯ç”±</p>
</li>
</ul>
<p><strong>æ¶ˆè´¹è€…ã€éœ€è¦å£°æ˜Exchangeå¹¶å°†Exchangeå’ŒQueueç»‘å®šã€‘</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">               </span><span style="color:#998;font-style:italic">//è®¾ç½®è™šæ‹Ÿä¸»æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setAutomaticRecoveryEnabled</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//è®¾ç½®è‡ªåŠ¨é‡è¿</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setConnectionTimeout</span>(5000);<span style="color:#bbb">        </span><span style="color:#998;font-style:italic">//è®¾ç½®è¶…æ—¶æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºConnect</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.åˆ›å»ºChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.å£°æ˜Exchange
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange        -äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * type            -äº¤æ¢æœºç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable         -æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete      -å½“äº¤æ¢æœºç»‘å®šçš„æœ€åä¸€ä¸ªQueueåˆ é™¤æ—¶æ˜¯å¦åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * internal        -æ­¤äº¤æ¢æœºæ˜¯å¦å†…éƒ¨ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments       -é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;app_exchange_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å£°æ˜Queue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable      - æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exclusive    - æ˜¯å¦ç‹¬å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;app_queue_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å»ºç«‹ç»‘å®šå…³ç³»</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;app_queue_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;app_exchange_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;broadcast.*&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.è¯»å–æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;app_queue_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç”Ÿäº§è€…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.é€šè¿‡channelå‘ç”Ÿæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;app_exchange_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;broadcast.user&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;broadcast user&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;app_exchange_topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;broadcast.news&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;broadcast news&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="fanout-exchange">Fanout Exchange</h3>
<p><img src="/img/rabbit/exchange-fanout.png" alt="exchange-fanout"></p>
<ul>
<li>ä¸éœ€è¦RoutingKeyï¼Œä¸å¤„ç†RoutingKey</li>
<li>å¯ä»¥ç†è§£ä¸ºè·¯ç”±è¡¨çš„æ¨¡å¼</li>
<li>éœ€è¦æå‰å°†Exchangeä¸Queueè¿›è¡Œç»‘å®š
<ul>
<li>ä¸€ä¸ªExchangeå¯ä»¥ç»‘å®šå¤šä¸ªQueue</li>
<li>ä¸€ä¸ªQueueå¯ä»¥åŒå¤šä¸ªExchangeè¿›è¡Œç»‘å®š</li>
</ul>
</li>
<li>å¦‚æœæ¥å—åˆ°æ¶ˆæ¯çš„Exchangeæ²¡æœ‰ä¸ä»»ä½•Queueç»‘å®šï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æŠ›å¼ƒ</li>
<li>Fanoutäº¤æ¢æœºè½¬å‘æ¶ˆæ¯æ˜¯æœ€å¿«çš„</li>
</ul>
<p><strong>æ¶ˆè´¹è€…ã€éœ€è¦å£°æ˜Exchangeå¹¶å°†Exchangeå’ŒQueueç»‘å®šä½†ä¸éœ€è¦è·¯ç”±é”®ã€‘</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">               </span><span style="color:#998;font-style:italic">//è®¾ç½®è™šæ‹Ÿä¸»æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setAutomaticRecoveryEnabled</span>(<span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//è®¾ç½®è‡ªåŠ¨é‡è¿</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setConnectionTimeout</span>(5000);<span style="color:#bbb">        </span><span style="color:#998;font-style:italic">//è®¾ç½®è¶…æ—¶æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºConnect</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.åˆ›å»ºChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.å£°æ˜Exchange
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange        -äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * type            -äº¤æ¢æœºç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable         -æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete      -å½“äº¤æ¢æœºç»‘å®šçš„æœ€åä¸€ä¸ªQueueåˆ é™¤æ—¶æ˜¯å¦åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * internal        -æ­¤äº¤æ¢æœºæ˜¯å¦å†…éƒ¨ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments       -é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;app_exchange_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å£°æ˜Queue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable      - æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exclusive    - æ˜¯å¦ç‹¬å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;app_queue_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å»ºç«‹ç»‘å®šå…³ç³»[routingKeyä¸èƒ½ä¸ºnull]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;app_queue_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;app_exchange_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.è¯»å–æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;app_queue_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç”Ÿäº§è€…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.é€šè¿‡channelå‘ç”Ÿæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * routingkey   - è·¯ç”±é”®ï¼Œä¸èƒ½ä¸ºnull
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>String<span style="color:#bbb"> </span>msg<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;message fanout&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;app_exchange_fanout&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span>msg.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="headers-exchange">Headers Exchange</h3>
<ul>
<li><code>header exchange</code>ä¸<code>topic exchange</code>æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†æ˜¯<code>topic exchange</code>çš„è·¯ç”±æ˜¯åŸºäºè·¯ç”±é”®ï¼Œè€Œ<code>header exchange</code>çš„è·¯ç”±å€¼åŸºäºæ¶ˆæ¯çš„<code>header</code>æ•°æ®</li>
<li><code>topic exchange</code>è·¯ç”±é”®åªæœ‰æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œå¤´äº¤æ¢æœºå¯ä»¥æ˜¯æ•´å‹å’Œå“ˆå¸Œå€¼</li>
<li>æ¶ˆæ¯headeræ•°æ®é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šå€¼â€x-matchâ€ï¼Œå®ƒæœ‰ä¸¤ä¸ªå€¼
<ul>
<li>allã€é»˜è®¤å€¼ã€‘ï¼š messageä¸­headerçš„é”®å€¼å¯¹å’Œäº¤æ¢æœºçš„headeré”®å€¼å¯¹å…¨éƒ¨åŒ¹é…ï¼Œæ‰å¯ä»¥è·¯ç”±åˆ°å¯¹åº”é˜Ÿåˆ—</li>
<li>anyï¼šmessageä¸­headeré”®å€¼å¯¹å’Œäº¤æ¢æœºçš„headeré”®å€¼å¯¹ä»»æ„ä¸€ä¸ªåŒ¹é…ï¼Œå°±å¯ä»¥è·¯ç”±åˆ°å¯¹åº”é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<p><strong>æ¶ˆè´¹è€…ã€éœ€è¦å£°æ˜Exchangeå¹¶å°†Exchangeå’ŒQueueç»‘å®šéœ€è¦å®šä¹‰å¤´ä¿¡æ¯ã€‘</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">               </span><span style="color:#998;font-style:italic">//è®¾ç½®è™šæ‹Ÿä¸»æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºConnect</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.åˆ›å»ºChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 4.å£°æ˜Exchange
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange        -äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * type            -äº¤æ¢æœºç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable         -æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete      -å½“äº¤æ¢æœºç»‘å®šçš„æœ€åä¸€ä¸ªQueueåˆ é™¤æ—¶æ˜¯å¦åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * internal        -æ­¤äº¤æ¢æœºæ˜¯å¦å†…éƒ¨ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments       -é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;app_exchange_header&#34;</span>,<span style="color:#bbb"> </span>BuiltinExchangeType.<span style="color:#008080">HEADERS</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å£°æ˜Queue
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * durable      - æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exclusive    - æ˜¯å¦ç‹¬å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;app_queue_header&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å®šä¹‰å¤´ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>headerMap<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>headerMap.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;x-match&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;any&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>headerMap.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;student&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>headerMap.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;teacher&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.å»ºç«‹ç»‘å®šå…³ç³»[routingKeyä¸èƒ½ä¸ºnull]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;app_queue_header&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;app_exchange_header&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span>headerMap);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.è¯»å–æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;app_queue_header&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//9.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç”Ÿäº§è€…</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">               </span><span style="color:#998;font-style:italic">//è®¾ç½®è™šæ‹Ÿä¸»æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºConnect</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//3.åˆ›å»ºChannel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//4.å®šä¹‰å¤´ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>headerMap<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>headerMap.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;student&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">Builder</span>()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">headers</span>(headerMap)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">build</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//5.å‘å¸ƒä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;app_exchange_header&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span>props,<span style="color:#bbb"> </span><span style="color:#d14">&#34;I am a student&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">//6.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­message">å…­ã€Message</h2>
<h3 id="messageä¿¡æ¯">Messageä¿¡æ¯</h3>
<ul>
<li>
<p>æœåŠ¡å™¨ä¸åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’çš„æ•°æ®</p>
</li>
<li>
<p>æœ¬è´¨ä¸Šæ˜¯ä¸€æ®µæ•°æ®ï¼Œç”±Propertieså’ŒPayloadï¼ˆBodyï¼‰ç»„æˆ</p>
</li>
<li>
<p>Propertieså…·æœ‰å¾ˆå¤šå±æ€§</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>delivery_mode</td>
<td>æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ã€2æŒä¹…åŒ–ï¼Œ1éæŒä¹…åŒ–ã€‘</td>
</tr>
<tr>
<td>headers</td>
<td>å¯è‡ªå®šä¹‰å±æ€§</td>
</tr>
<tr>
<td>content_type</td>
<td>æ¶ˆæ¯çš„ç±»å‹</td>
</tr>
<tr>
<td>content_encoding</td>
<td>æ¶ˆæ¯çš„ç¼–ç æˆ–è€…å‹ç¼©æ–¹å¼</td>
</tr>
<tr>
<td>priority</td>
<td>ä¼˜å…ˆçº§ï¼Œ0~9ä¹‹é—´ï¼Œ0æœ€ä½</td>
</tr>
<tr>
<td>correlation_id</td>
<td>å…³è”ä¸šåŠ¡idæˆ–å…ˆå‰æ¶ˆæ¯çš„IDï¼Œå¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¡Œä¸º</td>
</tr>
<tr>
<td>replay_to</td>
<td>é€šå¸¸ç”¨äºå‘½åå›è°ƒé˜Ÿåˆ—ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¡Œä¸º</td>
</tr>
<tr>
<td>expiration</td>
<td>æ¶ˆæ¯çš„å¤±æ•ˆæ—¶é—´</td>
</tr>
<tr>
<td>message_id</td>
<td>æ¶ˆæ¯idï¼Œæ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¡Œä¸º</td>
</tr>
<tr>
<td>timestamp</td>
<td>å‘é€æ¶ˆæ¯çš„æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>type</td>
<td>ç±»å‹ï¼Œä¾‹å¦‚content_typeä¸ºæµç±»å‹ï¼Œtypeä¸ºProtobuf</td>
</tr>
<tr>
<td>app_id</td>
<td>åº”ç”¨ç¨‹åºidï¼Œå·®é”™å’Œå®šä½æ—¶ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¡Œä¸º</td>
</tr>
<tr>
<td>user_id</td>
<td>ç”¨æˆ·idï¼ŒRabbitMQä¼šéªŒè¯å½“å‰è¿æ¥çš„ç”¨æˆ·ï¼Œè‹¥ä¸åŒ¹é…åˆ™ä¸¢å¼ƒæ¶ˆæ¯ï¼Œä¸å»ºè®®ä½¿ç”¨</td>
</tr>
<tr>
<td>cluster_id</td>
<td>é›†ç¾¤idï¼ŒåºŸå¼ƒ</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p><strong>æ¶ˆæ¯ä½¿ç”¨ç¤ºä¾‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>headers<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>headers.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;username&#34;</span>,<span style="color:#d14">&#34;kun&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>AMQP.<span style="color:#008080">BasicProperties</span>.<span style="color:#008080">Builder</span>()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">deliveryMode</span>(2)<span style="color:#bbb">          </span><span style="color:#998;font-style:italic">//2ä»£è¡¨æŒä¹…åŒ–æŠ•é€’ï¼Œ1ä»£è¡¨éæŒä¹…åŒ–æŠ•é€’</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">contentEncoding</span>(<span style="color:#d14">&#34;UTF-8&#34;</span>)<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//è®¾ç½®å­—ç¬¦é›†</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">contentType</span>(<span style="color:#d14">&#34;text/plain&#34;</span>)<span style="color:#998;font-style:italic">//è®¾ç½®æ¶ˆæ¯ç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">expiration</span>(<span style="color:#d14">&#34;10000&#34;</span>)<span style="color:#bbb">      </span><span style="color:#998;font-style:italic">//è®¾ç½®10såè¿‡æœŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">headers</span>(headers)<span style="color:#bbb">         </span><span style="color:#998;font-style:italic">//æ”¾ç½®headers</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">build</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>String<span style="color:#bbb"> </span>msg<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;message&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;RoutingKey-001&#34;</span>,<span style="color:#bbb"> </span>properties,<span style="color:#bbb"> </span>msg.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶">æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</h3>
<p>â€‹	æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶æ˜¯æŒ‡ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åï¼Œå¦‚æœBrokeræ”¶åˆ°æ¶ˆæ¯ã€é›†ç¾¤æ¨¡å¼ä¸‹æ‰€æœ‰çš„borkeræ¥æ”¶åˆ°æ‰è§¦å‘ã€‘ï¼Œåˆ™ä¼šç»™ç”Ÿäº§è€…ä¸€ä¸ªåº”ç­”ã€å’Œæ¶ˆè´¹è€…æ— å…³ã€‘ï¼Œ<span style="color:red">ä½†å¹¶ä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šä¼šè¢«æŠ•é€’åˆ°ç›®æ ‡queueé‡Œ</span>ã€æ¯”å¦‚è·¯ç”±keyæ²¡æœ‰å¯¹åº”çš„Queueã€‘ã€‚ç”Ÿäº§è€…è¿›è¡Œæ¥æ”¶åº”ç­”ï¼Œç”¨æ¥ç¡®å®šè¿™æ¡æ¶ˆæ¯æ˜¯å¦æ­£å¸¸å‘é€åˆ°Brokerï¼Œè¿™ç§æŠ•é€’æ–¹å¼ä¹Ÿæ˜¯æ¶ˆæ¯å¯é æ€§æŠ•é€’çš„æ ¸å¿ƒä¿éšœã€‚éæ­£å¸¸æ¥æ”¶çš„åŸå› æœ‰ï¼šç£ç›˜å®¹é‡æ»¡ã€é˜Ÿåˆ—åˆ°è¾¾æœ€å¤§å®¹é‡ç­‰ã€‚</p>
<img src="/img/rabbit/message-confirm.png" alt="1561104995189" style="zoom: 67%;" />
<p><strong>Confirmç¡®è®¤æ¶ˆæ¯å®ç°æ­¥éª¤</strong></p>
<p>ç¬¬ä¸€æ­¥ï¼šåœ¨channelä¸Šå¼€å¯ç¡®è®¤æ¨¡å¼ï¼šchannel.confirmSelect();</p>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨channelæ·»åŠ ç›‘å¬ï¼šaddConfirmListener</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.å¼€å¯æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">confirmSelect</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å‡†å¤‡æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>String<span style="color:#bbb"> </span>exchange<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;confirm_exchange_direct&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>String<span style="color:#bbb"> </span>routingKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;confirm_key&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>String<span style="color:#bbb"> </span>message<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;confirm_message&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.æ¶ˆæ¯å…¥åº“</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ¶ˆæ¯å­˜å…¥æ•°æ®åº“ &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>exchange<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>routingKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>message);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.æ·»åŠ ç›‘å¬</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">addConfirmListener</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConfirmListener()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">handleAck</span>(<span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>deliveryTag,<span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>multiple)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ­¤æ¶ˆæ¯è¢«brokeræ¥æ”¶åˆ°&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;deliveryTag &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>deliveryTag);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;multiple &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>multiple);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ¶ˆæ¯å­˜å…¥æ•°æ®åº“ï¼Œæ”¹ä¸ºçŠ¶æ€è¢«æ¥æ”¶&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(exchange<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>routingKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>message);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">handleNack</span>(<span style="color:#458;font-weight:bold">long</span><span style="color:#bbb"> </span>deliveryTag,<span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">boolean</span><span style="color:#bbb"> </span>multiple)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ­¤æ¶ˆæ¯æ²¡æœ‰è¢«brokeræ¥æ”¶åˆ°&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(deliveryTag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; deliveryTag&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;multiple&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>multiple);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ¶ˆæ¯å­˜å…¥æ•°æ®åº“ï¼Œæ”¹ä¸ºçŠ¶æ€æœªè¢«æ¥æ”¶&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(exchange<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>routingKey<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#d14">&#34;-&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>message);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å‘é€æ¶ˆæ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(exchange,<span style="color:#bbb"> </span>routingKey,<span style="color:#bbb"> </span>properties,<span style="color:#bbb"> </span>message.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(10000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//9.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¶ˆæ¯è¿”å›æœºåˆ¶">æ¶ˆæ¯è¿”å›æœºåˆ¶</h3>
<p>â€‹	æ¶ˆæ¯è¿”å›æœºåˆ¶æ˜¯ç”¨äºå¤„ç†æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‘é€çš„exchange[<strong>å­˜åœ¨</strong>]ä½†æ˜¯æ‰¾ä¸åˆ°åŒ¹é…çš„è·¯ç”±è§„åˆ™ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦ç›‘å¬è¿™ç§ä¸å¯è¾¾æ¶ˆæ¯ï¼Œéœ€è¦ä½¿ç”¨æ¶ˆæ¯è¿”å›æœºåˆ¶Return Listenerã€‚å¦‚æœexchangeä¸å­˜åœ¨ä¼šä¸€ç›´ä¸ç»ˆæ­¢çº¿ç¨‹ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setVirtualHost</span>(<span style="color:#d14">&#34;/&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.æ¶ˆæ¯è¿”å›ç›‘å¬</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">addReturnListener</span>(<span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ReturnListener()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">handleReturn</span>(<span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>replyCode,<span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>replyText,<span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>exchange,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>String<span style="color:#bbb"> </span>routingKey,<span style="color:#bbb"> </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;æ¶ˆæ¯è¿”å›ï¼Œæ²¡ç”¨å¯¹åº”çš„è·¯ç”±è§„åˆ™&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(replyCode);<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//è¿”å›çŠ¶æ€ç </span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(replyText);<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//è¿”å›çŠ¶æ€è¯´æ˜</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(exchange);<span style="color:#bbb">   </span><span style="color:#998;font-style:italic">//æ¶ˆæ¯çš„exchange</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(routingKey);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//æ¶ˆæ¯çš„routingKey</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(properties);<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">//æ¶ˆæ¯çš„properties</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(body);<span style="color:#bbb">       </span><span style="color:#998;font-style:italic">//æ¶ˆæ¯çš„body</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * mandatory    - true:ç›‘å¬å™¨æ¥æ”¶åˆ°è·¯ç”±ä¸å¯è¾¾æ¶ˆæ¯ä¼šè¿›è¡Œåç»­å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *              - false:brokerè‡ªåŠ¨åˆ é™¤ä¸å¯è¾¾æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;return_exchange_direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;return_key&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;return_message&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(20000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½¿ç”¨æ¶ˆæ¯ç¡®è®¤æœºåˆ¶mandatoryå¿…é¡»è®¾ç½®ä¸ºtrue</p>
</blockquote>
<h3 id="ttlæ¶ˆæ¯">TTLæ¶ˆæ¯</h3>
<p>TTLæ˜¯<code>Time To Live</code>çš„ç¼©å†™ï¼Œå³ç”Ÿå­˜æ—¶é—´ã€‚</p>
<ul>
<li>RabbitMQæ”¯æŒ<code>æ¶ˆæ¯</code>çš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨æ¶ˆè´¹å‘é€æ—¶å¯ä»¥è¿›è¡ŒæŒ‡å®šã€‚</li>
<li>RabbitMQæ”¯æŒ<code>é˜Ÿåˆ—</code>çš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨æ¶ˆæ¯å…¥é˜Ÿåˆ—å¼€å§‹è®¡ç®—ï¼Œåªè¦è¶…è¿‡äº†é˜Ÿåˆ—è®¾ç½®çš„è¶…æ—¶æ—¶é—´é…ç½®å°±ä¼šè‡ªåŠ¨æ¸…é™¤</li>
</ul>
<p><strong>æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * exchange     - äº¤æ¢æœºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * routingkey   - è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * props        - å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * body         - æ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>AMQP.<span style="color:#008080">BasicProperties</span>.<span style="color:#008080">Builder</span>()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">expiration</span>(<span style="color:#d14">&#34;10000&#34;</span>)<span style="color:#bbb">      </span><span style="color:#998;font-style:italic">//è®¾ç½®10såè¿‡æœŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>.<span style="color:#008080">build</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>channel.<span style="color:#008080">basicPublish</span>(<span style="color:#d14">&#34;ttl_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;ttl_key&#34;</span>,<span style="color:#bbb"> </span>properties,<span style="color:#bbb"> </span><span style="color:#d14">&#34;ttl msg&#34;</span>.<span style="color:#008080">getBytes</span>());<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é˜Ÿåˆ—è®¾ç½®è¿‡æœŸæ—¶é—´</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * å£°æ˜Queueã€åˆ›å»ºQueueã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * durable      - æ˜¯å¦æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * exclusive    - æ˜¯å¦ç‹¬å 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * autoDelete   - æ˜¯å¦è‡ªåŠ¨åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * arguments    - é¢å¤–å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-message-ttl      è®¾ç½®é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„ç”Ÿå­˜å‘¨æœŸ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-expires          å½“é˜Ÿåˆ—åœ¨æŒ‡å®šçš„æ—¶é—´æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-max-length       é™å®šé˜Ÿåˆ—çš„æ¶ˆæ¯çš„æœ€å¤§å€¼é•¿åº¦ï¼Œè¶…å‡ºè¡Œä¸ºå‚è§x-overflow
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-max-length-bytes é™å®šé˜Ÿåˆ—æœ€å¤§å ç”¨çš„ç©ºé—´å¤§å°ï¼Œè¶…å‡ºè¡Œä¸ºå‚è§x-overflow
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-overflow         è®¾ç½®é˜Ÿåˆ—æº¢å‡ºè¡Œä¸ºdrop-headã€åˆ é™¤å¤´éƒ¨ã€‘æˆ–reject-publishã€æ‹’ç»åŠ å…¥ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-dead-letter-exchange        äº§ç”Ÿæ­»ä¿¡æ—¶è·¯ç”±çš„äº¤æ¢æœº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-dead-letter-routing-key     äº§ç”Ÿæ­»ä¿¡æ—¶è·¯ç”±çš„é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-max-priority      ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå£°æ˜é˜Ÿåˆ—æ—¶å…ˆå®šä¹‰æœ€å¤§ä¼˜å…ˆçº§,0-9æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  *                x-queue-mode        ã€lazyã€‘å°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ä¸Šä¸æ”¾å†…å­˜ä¸­ï¼Œæ¶ˆè´¹æ—¶åŠ è½½åˆ°å†…å­˜å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,<span style="color:#bbb"> </span>Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>arguments<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>arguments.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;x-message-ttl&#34;</span>,<span style="color:#bbb"> </span>1000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;ttl_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span>arguments);<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸ƒæ¶ˆè´¹ç«¯">ä¸ƒã€æ¶ˆè´¹ç«¯</h2>
<h3 id="æ¶ˆè´¹ç«¯çš„è‡ªå®šä¹‰ç›‘å¬">æ¶ˆè´¹ç«¯çš„è‡ªå®šä¹‰ç›‘å¬</h3>
<p>æ›´åŠ ä¼˜é›…çš„å¤„ç†æ¶ˆæ¯çš„æ–¹å¼ï¼Œä¸ç”¨ä½¿ç”¨å¾ªç¯ç­‰æ‰‹æ®µè¯»å–æ¶ˆæ¯ï¼Œè€Œæ˜¯ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶æ¨é€æ¶ˆæ¯ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.å®šä¹‰queue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;custom_consumer_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å®šä¹‰exchange</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;custom_consumer_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.ç»‘å®šqueue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;custom_consumer_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;custom_consumer_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;custom_key&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.è‡ªå®šæ¶ˆè´¹è€…</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicConsume</span>(<span style="color:#d14">&#34;custom_consumer_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MyConsumer(channel));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(10000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">//è‡ªå®šä¹‰æ¶ˆè´¹è€…</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyConsumer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>DefaultConsumer{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">MyConsumer</span>(Channel<span style="color:#bbb"> </span>channel)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">super</span>(channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">handleDelivery</span>(String<span style="color:#bbb"> </span>consumerTag,<span style="color:#bbb"> </span>Envelope<span style="color:#bbb"> </span>envelope,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties,<span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;consumerTag &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>consumerTag);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;envelope    &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>envelope);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;properties  &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>properties);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;body        &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>body);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">getChannel</span>().<span style="color:#008080">basicAck</span>(envelope.<span style="color:#008080">getDeliveryTag</span>(),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¶ˆè´¹ç«¯çš„é™æµç­–ç•¥">æ¶ˆè´¹ç«¯çš„é™æµç­–ç•¥</h3>
<p>â€‹	å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œç”±äºæˆ‘ä»¬çš„æ¶ˆè´¹ç«¯çªç„¶å…¨éƒ¨ä¸å¯ç”¨äº†ï¼Œå¯¼è‡´RabbitMQæœåŠ¡å™¨ä¸Šæœ‰ä¸Šä¸‡æ¡æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œè¿™æ—¶å€™å¦‚æœæ²¡åšä»»ä½•ç°åœ¨ï¼Œéšä¾¿å¼€å¯ä¸€ä¸ªæ¶ˆè´¹ç«¯å®¢æˆ·ç«¯ï¼Œå°±ä¼šå¯¼è‡´å·¨é‡çš„æ¶ˆæ¯ç¬é—´å…¨éƒ¨æ¨é€è¿‡æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬å•ä¸ªå®¢æˆ·ç«¯æ— æ³•åŒæ—¶å¤„ç†è¿™ä¹ˆå¤šçš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æ¶ˆè´¹ç«¯å˜å¾—å·¨å¡ï¼Œæœ‰å¯èƒ½ç›´æ¥å´©æºƒä¸å¯ç”¨ã€‚</p>
<p>â€‹	RabbitMQæä¾›äº†ä¸€ç§qosï¼ˆæœåŠ¡è´¨é‡ä¿è¯ï¼‰åŠŸèƒ½ï¼Œå³åœ¨<strong>éè‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯</strong>çš„å‰æä¸‹ï¼Œå¦‚æœä¸€å®šæ•°ç›®çš„æ¶ˆæ¯æœªè¢«ç¡®è®¤ä¸è¿›è¡Œæ¶ˆè´¹æ–°çš„æ¶ˆæ¯ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.å£°æ˜exchange</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;qos-exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å£°æ˜Queue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;qos-queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.ç»‘å®š</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;qos-queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;qos-exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;qos-key&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 7.è®¾ç½®qos
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * prefetchSize     - é™åˆ¶æŠ“å–æ¶ˆæ¯çš„å¤§å°ï¼Œä¸€èˆ¬ä¸º0ä¸åšé™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * prefetchCount    - æ¯æ¬¡æœ€å¤šæŠ“å–å¤šå°‘ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * global           - ä¸€èˆ¬è®¾ç½®ä¸ºfalseï¼Œåœ¨channelæ–°èƒ½å¹¶ä¸å¥½
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *                  -   trueï¼šè¿ç”¨åœ¨channel
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *                  -   falseï¼šè¿ç”¨åœ¨consumer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicQos</span>(0,<span style="color:#bbb"> </span>1,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.åˆ›å»ºæ¶ˆè´¹è€…,ä½¿ç”¨qosæ—¶autoAckå¿…é¡»è®¾ç½®ä¸ºfalse</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>GetResponse<span style="color:#bbb"> </span>response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>channel.<span style="color:#008080">basicGet</span>(<span style="color:#d14">&#34;qos-queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">if</span>(response<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">!=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>props<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getProps</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getBody</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;routingKeyï¼š &#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getRoutingKey</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;bodyï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>String(body));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>channel.<span style="color:#008080">basicAck</span>(response.<span style="color:#008080">getEnvelope</span>().<span style="color:#008080">getDeliveryTag</span>(),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(1000000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//9.å…³é—­ç›¸å…³è¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¶ˆè´¹ç«¯ackä¸é‡å›é˜Ÿåˆ—æœºåˆ¶">æ¶ˆè´¹ç«¯ACKä¸é‡å›é˜Ÿåˆ—æœºåˆ¶</h3>
<p><strong>æ¶ˆè´¹ç«¯çš„æ‰‹å·¥ACKå’ŒNACK</strong></p>
<ul>
<li>æ¶ˆæ¯é€šè¿‡ACKç¡®è®¤æ˜¯å¦è¢«æ­£ç¡®æ¥æ”¶ï¼Œæ¯ä¸ªMessageéƒ½è¦è¢«ç¡®è®¤ï¼Œå¯ä»¥æ‰‹åŠ¨å»ACKæˆ–è‡ªåŠ¨ACK</li>
<li>è‡ªåŠ¨ç¡®è®¤ä¼šåœ¨æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…åç«‹å³ç¡®è®¤ï¼Œä½†å­˜åœ¨ä¸¢å¤±æ¶ˆæ¯çš„å¯èƒ½ï¼Œå¦‚æœæ¶ˆè´¹ç«¯æ¶ˆè´¹é€»è¾‘æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹ç«¯æ²¡æœ‰å¤„ç†æˆåŠŸè¿™æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºä¸¢å¤±äº†æ¶ˆæ¯</li>
<li>å¦‚æœæ‰‹åŠ¨ç¡®è®¤åˆ™å½“æ¶ˆè´¹è€…è°ƒç”¨<code>ack</code>ã€<code>nack</code>ã€<code>reject</code>è¿›è¡Œç¡®è®¤ï¼Œå¦‚æœæ¶ˆæ¯æœªè¢« ACK åˆ™ä¼šå‘é€åˆ°ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…</li>
</ul>
<p><strong>æ¶ˆè´¹ç«¯çš„é‡å›é˜Ÿåˆ—</strong></p>
<ul>
<li>æ¶ˆæ¯é‡å›é˜Ÿåˆ—æ˜¯ä¸ºäº†å¯¹æ²¡æœ‰å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ï¼ŒæŠŠæ¶ˆæ¯å†æ¬¡é€€å›Broker</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹å…³é—­é‡å›é˜Ÿåˆ—</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.å£°æ˜Queueã€åˆ›å»ºQueueã€‘</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;ack_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//5.å£°æ˜Exchange</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;ack_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.ç»‘å®šqueue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;ack_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;ack_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;ack_key&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 7.æ¥æ”¶æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoAck      - è‡ªåŠ¨ç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Consumer     - è‡ªå®šä¹‰æ¶ˆè´¹è€…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicConsume</span>(<span style="color:#d14">&#34;ack_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MyConsumer(channel));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//8.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(10000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">//è‡ªå®šä¹‰æ¶ˆè´¹è€…</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyConsumer</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">extends</span><span style="color:#bbb"> </span>DefaultConsumer<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">MyConsumer</span>(Channel<span style="color:#bbb"> </span>channel)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">super</span>(channel);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>1;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">handleDelivery</span>(String<span style="color:#bbb"> </span>consumerTag,<span style="color:#bbb"> </span>Envelope<span style="color:#bbb"> </span>envelope,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>AMQP.<span style="color:#008080">BasicProperties</span><span style="color:#bbb"> </span>properties,<span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>body)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>IOException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;consumerTag &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>consumerTag);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;envelope    &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>envelope);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;properties  &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>properties);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(<span style="color:#d14">&#34;body        &#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>body);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">if</span><span style="color:#bbb"> </span>(i<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">%</span><span style="color:#bbb"> </span>3<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">==</span><span style="color:#bbb"> </span>0)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * nackç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * deliveryTag    - æ¶ˆæ¯tag
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * multiple       - æ˜¯å¦æ‰¹é‡ç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * requeue        - æ˜¯å¦é‡å›brokeré˜Ÿåˆ—å°¾éƒ¨ï¼Œå¦‚æœfalseä¸å†é‡å›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * ä¸ void basicReject(long deliveryTag, boolean requeue) åŒºåˆ«
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * basicReject  ä¸€æ¬¡åªèƒ½æ‹’ç»æ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * basicNack    æ–¹æ³•å¯ä»¥æ”¯æŒä¸€æ¬¡ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯çš„æ‹’æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">getChannel</span>().<span style="color:#008080">basicNack</span>(envelope.<span style="color:#008080">getDeliveryTag</span>(),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#000;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * nackç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * deliveryTag    - æ¶ˆæ¯tag
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * multiple       - æ˜¯å¦æ‰¹é‡ç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        * requeue        - æ˜¯å¦é‡å›é˜Ÿåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">super</span>.<span style="color:#008080">getChannel</span>().<span style="color:#008080">basicAck</span>(envelope.<span style="color:#008080">getDeliveryTag</span>(),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>i<span style="color:#000;font-weight:bold">++</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="span-iddead-letter-exchangeæ­»ä¿¡é˜Ÿåˆ—dlx---dead-letter-exchangespan"><span id="Dead-Letter-Exchange">æ­»ä¿¡é˜Ÿåˆ—ã€DLX - Dead-Letter-Exchangeã€‘</span></h3>
<p>å½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ï¼ˆdead messageï¼‰åï¼Œå®ƒèƒ½å¤Ÿè¢«é‡æ–°publishåˆ°å¦ä¸€ä¸ªExchangeï¼Œè¿™ä¸ªExchangeå°±æ˜¯DLXã€‚</p>
<p>DLXä¹Ÿæ˜¯ä¸€ä¸ªæ­£å¸¸çš„å’Œå…¶å®ƒExchangeæ²¡ä»»ä½•åŒºåˆ«çš„äº¤æ¢æœºï¼Œå®ƒèƒ½åœ¨ä»»ä½•é˜Ÿåˆ—ä¸Šè¢«æŒ‡å®šã€‚</p>
<p>æ¶ˆæ¯å˜æˆæ­»ä¿¡çš„æƒ…å†µï¼š</p>
<ul>
<li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆbasic.reject / basic.nackï¼‰å¹¶ä¸”requeue=false</li>
<li>æ¶ˆæ¯TTLè¿‡æœŸ</li>
<li>é˜Ÿåˆ—åˆ°è¾¾æœ€å¤§é•¿åº¦</li>
</ul>
<p><strong>æ­»ä¿¡é˜Ÿåˆ—çš„åº”ç”¨</strong></p>
<p>â€‹	å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼šæ•°æ®è¿›å…¥æ­£å¸¸çš„queueä¸­ä¸”æ²¡æœ‰æ¶ˆè´¹è€…ï¼ˆæ ¹æ®ä¸šåŠ¡è®¾ç½®ç›¸åº”çš„å¤±æ•ˆæ—¶é—´ã€å»¶è¿Ÿæ—¶é—´ã€‘ï¼‰è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ•°æ®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">main</span>(String<span style="color:#000;font-weight:bold">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//1.åˆ›å»ºè¿æ¥å·¥å‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>ConnectionFactory<span style="color:#bbb"> </span>connectionFactory<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ConnectionFactory();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setHost</span>(<span style="color:#d14">&#34;192.168.1.155&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connectionFactory.<span style="color:#008080">setPort</span>(5672);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//2.åˆ›å»ºè¿æ¥</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Connection<span style="color:#bbb"> </span>connection<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connectionFactory.<span style="color:#008080">newConnection</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//3.é€šè¿‡è¿æ¥å¾—åˆ°Channel</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Channel<span style="color:#bbb"> </span>channel<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>connection.<span style="color:#008080">createChannel</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//4.åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;dlx_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;dlx_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;topic&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;dlx_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;dlx_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;#&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 5.å£°æ˜Queueã€åˆ›å»ºQueueã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * x-dead-letter-exchange       - æ­»ä¿¡é˜Ÿåˆ—çš„äº¤æ¢æœº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * x-dead-letter-routing-key    - æ­»ä¿¡é˜Ÿåˆ—çš„è·¯ç”±é”®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,<span style="color:#bbb"> </span>Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>arguments<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>arguments.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;x-dead-letter-exchange&#34;</span>,<span style="color:#d14">&#34;dlx_exchange&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>arguments.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;x-dead-letter-routing-key&#34;</span>,<span style="color:#d14">&#34;dlx_key&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueDeclare</span>(<span style="color:#d14">&#34;dlx_test_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span>arguments);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//6.å£°æ˜Exchange</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">exchangeDeclare</span>(<span style="color:#d14">&#34;dlx_test_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//7.ç»‘å®šqueue</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">queueBind</span>(<span style="color:#d14">&#34;dlx_test_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;dlx_test_exchange&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;dlx_test_key&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 8.æ¥æ”¶æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * queue        - queueåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * autoAck      - è‡ªåŠ¨ç­¾æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Consumer     - è‡ªå®šä¹‰æ¶ˆè´¹è€…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">basicConsume</span>(<span style="color:#d14">&#34;dlx_test_queue&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>MyConsumer(channel));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">//9.å…³é—­èµ„æº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>Thread.<span style="color:#008080">sleep</span>(10000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>channel.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>connection.<span style="color:#008080">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</h3>
<p>å‚è§ã€<a href="#delay queue">Spring AMQPä½¿ç”¨-å»¶è¿Ÿé˜Ÿåˆ—</a>ã€‘</p>
<h2 id="å…«æ¶ˆæ¯å¯é æ€§ä¿éšœ">å…«ã€æ¶ˆæ¯å¯é æ€§ä¿éšœ</h2>
<h4 id="ä¿éšœ100æŠ•é€’æˆåŠŸ">ä¿éšœ100%æŠ•é€’æˆåŠŸ</h4>
<p><strong>æ–¹æ¡ˆä¸€ï¼šæ¶ˆæ¯è½åº“ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œæ‰“æ ‡</strong></p>
<p><img src="/img/rabbit/message-flage.png" alt="message-flage"></p>
<p><strong>æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯çš„å»¶è¿ŸæŠ•é€’ï¼ŒåšäºŒæ¬¡ç¡®è®¤ï¼Œå›è°ƒæ£€æŸ¥</strong></p>
<h4 id="callback-checkimgrabbitcallback-checkpngå¹‚ç­‰æ€§ä¿éšœ"><img src="/img/rabbit/callback-check.png" alt="callback-check">å¹‚ç­‰æ€§ä¿éšœ</h4>
<p><strong>å”¯ä¸€ID + æŒ‡çº¹ç æœºåˆ¶</strong></p>
<p><code>åŸç†å°±æ˜¯åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡ï¼Œä¸šåŠ¡å®Œæˆåæ’å…¥ä¸»é”®æ ‡è¯†</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- å”¯ä¸€IDæŒ‡çš„æ˜¯ä¸šåŠ¡çš„ID,ä¾‹å¦‚è®¢å•ID,å•†å“ID,UUID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- æŒ‡çº¹ç æŒ‡æ¯æ¬¡æ­£å¸¸æ“ä½œçš„ç ï¼Œä¾‹å¦‚æ—¶é—´æˆ³+ä¸šåŠ¡ç¼–å·æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">count</span>(<span style="color:#000;font-weight:bold">*</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">from</span><span style="color:#bbb"> </span>t_check<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">where</span><span style="color:#bbb"> </span>ID<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">å”¯ä¸€</span>ID<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">æŒ‡çº¹ç </span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½å¤„ï¼šå®ç°ç®€å•</p>
<p>åå¤„ï¼šé«˜å¹¶å‘ä¸‹æ•°æ®åº“ç“¶é¢ˆ</p>
<p>è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®IDè¿›è¡Œåˆ†åº“åˆ†è¡¨è¿›è¡Œç®—æ³•è·¯ç”±</p>
<p><strong>åˆ©ç”¨Redisçš„åŸå­æ€§å®ç°</strong></p>
<p><code>åŸç†åˆ©ç”¨Redisçš„åŸå­æ€§ï¼Œå°†æ ‡ç¤ºæ¶ˆæ¯çš„å”¯ä¸€IDã€ä¸šåŠ¡ç”Ÿæˆçš„ã€‘æ”¾å…¥redisï¼Œåœ¨æ¶ˆè´¹æ¶ˆæ¯å‰åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­¤æ¶ˆæ¯</code></p>
<p>å¥½å¤„ï¼šæ•ˆç‡é«˜</p>
<p>åå¤„ï¼šå¦‚æœæ•°æ®éœ€è¦ç«‹å³è½åº“ï¼Œé‚£ä¹ˆæ•°æ®åº“å’Œredisè¦ä¿æŒâ€œäº‹åŠ¡ä¸€è‡´æ€§â€</p>
<p>â€‹            å¦‚æœæ•°æ®ä¸éœ€è¦ç«‹å³è½åº“ç”±åˆ«çš„æœåŠ¡è¿›è¡Œè½åº“ï¼Œé‚£ä¹ˆå¦‚ä½•è¦ä¿æŒåŒæ­¥</p>
<h2 id="ä¹é›†ç¾¤æ­å»º">ä¹ã€é›†ç¾¤æ­å»º</h2>
<h3 id="ä¸»å¤‡æ¨¡å¼">ä¸»å¤‡æ¨¡å¼</h3>
<p>â€‹	å®ç°Rabbité«˜å¯ç”¨ï¼Œä¸€èˆ¬ç”¨äºå¹¶å‘å’Œæµé‡ä¸é«˜çš„æƒ…å†µï¼Œä»èŠ‚ç‚¹ä¸å¯è¯»å†™ã€‚ä¸»å¤‡æ¨¡å¼ä¹Ÿç§°ä¸ºWarrenæ¨¡å¼ã€‚å½“ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶å¤‡ç”¨èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</p>
<img src="/img/rabbit/master-backup.png" alt="master-backup" style="zoom: 50%;" />
<h3 id="è¿œç¨‹æ¨¡å¼">è¿œç¨‹æ¨¡å¼</h3>
<p>â€‹	è¿œç¨‹æ¨¡å¼å¯ä»¥å®ç°å¤šæ´»ï¼Œç®€ç§°<code>Shovel</code>æ¨¡å¼ã€‚è¿œè·ç¦»é€šè®¯å’Œå¤åˆ¶ï¼Œå³å°†æ¶ˆæ¯è¿›è¡Œä¸åŒä¸­å¿ƒçš„å¤åˆ¶å·¥ä½œï¼Œå¯ä»¥è·¨åœ°åŸŸçš„è®©ä¿©MQé›†ç¾¤äº’è”ã€‚å°†æºèŠ‚ç‚¹çš„æ¶ˆæ¯å‘å¸ƒåˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­<code>Shovel</code>å°±æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®ƒè´Ÿè´£è¿æ¥æºèŠ‚ç‚¹ï¼Œè¯»å–æŸä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œç„¶åå°†æ¶ˆæ¯å†™å…¥åˆ°ç›®æ ‡èŠ‚ç‚¹çš„exchangeä¸­ã€‚ä¸å»ºè®®ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå·²ç»è¢«<code>Federation</code>å¤šæ´»å–ä»£ã€‚</p>
<h3 id="é•œåƒæ¨¡å¼">é•œåƒæ¨¡å¼</h3>
<p>â€‹	é•œåƒï¼ˆMirrorï¼‰æ¨¡å¼ä¿è¯äº†100%æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸€èˆ¬å¸¸ç”¨é•œåƒæ¨¡å¼æ­å»ºRabbitMQé›†ç¾¤ã€‚</p>
<p>â€‹	é•œåƒï¼ˆMirrorï¼‰é˜Ÿåˆ—çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯é æ€§è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†å®ç°æ•°æ®åŒæ­¥ï¼Œä¸€èˆ¬æ¥è®²æ˜¯2-3ä¸ªèŠ‚ç‚¹å®ç°åŒæ­¥ã€‚</p>
<img src="/img/rabbit/Mirror.png" alt="Mirror" style="zoom:67%;" />
<p>æ­å»ºé«˜å¯ç”¨é•œåƒæ¨¡å¼æ­¥éª¤</p>
<p><strong>é›†ç¾¤æ­å»º</strong></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹é›†ç¾¤ç”¨æˆ·ä¸è¿æ¥å¿ƒè·³æ£€æµ‹</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebin/rabbit.app
</span></span><span style="display:flex;"><span>{heartbeat, 1} #å°†60æ”¹ä¸º1
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äºŒæ­¥ï¼šå®‰è£…ç®¡ç†æ’ä»¶</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ä¹Ÿæ˜¯webç®¡ç†æ’ä»¶ lsof -i:15672 æˆ–è€… netstat -tnlp|grep 15672 æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</span>
</span></span><span style="display:flex;"><span>rabbitmq-plugins <span style="color:#0086b3">enable</span> rabbitmq_management
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰æ­¥ï¼šé€‰å–ä¸»èŠ‚ç‚¹ï¼ŒåŒæ­¥cookieã€‚é€‰å–ä¸€ä¸ªåšä¸ºä¸»èŠ‚ç‚¹ï¼Œå°†<code>/var/lib/rabbitmq/.erlang.cookie</code>å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œæ³¨æ„æƒé™ã€‚</strong></p>
<p><strong>ç¬¬å››æ­¥ï¼šåœæ­¢æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rabbitmqctl stop
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬äº”æ­¥ï¼šå¯åŠ¨é›†ç¾¤</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rabbitmq-server -detached
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬å…­æ­¥ï¼šä¸»æœºåæ£€æŸ¥ï¼Œå¿…é¡»è¦æœ‰ä¸»æœºåã€/etc/hostnameã€‘ï¼Œæ³¨æ„è®¾ç½®å®Œæˆä¹‹åé‡å¯</strong></p>
<p><strong>ç¬¬ä¸ƒæ­¥ï¼šç½‘ç»œæ£€æŸ¥ï¼Œæµ‹è¯•å„èŠ‚ç‚¹ä¹‹é—´æ˜¯å¦å¯ä»¥ç”¨hostNameè¿é€šï¼Œå¦‚æœä¸å¯ä»¥éœ€è¦ä¿®æ”¹ã€/etc/hostsã€‘</strong></p>
<p><strong>ç¬¬å…«æ­¥ï¼šæ™®é€šnodeèŠ‚ç‚¹æ‰§è¡Œ</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>rabbitmqctl join_cluster rabbit@<span style="color:#000;font-weight:bold">[</span>masterHostName<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>rabbitmqctl start_app
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¹æ­¥ï¼šä»»æ„èŠ‚ç‚¹æ‰§è¡Œ<code>rabbitmqctl set_policy ha-all &quot;^&quot; '{&quot;ha-mode&quot;:&quot;all&quot;}'  </code></strong></p>
<blockquote>
<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š<code>rabbitmqctl cluster_status  </code></p>
</blockquote>
<blockquote>
<p>ä¿®æ”¹é›†ç¾¤åç§°ï¼š<code>rabbitmqctl set_cluster_name [cluster_name] </code></p>
</blockquote>
<blockquote>
<p>ç§»é™¤èŠ‚ç‚¹ï¼š<code>rabbitmqctl forget_cluster_node rabbit@hostName  </code></p>
</blockquote>
<p><strong>Haproxyé…ç½®</strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">global
    ......

defaults
	  ......
	  
# rabbitmqé›†ç¾¤èŠ‚ç‚¹é…ç½® 
listen rabbitmq_cluster
    bind 0.0.0.0:5672
    # é…ç½®TCPæ¨¡å¼
    mode tcp
    # ç®€å•çš„è½®è¯¢
    balance roundrobin
    # interæ¯éš”äº”ç§’å¯¹mqé›†ç¾¤åšå¥åº·æ£€æŸ¥ï¼Œ2æ¬¡æ­£ç¡®è¯æ˜æœåŠ¡å™¨å¯ç”¨ï¼Œ3æ¬¡å¤±è´¥è¯æ˜æœåŠ¡å™¨ä¸å¯ç”¨
    server rabbit155 192.168.1.155:5672 check inter 5000 rise 2 fall 3
    server rabbit149 192.168.1.149:5672 check inter 5000 rise 2 fall 3
    server rabbit151 192.168.1.151:5672 check inter 5000 rise 2 fall 3

#é…ç½®haproxy webç›‘æ§ï¼ŒæŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
listen stats
    bind 0.0.0.0:8100
    mode http
    option httplog
    stats enable
    # è®¾ç½®haproxyç›‘æ§åœ°å€ä¸ºhttp://localhost:8100/rabbitmq-stats
    stats uri /rabbitmq-stats
    stats refresh 5s
</code></pre><p><strong>Keepalivedé…ç½®</strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">! Configuration File for keepalived

global_defs {
   router_id rabbit149   # æ ‡è¯†èŠ‚ç‚¹çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸ä¸ºhostname
}

vrrp_script chk_haproxy {
    # æ‰§è¡Œè„šæœ¬ä½ç½®ï¼Œéœ€è¦æ‰§è¡Œæƒé™
    script &#34;/etc/keepalived/haproxy_check.sh&#34;
    # æ£€æµ‹æ—¶é—´é—´éš”
    interval 2                            
    # å¦‚æœæ¡ä»¶æˆç«‹åˆ™æƒé‡å‡20
    weight -20
}

vrrp_instance VI_1 {
    state MASTER          # ä¸»èŠ‚ç‚¹ä¸ºMASTERï¼Œå¤‡ä»½èŠ‚ç‚¹ä¸ºBACKUP
    interface enp0s3      # ç»‘å®šè™šæ‹ŸIPçš„ç½‘ç»œæ¥å£ï¼ˆç½‘å¡ï¼‰
    virtual_router_id 60  # è™šæ‹Ÿè·¯ç”±IDå·ï¼ˆä¸»å¤‡èŠ‚ç‚¹ä¸€å®šè¦ç›¸åŒï¼‰
    mcast_src_ip 192.168.1.149 # æœ¬æœºipåœ°å€
    priority 100          #ä¼˜å…ˆçº§é…ç½®ï¼ˆ0-254çš„å€¼ï¼‰ï¼Œå¤‡æœºè¦æ¯”MASTERä½
    nopreempt
    advert_int 1          # ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œä¿©ä¸ªèŠ‚ç‚¹å¿…é¡»é…ç½®ä¸€è‡´ï¼Œé»˜è®¤1s
    authentication {      # è®¤è¯åŒ¹é…
        auth_type PASS
        auth_pass 1111
    }

    track_script {
        chk_haproxy
    }

    virtual_ipaddress {
        192.168.1.60      # è™šæ‹Ÿipï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª
    }
}
</code></pre><p>æ£€æŸ¥è„šæœ¬ã€chk_haproxyã€‘</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#008080">A</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>ps -C haproxy --no-header |wc -l<span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#008080">$A</span> -eq <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">]</span>;<span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34;`date` haproxy is dead&#34;</span> &gt;&gt; /tmp/lvs.log
</span></span><span style="display:flex;"><span>    haproxy  -f /etc/haproxy/haproxy.cfg
</span></span><span style="display:flex;"><span>    sleep <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#d14">`</span>ps -C haproxy --no-header |wc -l<span style="color:#d14">`</span> -eq <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">]</span>;<span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34;`date` haproxy cannot start,stop keepalived&#34;</span> &gt;&gt; /tmp/lvs.log
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># æ€æ­»keepalived</span>
</span></span><span style="display:flex;"><span>    ps -C keepalived --no-header | awk <span style="color:#d14">&#39;{print $1}&#39;</span>|xargs <span style="color:#0086b3">kill</span> -9
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">exit</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34;`date` haproxy restart&#34;</span> &gt;&gt; /tmp/lvs.log
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">exit</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é›†ç¾¤å…³é”®é…ç½®">é›†ç¾¤å…³é”®é…ç½®</h3>
<p>é…ç½®æ–‡ä»¶ä½ç½®ï¼š/usr/lib/rabbitmq/lib/rabbitmq_server-[version]/ebin/rabbit.app</p>
<ul>
<li>
<p><code>tcp_listerners</code>ï¼šè®¾ç½®rabbimqçš„ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º[5672]</p>
</li>
<li>
<p><code>disk_free_limitã€DISKæ¨¡å¼ä¸‹æœ‰æ•ˆã€‘</code>ï¼šç£ç›˜ä½æ°´ä½çº¿ï¼Œè‹¥ç£ç›˜å®¹é‡ä½äºæŒ‡å®šå€¼åˆ™åœæ­¢æ¥æ”¶æ•°æ®ï¼Œé»˜è®¤å€¼ä¸º**{mem_relative, 1.0}**ï¼Œå³ä¸å†…å­˜ç›¸å…³è”1:1</p>
</li>
<li>
<p><code>vm_memory_high_watermarkã€RAMæ¨¡å¼ä¸‹æœ‰æ•ˆã€‘</code>ï¼šè®¾ç½®å†…å­˜ä½æ°´ä½çº¿ï¼Œè‹¥ä½äºè¯¥æ°´ä½çº¿ï¼Œåˆ™å¼€å¯æµæ§æœºåˆ¶ï¼Œé»˜è®¤å€¼æ˜¯0.4ï¼Œå³å†…å­˜æ€»é‡çš„40%</p>
</li>
<li>
<p><code>hipe_compile</code>ï¼šå°†éƒ¨åˆ†rabbimqä»£ç ç”¨<code>High Performance Erlang compiler</code>ç¼–è¯‘ï¼Œå¯æå‡æ€§èƒ½ï¼Œè¯¥å‚æ•°æ˜¯å®éªŒæ€§ï¼Œè‹¥å‡ºç°<span style="color:red">erlang vm segfaults</span>ï¼Œéœ€è¦å…³æ‰</p>
</li>
<li>
<p><code>force_fine_statistics</code>ï¼šè¯¥å‚æ•°å±äºrabbimq_managementï¼Œè‹¥ä¸ºtrueåˆ™è¿›è¡Œç²¾ç»†åŒ–çš„ç»Ÿè®¡ï¼Œä½†ä¼šå½±å“æ€§èƒ½</p>
</li>
</ul>
<h3 id="é›†ç¾¤æ¢å¤ä¸æ•…éšœè½¬ç§»">é›†ç¾¤æ¢å¤ä¸æ•…éšœè½¬ç§»</h3>
<p>åœºæ™¯ä¸€ï¼šAå…ˆåœæ­¢ï¼ŒB(Master)ååœæ­¢</p>
<p>å¤„ç†æ–¹æ³•ï¼šæ”¹åœºæ™¯ä¸‹å…ˆå¯åŠ¨Bï¼Œå†å¯åŠ¨Aã€‚æˆ–è€…å…ˆå¯åŠ¨Aï¼Œéš”30så†…å¯åŠ¨Bå³å¯</p>
<hr>
<p>åœºæ™¯äºŒï¼šAã€BåŒæ—¶åœæœºï¼ˆåŒæ—¶æ–­ç‚¹ï¼‰</p>
<p>å¤„ç†æ–¹æ³•ï¼š30så†…åŒæ—¶å¯åŠ¨Aã€Bå³å¯</p>
<hr>
<p>åœºæ™¯ä¸‰ï¼šAå…ˆåœæ­¢ï¼ŒB(Master)ååœæ­¢ï¼Œä¸”Aæ— æ³•æ¢å¤</p>
<p>å¤„ç†æ–¹æ³•ï¼šBå¯åŠ¨ä¹‹åè°ƒç”¨<code>rabbitmqctl forget_cluster_node rabbit@nodeA</code>è§£é™¤ä¸Açš„clusterå…³ç³»ï¼Œå†åŠ å…¥æ–°çš„èŠ‚ç‚¹å³å¯</p>
<hr>
<p>åœºæ™¯å››ï¼šAå…ˆåœæ­¢ï¼ŒB(Master)ååœæ­¢ï¼Œä¸”Bæ— æ³•æ¢å¤</p>
<p>å¤„ç†æ–¹æ³•ï¼šåœ¨AèŠ‚ç‚¹ä¸Šè°ƒç”¨<code>rabbitmqctl forget_cluster_node --offline rabbit@nodeB</code>ï¼Œä¹‹åå¯åŠ¨AèŠ‚ç‚¹ä½œä¸ºMasterï¼Œå†åŠ å…¥æ–°çš„SlaveèŠ‚ç‚¹å³å¯</p>
<h3 id="å¤šæ´»æ¨¡å¼">å¤šæ´»æ¨¡å¼</h3>
<p>â€‹	<code>Federation</code>æ¨¡å¼æ˜¯å¼‚åœ°æ•°æ®å¤åˆ¶çš„ä¸»æµæ¨¡å¼ï¼Œå› ä¸º<code>Shovel</code>æ¨¡å¼é…ç½®å¤æ‚ï¼Œ<code>Federation</code>é…ç½®ç®€å•ã€‚å¯ä»¥å®ç°Brokerå’ŒClusterä¹‹é—´çš„æ¶ˆæ¯ä¼ è¾“ï¼Œè¿æ¥åŒæ–¹å¯ä»¥ä½¿ç”¨ä¸åŒçš„userså’Œvritual hostsï¼Œä½¿ç”¨çš„æ˜¯AMQPåè®®æ‰€ä»¥åŒæ–¹ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„erlangå’ŒRabbitMQã€‚</p>
<p><img src="/img/rabbit/Federation.png" alt="Federation"></p>
<blockquote>
<p>Federation Exchangesï¼Œå¯ä»¥çœ‹æˆDownstreamä»Upstreamä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼Œä½†å¹¶ä¸æ˜¯æ‹‰å–æ‰€æœ‰æ¶ˆæ¯ï¼Œä¹‹é¡»æ˜¯åœ¨Downstreamä¸Šå·²ç»æ˜ç¡®å®šä¹‰Bindingså…³ç³»çš„Exchangeï¼Œä¹Ÿå°±æ˜¯æœ‰å®é™…çš„ç‰©ç†Queueæ¥æ¥æ”¶æ¶ˆï¼Œæ‰ä¼šUpstreamæ‹‰å–æ¶ˆæ¯åˆ°Downstreamã€‚Downstreamä¼šå°†ç»‘å®šå…³ç³»ç»„åˆåœ¨ä¸€èµ·ï¼Œç»‘å®š/è§£é™¤ç»‘å®šå‘½ä»¤å°†å‘é€åˆ°Upstreamäº¤æ¢æœºã€‚å› æ­¤FederationExchangeåªæ¥æ”¶å…·æœ‰è®¢é˜…çš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<h2 id="åspan-iddelay-queueå»¶è¿Ÿæ’ä»¶çš„ä½¿ç”¨span">åã€<span id="delay queue">å»¶è¿Ÿæ’ä»¶çš„ä½¿ç”¨</span></h2>
<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œå‚è§<a href="#Dead-Letter-Exchange">æ­¤é“¾æ¥</a></p>
<p>æ–¹å¼äºŒï¼šä½¿ç”¨<code>rabbitmq_delayed_message_exchange</code>æ’ä»¶ã€æ›´åŠ ç®€å•ä¼˜ç§€ã€‘</p>
<ul>
<li><a href="http://www.rabbitmq.com/community-plugins.html">å®˜ç½‘ä¸‹è½½æ’ä»¶</a>ï¼Œè§£å‹åˆ°æŒ‡å®šä½ç½®ã€usr/lib/rabbitmq/lib/rabbitmq_server-[version]/plugins/ ã€‘</li>
<li>å®‰è£…æ’ä»¶<code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></li>
<li>ä½¿ç”¨Spring AMQPè®¾ç½®<code>x-delay</code>æ¶ˆæ¯å¤´å‚æ•°</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// å®šä¹‰äº¤æ¢æœºå’Œé˜Ÿåˆ—</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DelayExchangeConfigure</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Bean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>Queue<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">delayQueue</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>Queue(DELAY_QUEUE_NAME,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// å®šä¹‰ä¸€ä¸ªå»¶è¿Ÿäº¤æ¢æœº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Bean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>CustomExchange<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">delayExchange</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Map<span style="color:#000;font-weight:bold">&lt;</span>String,<span style="color:#bbb"> </span>Object<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>args<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#000;font-weight:bold">&lt;</span>String,<span style="color:#bbb"> </span>Object<span style="color:#000;font-weight:bold">&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å®šä¹‰äº¤æ¢æœºç±»å‹</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>args.<span style="color:#008080">put</span>(<span style="color:#d14">&#34;x-delayed-type&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;direct&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>CustomExchange(DELAY_EXCHANGE_NAME,<span style="color:#bbb"> </span><span style="color:#d14">&#34;x-delayed-message&#34;</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>,<span style="color:#bbb"> </span>args);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">// ç»‘å®šé˜Ÿåˆ—åˆ°è¿™ä¸ªå»¶è¿Ÿäº¤æ¢æœºä¸Š</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Bean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span>Binding<span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">delayBinding</span>(Queue<span style="color:#bbb"> </span>delayQueue,<span style="color:#bbb"> </span>CustomExchange<span style="color:#bbb"> </span>delayExchange)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>BindingBuilder.<span style="color:#008080">bind</span>(delayQueue).<span style="color:#008080">to</span>(delayExchange).<span style="color:#008080">with</span>(DELAY_ROUTING_KEY).<span style="color:#008080">noargs</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// ç”Ÿäº§è€…</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Controller</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@RequiredArgsConstructor</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DelayExchangeController</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">final</span><span style="color:#bbb"> </span>RabbitTemplate<span style="color:#bbb"> </span>rabbitTemplate;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@GetMapping</span>(<span style="color:#d14">&#34;/delay/send&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">delayExchangeSend</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>rabbitTemplate.<span style="color:#008080">convertAndSend</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>RabbitConstant.<span style="color:#008080">DELAY_EXCHANGE_NAME</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>RabbitConstant.<span style="color:#008080">DELAY_EXCHANGE_ROUTING_KEY</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#d14">&#34;delay_test_message&#34;</span><span style="color:#bbb"> </span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>message<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic">// Spring AMQPå·²ç»åœ¨æ–¹æ³•ä¸Šå·²ç»æ”¯æŒäº†x-delayè¿™ä¸ªå±æ€§</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>message.<span style="color:#008080">getMessageProperties</span>().<span style="color:#008080">setDelay</span>(5000);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000;font-weight:bold">return</span><span style="color:#bbb"> </span>message;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">// æ¶ˆè´¹è€…</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#3c5d5d;font-weight:bold">@Component</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DelayConsumer</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@RabbitListener</span>(queues<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>RabbitConstant.<span style="color:#008080">DELAY_EXCHANGE_QUEUE_NAME</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">process</span>(String<span style="color:#bbb"> </span>data)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(data);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
