<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="logstashçš„ä½¿ç”¨ - https://hobocat.github.io/post/searchengine/2020-08-09-logstash/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>logstashçš„ä½¿ç”¨</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">logstashçš„ä½¿ç”¨</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2020-08-09&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            6467 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            13 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€logstashæ¶æ„ç®€ä»‹">ä¸€ã€Logstashæ¶æ„ç®€ä»‹</a>
      <ul>
        <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
        <li><a href="#æ¶æ„">æ¶æ„</a></li>
        <li><a href="#pipelineå’Œlogstash-event">Pipelineå’ŒLogstash Event</a></li>
        <li><a href="#queueçš„åˆ†ç±»">Queueçš„åˆ†ç±»</a></li>
        <li><a href="#logstashé…ç½®æ–‡ä»¶">Logstashé…ç½®æ–‡ä»¶</a></li>
        <li><a href="#pipelineé…ç½®è¯­æ³•">Pipelineé…ç½®è¯­æ³•</a></li>
      </ul>
    </li>
    <li><a href="#äºŒinputæ’ä»¶">äºŒã€Inputæ’ä»¶</a>
      <ul>
        <li><a href="#stdinæ’ä»¶">stdinæ’ä»¶</a></li>
        <li><a href="#fileæ’ä»¶">fileæ’ä»¶</a></li>
        <li><a href="#kafkaæ’ä»¶">kafkaæ’ä»¶</a></li>
        <li><a href="#httpæ’ä»¶">httpæ’ä»¶</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰codecæ’ä»¶">ä¸‰ã€Codecæ’ä»¶</a>
      <ul>
        <li><a href="#plaindotsrubydebug">plain&amp;dots&amp;rubydebug</a></li>
        <li><a href="#linejson">line&amp;json</a></li>
        <li><a href="#multiline">multiline</a></li>
      </ul>
    </li>
    <li><a href="#å››filteræ’ä»¶">å››ã€Filteræ’ä»¶</a>
      <ul>
        <li><a href="#date-filter">Date Filter</a></li>
        <li><a href="#grok-filter">Grok Filter</a></li>
        <li><a href="#dissect-filter">Dissect Filter</a></li>
        <li><a href="#mutate-filter">Mutate Filter</a></li>
        <li><a href="#json-filter">Json Filter</a></li>
        <li><a href="#geoip-filter">GeoIp Filter</a></li>
        <li><a href="#ruby-filter">ruby Filter</a></li>
      </ul>
    </li>
    <li><a href="#äº”outputæ’ä»¶">äº”ã€Outputæ’ä»¶</a>
      <ul>
        <li><a href="#stdoutæ’ä»¶">stdoutæ’ä»¶</a></li>
        <li><a href="#fileæ’ä»¶-1">fileæ’ä»¶</a></li>
        <li><a href="#elasticsearchæ’ä»¶">elasticsearchæ’ä»¶</a></li>
      </ul>
    </li>
    <li><a href="#å…­è°ƒè¯•æŠ€å·§">å…­ã€è°ƒè¯•æŠ€å·§</a>
      <ul>
        <li><a href="#ç‰¹æ®Šå­—æ®µ">ç‰¹æ®Šå­—æ®µ</a></li>
        <li><a href="#ç›‘æ§">ç›‘æ§</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒä»mysqlå¯¼å…¥æ•°æ®åˆ°es">ä¸ƒã€ä»MySQLå¯¼å…¥æ•°æ®åˆ°ES</a></li>
    <li><a href="#å…«ä»csvä¸­å¯¼å‡ºæ•°æ®åˆ°es">å…«ã€ä»CSVä¸­å¯¼å‡ºæ•°æ®åˆ°ES</a></li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€logstashæ¶æ„ç®€ä»‹">ä¸€ã€Logstashæ¶æ„ç®€ä»‹</h2>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p>logstashæ˜¯ä¸€ä¸ªæ•°æ®æ”¶é›†å¤„ç†å¼•æ“ï¼Œå¯æ˜¯è§†ä¹‹ä¸ºä¸€ä¸ªETLå·¥å…·ã€‚</p>
<h3 id="æ¶æ„">æ¶æ„</h3>
<img src="/img/searchengine/logstash-struct.png" style="zoom:67%;" />
<ul>
<li>Input        ç”¨äºä»æ•°æ®æºè·å–æ•°æ®ï¼Œå¸¸è§çš„æ’ä»¶å¦‚<code>file</code>ï¼Œ<code> syslog</code>ï¼Œ<code> redis</code>ï¼Œ <code>beats</code> ç­‰</li>
<li>Codec      åœ¨è¾“å…¥å’Œè¾“å‡ºç­‰æ’ä»¶ä¸­ç”¨äºæ•°æ®è½¬æ¢çš„æ¨¡å—ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç¼–ç å¤„ç†ï¼Œå¸¸è§çš„æ’ä»¶å¦‚<code>json</code>ï¼Œ<code>multiline</code></li>
<li>Queue     æ•°æ®å›ç»è¿‡Queueè¿›è¡Œåˆ†å‘ï¼Œæœ‰<code>In Memory</code>å’Œ<code>Persistent Queue In Disk</code>ä¸¤ç§</li>
<li>Batcher   æ‰¹é‡çš„ä»Queueä¸­å–æ•°æ®ï¼Œå‘åä¼ é€’æ•°æ®ã€‚é»˜è®¤50msæˆ–è€…å¾…å¤„ç†æ–‡æ¡£æ•°å¤§äº125æ—¶å‘åä¼ é€’</li>
<li>Filter        ç”¨äºå¤„ç†æ•°æ®å¦‚æ ¼å¼è½¬æ¢ï¼Œæ•°æ®æ´¾ç”Ÿç­‰ï¼Œå¸¸è§çš„æ’ä»¶å¦‚<code>grok</code>ï¼Œ<code>mutate</code>ï¼Œ <code>drop</code>ï¼Œ <code>clone</code>ï¼Œ <code>geoip</code>ç­‰</li>
<li>Output    ç”¨äºæ•°æ®è¾“å‡ºï¼Œå¸¸è§çš„å¦‚<code>elastcisearch</code>ï¼Œ<code>file</code>ï¼Œ<code> graphite</code>, <code>statsd</code>ç­‰</li>
</ul>
<h3 id="pipelineå’Œlogstash-event">Pipelineå’ŒLogstash Event</h3>
<p><code>Pipline</code>ç”±ã€<code>Input</code>ã€‘-ã€<code>Filter</code>ã€‘-ã€<code>Output</code>ã€‘3ä¸ªé˜¶æ®µå¤„ç†æµç¨‹ç»„æˆï¼ŒåŒ…å«äº†é˜Ÿåˆ—ç®¡ç†å’Œæ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†</p>
<p><code>Logstash Event</code>æ˜¯å†…éƒ¨æµè½¬çš„æ•°æ®çš„è¡¨ç°å½¢å¼ã€‚åŸæ•°æ®åœ¨<code>Input</code>è½¬æ¢ä¸º<code>Event</code>ï¼Œåœ¨<code>Output event</code>æ—¶è¢«è½¬æ¢ä¸ºç›®æ ‡æ•°æ®æ ¼å¼ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥å¯¹<code>Event</code>ä¸­çš„å±æ€§è¿›è¡Œåˆ¤æ–­å’Œå¢åˆ æ”¹æŸ¥</p>
<img src="/img/searchengine/logstash-event.png" style="zoom:67%;" />
<h3 id="queueçš„åˆ†ç±»">Queueçš„åˆ†ç±»</h3>
<p><strong>In Memory</strong></p>
<p>æ˜¯ä¸€ä¸ªå†…å­˜çš„Queueï¼Œæ— æ³•é€šè¿‡å‚æ•°è®¾ç½®ã€‚æ— æ³•å¤„ç†è¿›ç¨‹å´©æºƒã€æœºå™¨å®•æœºç­‰æƒ…å†µï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</p>
<p><strong>Persistent Queue In Disk</strong></p>
<p>å¯ä¿è¯åœ¨å‡ºç°æ„å¤–çš„æƒ…å†µä¸‹ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œè€Œä¸”èƒ½ä¿è¯æ•°æ®è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</p>
<blockquote>
<p><code>Persistent Queue In Disk</code>å¯¹æ€§èƒ½å½±å“ä¼°è®¡æ˜¯åœ¨5%ä»¥å†…ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ä¸€èˆ¬å»ºè®®æ‰“å¼€</p>
</blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>queue.type</td>
<td>é˜Ÿåˆ—ç±»å‹å¯é€‰å€¼ï¼špersistedã€memoryã€é»˜è®¤ã€‘</td>
</tr>
<tr>
<td>queue.max_bytes</td>
<td>é˜Ÿåˆ—å­˜å‚¨çš„æœ€å¤§å®¹é‡ï¼Œé»˜è®¤1gb</td>
</tr>
<tr>
<td>path.queue</td>
<td>Persistent Queue In Diskå­˜åˆ°ç£ç›˜çš„å“ªä¸ªä½ç½®</td>
</tr>
<tr>
<td>queue.page_capacity</td>
<td>æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—æ¯ä¸€ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤64mb</td>
</tr>
<tr>
<td>queue.checkpoint.writes</td>
<td>æå‡å®¹ç¾èƒ½åŠ›ï¼Œå¦‚æœæ˜¯1 è¡¨ç¤ºæ¯å†™ä¸€ä¸ªæ•°æ®éƒ½å»åšç›˜ï¼Œé»˜è®¤1024</td>
</tr>
<tr>
<td>pipeline.workers</td>
<td>filter_outputçš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤CPUæ ¸å¿ƒæ•°</td>
</tr>
<tr>
<td>pipeline.batch.size</td>
<td>æ‰¹å¤„ç†å»¶è¿Ÿæ–‡æ¡£æ•°ï¼Œé»˜è®¤125</td>
</tr>
<tr>
<td>pipeline.batch.delay</td>
<td>æ‰¹å¤„ç†å»¶è¿Ÿï¼Œé»˜è®¤50ms</td>
</tr>
</tbody>
</table>
<h3 id="logstashé…ç½®æ–‡ä»¶">Logstashé…ç½®æ–‡ä»¶</h3>
<p><strong>åœ¨confæ–‡ä»¶å¤¹ä¸­è¢«ç§°ä¹‹ä¸ºsetting files</strong></p>
<ul>
<li><code>logstash.yml</code>ä¸­æ˜¯logstashç›¸å…³é…ç½®æ¯”å¦‚<code>node.name</code>ï¼Œ<code>path.data</code>ï¼Œ<code>pipline.workers</code>ã€<code>queue.type</code>ç­‰ï¼Œè¿™äº›é…ç½®å¯ä»¥è¢«å‘½ä»¤è¡Œå‚æ•°æ›¿ä»£</li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>node.name</td>
<td>èŠ‚ç‚¹åï¼Œä¾¿äºè¯†åˆ«</td>
</tr>
<tr>
<td>path.data</td>
<td>æŒä¹…åŒ–å­˜å‚¨æ•°æ®æ–‡ä»¶å¤¹ï¼Œé»˜è®¤logstashä¸‹çš„dataç›®å½•ï¼Œå¤šå®ä¾‹ä¸èƒ½ç›¸åŒ</td>
</tr>
<tr>
<td>path.config</td>
<td>è®¾å®špipelineçš„è·¯å¾„ï¼Œå¦‚æœæ˜¯ç›®å½•åˆ™æ‰«æç›®å½•ä¸‹çš„æ‰€æœ‰.confæ–‡ä»¶</td>
</tr>
<tr>
<td>path.log</td>
<td>pipelineæ—¥å¿—æ–‡ä»¶çš„ç›®å½•</td>
</tr>
<tr>
<td>pipeline.workers</td>
<td>è®¾å®špipelineçš„çº¿ç¨‹æ•°</td>
</tr>
<tr>
<td>pipeline.batch.size/delay</td>
<td>æ‰¹å¤„ç†å»¶è¿Ÿ</td>
</tr>
<tr>
<td>queue.type</td>
<td>é˜Ÿåˆ—ç±»å‹å¯é€‰å€¼ï¼špersistedã€memory</td>
</tr>
<tr>
<td>queue.max_bytes</td>
<td>é˜Ÿåˆ—å­˜å‚¨çš„æœ€å¤§å®¹é‡ï¼Œé»˜è®¤1gb</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å‘½ä»¤è¡Œå‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>&ndash;node.name</td>
<td>åŒnode.name</td>
</tr>
<tr>
<td>-f</td>
<td>åŒpath.config</td>
</tr>
<tr>
<td>&ndash;path.settings</td>
<td>logstashæ–‡ä»¶å¤¹ç›®å½•ä¸»è¦åŒ…å«logstash.ymlï¼Œå¯åŠ¨å¤šå®ä¾‹æ—¶ä¼šç”¨</td>
</tr>
<tr>
<td>-e</td>
<td>æŒ‡æ˜pipelineæ–‡ä»¶å†…å®¹ï¼Œå¤šç”¨äºæµ‹è¯•</td>
</tr>
<tr>
<td>-w</td>
<td>åŒpipeline.workers</td>
</tr>
<tr>
<td>-b</td>
<td>åŒpipeline.batch.size</td>
</tr>
<tr>
<td>&ndash;path.data</td>
<td>åŒpath.data</td>
</tr>
<tr>
<td>&ndash;debug</td>
<td>æ‰“å¼€è°ƒè¯•æ—¥å¿—</td>
</tr>
<tr>
<td>-t</td>
<td>æ£€æµ‹pipelineæ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</td>
</tr>
</tbody>
</table>
<ul>
<li><code>jvm.options</code>æ˜¯ä¿®æ”¹jvmçš„ç›¸å…³å‚æ•°</li>
</ul>
<p><strong>pipelineæ–‡ä»¶</strong></p>
<ul>
<li>
<p>å®šä¹‰æ•°æ®å¤„ç†æµç¨‹çš„æ–‡ä»¶ï¼Œé»˜è®¤ä»¥<code>.conf</code>ç»“å°¾ï¼Œç»“æ„å¦‚ä¸‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filter {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="pipelineé…ç½®è¯­æ³•">Pipelineé…ç½®è¯­æ³•</h3>
<p><strong>æ•°æ®ç±»å‹</strong></p>
<ul>
<li>
<p>å¸ƒå°”ç±»å‹       isFailed =&gt; true</p>
</li>
<li>
<p>æ•°å€¼ç±»å‹       num =&gt; 23</p>
</li>
<li>
<p>å­—ç¬¦ä¸²ç±»å‹   name =&gt; &ldquo;Hello&rdquo;</p>
</li>
<li>
<p>æ•°ç»„ç±»å‹       user =&gt; [ { &ldquo;id&rdquo; =&gt;1, &ldquo;name&rdquo; =&gt; &ldquo;bob&rdquo; }, { &ldquo;id&rdquo; =&gt; 2, &ldquo;name&rdquo;  =&gt; &ldquo;tom&rdquo; } ]   | name =&gt; [ &ldquo;bob&rdquo; , &ldquo;tom&rdquo; ]</p>
</li>
<li>
<p>å“ˆå¸Œç±»å‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>match =&gt; { 
</span></span><span style="display:flex;"><span>  &#34;k1&#34; =&gt; &#34;v1&#34;
</span></span><span style="display:flex;"><span>  &#34;k2&#34; =&gt; &#34;v2&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><strong>æ³¨é‡Š</strong></p>
<p>äº•å·å¼€å¤´<code># This is a comment</code></p>
<p><strong>å–å±æ€§</strong></p>
<ul>
<li>ç›´æ¥å¼•ç”¨å­—æ®µ              ä½¿ç”¨[]å–å‡ºï¼ŒåµŒå¥—ä½¿ç”¨å¤šå±‚[]å³å¯</li>
<li>å­—ç¬¦ä¸²ä½¿ç”¨å¼•ç”¨å€¼      ä½¿ç”¨å¼•ç”¨sprintfè¯­æ³•%{}</li>
</ul>
<p><strong>åˆ¤æ–­å€¼</strong></p>
<ul>
<li>å¯ä»¥ifã€else ifã€elseè¯­æ³•</li>
<li>åˆ¤æ–­çš„è¡¨è¾¾å¼
<ul>
<li>æ¯”è¾ƒ                      ==ï¼Œ!=ï¼Œ&lt;ï¼Œ&gt;ï¼Œ&lt;=ï¼Œ&gt;=</li>
<li>æ­£åˆ™æ˜¯å¦åŒ¹é…      =~ï¼Œ!~</li>
<li>åŒ…å«                      inï¼Œnot in</li>
<li>å¸ƒå°”æ“ä½œç¬¦          andï¼Œorï¼Œnandï¼Œxorï¼Œ!</li>
</ul>
</li>
</ul>
<h2 id="äºŒinputæ’ä»¶">äºŒã€Inputæ’ä»¶</h2>
<p>inputæ’ä»¶æŒ‡å®šäº†æ•°æ®è¾“å…¥æºï¼Œä¸€ä¸ªpipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶ã€‚</p>
<h3 id="stdinæ’ä»¶">stdinæ’ä»¶</h3>
<p>æœ€ç®€å•çš„è¾“å…¥ç±»å‹ï¼Œä»æ ‡å‡†è¾“å…¥æµè¯»å…¥æ•°æ®ï¼Œé€šç”¨é…ç½®ä¸º</p>
<ul>
<li>codecï¼Œç±»å‹ä¸ºcodec</li>
<li>typeï¼Œç±»å‹ä¸ºstringï¼Œè‡ªå®šä¹‰è¯¥äº‹ä»¶çš„ç±»å‹ï¼Œå¯ç”¨äºåç»­åˆ¤æ–­</li>
<li>tagsï¼Œç±»å‹ä¸ºarrayï¼Œè‡ªå®šä¹‰è¯¥äº‹ä»¶çš„tagï¼Œå¯ç”¨äºåç»­åˆ¤æ–­</li>
<li>add_fieldï¼Œç±»å‹ä¸ºhashï¼Œä¸ºè¯¥äº‹ä»¶æ·»åŠ å­—æ®µ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  stdin {
</span></span><span style="display:flex;"><span>    codec =&gt; &#34;plain&#34;
</span></span><span style="display:flex;"><span>    type =&gt; &#34;std&#34;
</span></span><span style="display:flex;"><span>    tags =&gt; [&#34;info log&#34;]
</span></span><span style="display:flex;"><span>    add_field =&gt; {
</span></span><span style="display:flex;"><span>    	&#34;info&#34; =&gt; &#34;this is info message&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {
</span></span><span style="display:flex;"><span>    codec =&gt; &#34;rubydebug&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="fileæ’ä»¶">fileæ’ä»¶</h3>
<p>fileæ’ä»¶ä¼šå®šæ—¶æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ›´æ–°å’Œæ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰æ–°æ–‡ä»¶ç”Ÿæˆï¼Œä¸ºäº†ä¸é‡å¤è¯»å–å†…å®¹ï¼Œä½¿ç”¨äº†<code>sincedb</code>è®°å½•äº†æ–‡ä»¶è¯»å–çš„è¡Œå·ã€‚æ–‡ä»¶è®°å½•çš„çš„åº•å±‚çš„<code>nodeId</code>æ‰€ä»¥å½“æ–‡ä»¶å‘ç”Ÿå½’æ¡£æ—¶ä¹Ÿä¸ä¼šå‘ç”Ÿé”™è¯¯ã€‚å…¶é…ç½®ä¸º</p>
<ul>
<li>pathï¼Œç±»å‹ä¸ºæ•°ç»„ï¼ŒæŒ‡æ˜è¯»å–æ–‡ä»¶çš„è·¯å¾„ï¼ŒåŸºäº<code>glob</code>è¯­æ³•</li>
<li>excludeï¼Œç±»å‹ä¸ºæ•°ç»„ï¼Œæ’é™¤ä¸æƒ³ç›‘å¬çš„æ–‡ä»¶è§„åˆ™ï¼ŒåŸºäº<code>glob</code>è¯­æ³•</li>
<li>sincedb_pathï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œè®°å½•<code>sincedb</code>æ–‡ä»¶è·¯å¾„</li>
<li>start_positionï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œ<code>beginning</code> or <code>end</code>ï¼Œæ˜¯å¦ä»å¤´è¯»å–æ–‡ä»¶</li>
<li>stat_intervalï¼Œç±»å‹ä¸ºæ•°å€¼ï¼Œå•ä½ç§’ï¼Œå®šæ—¶æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°ï¼Œé»˜è®¤ä¸º1s</li>
<li>discover_intervalï¼Œç±»å‹ä¸ºæ•°å€¼ï¼Œå•ä½ç§’ï¼Œå®šæ—¶æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶å¾…è¯»å–ï¼Œé»˜è®¤15s</li>
<li>ignore_olderï¼Œç±»å‹ä¸ºæ•°å€¼ï¼Œå•ä½ç§’ï¼Œæ‰«ææ–‡ä»¶åˆ—è¡¨æ—¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸Šæ¬¡æ›´æ”¹æ—¶é—´è¶…è¿‡è®¾å®šæ—¶é•¿ï¼Œåˆ™ä¸åšå¤„ç†ï¼Œä½†ä¾ç„¶ä¼šç›‘æ§æ˜¯å¦æœ‰æ–°çš„å†…å®¹ï¼Œé»˜è®¤å…³é—­</li>
<li>close_olderï¼Œç±»å‹ä¸ºæ•°å€¼ï¼Œå•ä½ç§’ï¼Œå¦‚æœç›‘å¬çš„æ–‡ä»¶åœ¨è¶…è¿‡çš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ›´æ–°åˆ™å…³é—­æ–‡ä»¶å¥æŸ„ï¼Œé‡Šæ”¾èµ„æºã€‚ä½†æ˜¯ä¾ç„¶ä¼šç»§ç»­ç›‘æ§ï¼Œé»˜è®¤æ—¶é—´3600ç§’</li>
</ul>
<blockquote>
<p>start_postionæœ‰ä¸¤ä¸ªå‚æ•°å¯é€‰ï¼Œé»˜è®¤æ˜¯endï¼Œè¡¨ç¤ºè¿è¡Œlogstashè¿è¡Œä¹‹ååªä¼šè¯»å–ä»logstashè¿è¡Œä¹‹åæ–°è¿›æ¥çš„æ•°æ®ã€‚å¦‚æœæƒ³è®©logstashä»å¤´è¯»å–è¦è®¾ç½®ä¸ºbeginningã€‚æ³¨æ„åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¯»å–çš„æ—¶å€™è¿™ä¸ªbeginningæ‰ç”Ÿæ•ˆï¼Œä¸€æ—¦è¯»å–è¿‡è¿™ä¸ªæ–‡ä»¶åœ¨sincedbä¸­æœ‰è®°å½•äº†ï¼Œlogstashä¹‹åå†å»è·‘å‘ç°åœ¨sincedbä¸­æœ‰è®°å½•äº†ï¼Œå°±ä¸ä¼šç”Ÿæ•ˆäº†ä¹Ÿå°±æ˜¯ä¸ä¼šå†ä»å¤´è¯»å–äº†ã€‚è¿™ä¸ªçš„åå¤„å°±æ˜¯æˆ‘ä»¬åšä¸€äº›è°ƒè¯•çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦åªèƒ½æŠŠsincedbæ–‡ä»¶ç»™åˆ æ‰ã€‚æˆ‘ä»¬å¯ä»¥æŠŠsincedb_pathè®¾ç½®ä¸º/dev/null è¿™æ˜¯ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œæ‰€æœ‰å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½ä¸ä¼šå­˜å‚¨ï¼Œé‚£ä¹ˆè¿™æ ·å†æŠŠstart_postionè®¾ç½®ä¸ºbeginningè¿™æ ·æ¯ä¸€æ¬¡è¿è¡Œlogstashçš„æ—¶å€™éƒ½æ˜¯ä»å¤´è¯»å–çš„ã€‚</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  file {
</span></span><span style="display:flex;"><span>    path =&gt; &#34;/var/log/*.log&#34;
</span></span><span style="display:flex;"><span>    sincedb_path =&gt; &#34;/dev/null&#34;
</span></span><span style="display:flex;"><span>    start_position =&gt; &#34;beginning&#34;
</span></span><span style="display:flex;"><span>    discover_interval =&gt; 15
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {codec =&gt; rubydebug {}}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="kafkaæ’ä»¶">kafkaæ’ä»¶</h3>
<p>kafkaæ˜¯æœ€æµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåœ¨Elastic Stackæ¶æ„ä¸­å¸¸ç”¨ï¼Œä½¿ç”¨ç›¸å¯¹ç®€å•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  kafka {
</span></span><span style="display:flex;"><span>    zk_connect =&gt; &#34;kafka:2181&#34;
</span></span><span style="display:flex;"><span>    group_id =&gt; &#34;logstash&#34;
</span></span><span style="display:flex;"><span>    topic_id =&gt; &#34;apache_logs&#34;
</span></span><span style="display:flex;"><span>    consumer_threads =&gt; 16
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {codec =&gt; rubydebug {}}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="httpæ’ä»¶">httpæ’ä»¶</h3>
<p>å¸¸å’Œå¯åŠ¨å‚æ•°<code>-r</code>è¿ç”¨ï¼Œç”¨äºçƒ­è°ƒè¯•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  http {
</span></span><span style="display:flex;"><span>    port =&gt; &#34;5555&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {codec =&gt; rubydebug {}}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸‰codecæ’ä»¶">ä¸‰ã€Codecæ’ä»¶</h2>
<p><code>codec</code>æ’ä»¶ä½œç”¨äº<code>input</code>æ’ä»¶å’Œ<code>output</code>æ’ä»¶ï¼Œè´Ÿè´£å°†æ•°æ®åœ¨åŸå§‹äº<code>logstash event</code>ä¹‹é—´è½¬æ¢ï¼Œå¸¸è§çš„codecæœ‰</p>
<ul>
<li>plain              è¯»å–åŸå§‹å†…å®¹</li>
<li>dots               å°†å†…å®¹ç®€åŒ–ä¸ºç‚¹è¿›è¡Œè¾“å‡º</li>
<li>rubydebug    å°†<code>Logstash Event</code>æŒ‰ç…§rubyæ ¼å¼è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•</li>
<li>line                å¤„ç†å¸¦æœ‰æ¢è¡Œç¬¦çš„å†…å®¹</li>
<li>json               å¤„ç†jsonå†…å®¹</li>
<li>multiline       å¤„ç†å¤šè¡Œæ•°æ®çš„å†…å®¹</li>
</ul>
<h3 id="plaindotsrubydebug">plain&amp;dots&amp;rubydebug</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>bin/logstash -e &#34;input{stdin{codec=&gt;\&#34;plain\&#34;}} output{stdout{codec=&gt;\&#34;rubydebug\&#34;}}&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bin/logstash -e &#34;input{stdin{codec=&gt;\&#34;plain\&#34;}} output{stdout{codec=&gt;\&#34;dots\&#34;}}&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="linejson">line&amp;json</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>bin/logstash -e &#34;input{stdin{codec=&gt;\&#34;line\&#34;}} output{stdout{codec=&gt;\&#34;rubydebug\&#34;}}&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bin/logstash -e &#34;input{stdin{codec=&gt;\&#34;json\&#34;}} output{stdout{codec=&gt;\&#34;rubydebug\&#34;}}&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="multiline">multiline</h3>
<p>å½“ä¸€ä¸ªEventçš„messageç”±å¤šè¡Œç»„æˆæ—¶éœ€è¦ä½¿ç”¨<code>mutiline codec</code>ï¼Œå¸¸è§çš„æƒ…å†µæ—¶å¤„ç†Javaå †æ ˆå¼‚å¸¸ã€‚ä¸»è¦å‚æ•°å¦‚ä¸‹</p>
<ul>
<li>pattern                            è®¾ç½®è¡ŒåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨<code>grok</code>è¯­æ³•</li>
<li>what previous | next    å¦‚æœåŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆåŒ¹é…è¡Œæ˜¯å±äºä¸Šä¸€ä¸ªæ—¶é—´è¿˜å‰©ä¸‹ä¸€ä¸ªäº‹ä»¶</li>
<li>negate true | false        æ˜¯å¦å¯¹<code>pattern</code>åŒ¹é…ç»“æœå–åï¼Œé»˜è®¤false</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>##################################ä»¥ä¸‹å¯ä»¥ç”¨äºç®€å•è¯»å–javaå †æ ˆè·Ÿè¸ªæ—¥å¿—##################################
</span></span><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  stdin {
</span></span><span style="display:flex;"><span>    codec =&gt; multiline {
</span></span><span style="display:flex;"><span>      what =&gt; &#34;next&#34;
</span></span><span style="display:flex;"><span>      negate =&gt; false
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {
</span></span><span style="display:flex;"><span>    codec =&gt; &#34;rubydebug&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å››filteræ’ä»¶">å››ã€Filteræ’ä»¶</h2>
<p>Filteræ˜¯logstashåŠŸèƒ½å¼ºå¤§çš„ä¸»è¦åŸå› ï¼Œå®ƒå¯ä»¥å¯¹<code>Logstash Event</code>è¿›è¡Œä¸°å¯Œçš„å¤„ç†ï¼Œæ¯”å¦‚æ•°æ®è§£æã€åˆ é™¤å­—æ®µã€ç±»å‹è½¬æ¢ç­‰ç­‰ã€‚å¸¸è§å¦‚ä¸‹ï¼š</p>
<ul>
<li>date        æ—¥æœŸè§£æ</li>
<li>grok        æ­£åˆ™åŒ¹é…è§£æ</li>
<li>dissect    åˆ†å‰²ç¬¦è§£æ</li>
<li>mutate    å¯¹å­—æ®µå¤„ç†ï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ç­‰</li>
<li>json         æŒ‰ç…§jsonè§£æå­—æ®µå†…å®¹åˆ°æŒ‡å®šå­—æ®µä¸­</li>
<li>geoip       å¢åŠ åœ°ç†ä½ç½®æ•°æ®</li>
<li>ruby         åˆ©ç”¨rubyä»£ç æ¥ä¿®æ”¹<code>Logstash Event</code></li>
</ul>
<h3 id="date-filter">Date Filter</h3>
<p>å°†æ—¥æœŸå­—ç¬¦ä¸²è§£æä¸ºæ—¥æœŸç±»å‹</p>
<ul>
<li>match        ç±»å‹ä¸ºæ•°ç»„ï¼Œç”¨äºæŒ‡å®šæ—¥æœŸåŒ¹é…æ ¼å¼ï¼Œå¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šç§æ—¥æœŸæ ¼å¼</li>
<li>target         ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šèµ‹å€¼çš„å­—æ®µåï¼Œé»˜è®¤ä¸º@timestamp</li>
<li>timezone   ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæ—¶åŒº</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  stdin {
</span></span><span style="display:flex;"><span>    codec =&gt; json
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  date {
</span></span><span style="display:flex;"><span>    # åŒ¹é…çš„å­—æ®µ
</span></span><span style="display:flex;"><span>    match =&gt; [&#34;log_date&#34;, &#34;yyyy-MM-dd HH:mm:ss&#34;]
</span></span><span style="display:flex;"><span>    # èµ‹å€¼ç›®æ ‡å­—æ®µï¼Œå¦‚æœä¸è®¾ç½®åˆ™ä¼šè¦†ç›–@timestampï¼Œå¦‚æœè®¾ç½®æ—¶åŒºè€Œä¸”è¦†ç›–æœ¬å­—æ®µï¼Œæ—¶åŒºæ— æ•ˆ
</span></span><span style="display:flex;"><span>    target =&gt; &#34;log_data&#34;
</span></span><span style="display:flex;"><span>    # æ—¶åŒºè®¾ç½®
</span></span><span style="display:flex;"><span>    timezone =&gt; &#34;Asia/Shanghai&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output{
</span></span><span style="display:flex;"><span>  stdout {
</span></span><span style="display:flex;"><span>    codec =&gt; rubydebug
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grok-filter">Grok Filter</h3>
<p>ä½¿ç”¨å®šä¹‰å¥½çš„æˆ–è€…è‡ªå®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå·²å®šä¹‰çš„å¸¸ç”¨æ­£åˆ™æŸ¥çœ‹<a href="https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns">å‚è€ƒ</a></p>
<p>Grokè¯­æ³•ä¸º<code>%{SYNTAX:SEMANTIC}</code>ï¼Œ<code>SYNTAX</code>ä¸º<code>grok pattern</code>çš„åç§°ï¼Œ<code>SEMANTIC</code>ä¸ºèµ‹å€¼å­—æ®µåç§°ã€‚<code>%{NUMBER:duration}</code>å¯ä»¥ç”¨äºåŒ¹é…æ•°å€¼ç±»å‹ï¼Œå¯ä»¥åœ¨åè·Ÿ<code>int</code>æˆ–<code>float</code>æ¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚<code>%{NUMBER:duration:int}</code>ã€‚<span style="color:red">å¦‚æœåŒ¹é…å¤±è´¥å°†ä¼šæœ‰ä¸€ä¸ª<code>_grokparsefailure</code>å­—æ®µäº§ç”Ÿï¼Œå¯ç”¨äºåç»­åˆ¤æ–­</span></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>##################################ä½¿ç”¨ç³»ç»Ÿå®šä¹‰çš„pattern##################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  grok {
</span></span><span style="display:flex;"><span>    match =&gt; { &#34;message&#34;=&gt;&#34;%{IP:ip} %{GREEDYDATA:data}&#34;}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>##################################ä½¿ç”¨è‡ªå®šä¹‰çš„pattern##################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  grok {
</span></span><span style="display:flex;"><span>    match =&gt; { &#34;message&#34;=&gt;&#34;%{IP:ip} %{SERVICE_NAME:service_name} %{GREEDYDATA:data}&#34;}
</span></span><span style="display:flex;"><span>    pattern_definitions =&gt; {
</span></span><span style="display:flex;"><span>      &#34;SERVICE_NAME&#34; =&gt; &#34;[a-zA-Z]{5}&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>###################################overwriteçš„ä½¿ç”¨###################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  grok {
</span></span><span style="display:flex;"><span>    match =&gt; { &#34;message&#34;=&gt;&#34;%{IP:ip} %{GREEDYDATA:message}&#34;}
</span></span><span style="display:flex;"><span>    overwrite =&gt; [&#34;message&#34;] #å°†ä¸Šè¿°åŒ¹é…çš„messageä¿¡æ¯è¦†ç›–åˆ°messageï¼Œå¦‚æœæ²¡æœ‰overwriteå°†ä¸æ‰§è¡Œè¦†ç›–æ“ä½œ
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dissect-filter">Dissect Filter</h3>
<p>åŸºäºåˆ†éš”ç¬¦çš„åŸç†è¿›è¡Œè§£ææ•°æ®ï¼Œæ•°æ®æ¯”<code>grok</code>å¿«ï¼Œä½†æ˜¯ä½¿ç”¨å…·æœ‰å±€é™æ€§</p>
<ul>
<li><code>+</code>å…·æœ‰æ‹¼æ¥æ•ˆæœ</li>
<li><code>/num</code>ä»£è¡¨æ‹¼æ¥çš„é¡ºåº</li>
<li><code>?</code>ä»£è¡¨åˆ›å»ºä¸€ä¸ªå±æ€§åï¼Œ<code>&amp;</code>ä»£è¡¨ç»™<code>?</code>çš„å±æ€§åèµ‹å€¼</li>
<li><code>convert_datatype</code>å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  dissect {
</span></span><span style="display:flex;"><span>    mapping =&gt; {
</span></span><span style="display:flex;"><span>      &#34;message&#34; =&gt; &#34;%{+ts/2} %{+ts/1}&#34;
</span></span><span style="display:flex;"><span>      &#34;urlParams&#34; =&gt; &#34;%{?username}=%{&amp;username}&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    convert_datatype =&gt; {
</span></span><span style="display:flex;"><span>      &#34;age&#34; =&gt; &#34;int&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mutate-filter">Mutate Filter</h3>
<p>å¯ä»¥å¯¹å„ç§å­—æ®µè¿›è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ã€æ›´æ–°ç­‰ã€‚ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>convert                  ç±»å‹è½¬æ¢</li>
<li>gsub                       å­—ç¬¦ä¸²æ›¿æ¢</li>
<li>split/join/merge   å­—ç¬¦ä¸²åˆ‡å‰²ã€æ•°ç»„åˆå¹¶ä¸ºå­—ç¬¦ä¸²ã€æ•°ç»„åˆå¹¶ä¸ºæ•°ç»„</li>
<li>rename                  å­—æ®µé‡å‘½å</li>
<li>update/rename    å­—æ®µé‡å‘½å</li>
<li>remove_field         åˆ é™¤å­—æ®µ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#convert å®ç°å­—æ®µç±»å‹è½¬æ¢ï¼Œç±»å‹ä¸ºhashï¼Œæ”¯æŒè½¬æ¢ä¸ºintegerã€floatã€stringå’Œboolean  #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span> mutate {
</span></span><span style="display:flex;"><span>   convert =&gt; {
</span></span><span style="display:flex;"><span>     &#34;age&#34; =&gt; &#34;integer&#34;
</span></span><span style="display:flex;"><span>     &#34;isLived&#34; =&gt; &#34;boolean&#34;
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#gsub å¯¹å­—æ®µå†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œç±»å‹ä¸ºæ•°ç»„ï¼Œæ¯ä¸‰é¡¹ä¸ºä¸€ä¸ªæ›¿æ¢é…ç½®                          #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    gsub =&gt; [
</span></span><span style="display:flex;"><span>      &#34;path&#34;,&#34;[\\]&#34;,&#34;/&#34;,
</span></span><span style="display:flex;"><span>      &#34;urlParams&#34;,&#34;[\\?#-]&#34;,&#34;.&#34;
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#split/join/merge å­—ç¬¦ä¸²åˆ‡å‰²ã€æ•°ç»„åˆå¹¶ä¸ºå­—ç¬¦ä¸²ã€æ•°ç»„åˆå¹¶ä¸ºæ•°ç»„                    #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    split =&gt; {&#34;jobs&#34; =&gt; &#34;,&#34;}
</span></span><span style="display:flex;"><span>    join  =&gt; {&#34;hobby&#34; =&gt; &#34;,&#34;}
</span></span><span style="display:flex;"><span>    merge =&gt; {&#34;dest_arr&#34; =&gt; &#34;source_arr&#34;}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#rename   å°†å­—æ®µé‡å‘½å                                                       #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    rename =&gt; {
</span></span><span style="display:flex;"><span>    &#34;message&#34; =&gt; &#34;source&#34;
</span></span><span style="display:flex;"><span>    &#34;@timestamp&#34; =&gt; &#34;create_time&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#update    åªåœ¨å­—æ®µå­˜åœ¨æ—¶ç”Ÿæ•ˆ                                                 #   
</span></span><span style="display:flex;"><span>#replace   å¦‚æœå­—æ®µä¸å­˜åœ¨ä¼šæ‰§è¡Œæ–°å¢æ“ä½œ                                        #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    replace =&gt; {&#34;source&#34; =&gt; &#34;source: %{message}&#34;}
</span></span><span style="display:flex;"><span>    update =&gt; {&#34;age&#34; =&gt; &#34;This is %{age}&#34;}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>#remove_field  åˆ é™¤å­—æ®µ                                                     #
</span></span><span style="display:flex;"><span>############################################################################
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    remove_field =&gt; [&#34;@timestamp&#34;]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="json-filter">Json Filter</h3>
<p>å°†å­—æ®µå†…å®¹ä¸ºjsonæ ¼å¼çš„æ•°æ®è¿›è¡Œè§£æ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span># æ³¨æ„ä¸èƒ½åœ¨httpçš„Postçš„entityä¸ºJsonçš„çŠ¶æ€ä¸‹æµ‹è¯•
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  json {
</span></span><span style="display:flex;"><span>    source =&gt; &#34;message&#34;
</span></span><span style="display:flex;"><span>    # å¦‚æœæ²¡æœ‰targetå®ƒå°†ä¼šè¢«æ”¾åœ¨rootçº§åˆ«ï¼Œå¦‚æœæœ‰targetå°†ä¼šæ”¾åœ¨targetä¸‹
</span></span><span style="display:flex;"><span>    target =&gt; &#34;msg_json&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="geoip-filter">GeoIp Filter</h3>
<p>æä¾›äº†æ ¹æ®Ipåœ°å€å¯¹åº”çš„ç»çº¬åº¦ã€åŸå¸‚åç­‰æ•°æ®çš„æŸ¥è¯¢ï¼Œæ–¹ä¾¿è¿›è¡Œåœ°ç†ä½ç½®çš„åˆ†æ</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  geoip {
</span></span><span style="display:flex;"><span>    source =&gt; &#34;ip&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ruby-filter">ruby Filter</h3>
<p>æœ€çµæ´»çš„æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡rubyä»£ç æ¥ä¿®æ”¹<code>Logstash Event</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  ruby {
</span></span><span style="display:flex;"><span>    codec =&gt; &#39;size = event.get(&#34;message&#34;).size;
</span></span><span style="display:flex;"><span>              event.set(&#34;message_size&#34;, size)&#39;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”outputæ’ä»¶">äº”ã€Outputæ’ä»¶</h2>
<h3 id="stdoutæ’ä»¶">stdoutæ’ä»¶</h3>
<p>è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµï¼Œä¸€èˆ¬ç”¨äºè°ƒè¯•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  stdout {
</span></span><span style="display:flex;"><span>    codec =&gt; rubydebug
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="fileæ’ä»¶-1">fileæ’ä»¶</h3>
<p>è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸€èˆ¬ç”¨äºå°†å¤šåœ°åˆ†æ•£æ—¥å¿—ç»Ÿä¸€çš„éœ€æ±‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span># é»˜è®¤ä»¥jsonæ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œä¸‹é¢æ”¹ä¸ºäº†è¡Œè¾“å‡ºï¼Œè¾“å‡ºEventä¸­çš„formatå­—æ®µ
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  file {
</span></span><span style="display:flex;"><span>    path =&gt; &#34;/opt/web.log&#34;
</span></span><span style="display:flex;"><span>    codec =&gt; line{ format =&gt; &#34;%{message}&#34;}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="elasticsearchæ’ä»¶">elasticsearchæ’ä»¶</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  elasticsearch {
</span></span><span style="display:flex;"><span>    hosts =&gt; [&#34;127.0.0.1:9200&#34;]
</span></span><span style="display:flex;"><span>    index =&gt; &#34;nginx-%{+YYYY.MM.dd}&#34;
</span></span><span style="display:flex;"><span>    document_id =&gt; &#34;%{id}&#34;  #ä½œä¸ºIDçš„å­—æ®µ
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­è°ƒè¯•æŠ€å·§">å…­ã€è°ƒè¯•æŠ€å·§</h2>
<h3 id="ç‰¹æ®Šå­—æ®µ">ç‰¹æ®Šå­—æ®µ</h3>
<p>å­˜åœ¨ä¸€ä¸ª<code>@metadata</code>çš„å­—æ®µï¼Œå…¶å†…å®¹ä¸ä¼šè¾“å‡ºåœ¨outputä¸­ï¼Œæ­¤å­—æ®µé€‚åˆç”¨äºåšæ¡ä»¶åˆ¤æ–­ï¼Œä¸´æ—¶å­˜å‚¨ç­‰ã€‚ç›¸æ¯”<code>remove_field</code>æ€§èƒ½å¥½ã€‚</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  http {
</span></span><span style="display:flex;"><span>    port =&gt; 5555
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    add_field =&gt; {
</span></span><span style="display:flex;"><span>      &#34;[@metadata][debug]&#34;=&gt; true
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>  if([@metadata][debug]) {
</span></span><span style="display:flex;"><span>    stdout {
</span></span><span style="display:flex;"><span>      codec =&gt; rubydebug
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }else {
</span></span><span style="display:flex;"><span>    elasticsearch {
</span></span><span style="display:flex;"><span>      hosts =&gt; [&#34;127.0.0.1:9200&#34;]
</span></span><span style="display:flex;"><span>      index =&gt; &#34;nginx-%{+YYYY.MM.dd}&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç›‘æ§">ç›‘æ§</h3>
<p>åœ¨<code>logstash.yml</code>ä¸‹æ‰“å¼€<code>xpack</code>ç›‘æ§é…ç½®ï¼Œå³å¯åœ¨elasticsearchä¸­æŸ¥çœ‹logstashçŠ¶æ€</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#000080">xpack.monitoring.elasticsearch.hosts</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;http://192.168.1.155:9200&#34;</span>]<span style="color:#bbb">  </span><span style="color:#998;font-style:italic">#æ³¨æ„http</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸ƒä»mysqlå¯¼å…¥æ•°æ®åˆ°es">ä¸ƒã€ä»MySQLå¯¼å…¥æ•°æ®åˆ°ES</h2>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡</strong></p>
<ul>
<li>
<p>æ•°æ®åº“å¦‚æœåšå¢é‡æ•°æ®å¯¼å…¥ï¼Œå¿…é¡»æé«˜ä¸€ä¸ªå¯æ§è¾¹ç•Œã€‚å¯æ§è¾¹ç•Œä¸€èˆ¬ä½¿ç”¨è‡ªå¢ä¸»é”®æˆ–è€…æ—¶é—´æˆ³</p>
</li>
<li>
<p>logstashä¸èƒ½åˆ›å»ºElasticSearchä¸­çš„ç´¢å¼•ï¼Œæ‰€ä»¥éœ€è¦æ‰‹å·¥åˆ›å»ºç´¢å¼•æˆ–ä½¿ç”¨ç´¢å¼•æ¨¡æ¿</p>
</li>
<li>
<p>å¯¼å…¥mysqlé©±åŠ¨jaråŒ…ã€‚æœ€ä½³ä¿å­˜åœ¨$logstash_home/configç›®å½•ä¸­</p>
</li>
</ul>
<p><strong>ç¬¬äºŒæ­¥ï¼šå®šä¹‰logstash-mysqlå¢é‡å¯¼å…¥é…ç½®æ–‡ä»¶</strong></p>
<p>$logstash_home/configåˆ›å»ºæ–‡ä»¶logstash-mysql-es.conf</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">input {
  jdbc {
    # mysqlç›¸å…³jdbcé…ç½®
    jdbc_connection_string =&gt; &#34;jdbc:mysql://192.168.1.117:3306/logstash?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&#34;
    jdbc_user =&gt; &#34;root&#34;
    jdbc_password =&gt; &#34;123456&#34;

    # jdbcè¿æ¥mysqlé©±åŠ¨çš„æ–‡ä»¶ç›®å½•
    jdbc_driver_library =&gt; &#34;./config/mysql-connector-java-5.1.5.jar&#34;
    jdbc_driver_class =&gt; &#34;com.mysql.jdbc.Driver&#34;
    jdbc_paging_enabled =&gt; true
    jdbc_page_size =&gt; &#34;50000&#34;

    jdbc_default_timezone =&gt;&#34;Asia/Shanghai&#34;

    # å¯ä»¥ç›´æ¥å†™SQLè¯­å¥åœ¨æ­¤å¤„ï¼Œä½¿ç”¨å¤§äºç­‰äºé¿å…ä¸¢å¤±æ•°æ®ã€‚å¦‚ä¸‹ï¼š
    statement =&gt; &#34;select * from test_logstash where update_time &gt;= :sql_last_value&#34;
    
    # ä¹Ÿå¯ä»¥å°†SQLå®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š
    #statement_filepath =&gt; &#34;./config/jdbc.sql&#34;

    # è¿™é‡Œç±»ä¼¼crontab,å¯ä»¥å®šåˆ¶å®šæ—¶æ“ä½œï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åŒæ­¥(åˆ† æ—¶ å¤© æœˆ å¹´)
    schedule =&gt; &#34;* * * * *&#34;
    
    # åœ¨ES6.xç‰ˆæœ¬ä¸­ï¼Œä¸éœ€è¦å®šä¹‰typeã€‚å³ä½¿å®šä¹‰ï¼Œlogstashä¹Ÿæ˜¯è‡ªåŠ¨åˆ›å»ºç´¢å¼•typeä¸ºdoc
    #type =&gt; &#34;doc&#34;

    # æ˜¯å¦è®°å½•ä¸Šæ¬¡æ‰§è¡Œç»“æœ, å¦‚æœä¸ºçœŸï¼Œå°†ä¼šæŠŠä¸Šæ¬¡æ‰§è¡Œåˆ°çš„tracking_columnå­—æ®µçš„å€¼è®°å½•ä¸‹æ¥ï¼Œä¿å­˜åˆ°last_run_metadata_pathæŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå¯¹ç£ç›˜çš„å­˜å‚¨å‹åŠ›å¤ªå¤§
    #record_last_run =&gt; true

    # æ˜¯å¦éœ€è¦è®°å½•æŸä¸ªcolumnçš„å€¼ï¼Œå¦‚æœrecord_last_runä¸ºçœŸï¼Œå¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦trackçš„columnåç§°ï¼Œæ­¤æ—¶è¯¥å‚æ•°å°±è¦ä¸ºtrueã€‚å¦åˆ™é»˜è®¤trackçš„æ˜¯timestampçš„å€¼
    use_column_value =&gt; true

    # å¦‚æœuse_column_valueä¸ºçœŸ,éœ€é…ç½®æ­¤å‚æ•°.trackçš„æ•°æ®åº“columnå,è¯¥columnå¿…é¡»æ˜¯é€’å¢çš„. ä¸€èˆ¬æ˜¯mysqlä¸»é”®
    tracking_column =&gt; &#34;update_time&#34;
    
    tracking_column_type =&gt; &#34;timestamp&#34;

    last_run_metadata_path =&gt; &#34;./logstash_capital_bill_last_id&#34;

    # æ˜¯å¦æ¸…é™¤last_run_metadata_pathçš„è®°å½•,å¦‚æœä¸ºçœŸé‚£ä¹ˆæ¯æ¬¡éƒ½ç›¸å½“äºä»å¤´å¼€å§‹æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åº“è®°å½•
    clean_run =&gt; false

    #æ˜¯å¦å°†å­—æ®µ(column)åç§°è½¬å°å†™
    lowercase_column_names =&gt; false
  }
}

output {
  elasticsearch {
    hosts =&gt; &#34;localhost:9200&#34;       #å¦‚æœæ˜¯å¤šä¸ªES,ä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªipå’Œç«¯å£
    index =&gt; &#34;mysql_datas&#34;          #ç´¢å¼•åç§° 
    document_id =&gt; &#34;%{id}&#34;          #æ•°æ®åº“ä¸­æ•°æ®ä¸ESä¸­documentæ•°æ®å…³è”çš„å­—æ®µï¼Œæ­¤å¤„ä»£è¡¨æ•°æ®åº“ä¸­çš„idå­—æ®µå’ŒESä¸­çš„documentçš„idå…³è”
    template_overwrite =&gt; true      #æ˜¯å¦ä½¿ç”¨æ¨¡æ¿ï¼Œå¼€å¯æ•ˆç‡æ›´é«˜
  }

  # è¿™é‡Œè¾“å‡ºè°ƒè¯•ï¼Œæ­£å¼è¿è¡Œæ—¶å¯ä»¥æ³¨é‡Šæ‰
  stdout {
      codec =&gt; json_lines
  } 
}
</code></pre><p><strong>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bin/logstash -f config/logstash-mysql-es.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…«ä»csvä¸­å¯¼å‡ºæ•°æ®åˆ°es">å…«ã€ä»CSVä¸­å¯¼å‡ºæ•°æ®åˆ°ES</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>  file {
</span></span><span style="display:flex;"><span>    path =&gt; &#34;/opt/elasticsearch/logstash/instance2/earthquakes.csv&#34;
</span></span><span style="display:flex;"><span>    sincedb_path =&gt; &#34;/dev/null&#34;
</span></span><span style="display:flex;"><span>    start_position =&gt; &#34;beginning&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>  csv {
</span></span><span style="display:flex;"><span>    columns =&gt; [&#34;dateTime&#34;,&#34;latitude&#34;,&#34;longitude&#34;,&#34;depth&#34;,&#34;magnitude&#34;,&#34;magType&#34;,
</span></span><span style="display:flex;"><span>                &#34;nbStations&#34;,&#34;gap&#34;,&#34;distance&#34;,&#34;rms&#34;,&#34;source&#34;,&#34;eventID&#34;]
</span></span><span style="display:flex;"><span>    convert =&gt; {
</span></span><span style="display:flex;"><span>      &#34;latitude&#34; =&gt; &#34;float&#34;
</span></span><span style="display:flex;"><span>      &#34;longitude&#34; =&gt; &#34;float&#34;
</span></span><span style="display:flex;"><span>      &#34;depth&#34; =&gt; &#34;float&#34;
</span></span><span style="display:flex;"><span>      &#34;rms&#34; =&gt; &#34;float&#34;
</span></span><span style="display:flex;"><span>      &#34;gap&#34; =&gt; &#34;float&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  date {
</span></span><span style="display:flex;"><span>    match =&gt; [&#34;dateTime&#34;, &#34;yyyy/MM/dd HH:mm:ss.SS&#34;]
</span></span><span style="display:flex;"><span>    timezone =&gt; &#34;Asia/Shanghai&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  mutate {
</span></span><span style="display:flex;"><span>    add_field =&gt; {
</span></span><span style="display:flex;"><span>      &#34;[@metadata][debug]&#34;=&gt; true
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>   if([@metadata][debug]) {
</span></span><span style="display:flex;"><span>    stdout {
</span></span><span style="display:flex;"><span>      codec =&gt; rubydebug
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }else {
</span></span><span style="display:flex;"><span>    elasticsearch {
</span></span><span style="display:flex;"><span>      hosts =&gt; [&#34;127.0.0.1:9200&#34;]
</span></span><span style="display:flex;"><span>      index =&gt; &#34;csv_datas&#34;   
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
