<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Prometheus&amp;Grafanaçš„ä½¿ç”¨ - https://hobocat.github.io/post/tool/2022-01-29-prometheus-grafana/">
    <meta name="author" content="Jack - https://hobocat.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Prometheus&amp;Grafanaçš„ä½¿ç”¨</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://hobocat.github.io/style.min.94e7ed14b48117025ebd1148adc11f7268f1ebf50d97297ac663edf1aa6f52dc.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div class="container-floating-box">
	<div class="box box1"></div>
	<div class="box box11"></div>
	<div class="box box12"></div>
	<div class="box box2"></div>
	<div class="box box3"></div>
	<div class="box box4"></div>
	<div class="box box5"></div>
	<div class="box box6"></div>
	<div class="box box7"></div>
	<div class="box box8"></div>
	<div class="box box9"></div>
</div>
        <div class="cool-before" style="background: url('/imgs/bg/wallhaven-6qr21l.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">Prometheus&amp;Grafanaçš„ä½¿ç”¨</h1>
    
        
        
            <div id="toc">ğŸ“œ</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <div class="curtag-desc">
            <a href="https://hobocat.github.io/tags/tool/"><img src="/imgs/icons/tag.svg" width="16" /> ç›¸å…³æ–‡ç« ï¼šTool <sup>6</sup></a>
        </div>

        <div class="curtag-post">
            
            
            
                <div class="curtag-post-item ">
                    <a href="https://hobocat.github.io/post/tool/2022-02-15-canal/">Canalçš„ä½¿ç”¨</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://hobocat.github.io/post/tool/2018-09-20-git/">Gitä½¿ç”¨æŒ‡å—</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://hobocat.github.io/post/tool/2021-02-07-guava/">Guavaçš„ä½¿ç”¨</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://hobocat.github.io/post/tool/2022-02-27-mapstruct/">MapStructçš„ä½¿ç”¨</a>
                </div>
                
                
            
            
                <div class="curtag-post-item curtag-post-item--active">
                    <a href="https://hobocat.github.io/post/tool/2022-01-29-prometheus-grafana/">Prometheus&amp;Grafanaçš„ä½¿ç”¨</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://hobocat.github.io/post/tool/2022-02-15-distributed-lock/">åˆ†å¸ƒå¼é”</a>
                </div>
                
                
        </div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2022-01-29&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2024-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            5781 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            12 åˆ†é’Ÿ</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/tool">Tool</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€prometheusç®€ä»‹">ä¸€ã€Prometheusç®€ä»‹</a></li>
    <li><a href="#äºŒprometheusçš„æ¶æ„">äºŒã€Prometheusçš„æ¶æ„</a></li>
    <li><a href="#ä¸‰prometheusåŠå…¶ç»„ä»¶çš„å®‰è£…">ä¸‰ã€PrometheusåŠå…¶ç»„ä»¶çš„å®‰è£…</a>
      <ul>
        <li><a href="#prometheus-serverçš„å®‰è£…">Prometheus Serverçš„å®‰è£…</a></li>
        <li><a href="#å®‰è£…exporteré€‰æ‹©æ€§å®‰è£…">å®‰è£…Exporterï¼ˆé€‰æ‹©æ€§å®‰è£…ï¼‰</a></li>
        <li><a href="#å®‰è£…-pushgatewayé€‰æ‹©æ€§å®‰è£…">å®‰è£… Pushgatewayï¼ˆé€‰æ‹©æ€§å®‰è£…ï¼‰</a></li>
        <li><a href="#alertmanageræ¨¡å—">Alertmanageræ¨¡å—</a></li>
      </ul>
    </li>
    <li><a href="#å››promqlä½¿ç”¨">å››ã€PromQLä½¿ç”¨</a>
      <ul>
        <li><a href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li>
        <li><a href="#æ“ä½œç¬¦">æ“ä½œç¬¦</a></li>
      </ul>
    </li>
    <li><a href="#äº”è‡ªå®šä¹‰ä¸Šä¼ ç›‘æ§æŒ‡æ ‡">äº”ã€è‡ªå®šä¹‰ä¸Šä¼ ç›‘æ§æŒ‡æ ‡</a>
      <ul>
        <li><a href="#exportmetriceæ–¹å¼">Export/metriceæ–¹å¼</a></li>
        <li><a href="#pushgatewayæ–¹å¼">Pushgatewayæ–¹å¼</a></li>
      </ul>
    </li>
    <li><a href="#å…­grafanaå®‰è£…ä¸é›†æˆprometheus">å…­ã€Grafanaå®‰è£…ä¸é›†æˆPrometheus</a>
      <ul>
        <li><a href="#ä¸‹è½½å®‰è£…å¯åŠ¨">ä¸‹è½½ã€å®‰è£…ã€å¯åŠ¨</a></li>
        <li><a href="#é›†æˆ">é›†æˆ</a></li>
        <li><a href="#grafanaçš„ä½¿ç”¨">Grafanaçš„ä½¿ç”¨</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒgrafanaè‡ªå®šä¹‰æŠ¥è­¦">ä¸ƒã€Grafanaè‡ªå®šä¹‰æŠ¥è­¦</a></li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <h2 id="ä¸€prometheusç®€ä»‹">ä¸€ã€Prometheusç®€ä»‹</h2>
<p>Prometheusæ˜¯ä¸€ä¸ªå¼€æºç›‘æ§å’Œè­¦æŠ¥ç³»ç»Ÿã€‚Prometheuså°†å…¶æŒ‡æ ‡æ”¶é›†å¹¶å­˜å‚¨åœ¨æ—¶åºæ•°æ®åº“ä¸­ï¼Œç”¨äºçµæ´»å±•ç¤ºå½“å‰ç›‘æ§åº”ç”¨çš„çŠ¶æ€ã€‚</p>
<p>Prometheuså…¶å¯¹ä¼ ç»Ÿç›‘æ§ç³»ç»Ÿçš„æµ‹è¯•å’Œå‘Šè­¦æ¨¡å‹è¿›è¡Œäº†å½»åº•çš„é¢ è¦†ï¼Œå½¢æˆäº†åŸºäº<span style="color:red">ä¸­å¤®åŒ–</span>çš„è§„åˆ™è®¡ç®—ã€ç»Ÿä¸€åˆ†æå’Œå‘Šè­¦çš„æ–°æ¨¡å‹ã€‚ ç›¸æ¯”äºä¼ ç»Ÿç›‘æ§ç³»ç»Ÿï¼ŒPrometheuså…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹</p>
<ul>
<li>
<p>æ˜“äºç®¡ç†</p>
<p>Prometheusæ ¸å¿ƒéƒ¨åˆ†åªæœ‰ä¸€ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸å­˜åœ¨ä»»ä½•çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆæ•°æ®åº“ï¼Œç¼“å­˜ç­‰ï¼‰ã€‚å› æ­¤ä¸ä¼šæœ‰æ½œåœ¨çº§è”æ•…éšœçš„é£é™©</p>
<p>PrometheusåŸºäº<span style="color:red">Pull</span>æ¨¡å‹çš„æ¶æ„æ–¹å¼ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼ˆæœ¬åœ°ç”µè„‘ï¼Œå¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼‰æ­å»ºæˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿ</p>
<p>å¯¹äºä¸€äº›å¤æ‚çš„æƒ…å†µï¼Œè¿˜å¯ä»¥ä½¿ç”¨Prometheus<span style="color:red">æœåŠ¡å‘ç°ï¼ˆService Discoveryï¼‰</span>çš„èƒ½åŠ›åŠ¨æ€ç®¡ç†ç›‘æ§ç›®æ ‡</p>
</li>
<li>
<p>ç›‘æ§æœåŠ¡çš„å†…éƒ¨è¿è¡ŒçŠ¶æ€</p>
</li>
</ul>
<p>â€‹		Prometheusæœ‰ä¸°å¯Œçš„Clientåº“ï¼Œå¯ä»¥è½»æ¾çš„åœ¨åº”ç”¨ä¸­æ·»åŠ å¯¹Prometheusçš„æ”¯æŒï¼Œä»è€Œå¯ä»¥è·å–æœåŠ¡å’Œåº”ç”¨å†…éƒ¨çœŸæ­£çš„è¿è¡ŒçŠ¶æ€</p>
<ul>
<li>å¼ºå¤§çš„æ•°æ®æ¨¡å‹</li>
</ul>
<p>â€‹		æ‰€æœ‰é‡‡é›†çš„ç›‘æ§æ•°æ®å‡ä»¥æŒ‡æ ‡å’Œæ ‡ç­¾çš„å½¢å¼ä¿å­˜åœ¨å†…ç½®çš„<span style="color:red">æ—¶åºæ•°æ®åº“ï¼ˆTSDBï¼‰</span>å½“ä¸­ã€‚</p>
<ul>
<li>
<p>å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€PromQL</p>
<p>Prometheuså†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®æŸ¥è¯¢è¯­è¨€PromQLã€‚é€šè¿‡ PromQLå¯ä»¥å®ç°å¯¹ç›‘æ§æ•°æ®çš„æŸ¥è¯¢ã€èšåˆ</p>
</li>
<li>
<p>é«˜æ•ˆ</p>
<p>Prometheuså¯ä»¥é«˜æ•ˆåœ°å¤„ç†æ”¶é›†çš„æ•°æ®ï¼Œå¯¹äºå•ä¸€å®ä¾‹è€Œè¨€å®ƒå¯ä»¥å¤„ç†æ•°ä»¥ç™¾ä¸‡çš„ç›‘æ§æŒ‡æ ‡å’Œæ¯ç§’å¤„ç†æ•°åä¸‡çš„æ•°æ®</p>
</li>
<li>
<p>å¯æ‰©å±•æ€§</p>
<p>å»ä¸­å¿ƒåŒ–è®¾è®¡ï¼Œä¾¿äºæ‰©å±•éƒ¨ç½²ï¼Œä»»åŠ¡é‡è¿‡å¤§æ—¶å¯ä»¥å¯¹å…¶è¿›è¡Œæ‰©å±•</p>
</li>
</ul>
<h2 id="äºŒprometheusçš„æ¶æ„">äºŒã€Prometheusçš„æ¶æ„</h2>
<p><img src="/img/prometheus-grafana/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E6%9E%B6%E6%9E%84.png" alt="æ™®ç½—ç±³ä¿®æ–¯æ¶æ„"></p>
<ul>
<li>
<p>é‡‡é›†å±‚</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pushgateway</td>
<td>å½“Prometheusä¸ç›‘æ§æœåŠ¡ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œæˆ–è€…ç›‘æ§çš„æ˜¯ä»»åŠ¡ç±»å‹çš„æ•°æ®ï¼ˆå¯èƒ½åªè¿è¡Œä¸€ä¼šï¼‰ä½¿ç”¨å°†æ•°æ®æ¨é€åˆ°ç½‘å…³çš„æ–¹å¼</td>
</tr>
<tr>
<td>Exporters</td>
<td>ä¸»è¦ç”¨æ¥é‡‡é›†æ•°æ®ï¼Œå¹¶é€šè¿‡HTTPæœåŠ¡çš„å½¢å¼æš´éœ²ç»™Prometheus Serverï¼ŒPrometheus Serveré€šè¿‡è®¿é—®è¯¥Exporteræä¾›çš„æ¥å£ï¼Œå³å¯è·å–åˆ°éœ€è¦é‡‡é›†çš„ç›‘æ§æ•°æ®</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å­˜å‚¨è®¡ç®—å±‚</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prometheus Server</td>
<td>é¢åŒ…å«äº†å­˜å‚¨å¼•æ“å’Œè®¡ç®—å¼•æ“</td>
</tr>
<tr>
<td>Retrieval</td>
<td>ç»„ä»¶ä¸ºå–æ•°ç»„ä»¶ï¼Œå®ƒä¼šä¸»åŠ¨ä»pushgatewayæˆ–è€…exporteræ‹‰å–æŒ‡æ ‡æ•°æ®</td>
</tr>
<tr>
<td>Service Discovery</td>
<td>å¯ä»¥åŠ¨æ€å‘ç°è¦ç›‘æ§çš„ç›®æ ‡</td>
</tr>
<tr>
<td>TSDB</td>
<td>æ•°æ®æ ¸å¿ƒå­˜å‚¨ä¸æŸ¥è¯¢</td>
</tr>
<tr>
<td>HTTP Server</td>
<td>å¯¹å¤–æä¾›HTTPæœåŠ¡</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>åº”ç”¨å±‚</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>AlertManager</td>
<td>æŠ¥è­¦è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®emailã€webhookç­‰ç­‰å‘Šè­¦é€šçŸ¥</td>
</tr>
<tr>
<td>æ•°æ®å¯è§†åŒ–</td>
<td>å¯äºå„ç§æ•°æ®å¯è§†åŒ–ç»„ä»¶é›†æˆä¾‹å¦‚grafanaï¼Œè¾¾åˆ°ä¸“ä¸šçš„å±•ç¤ºæ•ˆæœ</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id="ä¸‰prometheusåŠå…¶ç»„ä»¶çš„å®‰è£…">ä¸‰ã€PrometheusåŠå…¶ç»„ä»¶çš„å®‰è£…</h2>
<h3 id="prometheus-serverçš„å®‰è£…">Prometheus Serverçš„å®‰è£…</h3>
<p>1ã€ä»[å®˜ç½‘åœ°å€][https://prometheus.io/]ä¸‹è½½å®‰è£…åŒ…</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/prometheus/prometheus/releases/download/<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>/prometheus-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz
</span></span></code></pre></td></tr></table>
</div>
</div><p>2ã€è§£å‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -zxvf prometheus-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz -C /opt/module/
</span></span><span style="display:flex;"><span>mv /opt/module/prometheus-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64 /opt/module/prometheus
</span></span></code></pre></td></tr></table>
</div>
</div><p>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶prometheus.yml</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># å…¨å±€è®¾ç½®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">global</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">scrape_interval</span>:<span style="color:#bbb"> </span>15s    <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># é…ç½®æ‹‰å–æ•°æ®çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º1åˆ†é’Ÿã€‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">evaluation_interval</span>:<span style="color:#bbb"> </span>15s<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># è§„åˆ™éªŒè¯(ç”Ÿæˆalert)çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º1åˆ†é’Ÿã€‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># scrape_timeout is set to the global default (10s).</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># æŠ¥è­¦é…ç½®ï¼Œæ²¡æœ‰å¯è§†åŒ–ç•Œé¢ï¼Œä¹Ÿå¯ä½¿ç”¨grafanaçš„æŠ¥è­¦æœºåˆ¶</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">alerting</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">alertmanagers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">static_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic"># - alertmanager:9093</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># æŠ¥è­¦è§„åˆ™</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">rule_files</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># - &#34;first_rules.yml&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># - &#34;second_rules.yml&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼Œæ­¤å°æœåŠ¡å™¨ä½œä¸ºPrometheus Server</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">scrape_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">job_name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;prometheus&#34;</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ç›‘æ§ä½œä¸šçš„åç§°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">static_configs</span>:<span style="color:#bbb">         </span><span style="color:#998;font-style:italic"># è¡¨ç¤ºé™æ€ç›®æ ‡é…ç½®ï¼Œå°±æ˜¯å›ºå®šä»æŸä¸ªtargetæ‹‰å–æ•°æ®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;hostName:9090&#34;</span>]<span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ä¼šä»[http://hostname:9090/metrics]ä¸Šæ‹‰å–æ•°æ®</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>4ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Œæˆ–è€…ç›´æ¥å¯åŠ¨</p>
<ul>
<li>æ·»åŠ ç³»ç»ŸæœåŠ¡</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/systemd/system/prometheus.service
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=Prometheus Monitoring System
</span></span><span style="display:flex;"><span>Documentation=Prometheus Monitoring System
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>ExecStart=/opt/module/prometheus/prometheus \
</span></span><span style="display:flex;"><span>  --config.file=/opt/module/prometheus/prometheus.yml \
</span></span><span style="display:flex;"><span>  --web.listen-address=:9090
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯åŠ¨</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl <span style="color:#0086b3">enable</span> prometheus
</span></span><span style="display:flex;"><span>systemctl start prometheus
</span></span><span style="display:flex;"><span>systemctl status prometheus
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è®¿é—®ã€http://hostname:9090/ã€‘èƒ½æ‰“å¼€webç•Œé¢å³å¯</li>
</ul>
<h3 id="å®‰è£…exporteré€‰æ‹©æ€§å®‰è£…">å®‰è£…Exporterï¼ˆé€‰æ‹©æ€§å®‰è£…ï¼‰</h3>
<p>åœ¨Prometheusçš„æ¶æ„è®¾è®¡ä¸­ï¼ŒPrometheus Serverä¸»è¦è´Ÿè´£æ•°æ®çš„æ”¶é›†ï¼Œå­˜å‚¨å¹¶ä¸”å¯¹å¤–æä¾›æ•°æ®æŸ¥è¯¢æ”¯æŒï¼Œè€Œå®é™…çš„ç›‘æ§æ ·æœ¬æ•°æ®çš„æ”¶é›†åˆ™æ˜¯ç”±Exporterç›´æ¥ä¸ŠæŠ¥ï¼Œæˆ–è€…Pushgatewayæ”¶é›†ä¸ŠæŠ¥å®Œæˆã€‚å› æ­¤ä¸ºäº†èƒ½å¤Ÿç›‘æ§åˆ°æŸäº›ä¸œè¥¿ï¼Œå¦‚ä¸»æœºCPUä½¿ç”¨ç‡ï¼Œéœ€è¦ä½¿ç”¨Exporterã€‚Prometheuså‘¨æœŸæ€§çš„ä»Exporteræš´éœ²çš„HTTPæœåŠ¡åœ°å€ï¼ˆé€šå¸¸æ˜¯/metricsï¼‰æ‹‰å–ç›‘æ§æ ·æœ¬æ•°æ®ã€‚Exporterå¯ä»¥æ˜¯ä¸€ä¸ªç›¸å¯¹å¼€æ”¾çš„æ¦‚å¿µï¼Œæœ‰å¾ˆå¤šå®ç°çš„Exporterå¦‚mysqld_exporterã€‚å…¶å¯ä»¥æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„ç¨‹åºç‹¬ç«‹äºç›‘æ§ç›®æ ‡ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›´æ¥å†…ç½®åœ¨ç›‘æ§ç›®æ ‡ä¸­ã€‚åªè¦èƒ½å¤Ÿå‘Prometheusæä¾›æ ‡å‡†æ ¼å¼çš„ç›‘æ§æ ·æœ¬æ•°æ®å³å¯ã€‚</p>
<h4 id="å®‰è£…node_exporter">å®‰è£…node_exporter</h4>
<p>èƒ½å¤Ÿé‡‡é›†åˆ°ä¸»æœºçš„è¿è¡ŒæŒ‡æ ‡å¦‚CPU, å†…å­˜ï¼Œç£ç›˜ç­‰ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Node Exporterã€‚Node ExporteråŒæ ·é‡‡ç”¨Golangç¼–å†™ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä»»ä½•çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œåªéœ€è¦ä¸‹è½½ï¼Œè§£å‹å³å¯è¿è¡Œã€‚</p>
<p>1ã€ä»[å®˜ç½‘åœ°å€][https://prometheus.io/]ä¸‹è½½å®‰è£…åŒ…åˆ°éœ€è¦ç›‘æ§çš„ä¸»æœº</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/prometheus/node_exporter/releases/download/<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>/node_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz
</span></span></code></pre></td></tr></table>
</div>
</div><p>2ã€è§£å‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -zxvf node_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz -C /opt/module/
</span></span><span style="display:flex;"><span>mv /opt/module/node_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64 /opt/module/node_exporter
</span></span></code></pre></td></tr></table>
</div>
</div><p>3ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Œæˆ–è€…ç›´æ¥å¯åŠ¨</p>
<ul>
<li>æ·»åŠ ç³»ç»ŸæœåŠ¡</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/systemd/system/node_exporter.service
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=node_exporter
</span></span><span style="display:flex;"><span>After=network.target 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>User=root
</span></span><span style="display:flex;"><span>Group=root
</span></span><span style="display:flex;"><span>ExecStart=/opt/module/node_exporter/node_exporter\
</span></span><span style="display:flex;"><span>          --web.listen-address=:9100
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯åŠ¨æœåŠ¡</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl <span style="color:#0086b3">enable</span> node_exporter
</span></span><span style="display:flex;"><span>systemctl start node_exporter
</span></span><span style="display:flex;"><span>systemctl status node_exporter
</span></span></code></pre></td></tr></table>
</div>
</div><p>4ã€é…ç½®Prometheus Serverï¼Œä¿®æ”¹prometheus.yml</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">scrape_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">job_name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;node_exporter&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">static_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#d14">&#34;targetHostName:9100&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>5ã€é‡å¯Prometheus Serverï¼ŒæŸ¥çœ‹http://prometheus_server:9090ï¼Œä¸‹status/targets</p>
<h4 id="å®‰è£…mysqld_exporter">å®‰è£…mysqld_exporter</h4>
<p>1ã€ä»[å®˜ç½‘åœ°å€][https://prometheus.io/]ä¸‹è½½å®‰è£…åŒ…åˆ°éœ€è¦ç›‘æ§çš„ä¸»æœº</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/prometheus/mysqld_exporter/releases/download/<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>/mysqld_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz
</span></span></code></pre></td></tr></table>
</div>
</div><p>2ã€è§£å‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -zxvf mysqld_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz -C /opt/module/
</span></span><span style="display:flex;"><span>mv /opt/module/mysqld_exporter-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64 /opt/module/mysqld_exporter
</span></span></code></pre></td></tr></table>
</div>
</div><p>3ã€é…ç½®ï¼Œåˆ›å»ºmy.confé…ç½®æ–‡ä»¶</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>[client]
</span></span><span style="display:flex;"><span>host=[hostName]
</span></span><span style="display:flex;"><span>port=[port]
</span></span><span style="display:flex;"><span>user=[monitorUser]
</span></span><span style="display:flex;"><span>password=[monitorPassword]
</span></span></code></pre></td></tr></table>
</div>
</div><p>4ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Œæˆ–è€…ç›´æ¥å¯åŠ¨</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nohup /opt/module/mysqld_exporter/mysqld_exporter --web.listen-address<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;:9104&#34;</span> --config.my-cnf<span style="color:#000;font-weight:bold">=</span>/opt/module/mysqld_exporter/my.conf &amp;
</span></span></code></pre></td></tr></table>
</div>
</div><p>5ã€é…ç½®Prometheus Serverï¼Œä¿®æ”¹prometheus.yml</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">scrape_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">job_name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;mysqld_exporter&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">static_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#d14">&#34;targetHostName:9104&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>6ã€é‡å¯Prometheus Serverï¼ŒæŸ¥çœ‹http://prometheus_server:9090,ä¸‹status/targets</p>
<h3 id="å®‰è£…-pushgatewayé€‰æ‹©æ€§å®‰è£…">å®‰è£… Pushgatewayï¼ˆé€‰æ‹©æ€§å®‰è£…ï¼‰</h3>
<p>Prometheusåœ¨æ­£å¸¸æƒ…å†µä¸‹æ˜¯é‡‡ç”¨æ‹‰æ¨¡å¼ä»exporterï¼ˆæ¯”å¦‚ä¸“é—¨ç›‘æ§ä¸»æœºçš„NodeExporterï¼‰æ‹‰å–ç›‘æ§æ•°æ®ï¼Œä½†å½“é‡åˆ°å®šæ—¶æ€§ä»»åŠ¡ï¼Œæˆ–è€…ç½‘ç»œä¸åœ¨åŒä¸€ç½‘æ®µä¸Šæ—¶éœ€è¦é‡‡ç”¨Pushgatewayã€‚å°†éœ€è¦ç›‘æ§çš„æ•°æ®ä¸Šä¼ åˆ°Pushgatewayï¼Œä¹‹åå†ç”±Prometheus Serveræ‹‰å–æ•°æ®ã€‚</p>
<p>1ã€ä»[å®˜ç½‘åœ°å€][https://prometheus.io/]ä¸‹è½½å®‰è£…åŒ…åˆ°éœ€è¦ç›‘æ§çš„ä¸»æœº</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/prometheus/pushgateway/releases/download/<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>/pushgateway-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz
</span></span></code></pre></td></tr></table>
</div>
</div><p>2ã€è§£å‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tar -zxvf pushgateway-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64.tar.gz -C /opt/module/
</span></span><span style="display:flex;"><span>mv /opt/module/pushgateway-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>.linux-amd64 /opt/module/pushgateway
</span></span></code></pre></td></tr></table>
</div>
</div><p>3ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Œæˆ–è€…ç›´æ¥å¯åŠ¨</p>
<ul>
<li>æ·»åŠ ç³»ç»ŸæœåŠ¡</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/systemd/system/pushgateway.service
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=pushgateway
</span></span><span style="display:flex;"><span>After=network.target 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>User=root
</span></span><span style="display:flex;"><span>Group=root
</span></span><span style="display:flex;"><span>ExecStart=/opt/module/pushgateway/pushgateway\
</span></span><span style="display:flex;"><span>          --web.listen-address=:9091
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯åŠ¨æœåŠ¡</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl <span style="color:#0086b3">enable</span> pushgateway
</span></span><span style="display:flex;"><span>systemctl start pushgateway
</span></span><span style="display:flex;"><span>systemctl status pushgateway
</span></span></code></pre></td></tr></table>
</div>
</div><p>4ã€é…ç½®Prometheus Serverï¼Œä¿®æ”¹prometheus.yml</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">scrape_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">job_name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;pushgateway&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">honor_labels</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">#åŠ ä¸Šæ­¤é…ç½®exporterèŠ‚ç‚¹ä¸Šä¼ æ•°æ®ä¸­çš„ä¸€äº›æ ‡ç­¾å°†ä¸ä¼šè¢«pushgatewayèŠ‚ç‚¹çš„ç›¸åŒæ ‡ç­¾è¦†ç›–</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">static_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#d14">&#34;hostName:9091&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>5ã€é‡å¯Prometheus Serverï¼ŒæŸ¥çœ‹http://prometheus_server:9090ï¼Œä¸‹status/targets</p>
<h3 id="alertmanageræ¨¡å—">Alertmanageræ¨¡å—</h3>
<p>å®‰è£…ååˆ†ç®€å•ï¼Œä½†æ˜¯æ²¡æœ‰å¯è§†åŒ–ç•Œé¢æä¾›å®æ—¶ç¼–è¾‘ï¼Œçµæ´»è¯»è¾ƒä½ï¼Œç¼–å†™è¾ƒä¸ºéº»çƒ¦ï¼Œå¯ä½¿ç”¨Grafanaçš„æŠ¥è­¦</p>
<h2 id="å››promqlä½¿ç”¨">å››ã€PromQLä½¿ç”¨</h2>
<p>Prometheusé€šè¿‡æŒ‡æ ‡åç§°ï¼ˆmetrics nameï¼‰ä»¥åŠå¯¹åº”çš„ä¸€ç»„æ ‡ç­¾ï¼ˆlabel setï¼‰å”¯ä¸€å®šä¹‰ä¸€æ¡æ—¶é—´åºåˆ—ã€‚æŒ‡æ ‡åç§°åæ˜ äº†ç›‘æ§æ ·æœ¬çš„åŸºæœ¬æ ‡è¯†ï¼Œè€Œlabelåˆ™åœ¨è¿™ä¸ªåŸºæœ¬ç‰¹å¾ä¸Šä¸ºé‡‡é›†åˆ°çš„æ•°æ®æä¾›äº†å¤šç§ç‰¹å¾ç»´åº¦ã€‚ç”¨æˆ·å¯ä»¥åŸºäºè¿™äº›ç‰¹å¾ç»´åº¦<span style="color:red">è¿‡æ»¤ï¼Œèšåˆï¼Œç»Ÿè®¡</span>ä»è€Œäº§ç”Ÿæ–°çš„è®¡ç®—åçš„ä¸€æ¡æ—¶é—´åºåˆ—ã€‚PromQLæ˜¯Prometheuså†…ç½®çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå…¶æä¾›å¯¹æ—¶é—´åºåˆ—æ•°æ®ä¸°å¯Œçš„æŸ¥è¯¢ï¼Œèšåˆä»¥åŠé€»è¾‘è¿ç®—èƒ½åŠ›çš„æ”¯æŒã€‚å¹¶ä¸”è¢«å¹¿æ³›åº”ç”¨åœ¨Prometheusçš„æ—¥å¸¸åº”ç”¨å½“ä¸­ï¼ŒåŒ…æ‹¬å¯¹æ•°æ®æŸ¥è¯¢ã€å¯è§†åŒ–ã€å‘Šè­¦å¤„ç†å½“ä¸­ã€‚</p>
<h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h3>
<ul>
<li>æŸ¥è¯¢æ—¶é—´åºåˆ—[æ¯ä¸ªæ—¶é—´åºåˆ—åŒ…å«å•ä¸ªæ ·æœ¬ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„æ—¶é—´æˆ³ã€‚å³è¿”å›å€¼åªä¼šåŒ…å«è¯¥æ—¶é—´åºåˆ—ä¸­çš„æœ€æ–°çš„ä¸€ä¸ªæ ·æœ¬å€¼]</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promql" data-lang="promql"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥è¯¢mysqlé“¾æ¥è¶…æ—¶æ—¶é•¿ï¼Œæ­¤æŒ‡æ ‡åªéœ€è¦æŸ¥è¯¢å½“å‰çŠ¶æ€ï¼Œæ—¶é—´æ®µå†…çš„æ˜¯æ²¡æœ‰æ„ä¹‰çš„</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">mysql_global_variables_connect_timeout</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">mysql_global_variables_connect_timeout</span>{}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿‡æ»¤æ ‡ç­¾çš„åŒ¹é…æ¨¡å¼</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promql" data-lang="promql"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ç­‰å€¼æŸ¥è¯¢</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">mysql_global_variables_connect_timeout</span>{<span style="color:#900;font-weight:bold">instance</span><span style="color:#000;font-weight:bold">=</span>&#34;<span style="color:#d14">centos161:9104</span>&#34;}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ä¸ç­‰å€¼æŸ¥è¯¢</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">mysql_global_variables_connect_timeout</span>{<span style="color:#900;font-weight:bold">instance</span><span style="color:#000;font-weight:bold">!=</span>&#34;<span style="color:#d14">centos161:9104</span>&#34;}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">mysql_global_variables_connect_timeout</span>{<span style="color:#900;font-weight:bold">instance</span><span style="color:#000;font-weight:bold">=~</span>&#34;<span style="color:#d14">.*:9104</span>&#34;}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>èŒƒå›´æŸ¥è¯¢ï¼Œä¸€æ®µæ—¶é—´åºåˆ—çš„é›†åˆ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promql" data-lang="promql"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥è¯¢5minå†…çš„æ‰€æœ‰IOè®¾å¤‡çš„å–æ ·</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">node_disk_io_now</span>[<span style="color:#d14">5m</span>]<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ—¶é—´ä½ç§»æ“ä½œ</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promql" data-lang="promql"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ä¾‹å¦‚å½“å‰æ˜¯12ç‚¹ï¼Œæ­¤æŸ¥è¯¢æŸ¥è¯¢çš„æ˜¯11:50-11:55çš„æ•°æ®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008080">node_disk_io_now</span>[<span style="color:#d14">5m</span>]<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">offset</span><span style="color:#bbb"> </span><span style="color:#d14">5m</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>èšåˆæ“ä½œ</li>
</ul>
<p>æ”¯æŒsumï¼ˆæ±‚å’Œï¼‰ã€minï¼ˆæœ€å°å€¼ï¼‰ã€maxï¼ˆæœ€å¤§å€¼ï¼‰ã€avgï¼ˆå¹³å‡å€¼ï¼‰ã€stddevï¼ˆæ ‡å‡†å·®ï¼‰ã€stdvarï¼ˆæ ‡å‡†å·®å¼‚ï¼‰ã€countï¼ˆè®¡æ•°ï¼‰ã€count_valuesï¼ˆå¯¹valueè¿›è¡Œè®¡æ•°ï¼‰ã€bottomkï¼ˆånæ¡æ—¶åºï¼‰ã€topkï¼ˆå‰næ¡æ—¶åºï¼‰ã€quantileï¼ˆåˆ†å¸ƒç»Ÿè®¡ï¼‰</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promql" data-lang="promql"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æŸ¥è¯¢ç³»ç»Ÿæ‰€æœ‰ http è¯·æ±‚çš„æ€»é‡</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#008080">prometheus_http_requests_total</span><span style="color:#000;font-weight:bold">)</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># æŒ‰ç…§ mode è®¡ç®—ä¸»æœº CPU çš„å¹³å‡ä½¿ç”¨æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">avg</span><span style="color:#000;font-weight:bold">(</span><span style="color:#008080">node_cpu_seconds_total</span><span style="color:#000;font-weight:bold">)</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">(</span><span style="color:#008080">mode</span><span style="color:#000;font-weight:bold">)</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ“ä½œç¬¦">æ“ä½œç¬¦</h3>
<p>PromQLæ”¯æŒçš„æ‰€æœ‰æ•°å­¦è¿ç®—ç¬¦ï¼š+ï¼ˆåŠ æ³•ï¼‰ã€-ï¼ˆå‡æ³•ï¼‰ã€*ï¼ˆä¹˜æ³•ï¼‰ã€/ï¼ˆé™¤æ³•ï¼‰ã€%ï¼ˆæ±‚ä½™ï¼‰ã€^ï¼ˆå¹‚è¿ç®—ï¼‰</p>
<p>PromQLæ”¯æŒçš„æ‰€æœ‰å¸ƒå°”è¿ç®—ç¬¦ï¼š=ï¼ˆç›¸ç­‰ï¼‰ã€!=ï¼ˆä¸ç›¸ç­‰ï¼‰ã€&gt;ï¼ˆå¤§äºï¼‰ã€&lt;ï¼ˆå°äºï¼‰ã€&gt;=ï¼ˆå¤§äºç­‰äºï¼‰ã€&lt;=ï¼ˆå°äºç­‰äºï¼‰</p>
<p>PromQLæ”¯æŒçš„é›†åˆè¿ç®—ç¬¦ï¼šandï¼ˆå¹¶ä¸”ï¼‰ã€orï¼ˆæˆ–è€…ï¼‰ã€unlessï¼ˆæ’é™¤ï¼‰</p>
<h2 id="äº”è‡ªå®šä¹‰ä¸Šä¼ ç›‘æ§æŒ‡æ ‡">äº”ã€è‡ªå®šä¹‰ä¸Šä¼ ç›‘æ§æŒ‡æ ‡</h2>
<h3 id="exportmetriceæ–¹å¼">Export/metriceæ–¹å¼</h3>
<p>å¯ä½¿ç”¨<code>Micrometer</code>å’Œ<code>Prometheus Java Simpleclient</code>ä¸Šä¼ ç›‘æ§æŒ‡æ ‡ï¼ŒSpring Booté›†æˆäº†<code>Micrometer</code></p>
<ul>
<li><code>Micrometer</code>å¯å¯¹æ¥å¤šç§ç›‘æ§ç³»ç»Ÿï¼Œå¦‚æœä¸å†ä½¿ç”¨Prometheusä¹Ÿå¯ç›´æ¥åˆ‡æ¢æœªåˆ«çš„ç›‘æ§ç³»ç»Ÿï¼Œæ˜¯é€šç”¨å‹ç»„ä»¶</li>
<li><code>Prometheus Java Simpleclient</code>æ˜¯Prometheusçš„Javaå®¢æˆ·ç«¯ï¼Œç”¨äºä¸Šä¼ æ•°æ®</li>
</ul>
<p>å¦‚ä¸‹ä»¥<code>Spring Micrometer</code>ä¸ºä¾‹</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootTest</span>(webEnvironment<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>SpringBootTest.<span style="color:#008080">WebEnvironment</span>.<span style="color:#008080">DEFINED_PORT</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PrometheusMetricApplicationTests</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Autowired</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">private</span><span style="color:#bbb"> </span>MeterRegistry<span style="color:#bbb"> </span>registry;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * ç”¨äºç»Ÿè®¡æ¬¡æ•°ï¼Œä¾‹å¦‚MQæ¶ˆè´¹å¤±è´¥æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Counteræ¥å£å…è®¸ä»¥å›ºå®šçš„æ•°å€¼é€’å¢ï¼Œè¯¥æ•°å€¼å¿…é¡»ä¸ºæ­£æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">countersTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// å†™å…¥å®ä¾‹åç§°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Tag<span style="color:#bbb"> </span>instanceTag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Tag.<span style="color:#008080">of</span>(<span style="color:#d14">&#34;instance&#34;</span>,<span style="color:#bbb"> </span>InetAddress.<span style="color:#008080">getLocalHost</span>().<span style="color:#008080">getHostName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æ¶ˆè´¹è€…ç»„åç§°</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Tag<span style="color:#bbb"> </span>groupNameTag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Tag.<span style="color:#008080">of</span>(<span style="color:#d14">&#34;groupName&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;publishGoodsStateChange&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// é”™è¯¯ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Tag<span style="color:#bbb"> </span>errorMsgTag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Tag.<span style="color:#008080">of</span>(<span style="color:#d14">&#34;errorMsg&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;error: error msg is long long text&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// description ç›¸å½“äº HELPä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Counter.<span style="color:#008080">builder</span>(<span style="color:#d14">&#34;c2c_consume_exception&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">description</span>(<span style="color:#d14">&#34;ç»Ÿè®¡å¤±è´¥ä¸ªæ•°ã€‚ã€‚ã€‚&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">tags</span>(Lists.<span style="color:#008080">list</span>(instanceTag,<span style="color:#bbb"> </span>groupNameTag,<span style="color:#bbb"> </span>errorMsgTag))<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">register</span>(registry)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">increment</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(10<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Gaugeæ˜¯è·å–å½“å‰å€¼çš„å¥æŸ„ã€‚å…¸å‹çš„ä¾‹å­æ˜¯ï¼Œè·å–é›†åˆã€mapã€æˆ–è¿è¡Œä¸­çš„çº¿ç¨‹æ•°ç­‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">gaugesTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb"> </span>monitorCollect<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>monitorCollect.<span style="color:#008080">add</span>(1);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>monitorCollect.<span style="color:#008080">add</span>(2);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>monitorCollect.<span style="color:#008080">add</span>(3);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>monitorCollect.<span style="color:#008080">add</span>(4);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Gauge.<span style="color:#008080">builder</span>(<span style="color:#d14">&#34;monitor_collect_size&#34;</span>,<span style="color:#bbb"> </span>monitorCollect,<span style="color:#bbb"> </span>List::size)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">description</span>(<span style="color:#d14">&#34;ç›‘æ§æŸçº¿ç¨‹ã€é›†åˆçš„å¤§å°&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">register</span>(registry);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(10<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>monitorCollect.<span style="color:#008080">add</span>(5);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(10<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Timersï¼ˆè®¡æ—¶å™¨ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * Timerç”¨äºæµ‹é‡çŸ­æ—¶é—´å»¶è¿Ÿå’Œæ­¤ç±»äº‹ä»¶çš„é¢‘ç‡ã€‚æ‰€æœ‰Timerå®ç°è‡³å°‘å°†æ€»æ—¶é—´å’Œäº‹ä»¶æ¬¡æ•°æŠ¥å‘Šä¸ºå•ç‹¬çš„æ—¶é—´åºåˆ—ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">timersTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®°å½•æ‰§è¡Œå¼€å§‹æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Instant<span style="color:#bbb"> </span>startInstant<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Instant.<span style="color:#008080">now</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// åˆ‡é¢ï¼Œæ‰§è¡Œç¨‹åº</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(5<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// æ‰§è¡Œç»“æŸæ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Instant<span style="color:#bbb"> </span>endInstant<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>Instant.<span style="color:#008080">now</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Timer.<span style="color:#008080">builder</span>(<span style="color:#d14">&#34;c2c_publish_goods_task&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">description</span>(<span style="color:#d14">&#34;è®°å½•æ‰§è¡Œæ—¶é—´&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">register</span>(registry)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">record</span>(Duration.<span style="color:#008080">between</span>(startInstant,<span style="color:#bbb"> </span>endInstant));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(100<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * ä»»åŠ¡è®¡æ—¶å™¨ç”¨äºè·Ÿè¸ªæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„é•¿æ—¶é—´è¿è¡Œä»»åŠ¡çš„æ€»æŒç»­æ—¶é—´å’Œæ­¤ç±»ä»»åŠ¡çš„æ•°é‡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">longTaskTimers</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic">// è®°å½•æ‰§è¡Œå¼€å§‹æ—¶é—´</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>LongTaskTimer.<span style="color:#008080">builder</span>(<span style="color:#d14">&#34;b2c_publish_goods_task&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">description</span>(<span style="color:#d14">&#34;è®°å½•æ‰§è¡Œæ—¶é—´&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">register</span>(registry)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">record</span>(()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>Thread.<span style="color:#008080">sleep</span>(5000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">catch</span><span style="color:#bbb"> </span>(InterruptedException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>e.<span style="color:#008080">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>});<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(100<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *  Distribution summariesï¼ˆåˆ†å¸ƒæ±‡æ€»ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *  ç”¨äºè·Ÿè¸ªåˆ†å¸ƒå¼çš„äº‹ä»¶ã€‚å®ƒåœ¨ç»“æ„ä¸Šç±»ä¼¼äºè®¡æ—¶å™¨ï¼Œä½†æ˜¯è®°å½•çš„å€¼ä¸ä»£è¡¨æ—¶é—´å•ä½ã€‚ä¾‹å¦‚ï¼Œè®°å½•httpæœåŠ¡å™¨ä¸Šçš„è¯·æ±‚çš„å“åº”å¤§å°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *  å¯ä»¥ç”¨ç™¾åˆ†æ¯”ç›´æ–¹å›¾ã€å®¢æˆ·ç«¯ç™¾åˆ†æ¯”
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#3c5d5d;font-weight:bold">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">distributionSummariesTest</span>()<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">throws</span><span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>DistributionSummary<span style="color:#bbb"> </span>uploadFileSize<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>DistributionSummary.<span style="color:#008080">builder</span>(<span style="color:#d14">&#34;upload_file_size&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">distributionStatisticExpiry</span>(Duration.<span style="color:#008080">of</span>(10,<span style="color:#bbb"> </span>ChronoUnit.<span style="color:#008080">SECONDS</span>))<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>.<span style="color:#008080">register</span>(registry);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>uploadFileSize.<span style="color:#008080">record</span>(30);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>uploadFileSize.<span style="color:#008080">record</span>(30);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>uploadFileSize.<span style="color:#008080">record</span>(40);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Thread.<span style="color:#008080">sleep</span>(100<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span>1000L);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>application.propertiesé…ç½®</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring.application.name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">kun_application</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.endpoints.web.exposure.include</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">*</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.tags.application</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${spring.application.name}</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.enabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¢å¤–è¡¥å……ï¼šHistograms and percentilesï¼ˆç›´æ–¹å›¾å’Œç™¾åˆ†æ¯”ï¼‰</p>
<p>Timers å’Œ distribution summaries æ”¯æŒæ”¶é›†æ•°æ®æ¥è§‚å¯Ÿå®ƒä»¬çš„ç™¾åˆ†æ¯”ã€‚æŸ¥çœ‹ç™¾åˆ†æ¯”æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š</p>
<p><strong>Percentile histogramsï¼ˆç™¾åˆ†æ¯”ç›´æ–¹å›¾ï¼‰</strong>ï¼š Micrometerå°†å€¼ç´¯ç§¯åˆ°åº•å±‚ç›´æ–¹å›¾ï¼Œå¹¶å°†ä¸€ç»„é¢„å…ˆç¡®å®šçš„bucketså‘é€åˆ°ç›‘æ§ç³»ç»Ÿã€‚ç›‘æ§ç³»ç»Ÿçš„æŸ¥è¯¢è¯­è¨€è´Ÿè´£ä»è¿™ä¸ªç›´æ–¹å›¾ä¸­è®¡ç®—ç™¾åˆ†æ¯”ã€‚ç›®å‰ï¼Œåªæœ‰Prometheus , Atlas , Wavefrontæ”¯æŒåŸºäºç›´æ–¹å›¾çš„ç™¾åˆ†ä½æ•°è¿‘ä¼¼å€¼ï¼Œå¹¶ä¸”é€šè¿‡histogram_quantile , :percentile , hs()ä¾æ¬¡è¡¨ç¤ºã€‚</p>
<p><strong>Client-side percentilesï¼ˆå®¢æˆ·ç«¯ç™¾åˆ†æ¯”ï¼‰</strong>ï¼šMicrometerä¸ºæ¯ä¸ªmeter IDï¼ˆä¸€ç»„nameå’Œtagï¼‰è®¡ç®—ç™¾åˆ†ä½æ•°è¿‘ä¼¼å€¼ï¼Œå¹¶å°†ç™¾åˆ†ä½æ•°å€¼å‘é€åˆ°ç›‘æ§ç³»ç»Ÿã€‚</p>
<p>é…ç½®Prometheusä¸Spring Bootç¨‹åºå¯¹æ¥ï¼Œéœ€è¦é…ç½®Prometheus Serverï¼Œä¿®æ”¹prometheus.yml</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">scrape_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">job_name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;jobName-application&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">metrics_path</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;/actuator/prometheus&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">static_configs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#000080">targets</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#d14">&#34;targetHostaName:prot&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æœåŠ¡å‘ç°èƒ½åŠ›é›†æˆ</p>
<h3 id="pushgatewayæ–¹å¼">Pushgatewayæ–¹å¼</h3>
<p>åªéœ€è¦æ”¹å˜application.propertiesé…ç½®å’Œå¼•å…¥ä¾èµ–</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring.application.name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">kun_application</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.endpoints.web.exposure.include</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">*</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.tags.application</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${spring.application.name}</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.enabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.pushgateway.enabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.pushgateway.base-url</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">192.168.22.161:9091</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.pushgateway.job</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${spring.application.name}-job</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.pushgateway.push-rate</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">15s</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management.metrics.export.prometheus.pushgateway.base-url</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">http://PushgatewayHost:Prot</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;groupId&gt;</span>io.prometheus<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;artifactId&gt;</span>simpleclient_pushgateway<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;version&gt;</span>[version]<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­grafanaå®‰è£…ä¸é›†æˆprometheus">å…­ã€Grafanaå®‰è£…ä¸é›†æˆPrometheus</h2>
<p>Grafanaæ˜¯ä¸€æ¬¾é‡‡ç”¨Goè¯­è¨€ç¼–å†™çš„å¼€æºåº”ç”¨ï¼Œä¸»è¦ç”¨äºå¤§è§„æ¨¡æŒ‡æ ‡æ•°æ®çš„å¯è§†åŒ–å±•ç°ï¼Œæ˜¯ç½‘ç»œæ¶æ„å’Œåº”ç”¨åˆ†æä¸­æœ€æµè¡Œçš„<strong>æ—¶åºæ•°æ®å±•ç¤º</strong>å·¥å…·ï¼Œç›®å‰å·²ç»æ”¯æŒç»å¤§éƒ¨åˆ†å¸¸ç”¨çš„æ—¶åºæ•°æ®åº“ã€‚</p>
<h3 id="ä¸‹è½½å®‰è£…å¯åŠ¨">ä¸‹è½½ã€å®‰è£…ã€å¯åŠ¨</h3>
<ul>
<li>ä¸‹è½½ã€å®‰è£…</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://dl.grafana.com/oss/release/grafana-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>-1.x86_64.rpm
</span></span><span style="display:flex;"><span>sudo yum install grafana-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>-1.x86_64.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æŸ¥çœ‹å®‰è£…ç›®å½•</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rpm -qa | grep -i grafana
</span></span><span style="display:flex;"><span>rpm -ql grafana-<span style="color:#000;font-weight:bold">[</span>version<span style="color:#000;font-weight:bold">]</span>-1.x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯åŠ¨</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl start grafana-server 
</span></span><span style="display:flex;"><span>systemctl status grafana-server
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æŸ¥çœ‹ï¼Œè®¿é—®http://[hostname]:3000é»˜è®¤ç”¨æˆ·åadminã€å¯†ç admin</li>
</ul>
<h3 id="é›†æˆ">é›†æˆ</h3>
<p>ç‚¹å‡»Setting &raquo; Configuration &raquo; Data Sources &raquo; Add data Sourceã€é€‰æ‹©Prometheusï¼Œå¹¶å¡«å†™ç›¸å…³ä¿¡æ¯ã€‘</p>
<h3 id="grafanaçš„ä½¿ç”¨">Grafanaçš„ä½¿ç”¨</h3>
<p><strong>è‡ªå®šä¹‰Panel</strong></p>
<p>æ·»åŠ PromQLå³å¯</p>
<blockquote>
<p>Rowæ˜¯Panelçš„é›†åˆï¼Œå³ç”±å¤šä¸ªPannelç»„æˆä¸€ä¸ªç•Œé¢</p>
</blockquote>
<hr>
<p><strong>æ‹‰å–å…¬å…±Dashboard</strong></p>
<p>è®¿é—®<a href="https://grafana.com/grafana/dashboards/">grafana-dashboards</a>ï¼Œä¸‹è½½jsonæˆ–Copy IDæ–‡ä»¶ï¼Œä½¿ç”¨Create &raquo; Importã€ä¸Šä¼ Jsonæ–‡ä»¶æˆ–ç²˜è´´IDã€‘</p>
<h2 id="ä¸ƒgrafanaè‡ªå®šä¹‰æŠ¥è­¦">ä¸ƒã€Grafanaè‡ªå®šä¹‰æŠ¥è­¦</h2>
<p>ä½¿ç”¨webhookæ¨¡å¼å¯ä»¥è‡ªå®šä¹‰ä»»ä½•æŠ¥è­¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æœ€åŸºç¡€çš„é‚®ä»¶æŠ¥è­¦æœºåˆ¶</p>
<p>ç‚¹å‡»Alert &raquo; contact points &raquo; New contact point &raquo; æ·»åŠ ä¸€ä¸ªwebhook</p>
<p>ç¼–å†™webhookä»£ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ç®€ä¾¿çš„ç¬¬ä¸‰æ–¹äº‘å¹³å°</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PrometheusWebHook</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#3c5d5d;font-weight:bold">@PostMapping</span>(<span style="color:#d14">&#34;/prometheus/webhook&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#458;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#900;font-weight:bold">doAlert</span>(<span style="color:#3c5d5d;font-weight:bold">@RequestBody</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>body)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>System.<span style="color:#008080">out</span>.<span style="color:#008080">println</span>(body);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ°æ­¤webhookè®¾ç½®å®Œæˆï¼Œç„¶åå¯¹éœ€è¦è®¾ç½®çš„ç›‘æ§æŒ‡æ ‡ï¼Œè®¾ç½®æŠ¥è­¦é˜ˆå€¼å³å¯</p>

    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41092802000242">
            

        </a>

        
        <a href="//beian.miit.gov.cn" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">ğŸ•Šï¸</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.49); 
                backdrop-filter: saturate(100%) blur(6px);
            
            "></div>
    </body>
</html>
